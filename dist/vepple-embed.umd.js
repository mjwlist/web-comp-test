(function(Ie){typeof define=="function"&&define.amd?define(Ie):Ie()})(function(){"use strict";function Ie(){}function Uo(e){return e&&typeof e=="object"&&typeof e.then=="function"}function Vi(e){return e()}function Wn(){return Object.create(null)}function Dr(e){e.forEach(Vi)}function Vn(e){return typeof e=="function"}function Yi(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let _i;function qo(e,t){return _i||(_i=document.createElement("a")),_i.href=t,e===_i.href}function Wo(e){return Object.keys(e).length===0}function Hr(e,t){e.appendChild(t)}function dt(e,t,r){e.insertBefore(t,r||null)}function Pt(e){e.parentNode.removeChild(e)}function At(e){return document.createElement(e)}function Kr(e){return document.createTextNode(e)}function Yn(){return Kr(" ")}function Vo(){return Kr("")}function Xt(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function Yo(e){return Array.from(e.childNodes)}function Xi(e,t,r,i){r===null?e.style.removeProperty(t):e.style.setProperty(t,r,i?"important":"")}function Gi(e){const t={};for(const r of e)t[r.name]=r.value;return t}let Qr;function Gt(e){Qr=e}function Xn(){if(!Qr)throw new Error("Function called outside component initialization");return Qr}function Gn(e){Xn().$$.on_mount.push(e)}const Jr=[],yi=[],gi=[],jn=[],Xo=Promise.resolve();let ji=!1;function Go(){ji||(ji=!0,Xo.then(Dt))}function Zi(e){gi.push(e)}const Ki=new Set;let wi=0;function Dt(){const e=Qr;do{for(;wi<Jr.length;){const t=Jr[wi];wi++,Gt(t),jo(t.$$)}for(Gt(null),Jr.length=0,wi=0;yi.length;)yi.pop()();for(let t=0;t<gi.length;t+=1){const r=gi[t];Ki.has(r)||(Ki.add(r),r())}gi.length=0}while(Jr.length);for(;jn.length;)jn.pop()();ji=!1,Ki.clear(),Gt(e)}function jo(e){if(e.fragment!==null){e.update(),Dr(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Zi)}}const Mi=new Set;let Mr;function Zo(){Mr={r:0,c:[],p:Mr}}function Ko(){Mr.r||Dr(Mr.c),Mr=Mr.p}function Zn(e,t){e&&e.i&&(Mi.delete(e),e.i(t))}function Qo(e,t,r,i){if(e&&e.o){if(Mi.has(e))return;Mi.add(e),Mr.c.push(()=>{Mi.delete(e),i&&(r&&e.d(1),i())}),e.o(t)}}function Kn(e,t){const r=t.token={};function i(n,s,o,a){if(t.token!==r)return;t.resolved=a;let l=t.ctx;o!==void 0&&(l=l.slice(),l[o]=a);const c=n&&(t.current=n)(l);let f=!1;t.block&&(t.blocks?t.blocks.forEach((_,m)=>{m!==s&&_&&(Zo(),Qo(_,1,1,()=>{t.blocks[m]===_&&(t.blocks[m]=null)}),Ko())}):t.block.d(1),c.c(),Zn(c,1),c.m(t.mount(),t.anchor),f=!0),t.block=c,t.blocks&&(t.blocks[s]=c),f&&Dt()}if(Uo(e)){const n=Xn();if(e.then(s=>{Gt(n),i(t.then,1,t.value,s),Gt(null)},s=>{if(Gt(n),i(t.catch,2,t.error,s),Gt(null),!t.hasCatch)throw s}),t.current!==t.pending)return i(t.pending,0),!0}else{if(t.current!==t.then)return i(t.then,1,t.value,e),!0;t.resolved=e}}function Qn(e,t,r){const i=t.slice(),{resolved:n}=e;e.current===e.then&&(i[e.value]=n),e.current===e.catch&&(i[e.error]=n),e.block.p(i,r)}function Jo(e,t,r,i){const{fragment:n,on_mount:s,on_destroy:o,after_update:a}=e.$$;n&&n.m(t,r),i||Zi(()=>{const l=s.map(Vi).filter(Vn);o?o.push(...l):Dr(l),e.$$.on_mount=[]}),a.forEach(Zi)}function eh(e,t){const r=e.$$;r.fragment!==null&&(Dr(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function th(e,t){e.$$.dirty[0]===-1&&(Jr.push(e),Go(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Qi(e,t,r,i,n,s,o,a=[-1]){const l=Qr;Gt(e);const c=e.$$={fragment:null,ctx:null,props:s,update:Ie,not_equal:n,bound:Wn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Wn(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};o&&o(c.root);let f=!1;if(c.ctx=r?r(e,t.props||{},(_,m,...v)=>{const h=v.length?v[0]:m;return c.ctx&&n(c.ctx[_],c.ctx[_]=h)&&(!c.skip_bound&&c.bound[_]&&c.bound[_](h),f&&th(e,_)),m}):[],c.update(),f=!0,Dr(c.before_update),c.fragment=i?i(c.ctx):!1,t.target){if(t.hydrate){const _=Yo(t.target);c.fragment&&c.fragment.l(_),_.forEach(Pt)}else c.fragment&&c.fragment.c();t.intro&&Zn(e.$$.fragment),Jo(e,t.target,t.anchor,t.customElement),Dt()}Gt(l)}let xi;typeof HTMLElement=="function"&&(xi=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(Vi).filter(Vn);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(e,t,r){this[e]=r}disconnectedCallback(){Dr(this.$$.on_disconnect)}$destroy(){eh(this,1),this.$destroy=Ie}$on(e,t){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const i=r.indexOf(t);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Wo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});var Ji=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function rh(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),t}function Nr(){}Nr.prototype.addEventListener=function(e,t){var r=this.__events=this.__events||{},i=r[e]=r[e]||[];i.indexOf(t)<0&&i.push(t)},Nr.prototype.removeEventListener=function(e,t){var r=this.__events=this.__events||{},i=r[e];if(i){var n=i.indexOf(t);n>=0&&i.splice(n,1)}},Nr.prototype.emit=function(e,t){var r=this.__events=this.__events||{},i=r[e],n=Array.prototype.slice.call(arguments,1);if(i)for(var s=0;s<i.length;s++){var o=i[s];o.apply(this,n)}};function ih(e){for(var t in Nr.prototype)Nr.prototype.hasOwnProperty(t)&&(e.prototype[t]=Nr.prototype[t])}var ze=ih;function nh(){return typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return Date.now()}}var xr=nh(),Jn=xr;function ah(e,t){this.fn=e,this.cb=t,this.cfn=null}function jt(e){this._queue=[],this._delay=e&&e.delay||0,this._paused=e&&!!e.paused||!1,this._currentTask=null,this._lastFinished=null}jt.prototype.length=function(){return this._queue.length},jt.prototype.push=function(e,t){var r=new ah(e,t),i=this._cancel.bind(this,r);return this._queue.push(r),this._next(),i},jt.prototype.pause=function(){this._paused||(this._paused=!0)},jt.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},jt.prototype._start=function(e){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=e;var t=this._finish.bind(this,e);if(e.cfn=e.fn(t),typeof e.cfn!="function")throw new Error("WorkQueue: function is not cancellable")},jt.prototype._finish=function(e){var t=Array.prototype.slice.call(arguments,1);if(this._currentTask!==e)throw new Error("WorkQueue: called finish on wrong task");e.cb.apply(null,t),this._currentTask=null,this._lastFinished=Jn(),this._next()},jt.prototype._cancel=function(e){var t=Array.prototype.slice.call(arguments,1);if(this._currentTask===e)e.cfn.apply(null,t);else{var r=this._queue.indexOf(e);r>=0&&(this._queue.splice(r,1),e.cb.apply(null,t))}},jt.prototype._next=function(){if(!this._paused&&!!this._queue.length&&!this._currentTask){if(this._lastFinished!=null){var e=Jn()-this._lastFinished,t=this._delay-e;if(t>0){setTimeout(this._next.bind(this),t);return}}var r=this._queue.shift();this._start(r)}};var ea=jt;function sh(e,t,r,i){i=i||{};var n;r!=null&&r.absoluteWidth!=null?n=r.absoluteWidth/e:r!=null&&r.relativeWidth!=null?n=r.relativeWidth:n=1;var s;r&&r.absoluteHeight!=null?s=r.absoluteHeight/t:r!=null&&r.relativeHeight!=null?s=r.relativeHeight:s=1;var o;r!=null&&r.absoluteX!=null?o=r.absoluteX/e:r!=null&&r.relativeX!=null?o=r.relativeX:o=0;var a;return r!=null&&r.absoluteY!=null?a=r.absoluteY/t:r!=null&&r.relativeY!=null?a=r.relativeY:a=0,i.x=o,i.y=a,i.width=n,i.height=s,i}var ta=sh;function oh(e){return function(r){var i,n;try{n=e()}catch(s){i=s}finally{i?r(i):r(null,n)}}}var ra=oh;function hh(e){var t=!1,r;return function(){return t||(t=!0,r=e.apply(null,arguments)),r}}var en=hh,lh=en;function ch(e){return function(){if(!arguments.length)throw new Error("cancelized: expected at least one argument");var r=Array.prototype.slice.call(arguments,0),i=r[r.length-1]=lh(r[r.length-1]);function n(){i.apply(null,arguments)}return e.apply(null,r),n}}var ia=ch;function fh(e){for(var t in e)e.hasOwnProperty(t)&&(e[t]=void 0)}var Se=fh;function tn(){this._renderers={}}tn.prototype.set=function(e,t,r){this._renderers[e]||(this._renderers[e]={}),this._renderers[e][t]=r},tn.prototype.get=function(e,t){var r=this._renderers[e]&&this._renderers[e][t];return r||null};var uh=tn,vh=ze,dh=ea,ph=ta,mh=ra,_h=ia,yh=Se,gh=uh;function wh(e,t){return e.cmp(t)}function Mh(e,t){return-e.cmp(t)}function Ee(e){this._progressive=!!(e&&e.progressive),this._layers=[],this._renderers=[],this._tilesToLoad=[],this._tilesToRender=[],this._tmpVisible=[],this._tmpChildren=[],this._width=0,this._height=0,this._tmpRect={},this._tmpSize={},this._createTextureWorkQueue=new dh,this._emitRenderInvalid=this._emitRenderInvalid.bind(this),this._rendererRegistry=new gh}vh(Ee),Ee.prototype.destroy=function(){this.removeAllLayers(),yh(this)},Ee.prototype.registerRenderer=function(e,t,r){return this._rendererRegistry.set(e,t,r)},Ee.prototype.domElement=function(){throw new Error("Stage implementation must override domElement")},Ee.prototype.width=function(){return this._width},Ee.prototype.height=function(){return this._height},Ee.prototype.size=function(e){return e=e||{},e.width=this._width,e.height=this._height,e},Ee.prototype.setSize=function(e){this._width=e.width,this._height=e.height,this.setSizeForType(),this.emit("resize"),this._emitRenderInvalid()},Ee.prototype.setSizeForType=function(e){throw new Error("Stage implementation must override setSizeForType")},Ee.prototype.loadImage=function(){throw new Error("Stage implementation must override loadImage")},Ee.prototype._emitRenderInvalid=function(){this.emit("renderInvalid")},Ee.prototype.validateLayer=function(e){throw new Error("Stage implementation must override validateLayer")},Ee.prototype.listLayers=function(){return[].concat(this._layers)},Ee.prototype.hasLayer=function(e){return this._layers.indexOf(e)>=0},Ee.prototype.addLayer=function(e,t){if(this._layers.indexOf(e)>=0)throw new Error("Layer already in stage");if(t==null&&(t=this._layers.length),t<0||t>this._layers.length)throw new Error("Invalid layer position");this.validateLayer(e);var r=e.geometry().type,i=e.view().type,n=this._rendererRegistry.get(r,i);if(!n)throw new Error("No "+this.type+" renderer avaiable for "+r+" geometry and "+i+" view");var s=this.createRenderer(n);this._layers.splice(t,0,e),this._renderers.splice(t,0,s),e.addEventListener("viewChange",this._emitRenderInvalid),e.addEventListener("effectsChange",this._emitRenderInvalid),e.addEventListener("fixedLevelChange",this._emitRenderInvalid),e.addEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},Ee.prototype.moveLayer=function(e,t){var r=this._layers.indexOf(e);if(r<0)throw new Error("No such layer in stage");if(t<0||t>=this._layers.length)throw new Error("Invalid layer position");e=this._layers.splice(r,1)[0];var i=this._renderers.splice(r,1)[0];this._layers.splice(t,0,e),this._renderers.splice(t,0,i),this._emitRenderInvalid()},Ee.prototype.removeLayer=function(e){var t=this._layers.indexOf(e);if(t<0)throw new Error("No such layer in stage");var r=this._layers.splice(t,1)[0],i=this._renderers.splice(t,1)[0];this.destroyRenderer(i),r.removeEventListener("viewChange",this._emitRenderInvalid),r.removeEventListener("effectsChange",this._emitRenderInvalid),r.removeEventListener("fixedLevelChange",this._emitRenderInvalid),r.removeEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},Ee.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},Ee.prototype.startFrame=function(){throw new Error("Stage implementation must override startFrame")},Ee.prototype.endFrame=function(){throw new Error("Stage implementation must override endFrame")},Ee.prototype.render=function(){var e,t,r=this._tilesToLoad,i=this._tilesToRender,n=!0,s,o=this._width,a=this._height,l=this._tmpRect,c=this._tmpSize;if(!(o<=0||a<=0)){for(this.startFrame(),e=0;e<this._layers.length;e++)this._layers[e].textureStore().startFrame();for(e=0;e<this._layers.length;e++){var f=this._layers[e],_=f.effects(),m=f.view(),v=f.textureStore(),h=this._renderers[e],P=this._layers.length-e,w,b;if(ph(o,a,_&&_.rect,l),!(l.width<=0||l.height<=0)){for(c.width=l.width*this._width,c.height=l.height*this._height,m.setSize(c),h.startLayer(f,l),s=this._collectTiles(f,v),t=0;t<r.length;t++)w=r[t],v.markTile(w);for(t=0;t<i.length;t++)w=i[t],b=v.texture(w),h.renderTile(w,b,f,P);f.emit("renderComplete",s),s||(n=!1),h.endLayer(f,l)}}for(e=0;e<this._layers.length;e++)this._layers[e].textureStore().endFrame();this.endFrame(),this.emit("renderComplete",n)}},Ee.prototype._collectTiles=function(e,t){var r=this._tilesToLoad,i=this._tilesToRender,n=this._tmpVisible;r.length=0,i.length=0,n.length=0,e.visibleTiles(n);for(var s=!0,o=0;o<n.length;o++){var a=n[o],l;this._collectTileToLoad(a),t.texture(a)?(l=!1,this._collectTileToRender(a)):(l=this._collectChildren(a,t),s=!1),this._collectParents(a,t,l)}return r.sort(wh),i.sort(Mh),s},Ee.prototype._collectChildren=function(e,t){var r=this._tmpChildren,i=!0;do{if(r.length=0,!e.children(r))break;i=!1;for(var n=0;n<r.length;n++)e=r[n],t.texture(e)?(this._collectTileToLoad(e),this._collectTileToRender(e)):i=!0}while(i&&r.length===1);return i},Ee.prototype._collectParents=function(e,t,r){for(var i=this._progressive;(i||r)&&(e=e.parent())!=null;){if(r){if(t.texture(e))this._collectTileToRender(e),r=!1;else if(!this._progressive)continue}this._collectTileToLoad(e)||(i=!1)}return r},Ee.prototype._collectTileToLoad=function(e){return this._collectTileIntoList(e,this._tilesToLoad)},Ee.prototype._collectTileToRender=function(e){return this._collectTileIntoList(e,this._tilesToRender)},Ee.prototype._collectTileIntoList=function(e,t){for(var r=!1,i=0;i<t.length;i++)if(e.equals(t[i])){r=!0;break}return r||t.push(e),!r},Ee.prototype.createTexture=function(e,t,r){var i=this;function n(){return new i.TextureClass(i,e,t)}var s=_h(mh(n));return this._createTextureWorkQueue.push(s,function(o,a){r(o,e,t,a)})};var xh=Ee,Eh=function(){return typeof window!="undefined"?window:typeof self!="undefined"?self:typeof Ji!="undefined"?Ji:null}(),na=Eh,aa=na,bh=ze,Th=Se,rn={HTMLImageElement:["naturalWidth","naturalHeight"],HTMLCanvasElement:["width","height"],ImageBitmap:["width","height"]};function lr(e){var t=!1;for(var r in rn)if(aa[r]&&e instanceof aa[r]){t=!0,this._widthProp=rn[r][0],this._heightProp=rn[r][1];break}if(!t)throw new Error("Unsupported pixel source");this._element=e}bh(lr),lr.prototype.destroy=function(){Th(this)},lr.prototype.element=function(){return this._element},lr.prototype.width=function(){return this._element[this._widthProp]},lr.prototype.height=function(){return this._element[this._heightProp]},lr.prototype.timestamp=function(){return 0},lr.prototype.isDynamic=function(){return!1};var nn=lr;function Ph(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}var Ht=Ph,Lh=Ht;function sa(e){this.constructor.super_.apply(this,arguments),this.message=e}Lh(sa,Error);var oa=sa,Ei={exports:{}};/*!
 * Bowser - a browser detector
 * https://github.com/ded/bowser
 * MIT License | (c) Dustin Diaz 2015
 */(function(e){(function(t,r,i){e.exports?e.exports=i():t[r]=i()})(Ji,"bowser",function(){var t=!0;function r(c){function f(Re){var Xe=c.match(Re);return Xe&&Xe.length>1&&Xe[1]||""}function _(Re){var Xe=c.match(Re);return Xe&&Xe.length>1&&Xe[2]||""}var m=f(/(ipod|iphone|ipad)/i).toLowerCase(),v=/like android/i.test(c),h=!v&&/android/i.test(c),P=/nexus\s*[0-6]\s*/i.test(c),w=!P&&/nexus\s*[0-9]+/i.test(c),b=/CrOS/.test(c),R=/silk/i.test(c),D=/sailfish/i.test(c),O=/tizen/i.test(c),B=/(web|hpw)(o|0)s/i.test(c),F=/windows phone/i.test(c);/SamsungBrowser/i.test(c);var X=!F&&/windows/i.test(c),A=!m&&!R&&/macintosh/i.test(c),z=!h&&!D&&!O&&!B&&/linux/i.test(c),ae=_(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),Y=f(/version\/(\d+(\.\d+)?)/i),se=/tablet/i.test(c)&&!/tablet pc/i.test(c),ve=!se&&/[^-]mobi/i.test(c),G=/xbox/i.test(c),L;/opera/i.test(c)?L={name:"Opera",opera:t,version:Y||f(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(c)?L={name:"Opera",opera:t,version:f(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||Y}:/SamsungBrowser/i.test(c)?L={name:"Samsung Internet for Android",samsungBrowser:t,version:Y||f(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(c)?L={name:"NAVER Whale browser",whale:t,version:f(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(c)?L={name:"MZ Browser",mzbrowser:t,version:f(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(c)?L={name:"Opera Coast",coast:t,version:Y||f(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(c)?L={name:"Focus",focus:t,version:f(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(c)?L={name:"Yandex Browser",yandexbrowser:t,version:Y||f(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(c)?L={name:"UC Browser",ucbrowser:t,version:f(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(c)?L={name:"Maxthon",maxthon:t,version:f(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(c)?L={name:"Epiphany",epiphany:t,version:f(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(c)?L={name:"Puffin",puffin:t,version:f(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(c)?L={name:"Sleipnir",sleipnir:t,version:f(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(c)?L={name:"K-Meleon",kMeleon:t,version:f(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:F?(L={name:"Windows Phone",osname:"Windows Phone",windowsphone:t},ae?(L.msedge=t,L.version=ae):(L.msie=t,L.version=f(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(c)?L={name:"Internet Explorer",msie:t,version:f(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:b?L={name:"Chrome",osname:"Chrome OS",chromeos:t,chromeBook:t,chrome:t,version:f(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(c)?L={name:"Microsoft Edge",msedge:t,version:ae}:/vivaldi/i.test(c)?L={name:"Vivaldi",vivaldi:t,version:f(/vivaldi\/(\d+(\.\d+)?)/i)||Y}:D?L={name:"Sailfish",osname:"Sailfish OS",sailfish:t,version:f(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(c)?L={name:"SeaMonkey",seamonkey:t,version:f(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(c)?(L={name:"Firefox",firefox:t,version:f(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(c)&&(L.firefoxos=t,L.osname="Firefox OS")):R?L={name:"Amazon Silk",silk:t,version:f(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(c)?L={name:"PhantomJS",phantom:t,version:f(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(c)?L={name:"SlimerJS",slimer:t,version:f(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(c)||/rim\stablet/i.test(c)?L={name:"BlackBerry",osname:"BlackBerry OS",blackberry:t,version:Y||f(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:B?(L={name:"WebOS",osname:"WebOS",webos:t,version:Y||f(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(c)&&(L.touchpad=t)):/bada/i.test(c)?L={name:"Bada",osname:"Bada",bada:t,version:f(/dolfin\/(\d+(\.\d+)?)/i)}:O?L={name:"Tizen",osname:"Tizen",tizen:t,version:f(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||Y}:/qupzilla/i.test(c)?L={name:"QupZilla",qupzilla:t,version:f(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||Y}:/chromium/i.test(c)?L={name:"Chromium",chromium:t,version:f(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||Y}:/chrome|crios|crmo/i.test(c)?L={name:"Chrome",chrome:t,version:f(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:h?L={name:"Android",version:Y}:/safari|applewebkit/i.test(c)?(L={name:"Safari",safari:t},Y&&(L.version=Y)):m?(L={name:m=="iphone"?"iPhone":m=="ipad"?"iPad":"iPod"},Y&&(L.version=Y)):/googlebot/i.test(c)?L={name:"Googlebot",googlebot:t,version:f(/googlebot\/(\d+(\.\d+))/i)||Y}:L={name:f(/^(.*)\/(.*) /),version:_(/^(.*)\/(.*) /)},!L.msedge&&/(apple)?webkit/i.test(c)?(/(apple)?webkit\/537\.36/i.test(c)?(L.name=L.name||"Blink",L.blink=t):(L.name=L.name||"Webkit",L.webkit=t),!L.version&&Y&&(L.version=Y)):!L.opera&&/gecko\//i.test(c)&&(L.name=L.name||"Gecko",L.gecko=t,L.version=L.version||f(/gecko\/(\d+(\.\d+)?)/i)),!L.windowsphone&&(h||L.silk)?(L.android=t,L.osname="Android"):!L.windowsphone&&m?(L[m]=t,L.ios=t,L.osname="iOS"):A?(L.mac=t,L.osname="macOS"):G?(L.xbox=t,L.osname="Xbox"):X?(L.windows=t,L.osname="Windows"):z&&(L.linux=t,L.osname="Linux");function ot(Re){switch(Re){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}var ie="";L.windows?ie=ot(f(/Windows ((NT|XP)( \d\d?.\d)?)/i)):L.windowsphone?ie=f(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):L.mac?(ie=f(/Mac OS X (\d+([_\.\s]\d+)*)/i),ie=ie.replace(/[_\s]/g,".")):m?(ie=f(/os (\d+([_\s]\d+)*) like mac os x/i),ie=ie.replace(/[_\s]/g,".")):h?ie=f(/android[ \/-](\d+(\.\d+)*)/i):L.webos?ie=f(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):L.blackberry?ie=f(/rim\stablet\sos\s(\d+(\.\d+)*)/i):L.bada?ie=f(/bada\/(\d+(\.\d+)*)/i):L.tizen&&(ie=f(/tizen[\/\s](\d+(\.\d+)*)/i)),ie&&(L.osversion=ie);var $e=!L.windows&&ie.split(".")[0];return se||w||m=="ipad"||h&&($e==3||$e>=4&&!ve)||L.silk?L.tablet=t:(ve||m=="iphone"||m=="ipod"||h||P||L.blackberry||L.webos||L.bada)&&(L.mobile=t),L.msedge||L.msie&&L.version>=10||L.yandexbrowser&&L.version>=15||L.vivaldi&&L.version>=1||L.chrome&&L.version>=20||L.samsungBrowser&&L.version>=4||L.whale&&o([L.version,"1.0"])===1||L.mzbrowser&&o([L.version,"6.0"])===1||L.focus&&o([L.version,"1.0"])===1||L.firefox&&L.version>=20||L.safari&&L.version>=6||L.opera&&L.version>=10||L.ios&&L.osversion&&L.osversion.split(".")[0]>=6||L.blackberry&&L.version>=10.1||L.chromium&&L.version>=20?L.a=t:L.msie&&L.version<10||L.chrome&&L.version<20||L.firefox&&L.version<20||L.safari&&L.version<6||L.opera&&L.version<10||L.ios&&L.osversion&&L.osversion.split(".")[0]<6||L.chromium&&L.version<20?L.c=t:L.x=t,L}var i=r(typeof navigator!="undefined"&&navigator.userAgent||"");i.test=function(c){for(var f=0;f<c.length;++f){var _=c[f];if(typeof _=="string"&&_ in i)return!0}return!1};function n(c){return c.split(".").length}function s(c,f){var _=[],m;if(Array.prototype.map)return Array.prototype.map.call(c,f);for(m=0;m<c.length;m++)_.push(f(c[m]));return _}function o(c){for(var f=Math.max(n(c[0]),n(c[1])),_=s(c,function(m){var v=f-n(m);return m=m+new Array(v+1).join(".0"),s(m.split("."),function(h){return new Array(20-h.length).join("0")+h}).reverse()});--f>=0;){if(_[0][f]>_[1][f])return 1;if(_[0][f]===_[1][f]){if(f===0)return 0}else return-1}}function a(c,f,_){var m=i;typeof f=="string"&&(_=f,f=void 0),f===void 0&&(f=!1),_&&(m=r(_));var v=""+m.version;for(var h in c)if(c.hasOwnProperty(h)&&m[h]){if(typeof c[h]!="string")throw new Error("Browser version in the minVersion map should be a string: "+h+": "+String(c));return o([v,c[h]])<0}return f}function l(c,f,_){return!a(c,f,_)}return i.isUnsupportedBrowser=a,i.compareVersions=o,i.check=l,i._detect=r,i.detect=r,i})})(Ei);var an=nn,Ch=oa,Sh=Ei.exports,ha=na,Rh=en,Ah=!!ha.createImageBitmap&&!Sh.firefox,Ih={imageOrientation:"flipY",premultiplyAlpha:"premultiply"};function bi(e){this._stage=e}bi.prototype.loadImage=function(e,t,r){var i=this,n=new Image;n.crossOrigin="anonymous";var s=t&&t.x||0,o=t&&t.y||0,a=t&&t.width||1,l=t&&t.height||1;r=Rh(r),n.onload=function(){i._handleLoad(n,s,o,a,l,r)},n.onerror=function(){i._handleError(e,r)},n.src=e;function c(){n.onload=n.onerror=null,n.src="",r.apply(null,arguments)}return c},bi.prototype._handleLoad=function(e,t,r,i,n,s){if(t===0&&r===0&&i===1&&n===1){s(null,new an(e));return}if(t*=e.naturalWidth,r*=e.naturalHeight,i*=e.naturalWidth,n*=e.naturalHeight,Ah)ha.createImageBitmap(e,t,r,i,n,Ih).then(function(l){s(null,new an(l))});else{var o=document.createElement("canvas");o.width=i,o.height=n;var a=o.getContext("2d");a.drawImage(e,t,r,i,n,0,0,i,n),s(null,new an(o))}},bi.prototype._handleError=function(e,t){t(new Ch("Network error: "+e))};var zh=bi,$h=1;function Oh(){if(typeof window!="undefined"){if(window.devicePixelRatio)return window.devicePixelRatio;var e=window.screen;if(e&&e.deviceXDPI&&e.logicalXDPI)return e.deviceXDPI/e.logicalXDPI;if(e&&e.systemXDPI&&e.logicalXDPI)return e.systemXDPI/e.logicalXDPI}return $h}var Ti=Oh;function Dh(e){return(e&e-1)==0}var Hh=Dh;function sn(e){for(var t=document.documentElement.style,r=["Moz","Webkit","Khtml","O","ms"],i=0;i<r.length;i++){var n=r[i],s=e[0].toUpperCase()+e.slice(1),o=n+s;if(o in t)return o}return e}function Nh(e){var t=sn(e);return function(i){return i.style[t]}}function on(e){var t=sn(e);return function(i,n){return i.style[t]=n}}var la=on("transform"),ca=on("transformOrigin");function Fh(e){la(e,"translateZ(0)")}function kh(e){ca(e,"0 0 0")}function Bh(e){e.style.position="absolute"}function Uh(e,t,r){e.style.left=t+"px",e.style.top=r+"px"}function qh(e,t,r){e.style.width=t+"px",e.style.height=r+"px"}function Wh(e){e.style.width=e.style.height=0}function Vh(e){e.style.width=e.style.height="100%"}function Yh(e){e.style.overflow="hidden"}function Xh(e){e.style.overflow="visible"}function Gh(e){e.style.pointerEvents="none"}var pt={prefixProperty:sn,getWithVendorPrefix:Nh,setWithVendorPrefix:on,setTransform:la,setTransformOrigin:ca,setNullTransform:Fh,setNullTransformOrigin:kh,setAbsolute:Bh,setPixelPosition:Uh,setPixelSize:qh,setNullSize:Wh,setFullSize:Vh,setOverflowHidden:Yh,setOverflowVisible:Xh,setNoPointerEvents:Gh},jh=xh,Zh=zh,Kh=Ei.exports,Qh=Ht,Jh=Ti,fa=Hh,el=pt.setAbsolute,tl=pt.setFullSize,rl=Se,il={videoUseTexImage2D:Kh.chrome};function nl(e,t){var r={alpha:!0,premultipliedAlpha:!0,antialias:!!(t&&t.antialias),preserveDrawingBuffer:!!(t&&t.preserveDrawingBuffer)},i=e.getContext&&(e.getContext("webgl",r)||e.getContext("experimental-webgl",r));if(!i)throw new Error("Could not get WebGL context");return t.wrapContext&&(i=t.wrapContext(i)),i}function Je(e){e=e||{};var t=this;this.constructor.super_.call(this,e),this._generateMipmaps=e.generateMipmaps!=null?e.generateMipmaps:!1,this._loader=new Zh(this),this._domElement=document.createElement("canvas"),el(this._domElement),tl(this._domElement),this._gl=nl(this._domElement,e),this._handleContextLoss=function(){t.emit("webglcontextlost"),t._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=[]}Qh(Je,jh),Je.prototype.destroy=function(){this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this.constructor.super_.prototype.destroy.call(this)},Je.prototype.domElement=function(){return this._domElement},Je.prototype.webGlContext=function(){return this._gl},Je.prototype.setSizeForType=function(){var e=Jh();this._domElement.width=e*this._width,this._domElement.height=e*this._height},Je.prototype.loadImage=function(e,t,r){return this._loader.loadImage(e,t,r)},Je.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},Je.prototype.validateLayer=function(e){var t=e.geometry().maxTileSize(),r=this.maxTextureSize();if(t>r)throw new Error("Layer has level with tile size larger than maximum texture size ("+t+" vs. "+r+")")},Je.prototype.createRenderer=function(e){for(var t=this._rendererInstances,r=0;r<t.length;r++)if(t[r]instanceof e)return t[r];var i=new e(this._gl);return t.push(i),i},Je.prototype.destroyRenderer=function(e){var t=this._rendererInstances;if(this._renderers.indexOf(e)<0){e.destroy();var r=t.indexOf(e);r>=0&&t.splice(r,1)}},Je.prototype.startFrame=function(){var e=this._gl;if(!e)throw new Error("Bad WebGL context - maybe context was lost?");e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)},Je.prototype.endFrame=function(){},Je.prototype.takeSnapshot=function(e){(typeof e!="object"||e==null)&&(e={});var t=e.quality;if(typeof t=="undefined"&&(t=75),typeof t!="number"||t<0||t>100)throw new Error("WebGLStage: Snapshot quality needs to be a number between 0 and 100");return this.render(),this._domElement.toDataURL("image/jpeg",t/100)},Je.type=Je.prototype.type="webgl";function hn(e,t,r){this._stage=e,this._gl=e._gl,this._texture=null,this._timestamp=null,this._width=this._height=null,this.refresh(t,r)}hn.prototype.refresh=function(e,t){var r=this._gl,i=this._stage,n,s=t.timestamp();if(s!==this._timestamp){var o=t.element(),a=t.width(),l=t.height();if(a!==this._width||l!==this._height){var c=i.maxTextureSize();if(a>c)throw new Error("Texture width larger than max size ("+a+" vs. "+c+")");if(l>c)throw new Error("Texture height larger than max size ("+l+" vs. "+c+")");this._texture&&r.deleteTexture(n),n=this._texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,n),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,o)}else n=this._texture,r.bindTexture(r.TEXTURE_2D,n),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),o instanceof HTMLVideoElement&&il.videoUseTexImage2D?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,o):r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,o);i._generateMipmaps&&fa(a)&&fa(l)?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),this._timestamp=s,this._width=a,this._height=l}},hn.prototype.destroy=function(){this._texture&&this._gl.deleteTexture(this._texture),rl(this)},Je.TextureClass=Je.prototype.TextureClass=hn;var ua=Je,K=1e-6,le=typeof Float32Array!="undefined"?Float32Array:Array,It=Math.random;function al(e){le=e}var sl=Math.PI/180;function ol(e){return e*sl}function hl(e,t){return Math.abs(e-t)<=K*Math.max(1,Math.abs(e),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ll=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",EPSILON:K,get ARRAY_TYPE(){return le},RANDOM:It,setMatrixArrayType:al,toRadian:ol,equals:hl});function cl(){var e=new le(4);return le!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function fl(e){var t=new le(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ul(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function vl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function dl(e,t,r,i){var n=new le(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function pl(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function ml(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function _l(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=r*s-n*i;return o?(o=1/o,e[0]=s*o,e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null}function yl(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function gl(e){return e[0]*e[3]-e[2]*e[1]}function va(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1],c=r[2],f=r[3];return e[0]=i*a+s*l,e[1]=n*a+o*l,e[2]=i*c+s*f,e[3]=n*c+o*f,e}function wl(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*a,e[1]=n*l+o*a,e[2]=i*-a+s*l,e[3]=n*-a+o*l,e}function Ml(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1];return e[0]=i*a,e[1]=n*a,e[2]=s*l,e[3]=o*l,e}function xl(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function El(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function bl(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Tl(e){return Math.hypot(e[0],e[1],e[2],e[3])}function Pl(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function Ll(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function da(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Cl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Sl(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(r-o)<=K*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=K*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=K*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=K*Math.max(1,Math.abs(s),Math.abs(c))}function Rl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Al(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}var Il=va,zl=da,$l=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:cl,clone:fl,copy:ul,identity:vl,fromValues:dl,set:pl,transpose:ml,invert:_l,adjoint:yl,determinant:gl,multiply:va,rotate:wl,scale:Ml,fromRotation:xl,fromScaling:El,str:bl,frob:Tl,LDU:Pl,add:Ll,subtract:da,exactEquals:Cl,equals:Sl,multiplyScalar:Rl,multiplyScalarAndAdd:Al,mul:Il,sub:zl});function Ol(){var e=new le(6);return le!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function Dl(e){var t=new le(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Hl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Nl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function Fl(e,t,r,i,n,s){var o=new le(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function kl(e,t,r,i,n,s,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e}function Bl(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=r*s-i*n;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*a-s*o)*l,e[5]=(i*o-r*a)*l,e):null}function Ul(e){return e[0]*e[3]-e[1]*e[2]}function pa(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],f=r[1],_=r[2],m=r[3],v=r[4],h=r[5];return e[0]=i*c+s*f,e[1]=n*c+o*f,e[2]=i*_+s*m,e[3]=n*_+o*m,e[4]=i*v+s*h+a,e[5]=n*v+o*h+l,e}function ql(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(r),f=Math.cos(r);return e[0]=i*f+s*c,e[1]=n*f+o*c,e[2]=i*-c+s*f,e[3]=n*-c+o*f,e[4]=a,e[5]=l,e}function Wl(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],f=r[1];return e[0]=i*c,e[1]=n*c,e[2]=s*f,e[3]=o*f,e[4]=a,e[5]=l,e}function Vl(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],f=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=o,e[4]=i*c+s*f+a,e[5]=n*c+o*f+l,e}function Yl(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function Xl(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function Gl(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function jl(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function Zl(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function Kl(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function ma(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function Ql(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function Jl(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function ec(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function tc(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=t[0],c=t[1],f=t[2],_=t[3],m=t[4],v=t[5];return Math.abs(r-l)<=K*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=K*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-f)<=K*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-_)<=K*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(o-m)<=K*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-v)<=K*Math.max(1,Math.abs(a),Math.abs(v))}var rc=pa,ic=ma,nc=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Ol,clone:Dl,copy:Hl,identity:Nl,fromValues:Fl,set:kl,invert:Bl,determinant:Ul,multiply:pa,rotate:ql,scale:Wl,translate:Vl,fromRotation:Yl,fromScaling:Xl,fromTranslation:Gl,str:jl,frob:Zl,add:Kl,subtract:ma,multiplyScalar:Ql,multiplyScalarAndAdd:Jl,exactEquals:ec,equals:tc,mul:rc,sub:ic});function _a(){var e=new le(9);return le!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ac(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function sc(e){var t=new le(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function oc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function hc(e,t,r,i,n,s,o,a,l){var c=new le(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function lc(e,t,r,i,n,s,o,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function cc(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function fc(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function uc(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],f=t[8],_=f*o-a*c,m=-f*s+a*l,v=c*s-o*l,h=r*_+i*m+n*v;return h?(h=1/h,e[0]=_*h,e[1]=(-f*i+n*c)*h,e[2]=(a*i-n*o)*h,e[3]=m*h,e[4]=(f*r-n*l)*h,e[5]=(-a*r+n*s)*h,e[6]=v*h,e[7]=(-c*r+i*l)*h,e[8]=(o*r-i*s)*h,e):null}function vc(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],f=t[8];return e[0]=o*f-a*c,e[1]=n*c-i*f,e[2]=i*a-n*o,e[3]=a*l-s*f,e[4]=r*f-n*l,e[5]=n*s-r*a,e[6]=s*c-o*l,e[7]=i*l-r*c,e[8]=r*o-i*s,e}function dc(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-o*l)+r*(-c*n+o*a)+i*(l*n-s*a)}function ya(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],f=t[7],_=t[8],m=r[0],v=r[1],h=r[2],P=r[3],w=r[4],b=r[5],R=r[6],D=r[7],O=r[8];return e[0]=m*i+v*o+h*c,e[1]=m*n+v*a+h*f,e[2]=m*s+v*l+h*_,e[3]=P*i+w*o+b*c,e[4]=P*n+w*a+b*f,e[5]=P*s+w*l+b*_,e[6]=R*i+D*o+O*c,e[7]=R*n+D*a+O*f,e[8]=R*s+D*l+O*_,e}function pc(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],f=t[7],_=t[8],m=r[0],v=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=m*i+v*o+c,e[7]=m*n+v*a+f,e[8]=m*s+v*l+_,e}function mc(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],f=t[7],_=t[8],m=Math.sin(r),v=Math.cos(r);return e[0]=v*i+m*o,e[1]=v*n+m*a,e[2]=v*s+m*l,e[3]=v*o-m*i,e[4]=v*a-m*n,e[5]=v*l-m*s,e[6]=c,e[7]=f,e[8]=_,e}function _c(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function yc(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function gc(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function wc(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Mc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function xc(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=r+r,a=i+i,l=n+n,c=r*o,f=i*o,_=i*a,m=n*o,v=n*a,h=n*l,P=s*o,w=s*a,b=s*l;return e[0]=1-_-h,e[3]=f-b,e[6]=m+w,e[1]=f+b,e[4]=1-c-h,e[7]=v-P,e[2]=m-w,e[5]=v+P,e[8]=1-c-_,e}function Ec(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],f=t[8],_=t[9],m=t[10],v=t[11],h=t[12],P=t[13],w=t[14],b=t[15],R=r*a-i*o,D=r*l-n*o,O=r*c-s*o,B=i*l-n*a,F=i*c-s*a,X=n*c-s*l,A=f*P-_*h,z=f*w-m*h,ae=f*b-v*h,Y=_*w-m*P,se=_*b-v*P,ve=m*b-v*w,G=R*ve-D*se+O*Y+B*ae-F*z+X*A;return G?(G=1/G,e[0]=(a*ve-l*se+c*Y)*G,e[1]=(l*ae-o*ve-c*z)*G,e[2]=(o*se-a*ae+c*A)*G,e[3]=(n*se-i*ve-s*Y)*G,e[4]=(r*ve-n*ae+s*z)*G,e[5]=(i*ae-r*se-s*A)*G,e[6]=(P*X-w*F+b*B)*G,e[7]=(w*O-h*X-b*D)*G,e[8]=(h*F-P*O+b*R)*G,e):null}function bc(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Tc(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Pc(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Lc(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function ga(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function Cc(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function Sc(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function Rc(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Ac(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],f=e[8],_=t[0],m=t[1],v=t[2],h=t[3],P=t[4],w=t[5],b=t[6],R=t[7],D=t[8];return Math.abs(r-_)<=K*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-m)<=K*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(n-v)<=K*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(s-h)<=K*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-P)<=K*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(a-w)<=K*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-b)<=K*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-R)<=K*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(f-D)<=K*Math.max(1,Math.abs(f),Math.abs(D))}var Ic=ya,zc=ga,$c=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:_a,fromMat4:ac,clone:sc,copy:oc,fromValues:hc,set:lc,identity:cc,transpose:fc,invert:uc,adjoint:vc,determinant:dc,multiply:ya,translate:pc,rotate:mc,scale:_c,fromTranslation:yc,fromRotation:gc,fromScaling:wc,fromMat2d:Mc,fromQuat:xc,normalFromMat4:Ec,projection:bc,str:Tc,frob:Pc,add:Lc,subtract:ga,multiplyScalar:Cc,multiplyScalarAndAdd:Sc,exactEquals:Rc,equals:Ac,mul:Ic,sub:zc});function Oc(){var e=new le(16);return le!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Dc(e){var t=new le(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Hc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Nc(e,t,r,i,n,s,o,a,l,c,f,_,m,v,h,P){var w=new le(16);return w[0]=e,w[1]=t,w[2]=r,w[3]=i,w[4]=n,w[5]=s,w[6]=o,w[7]=a,w[8]=l,w[9]=c,w[10]=f,w[11]=_,w[12]=m,w[13]=v,w[14]=h,w[15]=P,w}function Fc(e,t,r,i,n,s,o,a,l,c,f,_,m,v,h,P,w){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=f,e[10]=_,e[11]=m,e[12]=v,e[13]=h,e[14]=P,e[15]=w,e}function wa(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kc(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Bc(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],f=t[8],_=t[9],m=t[10],v=t[11],h=t[12],P=t[13],w=t[14],b=t[15],R=r*a-i*o,D=r*l-n*o,O=r*c-s*o,B=i*l-n*a,F=i*c-s*a,X=n*c-s*l,A=f*P-_*h,z=f*w-m*h,ae=f*b-v*h,Y=_*w-m*P,se=_*b-v*P,ve=m*b-v*w,G=R*ve-D*se+O*Y+B*ae-F*z+X*A;return G?(G=1/G,e[0]=(a*ve-l*se+c*Y)*G,e[1]=(n*se-i*ve-s*Y)*G,e[2]=(P*X-w*F+b*B)*G,e[3]=(m*F-_*X-v*B)*G,e[4]=(l*ae-o*ve-c*z)*G,e[5]=(r*ve-n*ae+s*z)*G,e[6]=(w*O-h*X-b*D)*G,e[7]=(f*X-m*O+v*D)*G,e[8]=(o*se-a*ae+c*A)*G,e[9]=(i*ae-r*se-s*A)*G,e[10]=(h*F-P*O+b*R)*G,e[11]=(_*O-f*F-v*R)*G,e[12]=(a*z-o*Y-l*A)*G,e[13]=(r*Y-i*z+n*A)*G,e[14]=(P*D-h*B-w*R)*G,e[15]=(f*B-_*D+m*R)*G,e):null}function Uc(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],f=t[8],_=t[9],m=t[10],v=t[11],h=t[12],P=t[13],w=t[14],b=t[15];return e[0]=a*(m*b-v*w)-_*(l*b-c*w)+P*(l*v-c*m),e[1]=-(i*(m*b-v*w)-_*(n*b-s*w)+P*(n*v-s*m)),e[2]=i*(l*b-c*w)-a*(n*b-s*w)+P*(n*c-s*l),e[3]=-(i*(l*v-c*m)-a*(n*v-s*m)+_*(n*c-s*l)),e[4]=-(o*(m*b-v*w)-f*(l*b-c*w)+h*(l*v-c*m)),e[5]=r*(m*b-v*w)-f*(n*b-s*w)+h*(n*v-s*m),e[6]=-(r*(l*b-c*w)-o*(n*b-s*w)+h*(n*c-s*l)),e[7]=r*(l*v-c*m)-o*(n*v-s*m)+f*(n*c-s*l),e[8]=o*(_*b-v*P)-f*(a*b-c*P)+h*(a*v-c*_),e[9]=-(r*(_*b-v*P)-f*(i*b-s*P)+h*(i*v-s*_)),e[10]=r*(a*b-c*P)-o*(i*b-s*P)+h*(i*c-s*a),e[11]=-(r*(a*v-c*_)-o*(i*v-s*_)+f*(i*c-s*a)),e[12]=-(o*(_*w-m*P)-f*(a*w-l*P)+h*(a*m-l*_)),e[13]=r*(_*w-m*P)-f*(i*w-n*P)+h*(i*m-n*_),e[14]=-(r*(a*w-l*P)-o*(i*w-n*P)+h*(i*l-n*a)),e[15]=r*(a*m-l*_)-o*(i*m-n*_)+f*(i*l-n*a),e}function qc(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],f=e[9],_=e[10],m=e[11],v=e[12],h=e[13],P=e[14],w=e[15],b=t*o-r*s,R=t*a-i*s,D=t*l-n*s,O=r*a-i*o,B=r*l-n*o,F=i*l-n*a,X=c*h-f*v,A=c*P-_*v,z=c*w-m*v,ae=f*P-_*h,Y=f*w-m*h,se=_*w-m*P;return b*se-R*Y+D*ae+O*z-B*A+F*X}function Ma(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],f=t[7],_=t[8],m=t[9],v=t[10],h=t[11],P=t[12],w=t[13],b=t[14],R=t[15],D=r[0],O=r[1],B=r[2],F=r[3];return e[0]=D*i+O*a+B*_+F*P,e[1]=D*n+O*l+B*m+F*w,e[2]=D*s+O*c+B*v+F*b,e[3]=D*o+O*f+B*h+F*R,D=r[4],O=r[5],B=r[6],F=r[7],e[4]=D*i+O*a+B*_+F*P,e[5]=D*n+O*l+B*m+F*w,e[6]=D*s+O*c+B*v+F*b,e[7]=D*o+O*f+B*h+F*R,D=r[8],O=r[9],B=r[10],F=r[11],e[8]=D*i+O*a+B*_+F*P,e[9]=D*n+O*l+B*m+F*w,e[10]=D*s+O*c+B*v+F*b,e[11]=D*o+O*f+B*h+F*R,D=r[12],O=r[13],B=r[14],F=r[15],e[12]=D*i+O*a+B*_+F*P,e[13]=D*n+O*l+B*m+F*w,e[14]=D*s+O*c+B*v+F*b,e[15]=D*o+O*f+B*h+F*R,e}function Wc(e,t,r){var i=r[0],n=r[1],s=r[2],o,a,l,c,f,_,m,v,h,P,w,b;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*s+t[12],e[13]=t[1]*i+t[5]*n+t[9]*s+t[13],e[14]=t[2]*i+t[6]*n+t[10]*s+t[14],e[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(o=t[0],a=t[1],l=t[2],c=t[3],f=t[4],_=t[5],m=t[6],v=t[7],h=t[8],P=t[9],w=t[10],b=t[11],e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=f,e[5]=_,e[6]=m,e[7]=v,e[8]=h,e[9]=P,e[10]=w,e[11]=b,e[12]=o*i+f*n+h*s+t[12],e[13]=a*i+_*n+P*s+t[13],e[14]=l*i+m*n+w*s+t[14],e[15]=c*i+v*n+b*s+t[15]),e}function Vc(e,t,r){var i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Yc(e,t,r,i){var n=i[0],s=i[1],o=i[2],a=Math.hypot(n,s,o),l,c,f,_,m,v,h,P,w,b,R,D,O,B,F,X,A,z,ae,Y,se,ve,G,L;return a<K?null:(a=1/a,n*=a,s*=a,o*=a,l=Math.sin(r),c=Math.cos(r),f=1-c,_=t[0],m=t[1],v=t[2],h=t[3],P=t[4],w=t[5],b=t[6],R=t[7],D=t[8],O=t[9],B=t[10],F=t[11],X=n*n*f+c,A=s*n*f+o*l,z=o*n*f-s*l,ae=n*s*f-o*l,Y=s*s*f+c,se=o*s*f+n*l,ve=n*o*f+s*l,G=s*o*f-n*l,L=o*o*f+c,e[0]=_*X+P*A+D*z,e[1]=m*X+w*A+O*z,e[2]=v*X+b*A+B*z,e[3]=h*X+R*A+F*z,e[4]=_*ae+P*Y+D*se,e[5]=m*ae+w*Y+O*se,e[6]=v*ae+b*Y+B*se,e[7]=h*ae+R*Y+F*se,e[8]=_*ve+P*G+D*L,e[9]=m*ve+w*G+O*L,e[10]=v*ve+b*G+B*L,e[11]=h*ve+R*G+F*L,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Xc(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],f=t[9],_=t[10],m=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+c*i,e[5]=o*n+f*i,e[6]=a*n+_*i,e[7]=l*n+m*i,e[8]=c*n-s*i,e[9]=f*n-o*i,e[10]=_*n-a*i,e[11]=m*n-l*i,e}function Gc(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],o=t[1],a=t[2],l=t[3],c=t[8],f=t[9],_=t[10],m=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-c*i,e[1]=o*n-f*i,e[2]=a*n-_*i,e[3]=l*n-m*i,e[8]=s*i+c*n,e[9]=o*i+f*n,e[10]=a*i+_*n,e[11]=l*i+m*n,e}function jc(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],o=t[1],a=t[2],l=t[3],c=t[4],f=t[5],_=t[6],m=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+c*i,e[1]=o*n+f*i,e[2]=a*n+_*i,e[3]=l*n+m*i,e[4]=c*n-s*i,e[5]=f*n-o*i,e[6]=_*n-a*i,e[7]=m*n-l*i,e}function Zc(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Kc(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Qc(e,t,r){var i=r[0],n=r[1],s=r[2],o=Math.hypot(i,n,s),a,l,c;return o<K?null:(o=1/o,i*=o,n*=o,s*=o,a=Math.sin(t),l=Math.cos(t),c=1-l,e[0]=i*i*c+l,e[1]=n*i*c+s*a,e[2]=s*i*c-n*a,e[3]=0,e[4]=i*n*c-s*a,e[5]=n*n*c+l,e[6]=s*n*c+i*a,e[7]=0,e[8]=i*s*c+n*a,e[9]=n*s*c-i*a,e[10]=s*s*c+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Jc(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ef(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tf(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xa(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=i+i,l=n+n,c=s+s,f=i*a,_=i*l,m=i*c,v=n*l,h=n*c,P=s*c,w=o*a,b=o*l,R=o*c;return e[0]=1-(v+P),e[1]=_+R,e[2]=m-b,e[3]=0,e[4]=_-R,e[5]=1-(f+P),e[6]=h+w,e[7]=0,e[8]=m+b,e[9]=h-w,e[10]=1-(f+v),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function rf(e,t){var r=new le(3),i=-t[0],n=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],f=t[7],_=i*i+n*n+s*s+o*o;return _>0?(r[0]=(a*o+f*i+l*s-c*n)*2/_,r[1]=(l*o+f*n+c*i-a*s)*2/_,r[2]=(c*o+f*s+a*n-l*i)*2/_):(r[0]=(a*o+f*i+l*s-c*n)*2,r[1]=(l*o+f*n+c*i-a*s)*2,r[2]=(c*o+f*s+a*n-l*i)*2),xa(e,t,r),e}function Ea(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function ba(e,t){var r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],f=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(s,o,a),e[2]=Math.hypot(l,c,f),e}function Ta(e,t){var r=new le(3);ba(r,t);var i=1/r[0],n=1/r[1],s=1/r[2],o=t[0]*i,a=t[1]*n,l=t[2]*s,c=t[4]*i,f=t[5]*n,_=t[6]*s,m=t[8]*i,v=t[9]*n,h=t[10]*s,P=o+f+h,w=0;return P>0?(w=Math.sqrt(P+1)*2,e[3]=.25*w,e[0]=(_-v)/w,e[1]=(m-l)/w,e[2]=(a-c)/w):o>f&&o>h?(w=Math.sqrt(1+o-f-h)*2,e[3]=(_-v)/w,e[0]=.25*w,e[1]=(a+c)/w,e[2]=(m+l)/w):f>h?(w=Math.sqrt(1+f-o-h)*2,e[3]=(m-l)/w,e[0]=(a+c)/w,e[1]=.25*w,e[2]=(_+v)/w):(w=Math.sqrt(1+h-o-f)*2,e[3]=(a-c)/w,e[0]=(m+l)/w,e[1]=(_+v)/w,e[2]=.25*w),e}function nf(e,t,r,i){var n=t[0],s=t[1],o=t[2],a=t[3],l=n+n,c=s+s,f=o+o,_=n*l,m=n*c,v=n*f,h=s*c,P=s*f,w=o*f,b=a*l,R=a*c,D=a*f,O=i[0],B=i[1],F=i[2];return e[0]=(1-(h+w))*O,e[1]=(m+D)*O,e[2]=(v-R)*O,e[3]=0,e[4]=(m-D)*B,e[5]=(1-(_+w))*B,e[6]=(P+b)*B,e[7]=0,e[8]=(v+R)*F,e[9]=(P-b)*F,e[10]=(1-(_+h))*F,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function af(e,t,r,i,n){var s=t[0],o=t[1],a=t[2],l=t[3],c=s+s,f=o+o,_=a+a,m=s*c,v=s*f,h=s*_,P=o*f,w=o*_,b=a*_,R=l*c,D=l*f,O=l*_,B=i[0],F=i[1],X=i[2],A=n[0],z=n[1],ae=n[2],Y=(1-(P+b))*B,se=(v+O)*B,ve=(h-D)*B,G=(v-O)*F,L=(1-(m+b))*F,ot=(w+R)*F,ie=(h+D)*X,$e=(w-R)*X,Re=(1-(m+P))*X;return e[0]=Y,e[1]=se,e[2]=ve,e[3]=0,e[4]=G,e[5]=L,e[6]=ot,e[7]=0,e[8]=ie,e[9]=$e,e[10]=Re,e[11]=0,e[12]=r[0]+A-(Y*A+G*z+ie*ae),e[13]=r[1]+z-(se*A+L*z+$e*ae),e[14]=r[2]+ae-(ve*A+ot*z+Re*ae),e[15]=1,e}function sf(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=r+r,a=i+i,l=n+n,c=r*o,f=i*o,_=i*a,m=n*o,v=n*a,h=n*l,P=s*o,w=s*a,b=s*l;return e[0]=1-_-h,e[1]=f+b,e[2]=m-w,e[3]=0,e[4]=f-b,e[5]=1-c-h,e[6]=v+P,e[7]=0,e[8]=m+w,e[9]=v-P,e[10]=1-c-_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function of(e,t,r,i,n,s,o){var a=1/(r-t),l=1/(n-i),c=1/(s-o);return e[0]=s*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(n+i)*l,e[10]=(o+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*c,e[15]=0,e}function hf(e,t,r,i,n){var s=1/Math.tan(t/2),o;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(o=1/(i-n),e[10]=(n+i)*o,e[14]=2*n*i*o):(e[10]=-1,e[14]=-2*i),e}function lf(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-((o-a)*l*.5),e[9]=(n-s)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function cf(e,t,r,i,n,s,o){var a=1/(t-r),l=1/(i-n),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(n+i)*l,e[14]=(o+s)*c,e[15]=1,e}function ff(e,t,r,i){var n,s,o,a,l,c,f,_,m,v,h=t[0],P=t[1],w=t[2],b=i[0],R=i[1],D=i[2],O=r[0],B=r[1],F=r[2];return Math.abs(h-O)<K&&Math.abs(P-B)<K&&Math.abs(w-F)<K?wa(e):(f=h-O,_=P-B,m=w-F,v=1/Math.hypot(f,_,m),f*=v,_*=v,m*=v,n=R*m-D*_,s=D*f-b*m,o=b*_-R*f,v=Math.hypot(n,s,o),v?(v=1/v,n*=v,s*=v,o*=v):(n=0,s=0,o=0),a=_*o-m*s,l=m*n-f*o,c=f*s-_*n,v=Math.hypot(a,l,c),v?(v=1/v,a*=v,l*=v,c*=v):(a=0,l=0,c=0),e[0]=n,e[1]=a,e[2]=f,e[3]=0,e[4]=s,e[5]=l,e[6]=_,e[7]=0,e[8]=o,e[9]=c,e[10]=m,e[11]=0,e[12]=-(n*h+s*P+o*w),e[13]=-(a*h+l*P+c*w),e[14]=-(f*h+_*P+m*w),e[15]=1,e)}function uf(e,t,r,i){var n=t[0],s=t[1],o=t[2],a=i[0],l=i[1],c=i[2],f=n-r[0],_=s-r[1],m=o-r[2],v=f*f+_*_+m*m;v>0&&(v=1/Math.sqrt(v),f*=v,_*=v,m*=v);var h=l*m-c*_,P=c*f-a*m,w=a*_-l*f;return v=h*h+P*P+w*w,v>0&&(v=1/Math.sqrt(v),h*=v,P*=v,w*=v),e[0]=h,e[1]=P,e[2]=w,e[3]=0,e[4]=_*w-m*P,e[5]=m*h-f*w,e[6]=f*P-_*h,e[7]=0,e[8]=f,e[9]=_,e[10]=m,e[11]=0,e[12]=n,e[13]=s,e[14]=o,e[15]=1,e}function vf(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function df(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function pf(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Pa(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function mf(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function _f(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function yf(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function gf(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],f=e[8],_=e[9],m=e[10],v=e[11],h=e[12],P=e[13],w=e[14],b=e[15],R=t[0],D=t[1],O=t[2],B=t[3],F=t[4],X=t[5],A=t[6],z=t[7],ae=t[8],Y=t[9],se=t[10],ve=t[11],G=t[12],L=t[13],ot=t[14],ie=t[15];return Math.abs(r-R)<=K*Math.max(1,Math.abs(r),Math.abs(R))&&Math.abs(i-D)<=K*Math.max(1,Math.abs(i),Math.abs(D))&&Math.abs(n-O)<=K*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(s-B)<=K*Math.max(1,Math.abs(s),Math.abs(B))&&Math.abs(o-F)<=K*Math.max(1,Math.abs(o),Math.abs(F))&&Math.abs(a-X)<=K*Math.max(1,Math.abs(a),Math.abs(X))&&Math.abs(l-A)<=K*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(c-z)<=K*Math.max(1,Math.abs(c),Math.abs(z))&&Math.abs(f-ae)<=K*Math.max(1,Math.abs(f),Math.abs(ae))&&Math.abs(_-Y)<=K*Math.max(1,Math.abs(_),Math.abs(Y))&&Math.abs(m-se)<=K*Math.max(1,Math.abs(m),Math.abs(se))&&Math.abs(v-ve)<=K*Math.max(1,Math.abs(v),Math.abs(ve))&&Math.abs(h-G)<=K*Math.max(1,Math.abs(h),Math.abs(G))&&Math.abs(P-L)<=K*Math.max(1,Math.abs(P),Math.abs(L))&&Math.abs(w-ot)<=K*Math.max(1,Math.abs(w),Math.abs(ot))&&Math.abs(b-ie)<=K*Math.max(1,Math.abs(b),Math.abs(ie))}var wf=Ma,Mf=Pa,xf=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Oc,clone:Dc,copy:Hc,fromValues:Nc,set:Fc,identity:wa,transpose:kc,invert:Bc,adjoint:Uc,determinant:qc,multiply:Ma,translate:Wc,scale:Vc,rotate:Yc,rotateX:Xc,rotateY:Gc,rotateZ:jc,fromTranslation:Zc,fromScaling:Kc,fromRotation:Qc,fromXRotation:Jc,fromYRotation:ef,fromZRotation:tf,fromRotationTranslation:xa,fromQuat2:rf,getTranslation:Ea,getScaling:ba,getRotation:Ta,fromRotationTranslationScale:nf,fromRotationTranslationScaleOrigin:af,fromQuat:sf,frustum:of,perspective:hf,perspectiveFromFieldOfView:lf,ortho:cf,lookAt:ff,targetTo:uf,str:vf,frob:df,add:pf,subtract:Pa,multiplyScalar:mf,multiplyScalarAndAdd:_f,exactEquals:yf,equals:gf,mul:wf,sub:Mf});function ln(){var e=new le(3);return le!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ef(e){var t=new le(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function La(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function cn(e,t,r){var i=new le(3);return i[0]=e,i[1]=t,i[2]=r,i}function bf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Tf(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function Pf(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Ca(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Sa(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Ra(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Lf(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Cf(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Sf(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function Rf(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Af(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function If(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function zf(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function Aa(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function Ia(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function za(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function $f(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Of(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function $a(e,t){var r=t[0],i=t[1],n=t[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function fn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Pi(e,t,r){var i=t[0],n=t[1],s=t[2],o=r[0],a=r[1],l=r[2];return e[0]=n*l-s*a,e[1]=s*o-i*l,e[2]=i*a-n*o,e}function Df(e,t,r,i){var n=t[0],s=t[1],o=t[2];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=o+i*(r[2]-o),e}function Hf(e,t,r,i,n,s){var o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),f=o*(3-2*s);return e[0]=t[0]*a+r[0]*l+i[0]*c+n[0]*f,e[1]=t[1]*a+r[1]*l+i[1]*c+n[1]*f,e[2]=t[2]*a+r[2]*l+i[2]*c+n[2]*f,e}function Nf(e,t,r,i,n,s){var o=1-s,a=o*o,l=s*s,c=a*o,f=3*s*a,_=3*l*o,m=l*s;return e[0]=t[0]*c+r[0]*f+i[0]*_+n[0]*m,e[1]=t[1]*c+r[1]*f+i[1]*_+n[1]*m,e[2]=t[2]*c+r[2]*f+i[2]*_+n[2]*m,e}function Ff(e,t){t=t||1;var r=It()*2*Math.PI,i=It()*2-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function kf(e,t,r){var i=t[0],n=t[1],s=t[2],o=r[3]*i+r[7]*n+r[11]*s+r[15];return o=o||1,e[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/o,e[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/o,e[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/o,e}function Bf(e,t,r){var i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function Uf(e,t,r){var i=r[0],n=r[1],s=r[2],o=r[3],a=t[0],l=t[1],c=t[2],f=n*c-s*l,_=s*a-i*c,m=i*l-n*a,v=n*m-s*_,h=s*f-i*m,P=i*_-n*f,w=o*2;return f*=w,_*=w,m*=w,v*=2,h*=2,P*=2,e[0]=a+f+v,e[1]=l+_+h,e[2]=c+m+P,e}function qf(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Wf(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Vf(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Yf(e,t){var r=e[0],i=e[1],n=e[2],s=t[0],o=t[1],a=t[2],l=Math.sqrt(r*r+i*i+n*n),c=Math.sqrt(s*s+o*o+a*a),f=l*c,_=f&&fn(e,t)/f;return Math.acos(Math.min(Math.max(_,-1),1))}function Xf(e){return e[0]=0,e[1]=0,e[2]=0,e}function Gf(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function jf(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Zf(e,t){var r=e[0],i=e[1],n=e[2],s=t[0],o=t[1],a=t[2];return Math.abs(r-s)<=K*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=K*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=K*Math.max(1,Math.abs(n),Math.abs(a))}var Kf=Ca,Qf=Sa,Jf=Ra,eu=Aa,tu=Ia,Oa=La,ru=za,iu=function(){var e=ln();return function(t,r,i,n,s,o){var a,l;for(r||(r=3),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,a=i;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}(),nu=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:ln,clone:Ef,length:La,fromValues:cn,copy:bf,set:Tf,add:Pf,subtract:Ca,multiply:Sa,divide:Ra,ceil:Lf,floor:Cf,min:Sf,max:Rf,round:Af,scale:If,scaleAndAdd:zf,distance:Aa,squaredDistance:Ia,squaredLength:za,negate:$f,inverse:Of,normalize:$a,dot:fn,cross:Pi,lerp:Df,hermite:Hf,bezier:Nf,random:Ff,transformMat4:kf,transformMat3:Bf,transformQuat:Uf,rotateX:qf,rotateY:Wf,rotateZ:Vf,angle:Yf,zero:Xf,str:Gf,exactEquals:jf,equals:Zf,sub:Kf,mul:Qf,div:Jf,dist:eu,sqrDist:tu,len:Oa,sqrLen:ru,forEach:iu});function Da(){var e=new le(4);return le!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ha(e){var t=new le(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Na(e,t,r,i){var n=new le(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Fa(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ka(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function Ba(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Ua(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function qa(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Wa(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function au(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function su(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function ou(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function hu(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function lu(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Va(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function cu(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function Ya(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.hypot(r,i,n,s)}function Xa(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return r*r+i*i+n*n+s*s}function un(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function vn(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function fu(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function uu(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Ga(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=s*o,e}function ja(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function vu(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],o=r[0]*i[3]-r[3]*i[0],a=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],c=r[2]*i[3]-r[3]*i[2],f=t[0],_=t[1],m=t[2],v=t[3];return e[0]=_*c-m*l+v*a,e[1]=-(f*c)+m*o-v*s,e[2]=f*l-_*o+v*n,e[3]=-(f*a)+_*s-m*n,e}function Za(e,t,r,i){var n=t[0],s=t[1],o=t[2],a=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=o+i*(r[2]-o),e[3]=a+i*(r[3]-a),e}function du(e,t){t=t||1;var r,i,n,s,o,a;do r=It()*2-1,i=It()*2-1,o=r*r+i*i;while(o>=1);do n=It()*2-1,s=It()*2-1,a=n*n+s*s;while(a>=1);var l=Math.sqrt((1-o)/a);return e[0]=t*r,e[1]=t*i,e[2]=t*n*l,e[3]=t*s*l,e}function pu(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,e}function mu(e,t,r){var i=t[0],n=t[1],s=t[2],o=r[0],a=r[1],l=r[2],c=r[3],f=c*i+a*s-l*n,_=c*n+l*i-o*s,m=c*s+o*n-a*i,v=-o*i-a*n-l*s;return e[0]=f*c+v*-o+_*-l-m*-a,e[1]=_*c+v*-a+m*-o-f*-l,e[2]=m*c+v*-l+f*-a-_*-o,e[3]=t[3],e}function _u(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function yu(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ka(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Qa(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(r-o)<=K*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=K*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=K*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=K*Math.max(1,Math.abs(s),Math.abs(c))}var gu=Ua,wu=qa,Mu=Wa,xu=Ya,Eu=Xa,bu=un,Tu=vn,Pu=function(){var e=Da();return function(t,r,i,n,s,o){var a,l;for(r||(r=4),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,a=i;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}(),Lu=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Da,clone:Ha,fromValues:Na,copy:Fa,set:ka,add:Ba,subtract:Ua,multiply:qa,divide:Wa,ceil:au,floor:su,min:ou,max:hu,round:lu,scale:Va,scaleAndAdd:cu,distance:Ya,squaredDistance:Xa,length:un,squaredLength:vn,negate:fu,inverse:uu,normalize:Ga,dot:ja,cross:vu,lerp:Za,random:du,transformMat4:pu,transformQuat:mu,zero:_u,str:yu,exactEquals:Ka,equals:Qa,sub:gu,mul:wu,div:Mu,dist:xu,sqrDist:Eu,len:bu,sqrLen:Tu,forEach:Pu});function Li(){var e=new le(4);return le!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Cu(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ja(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function Su(e,t){var r=Math.acos(t[3])*2,i=Math.sin(r/2);return i>K?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function Ru(e,t){var r=pn(e,t);return Math.acos(2*r*r-1)}function es(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1],c=r[2],f=r[3];return e[0]=i*f+o*a+n*c-s*l,e[1]=n*f+o*l+s*a-i*c,e[2]=s*f+o*c+i*l-n*a,e[3]=o*f-i*a-n*l-s*c,e}function ts(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=n*l+s*a,e[2]=s*l-n*a,e[3]=o*l-i*a,e}function rs(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*a,e[1]=n*l+o*a,e[2]=s*l+i*a,e[3]=o*l-n*a,e}function is(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=n*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e}function Au(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function ns(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=Math.sqrt(r*r+i*i+n*n),a=Math.exp(s),l=o>0?a*Math.sin(o)/o:0;return e[0]=r*l,e[1]=i*l,e[2]=n*l,e[3]=a*Math.cos(o),e}function as(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=Math.sqrt(r*r+i*i+n*n),a=o>0?Math.atan2(o,s)/o:0;return e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=.5*Math.log(r*r+i*i+n*n+s*s),e}function Iu(e,t,r){return as(e,t),os(e,e,r),ns(e,e),e}function Ci(e,t,r,i){var n=t[0],s=t[1],o=t[2],a=t[3],l=r[0],c=r[1],f=r[2],_=r[3],m,v,h,P,w;return v=n*l+s*c+o*f+a*_,v<0&&(v=-v,l=-l,c=-c,f=-f,_=-_),1-v>K?(m=Math.acos(v),h=Math.sin(m),P=Math.sin((1-i)*m)/h,w=Math.sin(i*m)/h):(P=1-i,w=i),e[0]=P*n+w*l,e[1]=P*s+w*c,e[2]=P*o+w*f,e[3]=P*a+w*_,e}function zu(e){var t=It(),r=It(),i=It(),n=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=s*Math.sin(2*Math.PI*i),e[3]=s*Math.cos(2*Math.PI*i),e}function $u(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-n*a,e[3]=s*a,e}function Ou(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function ss(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[s*3+s]-t[o*3+o]+1),e[n]=.5*i,i=.5/i,e[3]=(t[s*3+o]-t[o*3+s])*i,e[s]=(t[s*3+n]+t[n*3+s])*i,e[o]=(t[o*3+n]+t[n*3+o])*i}return e}function Du(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var s=Math.sin(t),o=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),f=Math.cos(i);return e[0]=s*l*f-o*a*c,e[1]=o*a*f+s*l*c,e[2]=o*l*c-s*a*f,e[3]=o*l*f+s*a*c,e}function Hu(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Nu=Ha,Fu=Na,dn=Fa,ku=ka,Bu=Ba,Uu=es,os=Va,pn=ja,qu=Za,mn=un,Wu=mn,_n=vn,Vu=_n,yn=Ga,Yu=Ka,Xu=Qa,Gu=function(){var e=ln(),t=cn(1,0,0),r=cn(0,1,0);return function(i,n,s){var o=fn(n,s);return o<-.999999?(Pi(e,t,n),Oa(e)<1e-6&&Pi(e,r,n),$a(e,e),Ja(i,e,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Pi(e,n,s),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+o,yn(i,i))}}(),ju=function(){var e=Li(),t=Li();return function(r,i,n,s,o,a){return Ci(e,i,o,a),Ci(t,n,s,a),Ci(r,e,t,2*a*(1-a)),r}}(),Zu=function(){var e=_a();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],yn(t,ss(t,e))}}(),Ku=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Li,identity:Cu,setAxisAngle:Ja,getAxisAngle:Su,getAngle:Ru,multiply:es,rotateX:ts,rotateY:rs,rotateZ:is,calculateW:Au,exp:ns,ln:as,pow:Iu,slerp:Ci,random:zu,invert:$u,conjugate:Ou,fromMat3:ss,fromEuler:Du,str:Hu,clone:Nu,fromValues:Fu,copy:dn,set:ku,add:Bu,mul:Uu,scale:os,dot:pn,lerp:qu,length:mn,len:Wu,squaredLength:_n,sqrLen:Vu,normalize:yn,exactEquals:Yu,equals:Xu,rotationTo:Gu,sqlerp:ju,setAxes:Zu});function Qu(){var e=new le(8);return le!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function Ju(e){var t=new le(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function ev(e,t,r,i,n,s,o,a){var l=new le(8);return l[0]=e,l[1]=t,l[2]=r,l[3]=i,l[4]=n,l[5]=s,l[6]=o,l[7]=a,l}function tv(e,t,r,i,n,s,o){var a=new le(8);a[0]=e,a[1]=t,a[2]=r,a[3]=i;var l=n*.5,c=s*.5,f=o*.5;return a[4]=l*i+c*r-f*t,a[5]=c*i+f*e-l*r,a[6]=f*i+l*t-c*e,a[7]=-l*e-c*t-f*r,a}function hs(e,t,r){var i=r[0]*.5,n=r[1]*.5,s=r[2]*.5,o=t[0],a=t[1],l=t[2],c=t[3];return e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=i*c+n*l-s*a,e[5]=n*c+s*o-i*l,e[6]=s*c+i*a-n*o,e[7]=-i*o-n*a-s*l,e}function rv(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0]*.5,e[5]=t[1]*.5,e[6]=t[2]*.5,e[7]=0,e}function iv(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function nv(e,t){var r=Li();Ta(r,t);var i=new le(3);return Ea(i,t),hs(e,r,i),e}function ls(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function av(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function sv(e,t,r,i,n,s,o,a,l){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e}var ov=dn;function hv(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var lv=dn;function cv(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function fv(e,t){var r=t[4],i=t[5],n=t[6],s=t[7],o=-t[0],a=-t[1],l=-t[2],c=t[3];return e[0]=(r*c+s*o+i*l-n*a)*2,e[1]=(i*c+s*a+n*o-r*l)*2,e[2]=(n*c+s*l+r*a-i*o)*2,e}function uv(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=r[0]*.5,l=r[1]*.5,c=r[2]*.5,f=t[4],_=t[5],m=t[6],v=t[7];return e[0]=i,e[1]=n,e[2]=s,e[3]=o,e[4]=o*a+n*c-s*l+f,e[5]=o*l+s*a-i*c+_,e[6]=o*c+i*l-n*a+m,e[7]=-i*a-n*l-s*c+v,e}function vv(e,t,r){var i=-t[0],n=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],f=t[7],_=a*o+f*i+l*s-c*n,m=l*o+f*n+c*i-a*s,v=c*o+f*s+a*n-l*i,h=f*o-a*i-l*n-c*s;return ts(e,t,r),i=e[0],n=e[1],s=e[2],o=e[3],e[4]=_*o+h*i+m*s-v*n,e[5]=m*o+h*n+v*i-_*s,e[6]=v*o+h*s+_*n-m*i,e[7]=h*o-_*i-m*n-v*s,e}function dv(e,t,r){var i=-t[0],n=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],f=t[7],_=a*o+f*i+l*s-c*n,m=l*o+f*n+c*i-a*s,v=c*o+f*s+a*n-l*i,h=f*o-a*i-l*n-c*s;return rs(e,t,r),i=e[0],n=e[1],s=e[2],o=e[3],e[4]=_*o+h*i+m*s-v*n,e[5]=m*o+h*n+v*i-_*s,e[6]=v*o+h*s+_*n-m*i,e[7]=h*o-_*i-m*n-v*s,e}function pv(e,t,r){var i=-t[0],n=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],f=t[7],_=a*o+f*i+l*s-c*n,m=l*o+f*n+c*i-a*s,v=c*o+f*s+a*n-l*i,h=f*o-a*i-l*n-c*s;return is(e,t,r),i=e[0],n=e[1],s=e[2],o=e[3],e[4]=_*o+h*i+m*s-v*n,e[5]=m*o+h*n+v*i-_*s,e[6]=v*o+h*s+_*n-m*i,e[7]=h*o-_*i-m*n-v*s,e}function mv(e,t,r){var i=r[0],n=r[1],s=r[2],o=r[3],a=t[0],l=t[1],c=t[2],f=t[3];return e[0]=a*o+f*i+l*s-c*n,e[1]=l*o+f*n+c*i-a*s,e[2]=c*o+f*s+a*n-l*i,e[3]=f*o-a*i-l*n-c*s,a=t[4],l=t[5],c=t[6],f=t[7],e[4]=a*o+f*i+l*s-c*n,e[5]=l*o+f*n+c*i-a*s,e[6]=c*o+f*s+a*n-l*i,e[7]=f*o-a*i-l*n-c*s,e}function _v(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1],c=r[2],f=r[3];return e[0]=i*f+o*a+n*c-s*l,e[1]=n*f+o*l+s*a-i*c,e[2]=s*f+o*c+i*l-n*a,e[3]=o*f-i*a-n*l-s*c,a=r[4],l=r[5],c=r[6],f=r[7],e[4]=i*f+o*a+n*c-s*l,e[5]=n*f+o*l+s*a-i*c,e[6]=s*f+o*c+i*l-n*a,e[7]=o*f-i*a-n*l-s*c,e}function yv(e,t,r,i){if(Math.abs(i)<K)return ls(e,t);var n=Math.hypot(r[0],r[1],r[2]);i=i*.5;var s=Math.sin(i),o=s*r[0]/n,a=s*r[1]/n,l=s*r[2]/n,c=Math.cos(i),f=t[0],_=t[1],m=t[2],v=t[3];e[0]=f*c+v*o+_*l-m*a,e[1]=_*c+v*a+m*o-f*l,e[2]=m*c+v*l+f*a-_*o,e[3]=v*c-f*o-_*a-m*l;var h=t[4],P=t[5],w=t[6],b=t[7];return e[4]=h*c+b*o+P*l-w*a,e[5]=P*c+b*a+w*o-h*l,e[6]=w*c+b*l+h*a-P*o,e[7]=b*c-h*o-P*a-w*l,e}function gv(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e}function cs(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=r[4],l=r[5],c=r[6],f=r[7],_=t[4],m=t[5],v=t[6],h=t[7],P=r[0],w=r[1],b=r[2],R=r[3];return e[0]=i*R+o*P+n*b-s*w,e[1]=n*R+o*w+s*P-i*b,e[2]=s*R+o*b+i*w-n*P,e[3]=o*R-i*P-n*w-s*b,e[4]=i*f+o*a+n*c-s*l+_*R+h*P+m*b-v*w,e[5]=n*f+o*l+s*a-i*c+m*R+h*w+v*P-_*b,e[6]=s*f+o*c+i*l-n*a+v*R+h*b+_*w-m*P,e[7]=o*f-i*a-n*l-s*c+h*R-_*P-m*w-v*b,e}var wv=cs;function Mv(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e}var fs=pn;function xv(e,t,r,i){var n=1-i;return fs(t,r)<0&&(i=-i),e[0]=t[0]*n+r[0]*i,e[1]=t[1]*n+r[1]*i,e[2]=t[2]*n+r[2]*i,e[3]=t[3]*n+r[3]*i,e[4]=t[4]*n+r[4]*i,e[5]=t[5]*n+r[5]*i,e[6]=t[6]*n+r[6]*i,e[7]=t[7]*n+r[7]*i,e}function Ev(e,t){var r=Si(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e}function bv(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var us=mn,Tv=us,Si=_n,Pv=Si;function Lv(e,t){var r=Si(t);if(r>0){r=Math.sqrt(r);var i=t[0]/r,n=t[1]/r,s=t[2]/r,o=t[3]/r,a=t[4],l=t[5],c=t[6],f=t[7],_=i*a+n*l+s*c+o*f;e[0]=i,e[1]=n,e[2]=s,e[3]=o,e[4]=(a-i*_)/r,e[5]=(l-n*_)/r,e[6]=(c-s*_)/r,e[7]=(f-o*_)/r}return e}function Cv(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function Sv(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function Rv(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],f=t[0],_=t[1],m=t[2],v=t[3],h=t[4],P=t[5],w=t[6],b=t[7];return Math.abs(r-f)<=K*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-_)<=K*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(n-m)<=K*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-v)<=K*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(o-h)<=K*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-P)<=K*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(l-w)<=K*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-b)<=K*Math.max(1,Math.abs(c),Math.abs(b))}var Av=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Qu,clone:Ju,fromValues:ev,fromRotationTranslationValues:tv,fromRotationTranslation:hs,fromTranslation:rv,fromRotation:iv,fromMat4:nv,copy:ls,identity:av,set:sv,getReal:ov,getDual:hv,setReal:lv,setDual:cv,getTranslation:fv,translate:uv,rotateX:vv,rotateY:dv,rotateZ:pv,rotateByQuatAppend:mv,rotateByQuatPrepend:_v,rotateAroundAxis:yv,add:gv,multiply:cs,mul:wv,scale:Mv,dot:fs,lerp:xv,invert:Ev,conjugate:bv,length:us,len:Tv,squaredLength:Si,sqrLen:Pv,normalize:Lv,str:Cv,exactEquals:Sv,equals:Rv});function vs(){var e=new le(2);return le!=Float32Array&&(e[0]=0,e[1]=0),e}function Iv(e){var t=new le(2);return t[0]=e[0],t[1]=e[1],t}function zv(e,t){var r=new le(2);return r[0]=e,r[1]=t,r}function $v(e,t){return e[0]=t[0],e[1]=t[1],e}function Ov(e,t,r){return e[0]=t,e[1]=r,e}function Dv(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function ds(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function ps(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function ms(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Hv(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Nv(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Fv(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function kv(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Bv(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Uv(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function qv(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function _s(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.hypot(r,i)}function ys(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function gs(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function ws(e){var t=e[0],r=e[1];return t*t+r*r}function Wv(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Vv(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Yv(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function Xv(e,t){return e[0]*t[0]+e[1]*t[1]}function Gv(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function jv(e,t,r,i){var n=t[0],s=t[1];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e}function Zv(e,t){t=t||1;var r=It()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Kv(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function Qv(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function Jv(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function ed(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function td(e,t,r,i){var n=t[0]-r[0],s=t[1]-r[1],o=Math.sin(i),a=Math.cos(i);return e[0]=n*a-s*o+r[0],e[1]=n*o+s*a+r[1],e}function rd(e,t){var r=e[0],i=e[1],n=t[0],s=t[1],o=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+s*s),a=o&&(r*n+i*s)/o;return Math.acos(Math.min(Math.max(a,-1),1))}function id(e){return e[0]=0,e[1]=0,e}function nd(e){return"vec2("+e[0]+", "+e[1]+")"}function ad(e,t){return e[0]===t[0]&&e[1]===t[1]}function sd(e,t){var r=e[0],i=e[1],n=t[0],s=t[1];return Math.abs(r-n)<=K*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=K*Math.max(1,Math.abs(i),Math.abs(s))}var od=gs,hd=ds,ld=ps,cd=ms,fd=_s,ud=ys,vd=ws,dd=function(){var e=vs();return function(t,r,i,n,s,o){var a,l;for(r||(r=2),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,a=i;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],s(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}(),pd=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:vs,clone:Iv,fromValues:zv,copy:$v,set:Ov,add:Dv,subtract:ds,multiply:ps,divide:ms,ceil:Hv,floor:Nv,min:Fv,max:kv,round:Bv,scale:Uv,scaleAndAdd:qv,distance:_s,squaredDistance:ys,length:gs,squaredLength:ws,negate:Wv,inverse:Vv,normalize:Yv,dot:Xv,cross:Gv,lerp:jv,random:Zv,transformMat2:Kv,transformMat2d:Qv,transformMat3:Jv,transformMat4:ed,rotate:td,angle:rd,zero:id,str:nd,exactEquals:ad,equals:sd,len:od,sub:hd,mul:ld,div:cd,dist:fd,sqrDist:ud,sqrLen:vd,forEach:dd}),md=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",glMatrix:ll,mat2:$l,mat2d:nc,mat3:$c,mat4:xf,quat:Ku,quat2:Av,vec2:pd,vec3:nu,vec4:Lu}),at=rh(md);function _d(e,t,r){return Math.min(Math.max(e,t),r)}var Fr=_d,yd=256,Ms=256,Ri=Fr,gd=at.vec4,Ai=at.vec3,kr=at.mat4;function xs(e,t,r){var i=e.createShader(t);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw e.getShaderInfoLog(i);return i}function wd(e,t,r,i,n){var s=xs(e,e.VERTEX_SHADER,t),o=xs(e,e.FRAGMENT_SHADER,r),a=e.createProgram();if(e.attachShader(a,s),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw e.getProgramInfoLog(a);for(var l=0;l<i.length;l++){var c=i[l];if(a[c]=e.getAttribLocation(a,c),a[c]===-1)throw new Error("Shader program has no "+c+" attribute")}for(var f=0;f<n.length;f++){var _=n[f];if(a[_]=e.getUniformLocation(a,_),a[_]===-1)throw new Error("Shader program has no "+_+" uniform")}return a}function Md(e,t){for(var r=e.getAttachedShaders(t),i=0;i<r.length;i++){var n=r[i];e.detachShader(t,n),e.deleteShader(n)}e.deleteProgram(t)}function gn(e,t,r,i){var n=e.createBuffer();return e.bindBuffer(t,n),e.bufferData(t,i,r),n}function xd(e,t,r,i){return{vertexIndices:gn(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW,new Uint16Array(t)),vertexPositions:gn(e,e.ARRAY_BUFFER,e.STATIC_DRAW,new Float32Array(r)),textureCoords:gn(e,e.ARRAY_BUFFER,e.STATIC_DRAW,new Float32Array(i))}}function Ed(e,t){e.deleteBuffer(t.vertexIndices),e.deleteBuffer(t.vertexPositions),e.deleteBuffer(t.textureCoords)}function bd(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++)e.enableVertexAttribArray(i)}function Td(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++)e.disableVertexAttribArray(i)}function Pd(e,t,r){e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r._texture),e.uniform1i(t.uSampler,0)}function Ld(e,t,r,i){var n=((r+1)*Ms-i)/(Ms*yd);e.uniform1f(t.uDepth,n)}var Cd=1,Sd=gd.create(),Es=kr.create();kr.identity(Es);function Rd(e,t,r){var i=Cd;t&&t.opacity!=null&&(i=t.opacity),e.uniform1f(r.opacity,i);var n=Sd;t&&t.colorOffset&&(n=t.colorOffset),e.uniform4fv(r.colorOffset,n);var s=Es;t&&t.colorMatrix&&(s=t.colorMatrix),e.uniformMatrix4fv(r.colorMatrix,!1,s)}var bs=Ai.create(),Ts=Ai.create();function Ad(e,t,r,i){if(r.x===0&&r.width===1&&r.y===0&&r.height===1){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),kr.identity(i);return}var n=r.x,s=Ri(n,0,1),o=s-n,a=1-s,l=Ri(r.width-o,0,a),c=r.width-l,f=1-r.height-r.y,_=Ri(f,0,1),m=_-f,v=1-_,h=Ri(r.height-m,0,v),P=r.height-h;Ai.set(Ts,r.width/l,r.height/h,1),Ai.set(bs,(c-o)/l,(P-m)/h,0),kr.identity(i),kr.translate(i,i,bs),kr.scale(i,i,Ts),e.viewport(e.drawingBufferWidth*s,e.drawingBufferHeight*_,e.drawingBufferWidth*l,e.drawingBufferHeight*h)}var Ps={createShaderProgram:wd,destroyShaderProgram:Md,createConstantBuffers:xd,destroyConstantBuffers:Ed,enableAttributes:bd,disableAttributes:Td,setTexture:Pd,setDepth:Ld,setViewport:Ad,setupPixelEffectUniforms:Rd},Id=["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uProjMatrix;","varying vec2 vTextureCoord;","void main(void) {","  gl_Position = uViewportMatrix * uProjMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);","  gl_Position.z = uDepth * gl_Position.w;","  vTextureCoord = aTextureCoord;","}"].join(`
`),zd=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec2 vTextureCoord;","void main(void) {","  vec4 color = texture2D(uSampler, vTextureCoord) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join(`
`),Er=at.mat4,Ls=at.vec3,$d=Se,Nt=Ps,Od=Nt.createConstantBuffers,Dd=Nt.destroyConstantBuffers,Hd=Nt.createShaderProgram,Nd=Nt.destroyShaderProgram,Fd=Nt.enableAttributes,kd=Nt.disableAttributes,Bd=Nt.setViewport,Ud=Nt.setupPixelEffectUniforms,qd=Nt.setDepth,Wd=Nt.setTexture,Vd=Id,Yd=zd,Cs=[0,1,2,0,2,3],Xd=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],Gd=[0,0,1,0,1,1,0,1],jd=["aVertexPosition","aTextureCoord"],Zd=["uDepth","uOpacity","uSampler","uProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix"];function ei(e){this.gl=e,this.projMatrix=Er.create(),this.viewportMatrix=Er.create(),this.translateVector=Ls.create(),this.scaleVector=Ls.create(),this.constantBuffers=Od(e,Cs,Xd,Gd),this.shaderProgram=Hd(e,Vd,Yd,jd,Zd)}ei.prototype.destroy=function(){Dd(this.gl,this.constantBuffers),Nd(this.gl,this.shaderProgram),$d(this)},ei.prototype.startLayer=function(e,t){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,s=this.viewportMatrix;r.useProgram(i),Fd(r,i),Bd(r,e,t,s),r.uniformMatrix4fv(i.uViewportMatrix,!1,s),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),r.vertexAttribPointer(i.aTextureCoord,2,r.FLOAT,r.FALSE,0,0),Ud(r,e.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},ei.prototype.endLayer=function(e,t){var r=this.gl,i=this.shaderProgram;kd(r,i)},ei.prototype.renderTile=function(e,t,r,i){var n=this.gl,s=this.shaderProgram,o=this.constantBuffers,a=this.projMatrix,l=this.translateVector,c=this.scaleVector;l[0]=e.centerX(),l[1]=e.centerY(),l[2]=-.5,c[0]=e.scaleX(),c[1]=e.scaleY(),c[2]=1,Er.copy(a,r.view().projection()),Er.rotateX(a,a,e.rotX()),Er.rotateY(a,a,e.rotY()),Er.translate(a,a,l),Er.scale(a,a,c),n.uniformMatrix4fv(s.uProjMatrix,!1,a),qd(n,s,i,e.z),Wd(n,s,t),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.vertexIndices),n.drawElements(n.TRIANGLES,Cs.length,n.UNSIGNED_SHORT,0)};var Ss=ei,Kd=Ss,Qd=Ht;function Rs(){this.constructor.super_.apply(this,arguments)}Qd(Rs,Kd);var As=Rs,Jd=Ss,ep=Ht;function Is(){this.constructor.super_.apply(this,arguments)}ep(Is,Jd);var zs=Is,tp=["attribute vec3 aVertexPosition;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uInvProjMatrix;","varying vec4 vRay;","void main(void) {","  vRay = uInvProjMatrix * vec4(aVertexPosition.xy, 1.0, 1.0);","  gl_Position = uViewportMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);","}"].join(`
`),rp=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform float uTextureX;","uniform float uTextureY;","uniform float uTextureWidth;","uniform float uTextureHeight;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec4 vRay;","const float PI = 3.14159265358979323846264;","void main(void) {","  float r = inversesqrt(vRay.x * vRay.x + vRay.y * vRay.y + vRay.z * vRay.z);","  float phi  = acos(vRay.y * r);","  float theta = atan(vRay.x, -1.0*vRay.z);","  float s = 0.5 + 0.5 * theta / PI;","  float t = 1.0 - phi / PI;","  s = s * uTextureWidth + uTextureX;","  t = t * uTextureHeight + uTextureY;","  vec4 color = texture2D(uSampler, vec2(s, t)) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join(`
`),Ii=at.mat4,ip=Se,Ft=Ps,np=Ft.createConstantBuffers,ap=Ft.destroyConstantBuffers,sp=Ft.createShaderProgram,op=Ft.destroyShaderProgram,hp=Ft.enableAttributes,lp=Ft.disableAttributes,cp=Ft.setViewport,fp=Ft.setupPixelEffectUniforms,up=Ft.setDepth,vp=Ft.setTexture,dp=tp,pp=rp,$s=[0,1,2,0,2,3],mp=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],_p=[0,0,1,0,1,1,0,1],yp=["aVertexPosition"],gp=["uDepth","uOpacity","uSampler","uInvProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix","uTextureX","uTextureY","uTextureWidth","uTextureHeight"];function ti(e){this.gl=e,this.invProjMatrix=Ii.create(),this.viewportMatrix=Ii.create(),this.constantBuffers=np(e,$s,mp,_p),this.shaderProgram=sp(e,dp,pp,yp,gp)}ti.prototype.destroy=function(){ap(this.gl,this.constantBuffers),op(this.gl,this.shaderProgram),ip(this)},ti.prototype.startLayer=function(e,t){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,s=this.invProjMatrix,o=this.viewportMatrix;r.useProgram(i),hp(r,i),cp(r,e,t,o),r.uniformMatrix4fv(i.uViewportMatrix,!1,o),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),Ii.copy(s,e.view().projection()),Ii.invert(s,s),r.uniformMatrix4fv(i.uInvProjMatrix,!1,s);var a=e.effects().textureCrop||{},l=a.x!=null?a.x:0,c=a.y!=null?a.y:0,f=a.width!=null?a.width:1,_=a.height!=null?a.height:1;r.uniform1f(i.uTextureX,l),r.uniform1f(i.uTextureY,c),r.uniform1f(i.uTextureWidth,f),r.uniform1f(i.uTextureHeight,_),fp(r,e.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},ti.prototype.endLayer=function(e,t){var r=this.gl,i=this.shaderProgram;lp(r,i)},ti.prototype.renderTile=function(e,t,r,i){var n=this.gl,s=this.shaderProgram,o=this.constantBuffers;up(n,s,i,e.z),vp(n,s,t),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.vertexIndices),n.drawElements(n.TRIANGLES,$s.length,n.UNSIGNED_SHORT,0)};var Os=ti,wp=As,Mp=zs,xp=Os;function Ep(e){switch(e.type){case"webgl":e.registerRenderer("flat","flat",Mp),e.registerRenderer("cube","rectilinear",wp),e.registerRenderer("equirect","rectilinear",xp);break;default:throw new Error("Unknown stage type: "+e.type)}}var Ds=Ep;function bp(){for(var e=0,t=0;t<arguments.length;t++){var r=arguments[t];e+=r,e+=r<<10,e^=r>>6}return e+=e<<3,e^=e>>11,e+=e<<15,e>=0?e:-e}var zi=bp;function Tp(e,t){return(+e%(t=+t)+t)%t}var cr=Tp,wn=cr,Pp=64;function br(e){if(e!=null&&(!isFinite(e)||Math.floor(e)!==e||e<1))throw new Error("Set: invalid capacity");this._capacity=this._capacity||Pp,this._buckets=[];for(var t=0;t<this._capacity;t++)this._buckets.push([]);this._size=0}br.prototype.add=function(e){for(var t=wn(e.hash(),this._capacity),r=this._buckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n))return r[i]=e,n}return r.push(e),this._size++,null},br.prototype.remove=function(e){for(var t=wn(e.hash(),this._capacity),r=this._buckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n)){for(var s=i;s<r.length-1;s++)r[s]=r[s+1];return r.length=r.length-1,this._size--,n}}return null},br.prototype.has=function(e){for(var t=wn(e.hash(),this._capacity),r=this._buckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n))return!0}return!1},br.prototype.size=function(){return this._size},br.prototype.clear=function(){for(var e=0;e<this._capacity;e++)this._buckets[e].length=0;this._size=0},br.prototype.forEach=function(e){for(var t=0,r=0;r<this._capacity;r++)for(var i=this._buckets[r],n=0;n<i.length;n++)e(i[n]),t+=1;return t};var Hs=br,Lp=Hs;function Mn(){this._stack=[],this._visited=new Lp,this._vertices=null}Mn.prototype.search=function(e,t,r){var i=this._stack,n=this._visited,s=this._vertices,o=0;for(this._clear(),i.push(t);i.length>0;){var a=i.pop();if(!n.has(a)&&!!e.intersects(a.vertices(s))){n.add(a);for(var l=a.neighbors(),c=0;c<l.length;c++)i.push(l[c]);r.push(a),o++}}return this._vertices=s,this._clear(),o},Mn.prototype._clear=function(){this._stack.length=0,this._visited.clear()};var Ns=Mn,Cp=cr;function Zt(e){if(!isFinite(e)||Math.floor(e)!==e||e<0)throw new Error("LruMap: invalid capacity");this._capacity=e,this._keys=new Array(this._capacity),this._values=new Array(this._capacity),this._start=0,this._size=0}Zt.prototype._index=function(e){return Cp(this._start+e,this._capacity)},Zt.prototype.get=function(e){for(var t=0;t<this._size;t++){var r=this._keys[this._index(t)];if(e.equals(r))return this._values[this._index(t)]}return null},Zt.prototype.set=function(e,t){if(this._capacity===0)return e;this.del(e);var r=this._size===this._capacity?this._keys[this._index(0)]:null;return this._keys[this._index(this._size)]=e,this._values[this._index(this._size)]=t,this._size<this._capacity?this._size++:this._start=this._index(1),r},Zt.prototype.del=function(e){for(var t=0;t<this._size;t++)if(e.equals(this._keys[this._index(t)])){for(var r=this._values[this._index(t)],i=t;i<this._size-1;i++)this._keys[this._index(i)]=this._keys[this._index(i+1)],this._values[this._index(i)]=this._values[this._index(i+1)];return this._size--,r}return null},Zt.prototype.has=function(e){for(var t=0;t<this._size;t++)if(e.equals(this._keys[this._index(t)]))return!0;return!1},Zt.prototype.size=function(){return this._size},Zt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._start=0,this._size=0},Zt.prototype.forEach=function(e){for(var t=0,r=0;r<this._size;r++)e(this._keys[this._index(r)],this._values[this._index(r)]),t+=1;return t};var Fs=Zt;function $i(e){this._fallbackOnly=!!e.fallbackOnly}$i.prototype.numHorizontalTiles=function(){return Math.ceil(this.width()/this.tileWidth())},$i.prototype.numVerticalTiles=function(){return Math.ceil(this.height()/this.tileHeight())},$i.prototype.fallbackOnly=function(){return this._fallbackOnly};var xn=$i;function Sp(e,t){return e<t?-1:e>t?1:0}var ri=Sp,Rp=ri;function Ap(e,t){for(var r=[],i=0;i<e.length;i++)r.push(new t(e[i]));return r.sort(function(n,s){return Rp(n.width(),s.width())}),r}function Ip(e){for(var t=[],r=0;r<e.length;r++)e[r]._fallbackOnly||t.push(e[r]);if(!t.length)throw new Error("No selectable levels in list");return t}var ii={makeLevelList:Ap,makeSelectableLevelList:Ip};function zp(e){var t=typeof e;if(t==="object"){if(e===null)return"null";if(Object.prototype.toString.call(e)==="[object Array]")return"array";if(Object.prototype.toString.call(e)==="[object RegExp]")return"regexp"}return t}var ni=zp,$p=Ht,Op=zi,Dp=Ns,Hp=Fs,Np=xn,Fp=ii.makeLevelList,kp=ii.makeSelectableLevelList,Oi=Fr,Di=ri,Bp=ni,vt=at.vec3,En=at.vec4,Up=64,Tr="fudlrb",Pr={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},bn=vt.create();function ai(e,t,r,i){t&&vt.rotateZ(e,e,bn,t),r&&vt.rotateX(e,e,bn,r),i&&vt.rotateY(e,e,bn,i)}for(var Tn={},Pn=0;Pn<Tr.length;Pn++){var ks=Tr[Pn],Bs=Pr[ks],Us=vt.fromValues(0,0,-1);ai(Us,0,Bs.x,Bs.y),Tn[ks]=Us}var Hi={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},Ln=[[0,1],[1,0],[0,-1],[-1,0]];function Fe(e,t,r,i,n){this.face=e,this.x=t,this.y=r,this.z=i,this._geometry=n,this._level=n.levelList[i]}Fe.prototype.rotX=function(){return Pr[this.face].x},Fe.prototype.rotY=function(){return Pr[this.face].y},Fe.prototype.centerX=function(){return(this.x+.5)/this._level.numHorizontalTiles()-.5},Fe.prototype.centerY=function(){return .5-(this.y+.5)/this._level.numVerticalTiles()},Fe.prototype.scaleX=function(){return 1/this._level.numHorizontalTiles()},Fe.prototype.scaleY=function(){return 1/this._level.numVerticalTiles()},Fe.prototype.vertices=function(e){e||(e=[vt.create(),vt.create(),vt.create(),vt.create()]);var t=Pr[this.face];function r(a,l,c){vt.set(a,l,c,-.5),ai(a,0,t.x,t.y)}var i=this.centerX()-this.scaleX()/2,n=this.centerX()+this.scaleX()/2,s=this.centerY()-this.scaleY()/2,o=this.centerY()+this.scaleY()/2;return r(e[0],i,o),r(e[1],n,o),r(e[2],n,s),r(e[3],i,s),e},Fe.prototype.parent=function(){if(this.z===0)return null;var e=this.face,t=this.z,r=this.x,i=this.y,n=this._geometry,s=n.levelList[t],o=n.levelList[t-1],a=Math.floor(r/s.numHorizontalTiles()*o.numHorizontalTiles()),l=Math.floor(i/s.numVerticalTiles()*o.numVerticalTiles()),c=t-1;return new Fe(e,a,l,c,n)},Fe.prototype.children=function(e){if(this.z===this._geometry.levelList.length-1)return null;var t=this.face,r=this.z,i=this.x,n=this.y,s=this._geometry,o=s.levelList[r],a=s.levelList[r+1],l=a.numHorizontalTiles()/o.numHorizontalTiles(),c=a.numVerticalTiles()/o.numVerticalTiles();e=e||[];for(var f=0;f<l;f++)for(var _=0;_<c;_++){var m=l*i+f,v=c*n+_,h=r+1;e.push(new Fe(t,m,v,h,s))}return e},Fe.prototype.neighbors=function(){var e=this._geometry,t=e._neighborsCache,r=t.get(this);if(r)return r;for(var i=e._vec,n=this.face,s=this.x,o=this.y,a=this.z,l=this._level,c=l.numHorizontalTiles(),f=l.numVerticalTiles(),_=[],m=0;m<Ln.length;m++){var v=Ln[m][0],h=Ln[m][1],P=s+v,w=o+h,b=a,R=n;if(P<0||P>=c||w<0||w>=f){var D=this.centerX(),O=this.centerY();P<0?(vt.set(i,-.5,O,-.5),R=Hi[n][0]):P>=c?(vt.set(i,.5,O,-.5),R=Hi[n][1]):w<0?(vt.set(i,D,.5,-.5),R=Hi[n][2]):w>=f&&(vt.set(i,D,-.5,-.5),R=Hi[n][3]);var B;B=Pr[n],ai(i,0,B.x,B.y),B=Pr[R],ai(i,0,-B.x,-B.y),P=Oi(Math.floor((.5+i[0])*c),0,c-1),w=Oi(Math.floor((.5-i[1])*f),0,f-1)}_.push(new Fe(R,P,w,b,e))}return t.set(this,_),_},Fe.prototype.hash=function(){return Op(Tr.indexOf(this.face),this.z,this.y,this.x)},Fe.prototype.equals=function(e){return this._geometry===e._geometry&&this.face===e.face&&this.z===e.z&&this.y===e.y&&this.x===e.x},Fe.prototype.cmp=function(e){return Di(this.z,e.z)||Di(Tr.indexOf(this.face),Tr.indexOf(e.face))||Di(this.y,e.y)||Di(this.x,e.x)},Fe.prototype.str=function(){return"CubeTile("+tile.face+", "+tile.x+", "+tile.y+", "+tile.z+")"};function Lr(e){if(this.constructor.super_.call(this,e),this._size=e.size,this._tileSize=e.tileSize,this._size%this._tileSize!=0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}$p(Lr,Np),Lr.prototype.width=function(){return this._size},Lr.prototype.height=function(){return this._size},Lr.prototype.tileWidth=function(){return this._tileSize},Lr.prototype.tileHeight=function(){return this._tileSize},Lr.prototype._validateWithParentLevel=function(e){var t=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),s=this.numHorizontalTiles(),o=this.numVerticalTiles(),a=e.width(),l=e.height(),c=e.tileWidth(),f=e.tileHeight(),_=e.numHorizontalTiles(),m=e.numVerticalTiles();if(t%a!=0)throw new Error("Level width must be multiple of parent level: "+t+" vs. "+a);if(r%l!=0)throw new Error("Level height must be multiple of parent level: "+r+" vs. "+l);if(s%_!=0)throw new Error("Number of horizontal tiles must be multiple of parent level: "+s+" ("+t+"/"+i+") vs. "+_+" ("+a+"/"+c+")");if(o%m!=0)throw new Error("Number of vertical tiles must be multiple of parent level: "+o+" ("+r+"/"+n+") vs. "+m+" ("+l+"/"+f+")")};function Kt(e){if(Bp(e)!=="array")throw new Error("Level list must be an array");this.levelList=Fp(e,Lr),this.selectableLevelList=kp(this.levelList);for(var t=1;t<this.levelList.length;t++)this.levelList[t]._validateWithParentLevel(this.levelList[t-1]);this._tileSearcher=new Dp(this),this._neighborsCache=new Hp(Up),this._vec=En.create(),this._viewSize={}}Kt.prototype.maxTileSize=function(){for(var e=0,t=0;t<this.levelList.length;t++){var r=this.levelList[t];e=Math.max(e,r.tileWidth,r.tileHeight)}return e},Kt.prototype.levelTiles=function(e,t){var r=this.levelList.indexOf(e),i=e.numHorizontalTiles()-1,n=e.numVerticalTiles()-1;t=t||[];for(var s=0;s<Tr.length;s++)for(var o=Tr[s],a=0;a<=i;a++)for(var l=0;l<=n;l++)t.push(new Fe(o,a,l,r,this));return t},Kt.prototype._closestTile=function(e,t){var r=this._vec;En.set(r,0,0,1,1),En.transformMat4(r,r,e.inverseProjection());var i=1/0,n=null;for(var s in Tn){var o=Tn[s],a=1-vt.dot(o,r);a<i&&(i=a,n=s)}for(var l=Math.max(Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]))/.5,c=0;c<3;c++)r[c]=r[c]/l;var f=Pr[n];ai(r,0,-f.x,-f.y);var _=this.levelList.indexOf(t),m=t.numHorizontalTiles(),v=t.numVerticalTiles(),h=Oi(Math.floor((.5+r[0])*m),0,m-1),P=Oi(Math.floor((.5-r[1])*v),0,v-1);return new Fe(n,h,P,_,this)},Kt.prototype.visibleTiles=function(e,t,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],e.size(i),i.width===0||i.height===0)return r;var s=this._closestTile(e,t),o=n.search(e,s,r);if(!o)throw new Error("Starting tile is not visible");return r},Kt.Tile=Kt.prototype.Tile=Fe,Kt.type=Kt.prototype.type="cube",Fe.type=Fe.prototype.type="cube";var qp=Kt,Wp=Ht,Vp=zi,Yp=Ns,Xp=Fs,Gp=xn,jp=ii.makeLevelList,Zp=ii.makeSelectableLevelList,qs=Fr,Ws=cr,Cn=ri,Kp=ni,fr=at.vec2,Sn=at.vec4,Qp=64,Rn=[[0,1],[1,0],[0,-1],[-1,0]];function be(e,t,r,i){this.x=e,this.y=t,this.z=r,this._geometry=i,this._level=i.levelList[r]}be.prototype.rotX=function(){return 0},be.prototype.rotY=function(){return 0},be.prototype.centerX=function(){var e=this._level.width(),t=this._level.tileWidth();return(this.x*t+.5*this.width())/e-.5},be.prototype.centerY=function(){var e=this._level.height(),t=this._level.tileHeight();return .5-(this.y*t+.5*this.height())/e},be.prototype.scaleX=function(){var e=this._level.width();return this.width()/e},be.prototype.scaleY=function(){var e=this._level.height();return this.height()/e},be.prototype.width=function(){var e=this._level.width(),t=this._level.tileWidth();if(this.x===this._level.numHorizontalTiles()-1){var r=Ws(e,t);return r||t}else return t},be.prototype.height=function(){var e=this._level.height(),t=this._level.tileHeight();if(this.y===this._level.numVerticalTiles()-1){var r=Ws(e,t);return r||t}else return t},be.prototype.levelWidth=function(){return this._level.width()},be.prototype.levelHeight=function(){return this._level.height()},be.prototype.vertices=function(e){e||(e=[fr.create(),fr.create(),fr.create(),fr.create()]);var t=this.centerX()-this.scaleX()/2,r=this.centerX()+this.scaleX()/2,i=this.centerY()-this.scaleY()/2,n=this.centerY()+this.scaleY()/2;return fr.set(e[0],t,n),fr.set(e[1],r,n),fr.set(e[2],r,i),fr.set(e[3],t,i),e},be.prototype.parent=function(){if(this.z===0)return null;var e=this._geometry,t=this.z-1,r=Math.floor(this.x/2),i=Math.floor(this.y/2);return new be(r,i,t,e)},be.prototype.children=function(e){if(this.z===this._geometry.levelList.length-1)return null;var t=this._geometry,r=this.z+1;return e=e||[],e.push(new be(2*this.x,2*this.y,r,t)),e.push(new be(2*this.x,2*this.y+1,r,t)),e.push(new be(2*this.x+1,2*this.y,r,t)),e.push(new be(2*this.x+1,2*this.y+1,r,t)),e},be.prototype.neighbors=function(){var e=this._geometry,t=e._neighborsCache,r=t.get(this);if(r)return r;for(var i=this.x,n=this.y,s=this.z,o=this._level,a=o.numHorizontalTiles()-1,l=o.numVerticalTiles()-1,c=[],f=0;f<Rn.length;f++){var _=Rn[f][0],m=Rn[f][1],v=i+_,h=n+m,P=s;0<=v&&v<=a&&0<=h&&h<=l&&c.push(new be(v,h,P,e))}return t.set(this,c),c},be.prototype.hash=function(){return Vp(this.z,this.y,this.x)},be.prototype.equals=function(e){return this._geometry===e._geometry&&this.z===e.z&&this.y===e.y&&this.x===e.x},be.prototype.cmp=function(e){return Cn(this.z,e.z)||Cn(this.y,e.y)||Cn(this.x,e.x)},be.prototype.str=function(){return"FlatTile("+tile.x+", "+tile.y+", "+tile.z+")"};function Cr(e){this.constructor.super_.call(this,e),this._width=e.width,this._height=e.height,this._tileWidth=e.tileWidth,this._tileHeight=e.tileHeight}Wp(Cr,Gp),Cr.prototype.width=function(){return this._width},Cr.prototype.height=function(){return this._height},Cr.prototype.tileWidth=function(){return this._tileWidth},Cr.prototype.tileHeight=function(){return this._tileHeight},Cr.prototype._validateWithParentLevel=function(e){var t=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),s=e.width(),o=e.height(),a=e.tileWidth(),l=e.tileHeight();if(t%s!=0)return new Error("Level width must be multiple of parent level: "+t+" vs. "+s);if(r%o!=0)return new Error("Level height must be multiple of parent level: "+r+" vs. "+o);if(i%a!=0)return new Error("Level tile width must be multiple of parent level: "+i+" vs. "+a);if(n%l!=0)return new Error("Level tile height must be multiple of parent level: "+n+" vs. "+l)};function Qt(e){if(Kp(e)!=="array")throw new Error("Level list must be an array");this.levelList=jp(e,Cr),this.selectableLevelList=Zp(this.levelList);for(var t=1;t<this.levelList.length;t++)this.levelList[t]._validateWithParentLevel(this.levelList[t-1]);this._tileSearcher=new Yp(this),this._neighborsCache=new Xp(Qp),this._vec=Sn.create(),this._viewSize={}}Qt.prototype.maxTileSize=function(){for(var e=0,t=0;t<this.levelList.length;t++){var r=this.levelList[t];e=Math.max(e,r.tileWidth,r.tileHeight)}return e},Qt.prototype.levelTiles=function(e,t){var r=this.levelList.indexOf(e),i=e.numHorizontalTiles()-1,n=e.numVerticalTiles()-1;t||(t=[]);for(var s=0;s<=i;s++)for(var o=0;o<=n;o++)t.push(new be(s,o,r,this));return t},Qt.prototype._closestTile=function(e,t){var r=this._vec;Sn.set(r,0,0,1,1),Sn.transformMat4(r,r,e.inverseProjection());var i=.5+r[0],n=.5-r[1],s=this.levelList.indexOf(t),o=t.width(),a=t.height(),l=t.tileWidth(),c=t.tileHeight(),f=t.numHorizontalTiles(),_=t.numVerticalTiles(),m=qs(Math.floor(i*o/l),0,f-1),v=qs(Math.floor(n*a/c),0,_-1);return new be(m,v,s,this)},Qt.prototype.visibleTiles=function(e,t,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],e.size(i),i.width===0||i.height===0)return r;var s=this._closestTile(e,t),o=n.search(e,s,r);if(!o)throw new Error("Starting tile is not visible");return r},Qt.Tile=Qt.prototype.Tile=be,Qt.type=Qt.prototype.type="flat",be.type=be.prototype.type="flat";var Jp=Qt,e0=Ht,t0=zi,r0=ri,Vs=ii,i0=xn,n0=ni;function Ye(e,t){this.z=e,this._geometry=t,this._level=t.levelList[e]}Ye.prototype.rotX=function(){return 0},Ye.prototype.rotY=function(){return 0},Ye.prototype.centerX=function(){return .5},Ye.prototype.centerY=function(){return .5},Ye.prototype.scaleX=function(){return 1},Ye.prototype.scaleY=function(){return 1},Ye.prototype.parent=function(){return this.z===0?null:new Ye(this.z-1,this._geometry)},Ye.prototype.children=function(e){return this.z===this._geometry.levelList.length-1?null:(e=e||[],e.push(new Ye(this.z+1,this._geometry)),e)},Ye.prototype.neighbors=function(){return[]},Ye.prototype.hash=function(){return t0(this.z)},Ye.prototype.equals=function(e){return this._geometry===e._geometry&&this.z===e.z},Ye.prototype.cmp=function(e){return r0(this.z,e.z)},Ye.prototype.str=function(){return"EquirectTile("+tile.z+")"};function Br(e){this.constructor.super_.call(this,e),this._width=e.width}e0(Br,i0),Br.prototype.width=function(){return this._width},Br.prototype.height=function(){return this._width/2},Br.prototype.tileWidth=function(){return this._width},Br.prototype.tileHeight=function(){return this._width/2};function ur(e){if(n0(e)!=="array")throw new Error("Level list must be an array");this.levelList=Vs.makeLevelList(e,Br),this.selectableLevelList=Vs.makeSelectableLevelList(this.levelList)}ur.prototype.maxTileSize=function(){for(var e=0,t=0;t<this.levelList.length;t++){var r=this.levelList[t];e=Math.max(e,r.tileWidth,r.tileHeight)}return e},ur.prototype.levelTiles=function(e,t){var r=this.levelList.indexOf(e);return t=t||[],t.push(new Ye(r,this)),t},ur.prototype.visibleTiles=function(e,t,r){var i=new Ye(this.levelList.indexOf(t),this);r=r||[],r.length=0,r.push(i)},ur.Tile=ur.prototype.Tile=Ye,ur.type=ur.prototype.type="equirect",Ye.type=Ye.prototype.type="equirect";var a0=ur;function Sr(e,t,r){return 2*Math.atan(r*Math.tan(e/2)/t)}function s0(e,t,r){return Sr(e,t,r)}function o0(e,t,r){return Sr(e,t,Math.sqrt(t*t+r*r))}function h0(e,t,r){return Sr(e,r,t)}function l0(e,t,r){return Sr(e,r,Math.sqrt(t*t+r*r))}function c0(e,t,r){return Sr(e,Math.sqrt(t*t+r*r),t)}function f0(e,t,r){return Sr(e,Math.sqrt(t*t+r*r),r)}var Ys={convert:Sr,htov:s0,htod:o0,vtoh:h0,vtod:l0,dtoh:c0,dtov:f0};function u0(e){return typeof e=="number"&&isFinite(e)}var An=u0;function v0(e){return e.toPrecision(15)}var In=v0;function d0(){var e=arguments;return function(r){for(var i=r,n=0;n<e.length;n++){var s=e[n];i=s.call(null,i)}return i}}var Xs=d0,p0=ze,vr=at.mat4,st=at.vec4,Gs=Ti,si=Ys,zn=cr,dr=An,Rr=Fr,kt=In,m0=Xs,_0=Se,y0=0,g0=0,w0=0,M0=0,x0=0,E0=Math.PI/4,b0=0,T0=0,js=1e-6;function re(e,t){this._yaw=e&&e.yaw!=null?e.yaw:w0,this._pitch=e&&e.pitch!=null?e.pitch:M0,this._roll=e&&e.roll!=null?e.roll:x0,this._fov=e&&e.fov!=null?e.fov:E0,this._width=e&&e.width!=null?e.width:y0,this._height=e&&e.height!=null?e.height:g0,this._projectionCenterX=e&&e.projectionCenterX!=null?e.projectionCenterX:b0,this._projectionCenterY=e&&e.projectionCenterY!=null?e.projectionCenterY:T0,this._limiter=t||null,this._projMatrix=vr.create(),this._invProjMatrix=vr.create(),this._frustum=[st.create(),st.create(),st.create(),st.create(),st.create()],this._projectionChanged=!0,this._params={},this._fovs={},this._tmpVec=st.create(),this._update()}p0(re),re.prototype.destroy=function(){_0(this)},re.prototype.yaw=function(){return this._yaw},re.prototype.pitch=function(){return this._pitch},re.prototype.roll=function(){return this._roll},re.prototype.projectionCenterX=function(){return this._projectionCenterX},re.prototype.projectionCenterY=function(){return this._projectionCenterY},re.prototype.fov=function(){return this._fov},re.prototype.width=function(){return this._width},re.prototype.height=function(){return this._height},re.prototype.size=function(e){return e=e||{},e.width=this._width,e.height=this._height,e},re.prototype.parameters=function(e){return e=e||{},e.yaw=this._yaw,e.pitch=this._pitch,e.roll=this._roll,e.fov=this._fov,e},re.prototype.limiter=function(){return this._limiter},re.prototype.setYaw=function(e){this._resetParams(),this._params.yaw=e,this._update(this._params)},re.prototype.setPitch=function(e){this._resetParams(),this._params.pitch=e,this._update(this._params)},re.prototype.setRoll=function(e){this._resetParams(),this._params.roll=e,this._update(this._params)},re.prototype.setFov=function(e){this._resetParams(),this._params.fov=e,this._update(this._params)},re.prototype.setProjectionCenterX=function(e){this._resetParams(),this._params.projectionCenterX=e,this._update(this._params)},re.prototype.setProjectionCenterY=function(e){this._resetParams(),this._params.projectionCenterY=e,this._update(this._params)},re.prototype.offsetYaw=function(e){this.setYaw(this._yaw+e)},re.prototype.offsetPitch=function(e){this.setPitch(this._pitch+e)},re.prototype.offsetRoll=function(e){this.setRoll(this._roll+e)},re.prototype.offsetFov=function(e){this.setFov(this._fov+e)},re.prototype.setSize=function(e){this._resetParams(),this._params.width=e.width,this._params.height=e.height,this._update(this._params)},re.prototype.setParameters=function(e){this._resetParams(),this._params.yaw=e.yaw,this._params.pitch=e.pitch,this._params.roll=e.roll,this._params.fov=e.fov,this._params.projectionCenterX=e.projectionCenterX,this._params.projectionCenterY=e.projectionCenterY,this._update(this._params)},re.prototype.setLimiter=function(e){this._limiter=e||null,this._update()},re.prototype._resetParams=function(){var e=this._params;e.yaw=null,e.pitch=null,e.roll=null,e.fov=null,e.width=null,e.height=null},re.prototype._update=function(e){e==null&&(this._resetParams(),e=this._params);var t=this._yaw,r=this._pitch,i=this._roll,n=this._fov,s=this._projectionCenterX,o=this._projectionCenterY,a=this._width,l=this._height;if(e.yaw=e.yaw!=null?e.yaw:t,e.pitch=e.pitch!=null?e.pitch:r,e.roll=e.roll!=null?e.roll:i,e.fov=e.fov!=null?e.fov:n,e.width=e.width!=null?e.width:a,e.height=e.height!=null?e.height:l,e.projectionCenterX=e.projectionCenterX!=null?e.projectionCenterX:s,e.projectionCenterY=e.projectionCenterY!=null?e.projectionCenterY:o,this._limiter&&(e=this._limiter(e),!e))throw new Error("Bad view limiter");e=this._normalize(e);var c=e.yaw,f=e.pitch,_=e.roll,m=e.fov,v=e.width,h=e.height,P=e.projectionCenterX,w=e.projectionCenterY;if(!dr(c)||!dr(f)||!dr(_)||!dr(m)||!dr(v)||!dr(h)||!dr(P)||!dr(w))throw new Error("Bad view - suspect a broken limiter");this._yaw=c,this._pitch=f,this._roll=_,this._fov=m,this._width=v,this._height=h,this._projectionCenterX=P,this._projectionCenterY=w,(c!==t||f!==r||_!==i||m!==n||v!==a||h!==l||P!==s||w!==o)&&(this._projectionChanged=!0,this.emit("change")),(v!==a||h!==l)&&this.emit("resize")},re.prototype._normalize=function(e){this._normalizeCoordinates(e);var t=si.htov(Math.PI,e.width,e.height),r=isNaN(t)?Math.PI:Math.min(Math.PI,t);return e.fov=Rr(e.fov,js,r-js),e},re.prototype._normalizeCoordinates=function(e){return"yaw"in e&&(e.yaw=zn(e.yaw-Math.PI,-2*Math.PI)+Math.PI),"pitch"in e&&(e.pitch=zn(e.pitch-Math.PI,-2*Math.PI)+Math.PI),"roll"in e&&(e.roll=zn(e.roll-Math.PI,-2*Math.PI)+Math.PI),e},re.prototype.normalizeToClosest=function(e,t){var r=this._yaw,i=this._pitch,n=e.yaw,s=e.pitch,o=n-2*Math.PI,a=n+2*Math.PI;Math.abs(o-r)<Math.abs(n-r)?n=o:Math.abs(a-r)<Math.abs(n-r)&&(n=a);var l=s-2*Math.PI,c=s+2*Math.PI;return Math.abs(l-i)<Math.abs(s-i)?s=l:Math.abs(l-i)<Math.abs(s-i)&&(s=c),t=t||{},t.yaw=n,t.pitch=s,t},re.prototype.updateWithControlParameters=function(e){var t=this._fov,r=si.vtoh(t,this._width,this._height);isNaN(r)&&(r=t),this.offsetYaw(e.axisScaledX*r+e.x*2*r+e.yaw),this.offsetPitch(e.axisScaledY*t+e.y*2*r+e.pitch),this.offsetRoll(-e.roll),this.offsetFov(e.zoom*t)},re.prototype._updateProjection=function(){var e=this._projMatrix,t=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._width,n=this._height,s=this._fov,o=si.vtoh(s,i,n),a=i/n,l=this._projectionCenterX,c=this._projectionCenterY;if(l!==0||c!==0){var f=Math.atan(l*2*Math.tan(o/2)),_=Math.atan(c*2*Math.tan(s/2)),m=this._fovs;m.leftDegrees=(o/2+f)*180/Math.PI,m.rightDegrees=(o/2-f)*180/Math.PI,m.upDegrees=(s/2+_)*180/Math.PI,m.downDegrees=(s/2-_)*180/Math.PI,vr.perspectiveFromFieldOfView(e,m,-1,1)}else vr.perspective(e,s,a,-1,1);vr.rotateZ(e,e,this._roll),vr.rotateX(e,e,this._pitch),vr.rotateY(e,e,this._yaw),vr.invert(t,e),this._matrixToFrustum(e,r),this._projectionChanged=!1}},re.prototype._matrixToFrustum=function(e,t){st.set(t[0],e[3]+e[0],e[7]+e[4],e[11]+e[8],0),st.set(t[1],e[3]-e[0],e[7]-e[4],e[11]-e[8],0),st.set(t[2],e[3]+e[1],e[7]+e[5],e[11]+e[9],0),st.set(t[3],e[3]-e[1],e[7]-e[5],e[11]-e[9],0),st.set(t[4],e[3]+e[2],e[7]+e[6],e[11]+e[10],0)},re.prototype.projection=function(){return this._updateProjection(),this._projMatrix},re.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},re.prototype.intersects=function(e){this._updateProjection();for(var t=this._frustum,r=this._tmpVec,i=0;i<t.length;i++){for(var n=t[i],s=!1,o=0;o<e.length;o++){var a=e[o];st.set(r,a[0],a[1],a[2],0),st.dot(n,r)>=0&&(s=!0)}if(!s)return!1}return!0},re.prototype.selectLevel=function(e){for(var t=Gs()*this._height,r=Math.tan(.5*this._fov),i=0;i<e.length;i++){var n=e[i];if(r*n.height()>=t)return n}return e[e.length-1]},re.prototype.coordinatesToScreen=function(e,t){var r=this._tmpVec;t||(t={});var i=this._width,n=this._height;if(i<=0||n<=0)return t.x=null,t.y=null,null;var s=e.yaw,o=e.pitch,a=Math.sin(s)*Math.cos(o),l=-Math.sin(o),c=-Math.cos(s)*Math.cos(o);if(st.set(r,a,l,c,1),st.transformMat4(r,r,this.projection()),r[3]>=0)t.x=i*(r[0]/r[3]+1)/2,t.y=n*(1-r[1]/r[3])/2;else return t.x=null,t.y=null,null;return t},re.prototype.screenToCoordinates=function(e,t){var r=this._tmpVec;t||(t={});var i=this._width,n=this._height,s=2*e.x/i-1,o=1-2*e.y/n;st.set(r,s,o,1,1),st.transformMat4(r,r,this.inverseProjection());var a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);return t.yaw=Math.atan2(r[0],-r[2]),t.pitch=Math.acos(r[1]/a)-Math.PI/2,this._normalizeCoordinates(t),t},re.prototype.coordinatesToPerspectiveTransform=function(e,t,r){r=r||"";var i=this._height,n=this._width,s=this._fov,o=.5*i/Math.tan(s/2),a="";return a+="translateX("+kt(n/2)+"px) ",a+="translateY("+kt(i/2)+"px) ",a+="translateX(-50%) translateY(-50%) ",a+="perspective("+kt(o)+"px) ",a+="translateZ("+kt(o)+"px) ",a+="rotateZ("+kt(-this._roll)+"rad) ",a+="rotateX("+kt(-this._pitch)+"rad) ",a+="rotateY("+kt(this._yaw)+"rad) ",a+="rotateY("+kt(-e.yaw)+"rad) ",a+="rotateX("+kt(e.pitch)+"rad) ",a+="translateZ("+kt(-t)+"px) ",a+=r+" ",a},re.limit={yaw:function(e,t){return function(i){return i.yaw=Rr(i.yaw,e,t),i}},pitch:function(e,t){return function(i){return i.pitch=Rr(i.pitch,e,t),i}},roll:function(e,t){return function(i){return i.roll=Rr(i.roll,e,t),i}},hfov:function(e,t){return function(i){var n=i.width,s=i.height;if(n>0&&s>0){var o=si.htov(e,n,s),a=si.htov(t,n,s);i.fov=Rr(i.fov,o,a)}return i}},vfov:function(e,t){return function(i){return i.fov=Rr(i.fov,e,t),i}},resolution:function(e){return function(r){var i=r.height;if(i){var n=Gs()*i,s=2*Math.atan(n/e);r.fov=Rr(r.fov,s,1/0)}return r}},traditional:function(e,t,r){return r=r!=null?r:t,m0(re.limit.resolution(e),re.limit.vfov(0,t),re.limit.hfov(0,r),re.limit.pitch(-Math.PI/2,Math.PI/2))}},re.type=re.prototype.type="rectilinear";var P0=re,L0=ze,Ni=at.mat4,oi=at.vec4,Zs=Ti,Ur=An,Jt=Fr,C0=Se,S0=0,R0=0,Ks=.5,Qs=.5,A0=1,I0=[1,0,1,0],z0=[-1,-1,1,1],$0=1e-6;function ue(e,t){if(!(e&&e.mediaAspectRatio!=null))throw new Error("mediaAspectRatio must be defined");this._x=e&&e.x!=null?e.x:Ks,this._y=e&&e.y!=null?e.y:Qs,this._zoom=e&&e.zoom!=null?e.zoom:A0,this._mediaAspectRatio=e.mediaAspectRatio,this._width=e&&e.width!=null?e.width:S0,this._height=e&&e.height!=null?e.height:R0,this._limiter=t||null,this._projMatrix=Ni.create(),this._invProjMatrix=Ni.create(),this._frustum=[0,0,0,0],this._projectionChanged=!0,this._params={},this._vec=oi.create(),this._update()}L0(ue),ue.prototype.destroy=function(){C0(this)},ue.prototype.x=function(){return this._x},ue.prototype.y=function(){return this._y},ue.prototype.zoom=function(){return this._zoom},ue.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},ue.prototype.width=function(){return this._width},ue.prototype.height=function(){return this._height},ue.prototype.size=function(e){return e=e||{},e.width=this._width,e.height=this._height,e},ue.prototype.parameters=function(e){return e=e||{},e.x=this._x,e.y=this._y,e.zoom=this._zoom,e.mediaAspectRatio=this._mediaAspectRatio,e},ue.prototype.limiter=function(){return this._limiter},ue.prototype.setX=function(e){this._resetParams(),this._params.x=e,this._update(this._params)},ue.prototype.setY=function(e){this._resetParams(),this._params.y=e,this._update(this._params)},ue.prototype.setZoom=function(e){this._resetParams(),this._params.zoom=e,this._update(this._params)},ue.prototype.offsetX=function(e){this.setX(this._x+e)},ue.prototype.offsetY=function(e){this.setY(this._y+e)},ue.prototype.offsetZoom=function(e){this.setZoom(this._zoom+e)},ue.prototype.setMediaAspectRatio=function(e){this._resetParams(),this._params.mediaAspectRatio=e,this._update(this._params)},ue.prototype.setSize=function(e){this._resetParams(),this._params.width=e.width,this._params.height=e.height,this._update(this._params)},ue.prototype.setParameters=function(e){this._resetParams(),this._params.x=e.x,this._params.y=e.y,this._params.zoom=e.zoom,this._params.mediaAspectRatio=e.mediaAspectRatio,this._update(this._params)},ue.prototype.setLimiter=function(e){this._limiter=e||null,this._update()},ue.prototype._resetParams=function(){var e=this._params;e.x=null,e.y=null,e.zoom=null,e.mediaAspectRatio=null,e.width=null,e.height=null},ue.prototype._update=function(e){e==null&&(this._resetParams(),e=this._params);var t=this._x,r=this._y,i=this._zoom,n=this._mediaAspectRatio,s=this._width,o=this._height;if(e.x=e.x!=null?e.x:t,e.y=e.y!=null?e.y:r,e.zoom=e.zoom!=null?e.zoom:i,e.mediaAspectRatio=e.mediaAspectRatio!=null?e.mediaAspectRatio:n,e.width=e.width!=null?e.width:s,e.height=e.height!=null?e.height:o,this._limiter&&(e=this._limiter(e),!e))throw new Error("Bad view limiter");var a=e.x,l=e.y,c=e.zoom,f=e.mediaAspectRatio,_=e.width,m=e.height;if(!Ur(a)||!Ur(l)||!Ur(c)||!Ur(f)||!Ur(_)||!Ur(m))throw new Error("Bad view - suspect a broken limiter");c=Jt(c,$0,1/0),this._x=a,this._y=l,this._zoom=c,this._mediaAspectRatio=f,this._width=_,this._height=m,(a!==t||l!==r||c!==i||f!==n||_!==s||m!==o)&&(this._projectionChanged=!0,this.emit("change")),(_!==s||m!==o)&&this.emit("resize")},ue.prototype._zoomX=function(){return this._zoom},ue.prototype._zoomY=function(){var e=this._mediaAspectRatio,t=this._width/this._height,r=this._zoom,i=r*e/t;return isNaN(i)&&(i=r),i},ue.prototype.updateWithControlParameters=function(e){var t=this.zoom(),r=this._zoomX(),i=this._zoomY();this.offsetX(e.axisScaledX*r+e.x*t),this.offsetY(e.axisScaledY*i+e.y*t),this.offsetZoom(e.zoom*t)},ue.prototype._updateProjection=function(){var e=this._projMatrix,t=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._x,n=this._y,s=this._zoomX(),o=this._zoomY(),a=r[0]=.5-n+.5*o,l=r[1]=i-.5+.5*s,c=r[2]=.5-n-.5*o,f=r[3]=i-.5-.5*s;Ni.ortho(e,f,l,c,a,-1,1),Ni.invert(t,e),this._projectionChanged=!1}},ue.prototype.projection=function(){return this._updateProjection(),this._projMatrix},ue.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},ue.prototype.intersects=function(e){this._updateProjection();for(var t=this._frustum,r=0;r<t.length;r++){for(var i=t[r],n=I0[r],s=z0[r],o=!1,a=0;a<e.length;a++){var l=e[a];if(s<0&&l[n]<i||s>0&&l[n]>i){o=!0;break}}if(!o)return!1}return!0},ue.prototype.selectLevel=function(e){for(var t=Zs()*this.width(),r=this._zoom,i=0;i<e.length;i++){var n=e[i];if(r*n.width()>=t)return n}return e[e.length-1]},ue.prototype.coordinatesToScreen=function(e,t){var r=this._vec;t||(t={});var i=this._width,n=this._height;if(i<=0||n<=0)return t.x=null,t.y=null,null;var s=e&&e.x!=null?e.x:Ks,o=e&&e.y!=null?e.y:Qs;oi.set(r,s-.5,.5-o,-1,1),oi.transformMat4(r,r,this.projection());for(var a=0;a<3;a++)r[a]/=r[3];return t.x=i*(r[0]+1)/2,t.y=n*(1-r[1])/2,t},ue.prototype.screenToCoordinates=function(e,t){var r=this._vec;t||(t={});var i=this._width,n=this._height,s=2*e.x/i-1,o=1-2*e.y/n;return oi.set(r,s,o,1,1),oi.transformMat4(r,r,this.inverseProjection()),t.x=.5+r[0],t.y=.5-r[1],t},ue.limit={x:function(e,t){return function(i){return i.x=Jt(i.x,e,t),i}},y:function(e,t){return function(i){return i.y=Jt(i.y,e,t),i}},zoom:function(e,t){return function(i){return i.zoom=Jt(i.zoom,e,t),i}},resolution:function(e){return function(r){if(r.width<=0||r.height<=0)return r;var i=r.width,n=Zs()*i/e;return r.zoom=Jt(r.zoom,n,1/0),r}},visibleX:function(e,t){return function(i){var n=t-e;i.zoom>n&&(i.zoom=n);var s=e+.5*i.zoom,o=t-.5*i.zoom;return i.x=Jt(i.x,s,o),i}},visibleY:function(e,t){return function(i){if(i.width<=0||i.height<=0)return i;var n=i.width/i.height,s=n/i.mediaAspectRatio,o=(t-e)*s;i.zoom>o&&(i.zoom=o);var a=e+.5*i.zoom/s,l=t-.5*i.zoom/s;return i.y=Jt(i.y,a,l),i}},letterbox:function(){return function(t){if(t.width<=0||t.height<=0)return t;var r=t.width/t.height,i=1,n=r/t.mediaAspectRatio;t.mediaAspectRatio>=r&&(t.zoom=Math.min(t.zoom,i)),t.mediaAspectRatio<=r&&(t.zoom=Math.min(t.zoom,n));var s,o;t.zoom>i?s=o=.5:(s=0+.5*t.zoom/i,o=1-.5*t.zoom/i);var a,l;return t.zoom>n?a=l=.5:(a=0+.5*t.zoom/n,l=1-.5*t.zoom/n),t.x=Jt(t.x,s,o),t.y=Jt(t.y,a,l),t}}},ue.type=ue.prototype.type="flat";var O0=ue,D0=ea,H0=cr;function hi(e){this._concurrency=e&&e.concurrency||1,this._paused=e&&!!e.paused||!1,this._pool=[];for(var t=0;t<this._concurrency;t++)this._pool.push(new D0(e));this._next=0}hi.prototype.length=function(){for(var e=0,t=0;t<this._pool.length;t++)e+=this._pool[t].length();return e},hi.prototype.push=function(e,t){var r=this._next,i=this._pool[r].push(e,t);return this._next=H0(this._next+1,this._concurrency),i},hi.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var e=0;e<this._concurrency;e++)this._pool[e].pause()}},hi.prototype.resume=function(){if(this._paused){this._paused=!1;for(var e=0;e<this._concurrency;e++)this._pool[e].resume()}};var N0=hi;function F0(){}var li=F0,k0=li;function B0(){var e=Array.prototype.slice.call(arguments,0);return function(){var r=e.slice(0),i=null,n=null,s=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],o=arguments.length?arguments[arguments.length-1]:k0;function a(){var c=arguments[0];if(c){i=n=null,o.apply(null,arguments);return}if(!r.length){i=n=null,o.apply(null,arguments);return}i=r.shift();var f=i,_=Array.prototype.slice.call(arguments,1);_.push(a);var m=i.apply(null,_);if(f===i){if(typeof m!="function")throw new Error("chain: chaining on non-cancellable function");n=m}}function l(){n&&n.apply(null,arguments)}return s.unshift(null),a.apply(null,s),l}}var $n=B0;function U0(e,t){var r=null;function i(){r!=null&&(r=null,t(null))}function n(){r!=null&&(clearTimeout(r),r=null,t.apply(null,arguments))}return r=setTimeout(i,e),n}var Js=U0,q0=ze,W0=oa,V0=N0,Y0=$n,X0=Js,eo=xr,to={x:"x",y:"y",z:"z",f:"face"},G0="bdflru",j0=4,Z0=1e4;function ci(e,t){t=t||{},this._loadPool=new V0({concurrency:t.concurrency||j0}),this._retryDelay=t.retryDelay||Z0,this._retryMap={},this._sourceFromTile=e}q0(ci),ci.prototype.loadAsset=function(e,t,r){var i=this,n=this._retryDelay,s=this._retryMap,o=this._sourceFromTile(t),a=o.url,l=o.rect,c=e.loadImage.bind(e,a,l),f=function(w){return i._loadPool.push(c,function(b,R){b?(b instanceof W0&&(s[a]=eo(),i.emit("networkError",b,t)),w(b,t)):(delete s[a],w(null,t,R))})},_,m=s[a];if(m!=null){var v=eo(),h=v-m;h<n?_=n-h:(_=0,delete s[a])}var P=X0.bind(null,_);return Y0(P,f)(r)},ci.fromString=function(e,t){t=t||{};var r=t&&t.cubeMapPreviewFaceOrder||G0,i=t.cubeMapPreviewUrl?s:n;return new ci(i,t);function n(a){var l=e;for(var c in to){var f=to[c],_=K0(c),m=a.hasOwnProperty(f)?a[f]:"";l=l.replace(_,m)}return{url:l}}function s(a){return a.z===0?o(a):n(a)}function o(a){var l=r.indexOf(a.face)/6;return{url:t.cubeMapPreviewUrl,rect:{x:0,y:l,width:1,height:1/6}}}};function K0(e){var t="\\{("+e+")\\}";return new RegExp(t,"g")}var Q0=ci;function On(e){this._asset=e}On.prototype.asset=function(){return this._asset},On.prototype.loadAsset=function(e,t,r){var i=this,n=setTimeout(function(){r(null,t,i._asset)},0);function s(){clearTimeout(n),r.apply(null,arguments)}return s};var J0=On,em=nn,tm=Ht,rm=ze,im=Se;function Ar(e){this.constructor.super_.call(this,e),this._timestamp=0}tm(Ar,em),rm(Ar),Ar.prototype.destroy=function(){im(this)},Ar.prototype.timestamp=function(){return this._timestamp},Ar.prototype.isDynamic=function(){return!0},Ar.prototype.markDirty=function(){this._timestamp++,this.emit("change")};var nm=Ar,Fi=cr,am=64;function pr(e){if(e!=null&&(!isFinite(e)||Math.floor(e)!==e||e<1))throw new Error("Map: invalid capacity");this._capacity=e||am,this._keyBuckets=[],this._valBuckets=[];for(var t=0;t<this._capacity;t++)this._keyBuckets.push([]),this._valBuckets.push([]);this._size=0}pr.prototype.get=function(e){for(var t=Fi(e.hash(),this._capacity),r=this._keyBuckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n)){var s=this._valBuckets[t],o=s[i];return o}}return null},pr.prototype.set=function(e,t){for(var r=Fi(e.hash(),this._capacity),i=this._keyBuckets[r],n=this._valBuckets[r],s=0;s<i.length;s++){var o=i[s];if(e.equals(o)){var a=n[s];return i[s]=e,n[s]=t,a}}return i.push(e),n.push(t),this._size++,null},pr.prototype.del=function(e){for(var t=Fi(e.hash(),this._capacity),r=this._keyBuckets[t],i=this._valBuckets[t],n=0;n<r.length;n++){var s=r[n];if(e.equals(s)){for(var o=i[n],a=n;a<r.length-1;a++)r[a]=r[a+1],i[a]=i[a+1];return r.length=r.length-1,i.length=i.length-1,this._size--,o}}return null},pr.prototype.has=function(e){for(var t=Fi(e.hash(),this._capacity),r=this._keyBuckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n))return!0}return!1},pr.prototype.size=function(){return this._size},pr.prototype.clear=function(){for(var e=0;e<this._capacity;e++)this._keyBuckets[e].length=0,this._valBuckets[e].length=0;this._size=0},pr.prototype.forEach=function(e){for(var t=0,r=0;r<this._capacity;r++)for(var i=this._keyBuckets[r],n=this._valBuckets[r],s=0;s<i.length;s++)e(i[s],n[s]),t+=1;return t};var sm=pr,om=cr;function mr(e){if(!isFinite(e)||Math.floor(e)!==e||e<0)throw new Error("LruSet: invalid capacity");this._capacity=e,this._elements=new Array(this._capacity),this._start=0,this._size=0}mr.prototype._index=function(e){return om(this._start+e,this._capacity)},mr.prototype.add=function(e){if(this._capacity===0)return e;this.remove(e);var t=this._size===this._capacity?this._elements[this._index(0)]:null;return this._elements[this._index(this._size)]=e,this._size<this._capacity?this._size++:this._start=this._index(1),t},mr.prototype.remove=function(e){for(var t=0;t<this._size;t++){var r=this._elements[this._index(t)];if(e.equals(r)){for(var i=t;i<this._size-1;i++)this._elements[this._index(i)]=this._elements[this._index(i+1)];return this._size--,r}}return null},mr.prototype.has=function(e){for(var t=0;t<this._size;t++)if(e.equals(this._elements[this._index(t)]))return!0;return!1},mr.prototype.size=function(){return this._size},mr.prototype.clear=function(){this._elements.length=0,this._start=0,this._size=0},mr.prototype.forEach=function(e){for(var t=0,r=0;r<this._size;r++)e(this._elements[this._index(r)]),t+=1;return t};var hm=mr;function lm(e,t){for(var r in t)r in e||(e[r]=t[r]);return e}var Bt=lm,cm=li;function fm(e){return function(){var r=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],i=arguments.length?arguments[arguments.length-1]:cm,n=null,s=!1;function o(){var a=arguments[0];!a||s?i.apply(null,arguments):n=e.apply(null,r)}return r.push(o),o(!0),function(){s=!0,n.apply(null,arguments)}}}var ro=fm,io=sm,no=Hs,um=hm,ao=ze,vm=Bt,dm=ro,pm=$n,mm=Ht,so=Se,fi=typeof MARZIPANODEBUG!="undefined"&&MARZIPANODEBUG.textureStore,Lt={IDLE:0,START:1,MARK:2,END:3},_m={previouslyVisibleCacheSize:512},ym=0;function Dn(){}mm(Dn,Error);function ui(e,t){var r=this,i=ym++;r._id=i,r._store=e,r._tile=t,r._asset=null,r._texture=null,r._changeHandler=function(){e.emit("textureInvalid",t)};var n=e.source(),s=e.stage(),o=n.loadAsset.bind(n),a=s.createTexture.bind(s),l=pm(dm(o),a);e.emit("textureStartLoad",t),fi&&console.log("loading",i,t),r._cancel=l(s,t,function(c,f,_,m){if(r._cancel=null,c){_&&_.destroy(),m&&m.destroy(),c instanceof Dn?(e.emit("textureCancel",t),fi&&console.log("cancel",i,t)):(e.emit("textureError",t,c),fi&&console.log("error",i,t));return}r._texture=m,_.isDynamic()?(r._asset=_,_.addEventListener("change",r._changeHandler)):_.destroy(),e.emit("textureLoad",t),fi&&console.log("load",i,t)})}ui.prototype.asset=function(){return this._asset},ui.prototype.texture=function(){return this._texture},ui.prototype.destroy=function(){var e=this._id,t=this._store,r=this._tile,i=this._asset,n=this._texture,s=this._cancel;if(s){s(new Dn("Texture load cancelled"));return}i&&(i.removeEventListener("change",this._changeHandler),i.destroy()),n&&n.destroy(),t.emit("textureUnload",r),fi&&console.log("unload",e,r),so(this)},ao(ui);function et(e,t,r){r=vm(r||{},_m),this._source=e,this._stage=t,this._state=Lt.IDLE,this._delimCount=0,this._itemMap=new io,this._visible=new no,this._previouslyVisible=new um(r.previouslyVisibleCacheSize),this._pinMap=new io,this._newVisible=new no,this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}ao(et),et.prototype.destroy=function(){this.clear(),so(this)},et.prototype.stage=function(){return this._stage},et.prototype.source=function(){return this._source},et.prototype.clear=function(){var e=this;e._evicted.length=0,e._itemMap.forEach(function(t){e._evicted.push(t)}),e._evicted.forEach(function(t){e._unloadTile(t)}),e._itemMap.clear(),e._visible.clear(),e._previouslyVisible.clear(),e._pinMap.clear(),e._newVisible.clear(),e._noLongerVisible.length=0,e._visibleAgain.length=0,e._evicted.length=0},et.prototype.clearNotPinned=function(){var e=this;e._evicted.length=0,e._itemMap.forEach(function(t){e._pinMap.has(t)||e._evicted.push(t)}),e._evicted.forEach(function(t){e._unloadTile(t)}),e._visible.clear(),e._previouslyVisible.clear(),e._evicted.length=0},et.prototype.startFrame=function(){if(this._state!==Lt.IDLE&&this._state!==Lt.START)throw new Error("TextureStore: startFrame called out of sequence");this._state=Lt.START,this._delimCount++},et.prototype.markTile=function(e){if(this._state!==Lt.START&&this._state!==Lt.MARK)throw new Error("TextureStore: markTile called out of sequence");this._state=Lt.MARK;var t=this._itemMap.get(e),r=t&&t.texture(),i=t&&t.asset();r&&i&&r.refresh(e,i),this._newVisible.add(e)},et.prototype.endFrame=function(){if(this._state!==Lt.START&&this._state!==Lt.MARK&&this._state!==Lt.END)throw new Error("TextureStore: endFrame called out of sequence");this._state=Lt.END,this._delimCount--,this._delimCount||(this._update(),this._state=Lt.IDLE)},et.prototype._update=function(){var e=this;e._noLongerVisible.length=0,e._visible.forEach(function(r){e._newVisible.has(r)||e._noLongerVisible.push(r)}),e._visibleAgain.length=0,e._newVisible.forEach(function(r){e._previouslyVisible.has(r)&&e._visibleAgain.push(r)}),e._visibleAgain.forEach(function(r){e._previouslyVisible.remove(r)}),e._evicted.length=0,e._noLongerVisible.forEach(function(r){var i=e._itemMap.get(r),n=i&&i.texture();if(n){var s=e._previouslyVisible.add(r);s!=null&&e._evicted.push(s)}else i&&e._unloadTile(r)}),e._evicted.forEach(function(r){e._pinMap.has(r)||e._unloadTile(r)}),e._newVisible.forEach(function(r){var i=e._itemMap.get(r);i||e._loadTile(r)});var t=e._visible;e._visible=e._newVisible,e._newVisible=t,e._newVisible.clear(),e._noLongerVisible.length=0,e._visibleAgain.length=0,e._evicted.length=0},et.prototype._loadTile=function(e){if(this._itemMap.has(e))throw new Error("TextureStore: loading texture already in cache");var t=new ui(this,e);this._itemMap.set(e,t)},et.prototype._unloadTile=function(e){var t=this._itemMap.del(e);if(!t)throw new Error("TextureStore: unloading texture not in cache");t.destroy()},et.prototype.asset=function(e){var t=this._itemMap.get(e);return t?t.asset():null},et.prototype.texture=function(e){var t=this._itemMap.get(e);return t?t.texture():null},et.prototype.pin=function(e){var t=(this._pinMap.get(e)||0)+1;return this._pinMap.set(e,t),this._itemMap.has(e)||this._loadTile(e),t},et.prototype.unpin=function(e){var t=this._pinMap.get(e);if(t)t--,t>0?this._pinMap.set(e,t):(this._pinMap.del(e),!this._visible.has(e)&&!this._previouslyVisible.has(e)&&this._unloadTile(e));else throw new Error("TextureStore: unpin when not pinned");return t},et.prototype.query=function(e){var t=this._itemMap.get(e),r=this._pinMap.get(e)||0;return{visible:this._visible.has(e),previouslyVisible:this._previouslyVisible.has(e),hasAsset:t!=null&&t.asset()!=null,hasTexture:t!=null&&t.texture()!=null,pinned:r!==0,pinCount:r}};var oo=et;function gm(e,t){for(var r in t)e[r]=t[r];return e}var ho=gm,wm=ze,Mm=ho,xm=Se;function tt(e,t,r,i,n){n=n||{};var s=this;this._source=e,this._geometry=t,this._view=r,this._textureStore=i,this._effects=n.effects||{},this._fixedLevelIndex=null,this._viewChangeHandler=function(){s.emit("viewChange",s.view())},this._view.addEventListener("change",this._viewChangeHandler),this._textureStoreChangeHandler=function(){s.emit("textureStoreChange",s.textureStore())},this._textureStore.addEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureInvalid",this._textureStoreChangeHandler)}wm(tt),tt.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureInvalid",this._textureStoreChangeHandler),xm(this)},tt.prototype.source=function(){return this._source},tt.prototype.geometry=function(){return this._geometry},tt.prototype.view=function(){return this._view},tt.prototype.textureStore=function(){return this._textureStore},tt.prototype.effects=function(){return this._effects},tt.prototype.setEffects=function(e){this._effects=e,this.emit("effectsChange",this._effects)},tt.prototype.mergeEffects=function(e){Mm(this._effects,e),this.emit("effectsChange",this._effects)},tt.prototype.fixedLevel=function(){return this._fixedLevelIndex},tt.prototype.setFixedLevel=function(e){if(e!==this._fixedLevelIndex){if(e!=null&&(e>=this._geometry.levelList.length||e<0))throw new Error("Level index out of range: "+e);this._fixedLevelIndex=e,this.emit("fixedLevelChange",this._fixedLevelIndex)}},tt.prototype._selectLevel=function(){var e;return this._fixedLevelIndex!=null?e=this._geometry.levelList[this._fixedLevelIndex]:e=this._view.selectLevel(this._geometry.selectableLevelList),e},tt.prototype.visibleTiles=function(e){var t=this._selectLevel();return this._geometry.visibleTiles(this._view,t,e)},tt.prototype.pinLevel=function(e){for(var t=this._geometry.levelList[e],r=this._geometry.levelTiles(t),i=0;i<r.length;i++)this._textureStore.pin(r[i])},tt.prototype.unpinLevel=function(e){for(var t=this._geometry.levelList[e],r=this._geometry.levelTiles(t),i=0;i<r.length;i++)this._textureStore.unpin(r[i])},tt.prototype.pinFirstLevel=function(){return this.pinLevel(0)},tt.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)};var lo=tt,Em=ze,bm=Se;function _r(e){var t=this;this._stage=e,this._running=!1,this._rendering=!1,this._requestHandle=null,this._boundLoop=this._loop.bind(this),this._renderInvalidHandler=function(){t._rendering||t.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}Em(_r),_r.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),bm(this)},_r.prototype.stage=function(){return this._stage},_r.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},_r.prototype.stop=function(){this._requestHandle&&(window.cancelAnimationFrame(this._requestHandle),this._requestHandle=null),this._running=!1},_r.prototype.renderOnNextFrame=function(){this._running&&!this._requestHandle&&(this._requestHandle=window.requestAnimationFrame(this._boundLoop))},_r.prototype._loop=function(){if(!this._running)throw new Error("Render loop running while in stopped state");this._requestHandle=null,this._rendering=!0,this.emit("beforeRender"),this._rendering=!1,this._stage.render(),this.emit("afterRender")};var co=_r;function er(){this.velocity=null,this.friction=null,this.offset=null}er.equals=function(e,t){return e.velocity===t.velocity&&e.friction===t.friction&&e.offset===t.offset},er.prototype.equals=function(e){return er.equals(this,e)},er.prototype.update=function(e,t){e.offset&&(this.offset=this.offset||0,this.offset+=e.offset);var r=this.offsetFromVelocity(t);r&&(this.offset=this.offset||0,this.offset+=r),this.velocity=e.velocity,this.friction=e.friction},er.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},er.prototype.velocityAfter=function(e){return this.velocity?this.friction?Tm(this.velocity,this.friction*e):this.velocity:null},er.prototype.offsetFromVelocity=function(e){e=Math.min(e,this.nullVelocityTime());var t=this.velocityAfter(e),r=(this.velocity+t)/2;return r*e},er.prototype.nullVelocityTime=function(){return this.velocity==null?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)};function Tm(e,t){return e<0?Math.min(0,e+t):e>0?Math.max(0,e-t):0}var tr=er,Pm=ze,Lm=tr,Cm=Se;function qr(e,t,r,i,n){if(!e)throw new Error("KeyControlMethod: keyCode must be defined");if(!t)throw new Error("KeyControlMethod: parameter must be defined");if(!r)throw new Error("KeyControlMethod: velocity must be defined");if(!i)throw new Error("KeyControlMethod: friction must be defined");n=n||document,this._keyCode=e,this._parameter=t,this._velocity=r,this._friction=i,this._element=n,this._keydownHandler=this._handlePress.bind(this),this._keyupHandler=this._handleRelease.bind(this),this._blurHandler=this._handleBlur.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler),this._dynamics=new Lm,this._pressing=!1}Pm(qr),qr.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler),Cm(this)},qr.prototype._handlePress=function(e){e.keyCode===this._keyCode&&(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))},qr.prototype._handleRelease=function(e){e.keyCode===this._keyCode&&(this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1)},qr.prototype._handleBlur=function(){this._dynamics.velocity=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive"),this._pressing=!1};var fo=qr,Hn={exports:{}};/*! Hammer.JS - v2.0.4 - 2014-09-28
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2014 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,r,i,n){var s=["","webkit","moz","MS","ms","o"],o=r.createElement("div"),a="function",l=Math.round,c=Math.abs,f=Date.now;function _(u,p,g){return setTimeout(b(u,g),p)}function m(u,p,g){return Array.isArray(u)?(v(u,g[p],g),!0):!1}function v(u,p,g){var E;if(!!u)if(u.forEach)u.forEach(p,g);else if(u.length!==n)for(E=0;E<u.length;)p.call(g,u[E],E,u),E++;else for(E in u)u.hasOwnProperty(E)&&p.call(g,u[E],E,u)}function h(u,p,g){for(var E=Object.keys(p),S=0;S<E.length;)(!g||g&&u[E[S]]===n)&&(u[E[S]]=p[E[S]]),S++;return u}function P(u,p){return h(u,p,!0)}function w(u,p,g){var E=p.prototype,S;S=u.prototype=Object.create(E),S.constructor=u,S._super=E,g&&h(S,g)}function b(u,p){return function(){return u.apply(p,arguments)}}function R(u,p){return typeof u==a?u.apply(p&&p[0]||n,p):u}function D(u,p){return u===n?p:u}function O(u,p,g){v(A(p),function(E){u.addEventListener(E,g,!1)})}function B(u,p,g){v(A(p),function(E){u.removeEventListener(E,g,!1)})}function F(u,p){for(;u;){if(u==p)return!0;u=u.parentNode}return!1}function X(u,p){return u.indexOf(p)>-1}function A(u){return u.trim().split(/\s+/g)}function z(u,p,g){if(u.indexOf&&!g)return u.indexOf(p);for(var E=0;E<u.length;){if(g&&u[E][g]==p||!g&&u[E]===p)return E;E++}return-1}function ae(u){return Array.prototype.slice.call(u,0)}function Y(u,p,g){for(var E=[],S=[],$=0;$<u.length;){var V=p?u[$][p]:u[$];z(S,V)<0&&E.push(u[$]),S[$]=V,$++}return g&&(p?E=E.sort(function(de,Ue){return de[p]>Ue[p]}):E=E.sort()),E}function se(u,p){for(var g,E,S=p[0].toUpperCase()+p.slice(1),$=0;$<s.length;){if(g=s[$],E=g?g+S:p,E in u)return E;$++}return n}var ve=1;function G(){return ve++}function L(u){var p=u.ownerDocument;return p.defaultView||p.parentWindow}var ot=/mobile|tablet|ip(ad|hone|od)|android/i,ie="ontouchstart"in t,$e=se(t,"PointerEvent")!==n,Re=ie&&ot.test(navigator.userAgent),Xe="touch",mt="pen",$t="mouse",yr="kinect",Xr=25,Oe=1,fe=2,_e=4,Pe=8,rt=1,qe=2,ir=4,k=8,_t=16,j=qe|ir,yt=k|_t,Et=j|yt,$r=["x","y"],St=["clientX","clientY"];function We(u,p){var g=this;this.manager=u,this.callback=p,this.element=u.element,this.target=u.options.inputTarget,this.domHandler=function(E){R(u.options.enable,[u])&&g.handler(E)},this.init()}We.prototype={handler:function(){},init:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(L(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&B(this.element,this.evEl,this.domHandler),this.evTarget&&B(this.target,this.evTarget,this.domHandler),this.evWin&&B(L(this.element),this.evWin,this.domHandler)}};function gr(u){var p,g=u.options.inputClass;return g?p=g:$e?p=J:Re?p=oe:ie?p=Me:p=U,new p(u,bt)}function bt(u,p,g){var E=g.pointers.length,S=g.changedPointers.length,$=p&Oe&&E-S==0,V=p&(_e|Pe)&&E-S==0;g.isFirst=!!$,g.isFinal=!!V,$&&(u.session={}),g.eventType=p,Gr(u,g),u.emit("hammer.input",g),u.recognize(g),u.session.prevInput=g}function Gr(u,p){var g=u.session,E=p.pointers,S=E.length;g.firstInput||(g.firstInput=Wt(p)),S>1&&!g.firstMultiple?g.firstMultiple=Wt(p):S===1&&(g.firstMultiple=!1);var $=g.firstInput,V=g.firstMultiple,me=V?V.center:$.center,de=p.center=it(E);p.timeStamp=f(),p.deltaTime=p.timeStamp-$.timeStamp,p.angle=Vt(me,de),p.distance=gt(me,de),nr(g,p),p.offsetDirection=jr(p.deltaX,p.deltaY),p.scale=V?M(V.pointers,E):1,p.rotation=V?wr(V.pointers,E):0,qt(g,p);var Ue=u.element;F(p.srcEvent.target,Ue)&&(Ue=p.srcEvent.target),p.target=Ue}function nr(u,p){var g=p.center,E=u.offsetDelta||{},S=u.prevDelta||{},$=u.prevInput||{};(p.eventType===Oe||$.eventType===_e)&&(S=u.prevDelta={x:$.deltaX||0,y:$.deltaY||0},E=u.offsetDelta={x:g.x,y:g.y}),p.deltaX=S.x+(g.x-E.x),p.deltaY=S.y+(g.y-E.y)}function qt(u,p){var g=u.lastInterval||p,E=p.timeStamp-g.timeStamp,S,$,V,me;if(p.eventType!=Pe&&(E>Xr||g.velocity===n)){var de=g.deltaX-p.deltaX,Ue=g.deltaY-p.deltaY,hr=ar(E,de,Ue);$=hr.x,V=hr.y,S=c(hr.x)>c(hr.y)?hr.x:hr.y,me=jr(de,Ue),u.lastInterval=p}else S=g.velocity,$=g.velocityX,V=g.velocityY,me=g.direction;p.velocity=S,p.velocityX=$,p.velocityY=V,p.direction=me}function Wt(u){for(var p=[],g=0;g<u.pointers.length;)p[g]={clientX:l(u.pointers[g].clientX),clientY:l(u.pointers[g].clientY)},g++;return{timeStamp:f(),pointers:p,center:it(p),deltaX:u.deltaX,deltaY:u.deltaY}}function it(u){var p=u.length;if(p===1)return{x:l(u[0].clientX),y:l(u[0].clientY)};for(var g=0,E=0,S=0;S<p;)g+=u[S].clientX,E+=u[S].clientY,S++;return{x:l(g/p),y:l(E/p)}}function ar(u,p,g){return{x:p/u||0,y:g/u||0}}function jr(u,p){return u===p?rt:c(u)>=c(p)?u>0?qe:ir:p>0?k:_t}function gt(u,p,g){g||(g=$r);var E=p[g[0]]-u[g[0]],S=p[g[1]]-u[g[1]];return Math.sqrt(E*E+S*S)}function Vt(u,p,g){g||(g=$r);var E=p[g[0]]-u[g[0]],S=p[g[1]]-u[g[1]];return Math.atan2(S,E)*180/Math.PI}function wr(u,p){return Vt(p[1],p[0],St)-Vt(u[1],u[0],St)}function M(u,p){return gt(p[0],p[1],St)/gt(u[0],u[1],St)}var T={mousedown:Oe,mousemove:fe,mouseup:_e},H="mousedown",N="mousemove mouseup";function U(){this.evEl=H,this.evWin=N,this.allow=!0,this.pressed=!1,We.apply(this,arguments)}w(U,We,{handler:function(p){var g=T[p.type];g&Oe&&p.button===0&&(this.pressed=!0),g&fe&&p.which!==1&&(g=_e),!(!this.pressed||!this.allow)&&(g&_e&&(this.pressed=!1),this.callback(this.manager,g,{pointers:[p],changedPointers:[p],pointerType:$t,srcEvent:p}))}});var C={pointerdown:Oe,pointermove:fe,pointerup:_e,pointercancel:Pe,pointerout:Pe},q={2:Xe,3:mt,4:$t,5:yr},Q="pointerdown",te="pointermove pointerup pointercancel";t.MSPointerEvent&&(Q="MSPointerDown",te="MSPointerMove MSPointerUp MSPointerCancel");function J(){this.evEl=Q,this.evWin=te,We.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}w(J,We,{handler:function(p){var g=this.store,E=!1,S=p.type.toLowerCase().replace("ms",""),$=C[S],V=q[p.pointerType]||p.pointerType,me=V==Xe,de=z(g,p.pointerId,"pointerId");$&Oe&&(p.button===0||me)?de<0&&(g.push(p),de=g.length-1):$&(_e|Pe)&&(E=!0),!(de<0)&&(g[de]=p,this.callback(this.manager,$,{pointers:g,changedPointers:[p],pointerType:V,srcEvent:p}),E&&g.splice(de,1))}});var ge={touchstart:Oe,touchmove:fe,touchend:_e,touchcancel:Pe},he="touchstart",lt="touchstart touchmove touchend touchcancel";function Tt(){this.evTarget=he,this.evWin=lt,this.started=!1,We.apply(this,arguments)}w(Tt,We,{handler:function(p){var g=ge[p.type];if(g===Oe&&(this.started=!0),!!this.started){var E=ht.call(this,p,g);g&(_e|Pe)&&E[0].length-E[1].length==0&&(this.started=!1),this.callback(this.manager,g,{pointers:E[0],changedPointers:E[1],pointerType:Xe,srcEvent:p})}}});function ht(u,p){var g=ae(u.touches),E=ae(u.changedTouches);return p&(_e|Pe)&&(g=Y(g.concat(E),"identifier",!0)),[g,E]}var je={touchstart:Oe,touchmove:fe,touchend:_e,touchcancel:Pe},we="touchstart touchmove touchend touchcancel";function oe(){this.evTarget=we,this.targetIds={},We.apply(this,arguments)}w(oe,We,{handler:function(p){var g=je[p.type],E=Ze.call(this,p,g);!E||this.callback(this.manager,g,{pointers:E[0],changedPointers:E[1],pointerType:Xe,srcEvent:p})}});function Ze(u,p){var g=ae(u.touches),E=this.targetIds;if(p&(Oe|fe)&&g.length===1)return E[g[0].identifier]=!0,[g,g];var S,$,V=ae(u.changedTouches),me=[],de=this.target;if($=g.filter(function(Ue){return F(Ue.target,de)}),p===Oe)for(S=0;S<$.length;)E[$[S].identifier]=!0,S++;for(S=0;S<V.length;)E[V[S].identifier]&&me.push(V[S]),p&(_e|Pe)&&delete E[V[S].identifier],S++;if(!!me.length)return[Y($.concat(me),"identifier",!0),me]}function Me(){We.apply(this,arguments);var u=b(this.handler,this);this.touch=new oe(this.manager,u),this.mouse=new U(this.manager,u)}w(Me,We,{handler:function(p,g,E){var S=E.pointerType==Xe,$=E.pointerType==$t;if(S)this.mouse.allow=!1;else if($&&!this.mouse.allow)return;g&(_e|Pe)&&(this.mouse.allow=!0),this.callback(p,g,E)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Le=se(o.style,"touchAction"),nt=Le!==n,ce="compute",ke="auto",De="manipulation",Ae="none",ye="pan-x",pe="pan-y";function He(u,p){this.manager=u,this.set(p)}He.prototype={set:function(u){u==ce&&(u=this.compute()),nt&&(this.manager.element.style[Le]=u),this.actions=u.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var u=[];return v(this.manager.recognizers,function(p){R(p.options.enable,[p])&&(u=u.concat(p.getTouchAction()))}),Ce(u.join(" "))},preventDefaults:function(u){if(!nt){var p=u.srcEvent,g=u.offsetDirection;if(this.manager.session.prevented){p.preventDefault();return}var E=this.actions,S=X(E,Ae),$=X(E,pe),V=X(E,ye);if(S||$&&g&j||V&&g&yt)return this.preventSrc(p)}},preventSrc:function(u){this.manager.session.prevented=!0,u.preventDefault()}};function Ce(u){if(X(u,Ae))return Ae;var p=X(u,ye),g=X(u,pe);return p&&g?ye+" "+pe:p||g?p?ye:pe:X(u,De)?De:ke}var Ne=1,Be=2,Ve=4,ct=8,ft=ct,W=16,Ke=32;function Qe(u){this.id=G(),this.manager=null,this.options=P(u||{},this.defaults),this.options.enable=D(this.options.enable,!0),this.state=Ne,this.simultaneous={},this.requireFail=[]}Qe.prototype={defaults:{},set:function(u){return h(this.options,u),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(u){if(m(u,"recognizeWith",this))return this;var p=this.simultaneous;return u=Z(u,this),p[u.id]||(p[u.id]=u,u.recognizeWith(this)),this},dropRecognizeWith:function(u){return m(u,"dropRecognizeWith",this)?this:(u=Z(u,this),delete this.simultaneous[u.id],this)},requireFailure:function(u){if(m(u,"requireFailure",this))return this;var p=this.requireFail;return u=Z(u,this),z(p,u)===-1&&(p.push(u),u.requireFailure(this)),this},dropRequireFailure:function(u){if(m(u,"dropRequireFailure",this))return this;u=Z(u,this);var p=z(this.requireFail,u);return p>-1&&this.requireFail.splice(p,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(u){return!!this.simultaneous[u.id]},emit:function(u){var p=this,g=this.state;function E(S){p.manager.emit(p.options.event+(S?ne(g):""),u)}g<ct&&E(!0),E(),g>=ct&&E(!0)},tryEmit:function(u){if(this.canEmit())return this.emit(u);this.state=Ke},canEmit:function(){for(var u=0;u<this.requireFail.length;){if(!(this.requireFail[u].state&(Ke|Ne)))return!1;u++}return!0},recognize:function(u){var p=h({},u);if(!R(this.options.enable,[this,p])){this.reset(),this.state=Ke;return}this.state&(ft|W|Ke)&&(this.state=Ne),this.state=this.process(p),this.state&(Be|Ve|ct|W)&&this.tryEmit(p)},process:function(u){},getTouchAction:function(){},reset:function(){}};function ne(u){return u&W?"cancel":u&ct?"end":u&Ve?"move":u&Be?"start":""}function ee(u){return u==_t?"down":u==k?"up":u==qe?"left":u==ir?"right":""}function Z(u,p){var g=p.manager;return g?g.get(u):u}function wt(){Qe.apply(this,arguments)}w(wt,Qe,{defaults:{pointers:1},attrTest:function(u){var p=this.options.pointers;return p===0||u.pointers.length===p},process:function(u){var p=this.state,g=u.eventType,E=p&(Be|Ve),S=this.attrTest(u);return E&&(g&Pe||!S)?p|W:E||S?g&_e?p|ct:p&Be?p|Ve:Be:Ke}});function sr(){wt.apply(this,arguments),this.pX=null,this.pY=null}w(sr,wt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Et},getTouchAction:function(){var u=this.options.direction,p=[];return u&j&&p.push(pe),u&yt&&p.push(ye),p},directionTest:function(u){var p=this.options,g=!0,E=u.distance,S=u.direction,$=u.deltaX,V=u.deltaY;return S&p.direction||(p.direction&j?(S=$===0?rt:$<0?qe:ir,g=$!=this.pX,E=Math.abs(u.deltaX)):(S=V===0?rt:V<0?k:_t,g=V!=this.pY,E=Math.abs(u.deltaY))),u.direction=S,g&&E>p.threshold&&S&p.direction},attrTest:function(u){return wt.prototype.attrTest.call(this,u)&&(this.state&Be||!(this.state&Be)&&this.directionTest(u))},emit:function(u){this.pX=u.deltaX,this.pY=u.deltaY;var p=ee(u.direction);p&&this.manager.emit(this.options.event+p,u),this._super.emit.call(this,u)}});function or(){wt.apply(this,arguments)}w(or,wt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ae]},attrTest:function(u){return this._super.attrTest.call(this,u)&&(Math.abs(u.scale-1)>this.options.threshold||this.state&Be)},emit:function(u){if(this._super.emit.call(this,u),u.scale!==1){var p=u.scale<1?"in":"out";this.manager.emit(this.options.event+p,u)}}});function Or(){Qe.apply(this,arguments),this._timer=null,this._input=null}w(Or,Qe,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[ke]},process:function(u){var p=this.options,g=u.pointers.length===p.pointers,E=u.distance<p.threshold,S=u.deltaTime>p.time;if(this._input=u,!E||!g||u.eventType&(_e|Pe)&&!S)this.reset();else if(u.eventType&Oe)this.reset(),this._timer=_(function(){this.state=ft,this.tryEmit()},p.time,this);else if(u.eventType&_e)return ft;return Ke},reset:function(){clearTimeout(this._timer)},emit:function(u){this.state===ft&&(u&&u.eventType&_e?this.manager.emit(this.options.event+"up",u):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}});function Rt(){wt.apply(this,arguments)}w(Rt,wt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ae]},attrTest:function(u){return this._super.attrTest.call(this,u)&&(Math.abs(u.rotation)>this.options.threshold||this.state&Be)}});function Ot(){wt.apply(this,arguments)}w(Ot,wt,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:j|yt,pointers:1},getTouchAction:function(){return sr.prototype.getTouchAction.call(this)},attrTest:function(u){var p=this.options.direction,g;return p&(j|yt)?g=u.velocity:p&j?g=u.velocityX:p&yt&&(g=u.velocityY),this._super.attrTest.call(this,u)&&p&u.direction&&u.distance>this.options.threshold&&c(g)>this.options.velocity&&u.eventType&_e},emit:function(u){var p=ee(u.direction);p&&this.manager.emit(this.options.event+p,u),this.manager.emit(this.options.event,u)}});function Zr(){Qe.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}w(Zr,Qe,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[De]},process:function(u){var p=this.options,g=u.pointers.length===p.pointers,E=u.distance<p.threshold,S=u.deltaTime<p.time;if(this.reset(),u.eventType&Oe&&this.count===0)return this.failTimeout();if(E&&S&&g){if(u.eventType!=_e)return this.failTimeout();var $=this.pTime?u.timeStamp-this.pTime<p.interval:!0,V=!this.pCenter||gt(this.pCenter,u.center)<p.posThreshold;this.pTime=u.timeStamp,this.pCenter=u.center,!V||!$?this.count=1:this.count+=1,this._input=u;var me=this.count%p.taps;if(me===0)return this.hasRequireFailures()?(this._timer=_(function(){this.state=ft,this.tryEmit()},p.interval,this),Be):ft}return Ke},failTimeout:function(){return this._timer=_(function(){this.state=Ke},this.options.interval,this),Ke},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ft&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Yt(u,p){return p=p||{},p.recognizers=D(p.recognizers,Yt.defaults.preset),new y(u,p)}Yt.VERSION="2.0.4",Yt.defaults={domEvents:!1,touchAction:ce,enable:!0,inputTarget:null,inputClass:null,preset:[[Rt,{enable:!1}],[or,{enable:!1},["rotate"]],[Ot,{direction:j}],[sr,{direction:j},["swipe"]],[Zr],[Zr,{event:"doubletap",taps:2},["tap"]],[Or]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ut=1,d=2;function y(u,p){p=p||{},this.options=P(p,Yt.defaults),this.options.inputTarget=this.options.inputTarget||u,this.handlers={},this.session={},this.recognizers=[],this.element=u,this.input=gr(this),this.touchAction=new He(this,this.options.touchAction),x(this,!0),v(p.recognizers,function(g){var E=this.add(new g[0](g[1]));g[2]&&E.recognizeWith(g[2]),g[3]&&E.requireFailure(g[3])},this)}y.prototype={set:function(u){return h(this.options,u),u.touchAction&&this.touchAction.update(),u.inputTarget&&(this.input.destroy(),this.input.target=u.inputTarget,this.input.init()),this},stop:function(u){this.session.stopped=u?d:ut},recognize:function(u){var p=this.session;if(!p.stopped){this.touchAction.preventDefaults(u);var g,E=this.recognizers,S=p.curRecognizer;(!S||S&&S.state&ft)&&(S=p.curRecognizer=null);for(var $=0;$<E.length;)g=E[$],p.stopped!==d&&(!S||g==S||g.canRecognizeWith(S))?g.recognize(u):g.reset(),!S&&g.state&(Be|Ve|ct)&&(S=p.curRecognizer=g),$++}},get:function(u){if(u instanceof Qe)return u;for(var p=this.recognizers,g=0;g<p.length;g++)if(p[g].options.event==u)return p[g];return null},add:function(u){if(m(u,"add",this))return this;var p=this.get(u.options.event);return p&&this.remove(p),this.recognizers.push(u),u.manager=this,this.touchAction.update(),u},remove:function(u){if(m(u,"remove",this))return this;var p=this.recognizers;return u=this.get(u),p.splice(z(p,u),1),this.touchAction.update(),this},on:function(u,p){var g=this.handlers;return v(A(u),function(E){g[E]=g[E]||[],g[E].push(p)}),this},off:function(u,p){var g=this.handlers;return v(A(u),function(E){p?g[E].splice(z(g[E],p),1):delete g[E]}),this},emit:function(u,p){this.options.domEvents&&I(u,p);var g=this.handlers[u]&&this.handlers[u].slice();if(!(!g||!g.length)){p.type=u,p.preventDefault=function(){p.srcEvent.preventDefault()};for(var E=0;E<g.length;)g[E](p),E++}},destroy:function(){this.element&&x(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function x(u,p){var g=u.element;v(u.options.cssProps,function(E,S){g.style[se(g.style,S)]=p?E:""})}function I(u,p){var g=r.createEvent("Event");g.initEvent(u,!0,!0),g.gesture=p,p.target.dispatchEvent(g)}h(Yt,{INPUT_START:Oe,INPUT_MOVE:fe,INPUT_END:_e,INPUT_CANCEL:Pe,STATE_POSSIBLE:Ne,STATE_BEGAN:Be,STATE_CHANGED:Ve,STATE_ENDED:ct,STATE_RECOGNIZED:ft,STATE_CANCELLED:W,STATE_FAILED:Ke,DIRECTION_NONE:rt,DIRECTION_LEFT:qe,DIRECTION_RIGHT:ir,DIRECTION_UP:k,DIRECTION_DOWN:_t,DIRECTION_HORIZONTAL:j,DIRECTION_VERTICAL:yt,DIRECTION_ALL:Et,Manager:y,Input:We,TouchAction:He,TouchInput:oe,MouseInput:U,PointerEventInput:J,TouchMouseInput:Me,SingleTouchInput:Tt,Recognizer:Qe,AttrRecognizer:wt,Tap:Zr,Pan:sr,Swipe:Ot,Pinch:or,Rotate:Rt,Press:Or,on:O,off:B,each:v,merge:P,extend:h,inherit:w,bindFn:b,prefixed:se}),typeof n==a&&n.amd?n(function(){return Yt}):e.exports?e.exports=Yt:t[i]=Yt})(window,document,"Hammer")})(Hn);var Wr=Hn.exports,Sm=1,Nn="MarzipanoHammerElementId";function uo(e,t){return e[Nn]||(e[Nn]=Sm++),t+e[Nn]}function ki(){this._managers={},this._refCount={}}ki.prototype.get=function(e,t){var r=uo(e,t);return this._managers[r]||(this._managers[r]=this._createManager(e,t),this._refCount[r]=0),this._refCount[r]++,new Bi(this,this._managers[r],e,t)},ki.prototype._createManager=function(e,t){var r=new Wr.Manager(e);return t==="mouse"?r.add(new Wr.Pan({direction:Wr.DIRECTION_ALL,threshold:0})):(t==="touch"||t==="pen"||t==="kinect")&&(r.add(new Wr.Pan({direction:Wr.DIRECTION_ALL,threshold:20,pointers:1})),r.add(new Wr.Pinch)),r},ki.prototype._releaseHandle=function(e,t){var r=uo(e,t);this._refCount[r]&&(this._refCount[r]--,this._refCount[r]||(this._managers[r].destroy(),delete this._managers[r],delete this._refCount[r]))};function Bi(e,t,r,i){this._manager=t,this._element=r,this._type=i,this._hammerGestures=e,this._eventHandlers=[]}Bi.prototype.on=function(e,t){var r=this._type,i=function(n){r===n.pointerType&&t(n)};this._eventHandlers.push({events:e,handler:i}),this._manager.on(e,i)},Bi.prototype.release=function(){for(var e=0;e<this._eventHandlers.length;e++){var t=this._eventHandlers[e];this._manager.off(t.events,t.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},Bi.prototype.manager=function(){return this._manager};var Ui=new ki;function Rm(e,t,r,i,n){var s=Math.sqrt(Math.pow(t,2)+Math.pow(r,2));e=Math.max(e,s/i),vo(t,r,e,n),n[0]=Math.abs(n[0]),n[1]=Math.abs(n[1])}function vo(e,t,r,i){var n=Math.atan(t/e);i[0]=r*Math.cos(n),i[1]=r*Math.sin(n)}var po={maxFriction:Rm,changeVectorNorm:vo},Am=ze,mo=tr,Im=Ui,zm=Bt,$m=po.maxFriction,Om=Se,Dm={friction:6,maxFrictionTime:.3,hammerEvent:"pan"},_o=typeof MARZIPANODEBUG!="undefined"&&MARZIPANODEBUG.controls;function rr(e,t,r){if(this._element=e,this._opts=zm(r||{},Dm),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new mo,y:new mo},this._hammer=Im.get(e,t),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),this._opts.hammerEvent!="pan"&&this._opts.hammerEvent!="pinch")throw new Error(this._opts.hammerEvent+" is not a hammerEvent managed in DragControlMethod");this._hammer.on(this._opts.hammerEvent+"start",this._handleStart.bind(this)),this._hammer.on(this._opts.hammerEvent+"move",this._handleMove.bind(this)),this._hammer.on(this._opts.hammerEvent+"end",this._handleEnd.bind(this)),this._hammer.on(this._opts.hammerEvent+"cancel",this._handleEnd.bind(this))}Am(rr),rr.prototype.destroy=function(){this._hammer.release(),Om(this)},rr.prototype._handleHammerEvent=function(e){if(e.isFirst){if(_o&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}if(e.isFinal){if(_o&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},rr.prototype._handleStart=function(e){e.preventDefault(),this._startEvent=e},rr.prototype._handleMove=function(e){e.preventDefault(),this._startEvent&&(this._updateDynamicsMove(e),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},rr.prototype._handleEnd=function(e){e.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(e),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},rr.prototype._updateDynamicsMove=function(e){var t=e.deltaX,r=e.deltaY,i=this._lastEvent||this._startEvent;i&&(t-=i.deltaX,r-=i.deltaY);var n=this._element.getBoundingClientRect(),s=n.right-n.left,o=n.bottom-n.top;t/=s,r/=o,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-t,this._dynamics.y.offset=-r,this._lastEvent=e};var Fn=[null,null];rr.prototype._updateDynamicsRelease=function(e){var t=this._element.getBoundingClientRect(),r=t.right-t.left,i=t.bottom-t.top,n=1e3*e.velocityX/r,s=1e3*e.velocityY/i;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=n,this._dynamics.y.velocity=s,$m(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,Fn),this._dynamics.x.friction=Fn[0],this._dynamics.y.friction=Fn[1]};var yo=rr,Hm=ze,go=tr,Nm=Ui,Fm=Bt,km=po.maxFriction,Bm=Se,Um={speed:8,friction:6,maxFrictionTime:.3};function Ir(e,t,r){this._element=e,this._opts=Fm(r||{},Um),this._active=!1,this._hammer=Nm.get(e,t),this._dynamics={x:new go,y:new go},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}Hm(Ir),Ir.prototype.destroy=function(){this._hammer.release(),Bm(this)},Ir.prototype._handleStart=function(e){e.preventDefault(),this._active||(this._active=!0,this.emit("active"))},Ir.prototype._handleMove=function(e){e.preventDefault(),this._updateDynamics(e,!1)},Ir.prototype._handleRelease=function(e){e.preventDefault(),this._updateDynamics(e,!0),this._active&&(this._active=!1,this.emit("inactive"))};var kn=[null,null];Ir.prototype._updateDynamics=function(e,t){var r=this._element.getBoundingClientRect(),i=r.right-r.left,n=r.bottom-r.top,s=Math.max(i,n),o=e.deltaX/s*this._opts.speed,a=e.deltaY/s*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=o,this._dynamics.y.velocity=a,t&&(km(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,kn),this._dynamics.x.friction=kn[0],this._dynamics.y.friction=kn[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)};var wo=Ir,qm=ze,Wm=tr,Vm=Bt,Ym=Se,Xm={frictionTime:.2,zoomDelta:.001};function vi(e,t){this._element=e,this._opts=Vm(t||{},Xm),this._dynamics=new Wm,this._eventList=[];var r=this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing;this._wheelListener=r.bind(this),e.addEventListener("wheel",this._wheelListener)}qm(vi),vi.prototype.destroy=function(){this._element.removeEventListener("wheel",this._wheelListener),Ym(this)},vi.prototype.withoutSmoothing=function(e){this._dynamics.offset=Mo(e)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),e.preventDefault(),this.emit("active"),this.emit("inactive")},vi.prototype.withSmoothing=function(e){var t=e.timeStamp;for(this._eventList.push(e);this._eventList[0].timeStamp<t-this._opts.frictionTime*1e3;)this._eventList.shift(0);for(var r=0,i=0;i<this._eventList.length;i++){var n=Mo(this._eventList[i])*this._opts.zoomDelta;r+=n/this._opts.frictionTime}this._dynamics.velocity=r,this._dynamics.friction=Math.abs(r)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),e.preventDefault(),this.emit("active"),this.emit("inactive")};function Mo(e){var t=e.deltaMode==1?20:1;return e.deltaY*t}var xo=vi,Gm=ze,jm=tr,Zm=Ui,Km=Se;function Vr(e,t,r){this._hammer=Zm.get(e,t),this._lastEvent=null,this._active=!1,this._dynamics=new jm,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}Gm(Vr),Vr.prototype.destroy=function(){this._hammer.release(),Km(this)},Vr.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},Vr.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},Vr.prototype._handleEvent=function(e){var t=e.scale;this._lastEvent&&(t/=this._lastEvent.scale),this._dynamics.offset=(t-1)*-1,this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=e};var Eo=Vr,Qm=ze,Jm=tr,e1=Se;function di(e){if(!e)throw new Error("VelocityControlMethod: parameter must be defined");this._parameter=e,this._dynamics=new Jm}Qm(di),di.prototype.destroy=function(){e1(this)},di.prototype.setVelocity=function(e){this._dynamics.velocity=e,this.emit("parameterDynamics",this._parameter,this._dynamics)},di.prototype.setFriction=function(e){this._dynamics.friction=e,this.emit("parameterDynamics",this._parameter,this._dynamics)};var t1=di,r1=ze,i1=tr,n1=Se;function pi(e,t,r,i){if(!e)throw new Error("ElementPressControlMethod: element must be defined");if(!t)throw new Error("ElementPressControlMethod: parameter must be defined");if(!r)throw new Error("ElementPressControlMethod: velocity must be defined");if(!i)throw new Error("ElementPressControlMethod: friction must be defined");this._element=e,this._pressHandler=this._handlePress.bind(this),this._releaseHandler=this._handleRelease.bind(this),e.addEventListener("mousedown",this._pressHandler),e.addEventListener("mouseup",this._releaseHandler),e.addEventListener("mouseleave",this._releaseHandler),e.addEventListener("touchstart",this._pressHandler),e.addEventListener("touchmove",this._releaseHandler),e.addEventListener("touchend",this._releaseHandler),this._parameter=t,this._velocity=r,this._friction=i,this._dynamics=new i1,this._pressing=!1}r1(pi),pi.prototype.destroy=function(){this._element.removeEventListener("mousedown",this._pressHandler),this._element.removeEventListener("mouseup",this._releaseHandler),this._element.removeEventListener("mouseleave",this._releaseHandler),this._element.removeEventListener("touchstart",this._pressHandler),this._element.removeEventListener("touchmove",this._releaseHandler),this._element.removeEventListener("touchend",this._releaseHandler),n1(this)},pi.prototype._handlePress=function(){this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active")},pi.prototype._handleRelease=function(){this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1};var a1=pi,s1=ze,o1=tr,h1=xr,l1=Se;function zt(e){e=e||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch","roll"],this._now=e.nowForTesting||h1,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}s1(zt),zt.prototype.add=function(e){if(!this.has(e)){var t={};this._parameters.forEach(function(n){t[n]={dynamics:new o1,time:null}});var r=this._updateDynamics.bind(this,t),i={instance:e,dynamics:t,parameterDynamicsHandler:r};e.addEventListener("parameterDynamics",r),this._methods.push(i)}},zt.prototype.remove=function(e){var t=this._indexOfInstance(e);if(t>=0){var r=this._methods.splice(t,1)[0];r.instance.removeEventListener("parameterDynamics",r.parameterDynamicsHandler)}},zt.prototype.has=function(e){return this._indexOfInstance(e)>=0},zt.prototype._indexOfInstance=function(e){for(var t=0;t<this._methods.length;t++)if(this._methods[t].instance===e)return t;return-1},zt.prototype.list=function(){for(var e=[],t=0;t<this._methods.length;t++)e.push(this._methods[t].instance);return e},zt.prototype._updateDynamics=function(e,t,r){var i=e[t];if(!i)throw new Error("Unknown control parameter "+t);var n=this._now();i.dynamics.update(r,(n-i.time)/1e3),i.time=n,this.emit("change")},zt.prototype._resetComposedOffsets=function(){for(var e=0;e<this._parameters.length;e++)this._composedOffsets[this._parameters[e]]=0},zt.prototype.offsets=function(){var e,t=!1,r=this._now();this._resetComposedOffsets();for(var i=0;i<this._methods.length;i++)for(var n=this._methods[i].dynamics,s=0;s<this._parameters.length;s++){e=this._parameters[s];var o=n[e],a=o.dynamics;a.offset!=null&&(this._composedOffsets[e]+=a.offset,a.offset=null);var l=(r-o.time)/1e3,c=a.offsetFromVelocity(l);c&&(this._composedOffsets[e]+=c);var f=a.velocityAfter(l);a.velocity=f,f&&(t=!0),o.time=r}return this._composeReturn.changing=t,this._composeReturn},zt.prototype.destroy=function(){for(var e=this.list(),t=0;t<e.length;t++)this.remove(e[t]);l1(this)};var c1=zt,f1=ze,u1=c1,v1=Se,bo=typeof MARZIPANODEBUG!="undefined"&&MARZIPANODEBUG.controls;function Te(e){e=e||{},this._methods={},this._methodGroups={},this._composer=new u1,this._enabled=e&&e.enabled?!!e.enabled:!0,this._activeCount=0,this.updatedViews_=[],this._attachedRenderLoop=null}f1(Te),Te.prototype.destroy=function(){this.detach(),this._composer.destroy(),v1(this)},Te.prototype.methods=function(){var e={};for(var t in this._methods)e[t]=this._methods[t];return e},Te.prototype.method=function(e){return this._methods[e]},Te.prototype.registerMethod=function(e,t,r){if(this._methods[e])throw new Error("Control method already registered with id "+e);this._methods[e]={instance:t,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,e),inactiveHandler:this._handleInactive.bind(this,e)},r&&this.enableMethod(e,t)},Te.prototype.unregisterMethod=function(e){var t=this._methods[e];if(!t)throw new Error("No control method registered with id "+e);t.enabled&&this.disableMethod(e),delete this._methods[e]},Te.prototype.enableMethod=function(e){var t=this._methods[e];if(!t)throw new Error("No control method registered with id "+e);t.enabled||(t.enabled=!0,t.active&&this._incrementActiveCount(),this._listen(e),this._updateComposer(),this.emit("methodEnabled",e))},Te.prototype.disableMethod=function(e){var t=this._methods[e];if(!t)throw new Error("No control method registered with id "+e);!t.enabled||(t.enabled=!1,t.active&&this._decrementActiveCount(),this._unlisten(e),this._updateComposer(),this.emit("methodDisabled",e))},Te.prototype.addMethodGroup=function(e,t){this._methodGroups[e]=t},Te.prototype.removeMethodGroup=function(e){delete this._methodGroups[e]},Te.prototype.methodGroups=function(){var e={};for(var t in this._methodGroups)e[t]=this._methodGroups[t];return e},Te.prototype.enableMethodGroup=function(e){var t=this;t._methodGroups[e].forEach(function(r){t.enableMethod(r)})},Te.prototype.disableMethodGroup=function(e){var t=this;t._methodGroups[e].forEach(function(r){t.disableMethod(r)})},Te.prototype.enabled=function(){return this._enabled},Te.prototype.enable=function(){this._enabled||(this._enabled=!0,this._activeCount>0&&this.emit("active"),this.emit("enabled"),this._updateComposer())},Te.prototype.disable=function(){!this._enabled||(this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this.emit("disabled"),this._updateComposer())},Te.prototype.attach=function(e){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=e,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=e.renderOnNextFrame.bind(e),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},Te.prototype.detach=function(){!this._attachedRenderLoop||(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},Te.prototype.attached=function(){return this._attachedRenderLoop!=null},Te.prototype._listen=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");t.instance.addEventListener("active",t.activeHandler),t.instance.addEventListener("inactive",t.inactiveHandler)},Te.prototype._unlisten=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");t.instance.removeEventListener("active",t.activeHandler),t.instance.removeEventListener("inactive",t.inactiveHandler)},Te.prototype._handleActive=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");if(!t.enabled)throw new Error("Should not receive event from disabled control method");t.active||(t.active=!0,this._incrementActiveCount())},Te.prototype._handleInactive=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");if(!t.enabled)throw new Error("Should not receive event from disabled control method");t.active&&(t.active=!1,this._decrementActiveCount())},Te.prototype._incrementActiveCount=function(){this._activeCount++,bo&&this._checkActiveCount(),this._enabled&&this._activeCount===1&&this.emit("active")},Te.prototype._decrementActiveCount=function(){this._activeCount--,bo&&this._checkActiveCount(),this._enabled&&this._activeCount===0&&this.emit("inactive")},Te.prototype._checkActiveCount=function(){var e=0;for(var t in this._methods){var r=this._methods[t];r.enabled&&r.active&&e++}if(e!=this._activeCount)throw new Error("Bad control state")},Te.prototype._updateComposer=function(){var e=this._composer;for(var t in this._methods){var r=this._methods[t],i=this._enabled&&r.enabled;i&&!e.has(r.instance)&&e.add(r.instance),!i&&e.has(r.instance)&&e.remove(r.instance)}},Te.prototype._updateViewsWithControls=function(){var e=this._composer.offsets();e.changing&&this._attachedRenderLoop.renderOnNextFrame(),this.updatedViews_.length=0;for(var t=this._attachedRenderLoop.stage().listLayers(),r=0;r<t.length;r++){var i=t[r].view();this.updatedViews_.indexOf(i)<0&&(t[r].view().updateWithControlParameters(e.offsets),this.updatedViews_.push(i))}};var To=Te,d1=pt.setTransform,Po=In;function p1(e,t,r,i){i=i||"";var n="translateX("+Po(t)+"px) translateY("+Po(r)+"px) translateZ(0) "+i;d1(e,n)}var Lo=p1,m1=ze,_1=Lo,y1=pt.setTransform,g1=Se;function Mt(e,t,r,i,n){n=n||{},n.perspective=n.perspective||{},n.perspective.extraTransforms=n.perspective.extraTransforms!=null?n.perspective.extraTransforms:"",this._domElement=e,this._parentDomElement=t,this._view=r,this._coords={},this._perspective={},this.setPosition(i),this._parentDomElement.appendChild(this._domElement),this.setPerspective(n.perspective),this._visible=!0,this._position={x:0,y:0}}m1(Mt),Mt.prototype.destroy=function(){this._parentDomElement.removeChild(this._domElement),g1(this)},Mt.prototype.domElement=function(){return this._domElement},Mt.prototype.position=function(){return this._coords},Mt.prototype.setPosition=function(e){for(var t in e)this._coords[t]=e[t];this._update()},Mt.prototype.perspective=function(){return this._perspective},Mt.prototype.setPerspective=function(e){for(var t in e)this._perspective[t]=e[t];this._update()},Mt.prototype.show=function(){this._visible||(this._visible=!0,this._update())},Mt.prototype.hide=function(){this._visible&&(this._visible=!1,this._update())},Mt.prototype._update=function(){var e=this._domElement,t=this._coords,r=this._position,i,n,s=!1;if(this._visible){var o=this._view;this._perspective.radius?(s=!0,this._setEmbeddedPosition(o,t)):(o.coordinatesToScreen(t,r),i=r.x,n=r.y,i!=null&&n!=null&&(s=!0,this._setPosition(i,n)))}s?(e.style.display="block",e.style.position="absolute"):(e.style.display="none",e.style.position="")},Mt.prototype._setEmbeddedPosition=function(e,t){var r=e.coordinatesToPerspectiveTransform(t,this._perspective.radius,this._perspective.extraTransforms);y1(this._domElement,r)},Mt.prototype._setPosition=function(e,t){_1(this._domElement,e,t,this._perspective.extraTransforms)};var Co=Mt,w1=ze,M1=Co,x1=ta,So=Lo,Ro=pt.setAbsolute,E1=pt.setOverflowHidden,b1=pt.setOverflowVisible,T1=pt.setNullSize,P1=pt.setPixelSize,Ao=pt.setWithVendorPrefix("pointer-events"),L1=Se;function xt(e,t,r,i,n){n=n||{},this._parentDomElement=e,this._stage=t,this._view=r,this._renderLoop=i,this._hotspots=[],this._visible=!0,this._rect=n.rect,this._visibilityOrRectChanged=!0,this._stageWidth=null,this._stageHeight=null,this._tmpRect={},this._hotspotContainerWrapper=document.createElement("div"),Ro(this._hotspotContainerWrapper),Ao(this._hotspotContainerWrapper,"none"),this._parentDomElement.appendChild(this._hotspotContainerWrapper),this._hotspotContainer=document.createElement("div"),Ro(this._hotspotContainer),Ao(this._hotspotContainer,"all"),this._hotspotContainerWrapper.appendChild(this._hotspotContainer),this._updateHandler=this._update.bind(this),this._renderLoop.addEventListener("afterRender",this._updateHandler)}w1(xt),xt.prototype.destroy=function(){for(;this._hotspots.length;)this.destroyHotspot(this._hotspots[0]);this._parentDomElement.removeChild(this._hotspotContainerWrapper),this._renderLoop.removeEventListener("afterRender",this._updateHandler),L1(this)},xt.prototype.domElement=function(){return this._hotspotContainer},xt.prototype.setRect=function(e){this._rect=e,this._visibilityOrRectChanged=!0},xt.prototype.rect=function(){return this._rect},xt.prototype.createHotspot=function(e,t,r){t=t||{};var i=new M1(e,this._hotspotContainer,this._view,t,r);return this._hotspots.push(i),i._update(),this.emit("hotspotsChange"),i},xt.prototype.hasHotspot=function(e){return this._hotspots.indexOf(e)>=0},xt.prototype.listHotspots=function(){return[].concat(this._hotspots)},xt.prototype.destroyHotspot=function(e){var t=this._hotspots.indexOf(e);if(t<0)throw new Error("No such hotspot");this._hotspots.splice(t,1),e.destroy(),this.emit("hotspotsChange")},xt.prototype.hide=function(){this._visible&&(this._visible=!1,this._visibilityOrRectChanged=!0,this._update())},xt.prototype.show=function(){this._visible||(this._visible=!0,this._visibilityOrRectChanged=!0,this._update())},xt.prototype._update=function(){var e=this._hotspotContainerWrapper,t=this._stage.width(),r=this._stage.height(),i=this._tmpRect;if(this._visibilityOrRectChanged||this._rect&&(t!==this._stageWidth||r!==this._stageHeight)){var n=this._visible;e.style.display=n?"block":"none",n&&(this._rect?(x1(t,r,this._rect,i),So(e,t*i.x,r*i.y),P1(e,t*i.width,r*i.height),E1(e)):(So(e,0,0),T1(e),b1(e))),this._stageWidth=t,this._stageHeight=r,this._visibilityOrRectChanged=!1}for(var s=0;s<this._hotspots.length;s++)this._hotspots[s]._update()};var Io=xt,C1=lo,S1=oo,R1=Io,A1=ze,zo=xr,I1=li,z1=ni,$o=Bt,$1=Se;function Ge(e,t){this._viewer=e,this._view=t,this._layers=[],this._hotspotContainer=new R1(e._controlContainer,e.stage(),this._view,e.renderLoop()),this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotContainerHandler=this._updateHotspotContainer.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotContainerHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._view.addEventListener("change",this._viewChangeHandler),this._updateHotspotContainer()}A1(Ge),Ge.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotContainerHandler),this._movement&&this.stopMovement(),this._hotspotContainer.destroy(),this.destroyAllLayers(),$1(this)},Ge.prototype.hotspotContainer=function(){return this._hotspotContainer},Ge.prototype.layer=function(){return this._layers[0]},Ge.prototype.listLayers=function(){return[].concat(this._layers)},Ge.prototype.view=function(){return this._view},Ge.prototype.viewer=function(){return this._viewer},Ge.prototype.visible=function(){return this._viewer.scene()===this},Ge.prototype.createLayer=function(e){e=e||{};var t=e.textureStoreOpts||{},r=e.layerOpts||{},i=e.source,n=e.geometry,s=this._view,o=this._viewer.stage(),a=new S1(i,o,t),l=new C1(i,n,s,a,r);return this._layers.push(l),e.pinFirstLevel&&l.pinFirstLevel(),this.emit("layerChange"),l},Ge.prototype.destroyLayer=function(e){var t=this._layers.indexOf(e);if(t<0)throw new Error("No such layer in scene");this._layers.splice(t,1),this.emit("layerChange"),e.textureStore().destroy(),e.destroy()},Ge.prototype.destroyAllLayers=function(){for(;this._layers.length>0;)this.destroyLayer(this._layers[0])},Ge.prototype.switchTo=function(e,t){return this._viewer.switchScene(this,e,t)},Ge.prototype.lookTo=function(e,t,r){var i=this;if(t=t||{},r=r||I1,z1(e)!=="object")throw new Error("Target view parameters must be an object");var n=function(h){return(h*=2)<1?.5*h*h:-.5*(--h*(h-2)-1)},s=t.ease!=null?t.ease:n,o=t.controlsInterrupt!=null?t.controlsInterrupt:!1,a=t.transitionDuration!=null?t.transitionDuration:1e3,l=t.shortest!=null?t.shortest:!0,c=this._view,f=c.parameters(),_={};$o(_,e),$o(_,f),l&&c.normalizeToClosest&&c.normalizeToClosest(_,_);var m=function(){var h=!1;return function(P,w){if(w>=a&&h)return null;var b=Math.min(w/a,1);for(var R in P){var D=f[R],O=_[R];P[R]=D+s(b)*(O-D)}return h=w>=a,P}},v=this._viewer.controls().enabled();o||this._viewer.controls().disable(),this.startMovement(m,function(){v&&i._viewer.controls().enable(),r()})},Ge.prototype.startMovement=function(e,t){var r=this._viewer.renderLoop();this._movement&&this.stopMovement();var i=e();if(typeof i!="function")throw new Error("Bad movement");this._movement=e,this._movementStep=i,this._movementStartTime=zo(),this._movementParams={},this._movementCallback=t,r.addEventListener("beforeRender",this._updateMovementHandler),r.renderOnNextFrame()},Ge.prototype.stopMovement=function(){var e=this._movementCallback,t=this._viewer.renderLoop();!this._movement||(this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null,t.removeEventListener("beforeRender",this._updateMovementHandler),e&&e())},Ge.prototype.movement=function(){return this._movement},Ge.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var e=this._viewer.renderLoop(),t=this._view,r=zo()-this._movementStartTime,i=this._movementStep,n=this._movementParams;n=t.parameters(n),n=i(n,r),n==null?this.stopMovement():(t.setParameters(n),e.renderOnNextFrame())},Ge.prototype._updateHotspotContainer=function(){this.visible()?this._hotspotContainer.show():this._hotspotContainer.hide()};var Oo=Ge,O1=ze,D1=Bt,Do=xr,H1={duration:1/0};function Ut(e){e=D1(e||{},H1),this._duration=e.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}O1(Ut),Ut.prototype.start=function(){this._startTime=Do(),this._handle==null&&this._duration<1/0&&this._setup(this._duration)},Ut.prototype.started=function(){return this._startTime!=null},Ut.prototype.stop=function(){this._startTime=null,this._handle!=null&&(clearTimeout(this._handle),this._handle=null)},Ut.prototype._setup=function(e){this._handle=setTimeout(this._check,e)},Ut.prototype._teardown=function(){clearTimeout(this._handle),this._handle=null},Ut.prototype._check=function(){var e=Do(),t=e-this._startTime,r=this._duration-t;this._teardown(),r<=0?(this.emit("timeout"),this._startTime=null):r<1/0&&this._setup(r)},Ut.prototype.duration=function(){return this._duration},Ut.prototype.setDuration=function(e){this._duration=e,this._startTime!=null&&this._check()};var N1=Ut,F1=Bt,k1=Se,B1={active:"move",inactive:"default",disabled:"default"};function Yr(e,t,r,i){i=F1(i||{},B1),this._element=r,this._controls=e,this._id=t,this._attached=!1,this._setActiveCursor=this._setCursor.bind(this,i.active),this._setInactiveCursor=this._setCursor.bind(this,i.inactive),this._setDisabledCursor=this._setCursor.bind(this,i.disabled),this._setOriginalCursor=this._setCursor.bind(this,this._element.style.cursor),this._updateAttachmentHandler=this._updateAttachment.bind(this),e.addEventListener("methodEnabled",this._updateAttachmentHandler),e.addEventListener("methodDisabled",this._updateAttachmentHandler),e.addEventListener("enabled",this._updateAttachmentHandler),e.addEventListener("disabled",this._updateAttachmentHandler),this._updateAttachment()}Yr.prototype.destroy=function(){this._detachFromControlMethod(this._controls.method(this._id)),this._setOriginalCursor(),this._controls.removeEventListener("methodEnabled",this._updateAttachmentHandler),this._controls.removeEventListener("methodDisabled",this._updateAttachmentHandler),this._controls.removeEventListener("enabled",this._updateAttachmentHandler),this._controls.removeEventListener("disabled",this._updateAttachmentHandler),k1(this)},Yr.prototype._updateAttachment=function(){var e=this._controls,t=this._id;e.enabled()&&e.method(t).enabled?this._attachToControlMethod(e.method(t)):this._detachFromControlMethod(e.method(t))},Yr.prototype._attachToControlMethod=function(e){this._attached||(e.instance.addEventListener("active",this._setActiveCursor),e.instance.addEventListener("inactive",this._setInactiveCursor),e.active?this._setActiveCursor():this._setInactiveCursor(),this._attached=!0)},Yr.prototype._detachFromControlMethod=function(e){this._attached&&(e.instance.removeEventListener("active",this._setActiveCursor),e.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor(),this._attached=!1)},Yr.prototype._setCursor=function(e){this._element.style.cursor=e};var U1=Yr,q1=Bt,Bn=yo,W1=wo,V1=xo,Y1=Eo,Ct=fo,X1={mouseViewMode:"drag",dragMode:"pan"};function G1(e,t,r){r=q1(r||{},X1);var i={mouseViewDrag:new Bn(t,"mouse"),mouseViewQtvr:new W1(t,"mouse"),leftArrowKey:new Ct(37,"x",-.7,3),rightArrowKey:new Ct(39,"x",.7,3),upArrowKey:new Ct(38,"y",-.7,3),downArrowKey:new Ct(40,"y",.7,3),plusKey:new Ct(107,"zoom",-.7,3),minusKey:new Ct(109,"zoom",.7,3),wKey:new Ct(87,"y",-.7,3),aKey:new Ct(65,"x",-.7,3),sKey:new Ct(83,"y",.7,3),dKey:new Ct(68,"x",.7,3),qKey:new Ct(81,"roll",.7,3),eKey:new Ct(69,"roll",-.7,3)},n=["scrollZoom","touchView","pinch"];r.scrollZoom!==!1&&(i.scrollZoom=new V1(t));var s={arrowKeys:["leftArrowKey","rightArrowKey","upArrowKey","downArrowKey"],plusMinusKeys:["plusKey","minusKey"],wasdKeys:["wKey","aKey","sKey","dKey"],qeKeys:["qKey","eKey"]};switch(r.dragMode){case"pinch":i.pinch=new Bn(t,"touch",{hammerEvent:"pinch"});break;case"pan":i.touchView=new Bn(t,"touch"),i.pinch=new Y1(t,"touch");break;default:throw new Error("Unknown drag mode: "+r.dragMode)}switch(r.mouseViewMode){case"drag":n.push("mouseViewDrag");break;case"qtvr":n.push("mouseViewQtvr");break;default:throw new Error("Unknown mouse view mode: "+r.mouseViewMode)}for(var o in i){var a=i[o];e.registerMethod(o,a),n.indexOf(o)>=0&&e.enableMethod(o)}for(var l in s){var c=s[l];e.addMethodGroup(l,c)}return i}var Ho=G1,No=xr;function j1(e,t,r){var i=!1,n=No();function s(){if(!i){var o=(No()-n)/e;o<1?(t(o),requestAnimationFrame(s)):(t(1),r())}}return t(0),requestAnimationFrame(s),function(){i=!0,r.apply(null,arguments)}}var Fo=j1,Z1=ze,K1=co,Q1=To,J1=Oo,e_=N1,t_=ua,r_=U1,ko=Ui,i_=Ho,n_=Ds,a_=pt.setOverflowHidden,s_=pt.setAbsolute,o_=pt.setFullSize,h_=Fo,l_=li,c_=Se;function xe(e,t){t=t||{},this._domElement=e,a_(e),this._stage=new t_(t.stage),n_(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),s_(this._controlContainer),o_(this._controlContainer),e.appendChild(this._controlContainer),this._size={},this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new K1(this._stage),this._controls=new Q1,this._controlMethods=i_(this._controls,this._controlContainer,t.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=ko.get(this._controlContainer,"touch"),this._hammerManagerMouse=ko.get(this._controlContainer,"mouse"),this._dragCursor=new r_(this._controls,"mouseViewDrag",e,t.cursors&&t.cursors.drag||{}),this._renderLoop.start(),this._scenes=[],this._currentScene=null,this._replacedScene=null,this._cancelCurrentTween=null,this._layerChangeHandler=this._updateSceneLayers.bind(this),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new e_,this._idleTimer.start(),this._resetIdleTimerHandler=this._resetIdleTimer.bind(this),this.addEventListener("viewChange",this._resetIdleTimerHandler),this._triggerIdleTimerHandler=this._triggerIdleTimer.bind(this),this._idleTimer.addEventListener("timeout",this._triggerIdleTimerHandler),this._stopMovementHandler=this.stopMovement.bind(this),this._controls.addEventListener("active",this._stopMovementHandler),this.addEventListener("sceneChange",this._stopMovementHandler),this._idleMovement=null}Z1(xe),xe.prototype.destroy=function(){window.removeEventListener("resize",this._updateSizeListener),this._currentScene&&this._removeSceneEventListeners(this._currentScene),this._replacedScene&&this._removeSceneEventListeners(this._replacedScene),this._dragCursor.destroy();for(var e in this._controlMethods)this._controlMethods[e].destroy();for(;this._scenes.length;)this.destroyScene(this._scenes[0]);this._domElement.removeChild(this._stage.domElement()),this._stage.destroy(),this._renderLoop.destroy(),this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&this._cancelCurrentTween(),c_(this)},xe.prototype.updateSize=function(){var e=this._size;e.width=this._domElement.clientWidth,e.height=this._domElement.clientHeight,this._stage.setSize(e)},xe.prototype.stage=function(){return this._stage},xe.prototype.renderLoop=function(){return this._renderLoop},xe.prototype.controls=function(){return this._controls},xe.prototype.domElement=function(){return this._domElement},xe.prototype.createScene=function(e){e=e||{};var t=this.createEmptyScene({view:e.view});return t.createLayer({source:e.source,geometry:e.geometry,pinFirstLevel:e.pinFirstLevel,textureStoreOpts:e.textureStoreOpts,layerOpts:e.layerOpts}),t},xe.prototype.createEmptyScene=function(e){e=e||{};var t=new J1(this,e.view);return this._scenes.push(t),t},xe.prototype._updateSceneLayers=function(){var e,t,r=this._stage,i=this._currentScene,n=this._replacedScene,s=r.listLayers(),o=[];if(n&&(o=o.concat(n.listLayers())),i&&(o=o.concat(i.listLayers())),Math.abs(s.length-o.length)!==1)throw new Error("Stage and scene out of sync");if(o.length<s.length){for(e=0;e<s.length;e++)if(t=s[e],o.indexOf(t)<0){this._removeLayerFromStage(t);break}}if(o.length>s.length)for(e=0;e<o.length;e++)t=o[e],s.indexOf(t)<0&&this._addLayerToStage(t,e)},xe.prototype._addLayerToStage=function(e,t){e.pinFirstLevel(),this._stage.addLayer(e,t)},xe.prototype._removeLayerFromStage=function(e){this._stage.removeLayer(e),e.unpinFirstLevel(),e.textureStore().clearNotPinned()},xe.prototype._addSceneEventListeners=function(e){e.addEventListener("layerChange",this._layerChangeHandler),e.addEventListener("viewChange",this._viewChangeHandler)},xe.prototype._removeSceneEventListeners=function(e){e.removeEventListener("layerChange",this._layerChangeHandler),e.removeEventListener("viewChange",this._viewChangeHandler)},xe.prototype.destroyScene=function(e){var t=this._scenes.indexOf(e);if(t<0)throw new Error("No such scene in viewer");var r,i;if(this._currentScene===e){for(this._removeSceneEventListeners(e),i=e.listLayers(),r=0;r<i.length;r++)this._removeLayerFromStage(i[r]);this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._currentScene=null,this.emit("sceneChange")}if(this._replacedScene===e){for(this._removeSceneEventListeners(e),i=e.listLayers(),r=0;r<i.length;r++)this._removeLayerFromStage(i[r]);this._replacedScene=null}this._scenes.splice(t,1),e.destroy()},xe.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},xe.prototype.hasScene=function(e){return this._scenes.indexOf(e)>=0},xe.prototype.listScenes=function(){return[].concat(this._scenes)},xe.prototype.scene=function(){return this._currentScene},xe.prototype.view=function(){var e=this._currentScene;return e?e.view():null},xe.prototype.lookTo=function(e,t,r){var i=this._currentScene;i&&i.lookTo(e,t,r)},xe.prototype.startMovement=function(e,t){var r=this._currentScene;!r||r.startMovement(e,t)},xe.prototype.stopMovement=function(){var e=this._currentScene;!e||e.stopMovement()},xe.prototype.movement=function(){var e=this._currentScene;if(!!e)return e.movement()},xe.prototype.setIdleMovement=function(e,t){this._idleTimer.setDuration(e),this._idleMovement=t},xe.prototype.breakIdleMovement=function(){this.stopMovement(),this._resetIdleTimer()},xe.prototype._resetIdleTimer=function(){this._idleTimer.start()},xe.prototype._triggerIdleTimer=function(){var e=this._idleMovement;!e||this.startMovement(e)};var f_=1e3;function u_(e,t,r){var i=t.listLayers();i.forEach(function(n){n.mergeEffects({opacity:e})}),t._hotspotContainer.domElement().style.opacity=e}xe.prototype.switchScene=function(e,t,r){var i=this;t=t||{},r=r||l_;var n=this._stage,s=this._currentScene;if(s===e){r();return}if(this._scenes.indexOf(e)<0)throw new Error("No such scene in viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var o=s?s.listLayers():[],a=e.listLayers(),l=n.listLayers();if(s&&(l.length!==o.length||l.length>1&&l[0]!=o[0]))throw new Error("Stage not in sync with viewer");for(var c=t.transitionDuration!=null?t.transitionDuration:f_,f=t.transitionUpdate!=null?t.transitionUpdate:u_,_=0;_<a.length;_++)this._addLayerToStage(a[_]);function m(h){f(h,e,s)}function v(){if(i._replacedScene){i._removeSceneEventListeners(i._replacedScene),o=i._replacedScene.listLayers();for(var h=0;h<o.length;h++)i._removeLayerFromStage(o[h]);i._replacedScene=null}i._cancelCurrentTween=null,r()}this._cancelCurrentTween=h_(c,m,v),this._currentScene=e,this._replacedScene=s,this.emit("sceneChange"),this.emit("viewChange"),this._addSceneEventListeners(e)};var v_=xe,qi=at.vec4,d_=at.mat4;function p_(e){var t=e||{};return t.colorOffset=t.colorOffset||qi.create(),t.colorMatrix=t.colorMatrix||d_.create(),t}function Bo(e,t,r){m_(r,e,t.colorMatrix),qi.add(r,r,t.colorOffset)}function m_(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3];return e[0]=r[0]*i+r[1]*n+r[2]*s+r[3]*o,e[1]=r[4]*i+r[5]*n+r[6]*s+r[7]*o,e[2]=r[8]*i+r[9]*n+r[10]*s+r[11]*o,e[3]=r[12]*i+r[13]*n+r[14]*s+r[15]*o,e}var zr=qi.create();function __(e,t){for(var r=e.width,i=e.height,n=e.data,s=0;s<r*i;s++)qi.set(zr,n[s*4+0]/255,n[s*4+1]/255,n[s*4+2]/255,n[s*4+3]/255),Bo(zr,t,zr),n[s*4+0]=zr[0]*255,n[s*4+1]=zr[1]*255,n[s*4+2]=zr[2]*255,n[s*4+3]=zr[3]*255}var y_={identity:p_,applyToPixel:Bo,applyToImageData:__},g_=Bt,Un=.1,qn=.01,w_={yawSpeed:Un,pitchSpeed:Un,fovSpeed:Un,yawAccel:qn,pitchAccel:qn,fovAccel:qn,targetPitch:0,targetFov:null};function M_(e){e=g_(e||{},w_);var t=e.yawSpeed,r=e.pitchSpeed,i=e.fovSpeed,n=e.yawAccel,s=e.pitchAccel,o=e.fovAccel,a=e.targetPitch,l=e.targetFov;return function(){var f=0,_=0,m=0,v=0,h=0,P=0,w=0,b,R,D,O;return function(F,X){if(b=(X-f)/1e3,h=Math.min(_+b*n,t),R=h*b,F.yaw=F.yaw+R,a!=null&&F.pitch!==a){var A=.5*m*m/s;Math.abs(a-F.pitch)>A?P=Math.min(m+b*s,r):P=Math.max(m-b*s,0),D=P*b,a<F.pitch&&(F.pitch=Math.max(a,F.pitch-D)),a>F.pitch&&(F.pitch=Math.min(a,F.pitch+D))}if(l!=null&&F.fov!==a){var z=.5*v*v/o;Math.abs(l-F.fov)>z?w=Math.min(v+b*o,i):w=Math.max(v-b*o,0),O=w*b,l<F.fov&&(F.fov=Math.max(l,F.fov-O)),l>F.fov&&(F.fov=Math.min(l,F.fov+O))}return f=X,_=h,m=P,v=w,F}}}var x_=M_;function E_(e,t){function r(){t&&t.length>0?e.apply(null,t):e()}setTimeout(r,0)}var b_=E_;function T_(e){return e*Math.PI/180}var P_=T_;function L_(e){return e*180/Math.PI}var C_=L_,mi={WebGlStage:ua,WebGlCubeRenderer:As,WebGlFlatRenderer:zs,WebGlEquirectRenderer:Os,registerDefaultRenderers:Ds,CubeGeometry:qp,FlatGeometry:Jp,EquirectGeometry:a0,RectilinearView:P0,FlatView:O0,ImageUrlSource:Q0,SingleAssetSource:J0,StaticAsset:nn,DynamicAsset:nm,TextureStore:oo,Layer:lo,RenderLoop:co,KeyControlMethod:fo,DragControlMethod:yo,QtvrControlMethod:wo,ScrollZoomControlMethod:xo,PinchZoomControlMethod:Eo,VelocityControlMethod:t1,ElementPressControlMethod:a1,Controls:To,Dynamics:tr,Viewer:v_,Scene:Oo,Hotspot:Co,HotspotContainer:Io,colorEffects:y_,registerDefaultControls:Ho,autorotate:x_,util:{async:ra,cancelize:ia,chain:$n,clamp:Fr,clearOwnProperties:Se,cmp:ri,compose:Xs,convertFov:Ys,decimal:In,defaults:Bt,defer:b_,degToRad:P_,delay:Js,dom:pt,extend:ho,hash:zi,inherits:Ht,mod:cr,noop:li,now:xr,once:en,pixelRatio:Ti,radToDeg:C_,real:An,retry:ro,tween:Fo,type:ni},dependencies:{bowser:Ei.exports,glMatrix:at,eventEmitter:ze,hammerjs:Hn.exports}};function S_(e){let t,r;return{c(){t=At("div"),r=At("div"),this.c=Ie,Xt(r,"class","pano"),Xt(t,"class","wrap")},m(i,n){dt(i,t,n),Hr(t,r),e[2](r)},p:Ie,i:Ie,o:Ie,d(i){i&&Pt(t),e[2](null)}}}function R_(e,t,r){let{gql:i={}}=t,n;Gn(()=>{const o={controls:{mouseViewMode:"drag"}},a=new mi.Viewer(n,o),l=mi.ImageUrlSource.fromString(i.panorama.mediaItemUrl);a.controls().enableMethodGroup("arrowKeys");const c=new mi.EquirectGeometry([{width:4e3}]),f=mi.RectilinearView.limit.traditional(1024,100*Math.PI/180),_=new mi.RectilinearView({yaw:Math.PI},f);a.createScene({source:l,geometry:c,view:_,pinFirstLevel:!0}).switchTo()});function s(o){yi[o?"unshift":"push"](()=>{n=o,r(0,n)})}return e.$$set=o=>{"gql"in o&&r(1,i=o.gql)},[n,i,s]}class A_ extends xi{constructor(t){super();this.shadowRoot.innerHTML="<style>*,*:before,*:after{box-sizing:border-box}.wrap{position:relative;padding-bottom:56.25%;height:0;overflow:hidden}.pano{position:absolute;top:0;left:0;width:100%;height:100%}</style>",Qi(this,{target:this.shadowRoot,props:Gi(this.attributes),customElement:!0},R_,S_,Yi,{gql:1},null),t&&(t.target&&dt(t.target,this,t.anchor),t.props&&(this.$set(t.props),Dt()))}static get observedAttributes(){return["gql"]}get gql(){return this.$$.ctx[1]}set gql(t){this.$$set({gql:t}),Dt()}}customElements.define("vepple-panorama",A_),window.pannellum=function(e,t,r){function i(n,s){var o=this,a,l,c,f,_=!1,m=Date.now(),v=0,h=0,P=-1,w=0,b=0,R=new Array(10),D=!1,O,B=!1,F=!1,X,A,z={yaw:0,pitch:0,hfov:0},ae=!1,Y=!1,se=0,ve,G=0,L,ot,ie={},$e={},Re=[],Xe=!1,mt=1e-6,$t,yr=!1,Xr=!1,Oe={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:r,maxPitch:r,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:r,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:je,draggable:!0,dragConfirm:!1,disableKeyboardCtrl:!1,crossOrigin:"anonymous",targetBlank:!1,touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15};Oe.strings={loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console.",twoTouchActivate:"Use two fingers together to pan the panorama.",twoTouchXActivate:"Use two fingers together to pan the panorama horizontally.",twoTouchYActivate:"Use two fingers together to pan the panorama vertically.",ctrlZoomActivate:"Use %s + scroll to zoom the panorama."},n=typeof n=="string"?t.getElementById(n):n,n.classList.add("pnlm-container"),n.tabIndex=0;var fe=t.createElement("div");fe.className="pnlm-ui",n.appendChild(fe);var _e=t.createElement("div");_e.className="pnlm-render-container",n.appendChild(_e);var Pe=t.createElement("div");Pe.className="pnlm-dragfix",fe.appendChild(Pe);var rt=t.createElement("span");rt.className="pnlm-about-msg";var qe=t.createElement("a");qe.href="https://pannellum.org/",qe.textContent="Pannellum",rt.appendChild(qe);var ir=t.createElement("span");rt.appendChild(ir),fe.appendChild(rt),Pe.addEventListener("contextmenu",Wt);var k={},_t=t.createElement("div");_t.className="pnlm-sprite pnlm-hot-spot-debug-indicator",fe.appendChild(_t),k.container=t.createElement("div"),k.container.className="pnlm-panorama-info",k.title=t.createElement("div"),k.title.className="pnlm-title-box",k.container.appendChild(k.title),k.author=t.createElement("div"),k.author.className="pnlm-author-box",k.container.appendChild(k.author),fe.appendChild(k.container),k.load={},k.load.box=t.createElement("div"),k.load.box.className="pnlm-load-box",k.load.boxp=t.createElement("p"),k.load.box.appendChild(k.load.boxp),k.load.lbox=t.createElement("div"),k.load.lbox.className="pnlm-lbox",k.load.lbox.innerHTML='<div class="pnlm-loading"></div>',k.load.box.appendChild(k.load.lbox),k.load.lbar=t.createElement("div"),k.load.lbar.className="pnlm-lbar",k.load.lbarFill=t.createElement("div"),k.load.lbarFill.className="pnlm-lbar-fill",k.load.lbar.appendChild(k.load.lbarFill),k.load.box.appendChild(k.load.lbar),k.load.msg=t.createElement("p"),k.load.msg.className="pnlm-lmsg",k.load.box.appendChild(k.load.msg),fe.appendChild(k.load.box),k.errorMsg=t.createElement("div"),k.errorMsg.className="pnlm-error-msg pnlm-info-box",fe.appendChild(k.errorMsg),k.interactionMsg=t.createElement("div"),k.interactionMsg.className="pnlm-interaction-msg pnlm-info-box",fe.appendChild(k.interactionMsg);var j={};j.container=t.createElement("div"),j.container.className="pnlm-controls-container",fe.appendChild(j.container),j.load=t.createElement("button"),j.load.className="pnlm-load-button",j.load.addEventListener("click",function(){ct(),wt()}),fe.appendChild(j.load),j.zoom=t.createElement("div"),j.zoom.className="pnlm-zoom-controls pnlm-controls",j.zoomIn=t.createElement("div"),j.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",j.zoomIn.addEventListener("click",Ke),j.zoom.appendChild(j.zoomIn),j.zoomOut=t.createElement("div"),j.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",j.zoomOut.addEventListener("click",Qe),j.zoom.appendChild(j.zoomOut),j.container.appendChild(j.zoom),j.fullscreen=t.createElement("div"),j.fullscreen.addEventListener("click",ft),j.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&j.container.appendChild(j.fullscreen),j.orientation=t.createElement("div"),j.orientation.addEventListener("click",function(d){Y?or():Or()}),j.orientation.addEventListener("mousedown",function(d){d.stopPropagation()}),j.orientation.addEventListener("touchstart",function(d){d.stopPropagation()}),j.orientation.addEventListener("pointerdown",function(d){d.stopPropagation()}),j.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var yt=!1;e.DeviceOrientationEvent&&location.protocol=="https:"&&navigator.userAgent.toLowerCase().indexOf("mobi")>=0&&(j.container.appendChild(j.orientation),yt=!0);var Et=t.createElement("div");Et.className="pnlm-compass pnlm-controls pnlm-control",fe.appendChild(Et),s.firstScene?Ve(s.firstScene):s.default&&s.default.firstScene?Ve(s.default.firstScene):Ve(null),ct(!0);function $r(){var d=t.createElement("div");if(d.innerHTML="<!--[if lte IE 9]><i></i><![endif]-->",d.getElementsByTagName("i").length==1){bt();return}L=a.hfov,ot=a.pitch;var y,x;if(a.type=="cubemap"){for(X=[],y=0;y<6;y++)X.push(new Image),X[y].crossOrigin=a.crossOrigin;k.load.lbox.style.display="block",k.load.lbar.style.display="none"}else if(a.type=="multires"){var I=JSON.parse(JSON.stringify(a.multiRes));a.basePath&&a.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(a.multiRes.basePath)?I.basePath=a.basePath+a.multiRes.basePath:a.multiRes.basePath?I.basePath=a.multiRes.basePath:a.basePath&&(I.basePath=a.basePath),X=I}else if(a.dynamic===!0)X=a.panorama;else{if(a.panorama===r){bt(a.strings.noPanoramaError);return}X=new Image}if(a.type=="cubemap"){var u=6,p=function(){u--,u===0&&We()},g=function(S){var $=t.createElement("a");$.href=S.target.src,$.textContent=$.href,bt(a.strings.fileAccessError.replace("%s",$.outerHTML))};for(y=0;y<X.length;y++)x=a.cubeMap[y],x=="null"?(console.log("Will use background instead of missing cubemap face "+y),p()):(a.basePath&&!St(x)&&(x=a.basePath+x),X[y].onload=p,X[y].onerror=g,X[y].src=Ot(x))}else if(a.type=="multires")We();else if(x="",a.basePath&&(x=a.basePath),a.dynamic!==!0){if(a.panorama instanceof Image||a.panorama instanceof ImageData||e.ImageBitmap&&a.panorama instanceof ImageBitmap){X=a.panorama,We();return}x=St(a.panorama)?a.panorama:x+a.panorama,X.onload=function(){e.URL.revokeObjectURL(this.src),We()};var E=new XMLHttpRequest;E.onloadend=function(){if(E.status!=200){var S=t.createElement("a");S.href=x,S.textContent=S.href,bt(a.strings.fileAccessError.replace("%s",S.outerHTML))}var $=this.response;gr($,x),k.load.msg.innerHTML=""},E.onprogress=function(S){if(S.lengthComputable){var $=S.loaded/S.total*100;k.load.lbarFill.style.width=$+"%";var V,me,de;S.total>1e6?(V="MB",me=(S.loaded/1e6).toFixed(2),de=(S.total/1e6).toFixed(2)):S.total>1e3?(V="kB",me=(S.loaded/1e3).toFixed(1),de=(S.total/1e3).toFixed(1)):(V="B",me=S.loaded,de=S.total),k.load.msg.innerHTML=me+" / "+de+" "+V}else k.load.lbox.style.display="block",k.load.lbar.style.display="none"};try{E.open("GET",x,!0)}catch{bt(a.strings.malformedURLError)}E.responseType="blob",E.setRequestHeader("Accept","image/*,*/*;q=0.9"),E.withCredentials=a.crossOrigin==="use-credentials",E.send()}a.draggable&&fe.classList.add("pnlm-grab"),fe.classList.remove("pnlm-grabbing"),Xe=a.dynamicUpdate===!0,a.dynamic&&Xe&&(X=a.panorama,We())}function St(d){return new RegExp("^(?:[a-z]+:)?//","i").test(d)||d[0]=="/"||d.slice(0,5)=="blob:"}function We(){l||(l=new libpannellum.renderer(_e)),F||(F=!0,Pe.addEventListener("mousedown",ar,!1),t.addEventListener("mousemove",Vt,!1),t.addEventListener("mouseup",wr,!1),a.mouseZoom&&(fe.addEventListener("mousewheel",te,!1),fe.addEventListener("DOMMouseScroll",te,!1)),a.doubleClickZoom&&Pe.addEventListener("dblclick",jr,!1),n.addEventListener("mozfullscreenchange",W,!1),n.addEventListener("webkitfullscreenchange",W,!1),n.addEventListener("msfullscreenchange",W,!1),n.addEventListener("fullscreenchange",W,!1),typeof ResizeObserver=="function"?($t=new ResizeObserver(we),$t.observe(n)):(e.addEventListener("resize",we,!1),e.addEventListener("orientationchange",we,!1)),a.disableKeyboardCtrl||(n.addEventListener("keydown",J,!1),n.addEventListener("keyup",he,!1),n.addEventListener("blur",ge,!1)),t.addEventListener("mouseleave",wr,!1),t.documentElement.style.pointerAction===""&&t.documentElement.style.touchAction===""?(Pe.addEventListener("pointerdown",C,!1),Pe.addEventListener("pointermove",q,!1),Pe.addEventListener("pointerup",Q,!1),Pe.addEventListener("pointerleave",Q,!1)):(Pe.addEventListener("touchstart",M,!1),Pe.addEventListener("touchmove",T,!1),Pe.addEventListener("touchend",H,!1)),e.navigator.pointerEnabled&&(n.style.touchAction="none")),De(),ee(a.hfov),setTimeout(function(){},500)}function gr(d,y){var x=new FileReader;x.addEventListener("loadend",function(){var I=x.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var u=I.indexOf("\xFF\xC2");(u<0||u>65536)&&bt(a.strings.iOS8WebGLError)}var p=I.indexOf("<x:xmpmeta");if(p>-1&&a.ignoreGPanoXMP!==!0){var g=I.substring(p,I.indexOf("</x:xmpmeta>")+12),E=function($){var V;return g.indexOf($+'="')>=0?(V=g.substring(g.indexOf($+'="')+$.length+2),V=V.substring(0,V.indexOf('"'))):g.indexOf($+">")>=0&&(V=g.substring(g.indexOf($+">")+$.length+1),V=V.substring(0,V.indexOf("<"))),V!==r?Number(V):null},S={fullWidth:E("GPano:FullPanoWidthPixels"),croppedWidth:E("GPano:CroppedAreaImageWidthPixels"),fullHeight:E("GPano:FullPanoHeightPixels"),croppedHeight:E("GPano:CroppedAreaImageHeightPixels"),topPixels:E("GPano:CroppedAreaTopPixels"),heading:E("GPano:PoseHeadingDegrees"),horizonPitch:E("GPano:PosePitchDegrees"),horizonRoll:E("GPano:PoseRollDegrees"),pitch:E("GPano:InitialViewPitchDegrees"),yaw:E("GPano:InitialViewHeadingDegrees"),hfov:E("GPano:InitialHorizontalFOVDegrees")};S.fullWidth!==null&&S.croppedWidth!==null&&S.fullHeight!==null&&S.croppedHeight!==null&&S.topPixels!==null&&(Re.indexOf("haov")<0&&(a.haov=S.croppedWidth/S.fullWidth*360),Re.indexOf("vaov")<0&&(a.vaov=S.croppedHeight/S.fullHeight*180),Re.indexOf("vOffset")<0&&(a.vOffset=((S.topPixels+S.croppedHeight/2)/S.fullHeight-.5)*-180),S.heading!==null&&Re.indexOf("northOffset")<0&&(a.northOffset=S.heading,a.compass!==!1&&(a.compass=!0)),S.horizonPitch!==null&&S.horizonRoll!==null&&(Re.indexOf("horizonPitch")<0&&(a.horizonPitch=S.horizonPitch),Re.indexOf("horizonRoll")<0&&(a.horizonRoll=S.horizonRoll)),S.pitch!=null&&Re.indexOf("pitch")<0&&(a.pitch=S.pitch),S.yaw!=null&&Re.indexOf("yaw")<0&&(a.yaw=S.yaw),S.hfov!=null&&Re.indexOf("hfov")<0&&(a.hfov=S.hfov))}X.src=e.URL.createObjectURL(d),X.onerror=function(){function $(){return e.fetch?e.fetch(t.location.href).then(function(V){return V.headers.get("Content-Security-Policy")}):null}$().then(function(V){if(V){var me=V.split(";").find(function(de){var Ue=de.match(/img-src(.*)/);if(Ue)return!Ue[1].includes("blob")});me&&(console.log("CSP blocks blobs; reverting to URL."),X.crossOrigin=a.crossOrigin,X.src=y)}})}}),x.readAsBinaryString!==r?x.readAsBinaryString(d):x.readAsText(d)}function bt(d){d===r&&(d=a.strings.genericWebGLError),k.errorMsg.innerHTML="<p>"+d+"</p>",j.load.style.display="none",k.load.box.style.display="none",k.errorMsg.style.display="table",B=!0,O=r,_e.style.display="none",ut("error",d)}function Gr(){B&&(k.load.box.style.display="none",k.errorMsg.style.display="none",B=!1,_e.style.display="block",ut("errorcleared"))}function nr(d){k.interactionMsg.style.opacity=1,k.interactionMsg.innerHTML="<p>"+d+"</p>",k.interactionMsg.style.display="table",ut("messageshown"),clearTimeout(k.interactionMsg.timeout),k.interactionMsg.removeEventListener("transitionend",qt),k.interactionMsg.timeout=setTimeout(function(){k.interactionMsg.style.opacity=0,k.interactionMsg.addEventListener("transitionend",qt)},2e3)}function qt(){k.interactionMsg.style.opacity=0,k.interactionMsg.style.display="none",ut("messagecleared")}function Wt(d){var y=it(d);rt.style.left=y.x+"px",rt.style.top=y.y+"px",clearTimeout(Wt.t1),clearTimeout(Wt.t2),rt.style.display="block",rt.style.opacity=1,Wt.t1=setTimeout(function(){rt.style.opacity=0},2e3),Wt.t2=setTimeout(function(){rt.style.display="none"},2500),d.preventDefault()}function it(d){var y=n.getBoundingClientRect(),x={};return x.x=(d.clientX||d.pageX)-y.left,x.y=(d.clientY||d.pageY)-y.top,x}function ar(d){if(d.preventDefault(),n.focus(),!(!O||!a.draggable||a.draggingHotSpot)){var y=it(d);if(a.hotSpotDebug){var x=gt(d);console.log("Pitch: "+x[0]+", Yaw: "+x[1]+", Center Pitch: "+a.pitch+", Center Yaw: "+a.yaw+", HFOV: "+a.hfov)}Z(),or(),a.roll=0,z.hfov=0,_=!0,m=Date.now(),v=y.x,h=y.y,w=a.yaw,b=a.pitch,fe.classList.add("pnlm-grabbing"),fe.classList.remove("pnlm-grab"),ut("mousedown",d),oe()}}function jr(d){if(a.minHfov===a.hfov)o.setHfov(L,1e3);else{var y=gt(d);o.lookAt(y[0],y[1],a.minHfov,1e3)}}function gt(d){var y=it(d),x=l.getCanvas(),I=x.clientWidth,u=x.clientHeight,p=y.x/I*2-1,g=(1-y.y/u*2)*u/I,E=1/Math.tan(a.hfov*Math.PI/360),S=Math.sin(a.pitch*Math.PI/180),$=Math.cos(a.pitch*Math.PI/180),V=E*$-g*S,me=Math.sqrt(p*p+V*V),de=Math.atan((g*$+E*S)/me)*180/Math.PI,Ue=Math.atan2(p/me,V/me)*180/Math.PI+a.yaw;return Ue<-180&&(Ue+=360),Ue>180&&(Ue-=360),[de,Ue]}function Vt(d){if(f)pe(f,d);else if(_&&O){m=Date.now();var y=l.getCanvas(),x=y.clientWidth,I=y.clientHeight,u=it(d),p=(Math.atan(v/x*2-1)-Math.atan(u.x/x*2-1))*180/Math.PI*a.hfov/90+w;z.yaw=(p-a.yaw)%360*.2,a.yaw=p;var g=2*Math.atan(Math.tan(a.hfov/360*Math.PI)*I/x)*180/Math.PI,E=(Math.atan(u.y/I*2-1)-Math.atan(h/I*2-1))*180/Math.PI*g/90+b;z.pitch=(E-a.pitch)*.2,a.pitch=E}}function wr(d){f&&f.dragHandlerFunc&&f.dragHandlerFunc(d,f.dragHandlerArgs),f=null,!!_&&(_=!1,Date.now()-m>15&&(z.pitch=z.yaw=0),fe.classList.add("pnlm-grab"),fe.classList.remove("pnlm-grabbing"),m=Date.now(),ut("mouseup",d))}function M(d){if(!(!O||!a.draggable||f)){Z(),or(),a.roll=0,z.hfov=0;var y=it(d.targetTouches[0]);if(v=y.x,h=y.y,d.targetTouches.length==2){var x=it(d.targetTouches[1]);v+=(x.x-y.x)*.5,h+=(x.y-y.y)*.5,P=Math.sqrt((y.x-x.x)*(y.x-x.x)+(y.y-x.y)*(y.y-x.y))}_=!0,m=Date.now(),w=a.yaw,b=a.pitch,ut("touchstart",d),oe()}}function T(d){if(!!a.draggable&&(a.dragConfirm||d.preventDefault(),O&&(m=Date.now()),_&&O)){var y=it(d.targetTouches[0]),x=y.x,I=y.y;if(d.targetTouches.length==2&&P!=-1){var u=it(d.targetTouches[1]);x+=(u.x-y.x)*.5,I+=(u.y-y.y)*.5;var p=Math.sqrt((y.x-u.x)*(y.x-u.x)+(y.y-u.y)*(y.y-u.y));ee(a.hfov+(P-p)*.1),P=p}var g=a.hfov/360*a.touchPanSpeedCoeffFactor;if(!D&&(a.dragConfirm=="both"||a.dragConfirm=="yaw")&&d.targetTouches.length!=2)v!=x&&(a.dragConfirm=="yaw"?nr(a.strings.twoTouchXActivate):nr(a.strings.twoTouchActivate));else{var E=(v-x)*g+w;z.yaw=(E-a.yaw)%360*.2,a.yaw=E}if(!D&&(a.dragConfirm=="both"||a.dragConfirm=="pitch")&&d.targetTouches.length!=2)h!=I&&(a.dragConfirm=="pitch"?nr(a.strings.twoTouchYActivate):nr(a.strings.twoTouchActivate));else{var S=(I-h)*g+b;z.pitch=(S-a.pitch)*.2,a.pitch=S}(a.dragConfirm=="yaw"||a.dragConfirm=="pitch"||a.dragConfirm=="both")&&d.targetTouches.length==2&&(qt(),d.preventDefault())}}function H(){f=null,_=!1,Date.now()-m>150&&(z.pitch=z.yaw=0),P=-1,m=Date.now(),ut("touchend",event)}var N=[],U=[];function C(d){if(d.pointerType=="touch"){if(!O||!a.draggable)return;N.push(d.pointerId),U.push({clientX:d.clientX,clientY:d.clientY}),d.targetTouches=U,M(d),d.preventDefault()}}function q(d){if(d.pointerType=="touch"){if(f){pe(f,d);return}if(!a.draggable)return;for(var y=0;y<N.length;y++)if(d.pointerId==N[y]){U[y].clientX=d.clientX,U[y].clientY=d.clientY,d.targetTouches=U,T(d),d.preventDefault();return}}}function Q(d){if(f&&f.dragHandlerFunc&&f.dragHandlerFunc(d,f.dragHandlerArgs),f=null,d.pointerType=="touch"){for(var y=!1,x=0;x<N.length;x++)d.pointerId==N[x]&&(N[x]=r),N[x]&&(y=!0);y||(N=[],U=[],H()),d.preventDefault()}}function te(d){if(!(!O||a.mouseZoom=="fullscreenonly"&&!D)){if(!D&&a.mouseZoom=="ctrl"&&!d.ctrlKey){var y=navigator.platform.indexOf("Mac")!=-1?"control":"ctrl";nr(a.strings.ctrlZoomActivate.replace("%s",'<kbd class="pnlm-outline">'+y+"</kbd>"));return}qt(),d.preventDefault(),Z(),m=Date.now(),d.wheelDeltaY?(ee(a.hfov-d.wheelDeltaY*.05),z.hfov=d.wheelDelta<0?1:-1):d.wheelDelta?(ee(a.hfov-d.wheelDelta*.05),z.hfov=d.wheelDelta<0?1:-1):d.detail&&(ee(a.hfov+d.detail*1.5),z.hfov=d.detail>0?1:-1),oe()}}function J(d){Z(),m=Date.now(),or(),a.roll=0;var y=d.which||d.keycode;a.capturedKeyNumbers.indexOf(y)<0||!D&&(y==16||y==17)&&a.mouseZoom=="ctrl"||(d.preventDefault(),y==27?D&&ft():lt(y,!0))}function ge(){for(var d=0;d<10;d++)R[d]=!1}function he(d){var y=d.which||d.keycode;a.capturedKeyNumbers.indexOf(y)<0||(d.preventDefault(),lt(y,!1))}function lt(d,y){var x=!1;switch(d){case 109:case 189:case 17:case 173:R[0]!=y&&(x=!0),R[0]=y;break;case 107:case 187:case 16:case 61:R[1]!=y&&(x=!0),R[1]=y;break;case 38:R[2]!=y&&(x=!0),R[2]=y;break;case 87:R[6]!=y&&(x=!0),R[6]=y;break;case 40:R[3]!=y&&(x=!0),R[3]=y;break;case 83:R[7]!=y&&(x=!0),R[7]=y;break;case 37:R[4]!=y&&(x=!0),R[4]=y;break;case 65:R[8]!=y&&(x=!0),R[8]=y;break;case 39:R[5]!=y&&(x=!0),R[5]=y;break;case 68:R[9]!=y&&(x=!0),R[9]=y}x&&y&&(typeof performance!="undefined"&&performance.now()?A=performance.now():A=Date.now(),oe())}function Tt(){if(!!O){var d=!1,y=a.pitch,x=a.yaw,I=a.hfov,u;typeof performance!="undefined"&&performance.now()?u=performance.now():u=Date.now(),A===r&&(A=u);var p=(u-A)*a.hfov/1200;if(p=Math.min(p,10),R[0]&&a.keyboardZoom===!0&&(ee(a.hfov+(z.hfov*.8+.4)*p),d=!0),R[1]&&a.keyboardZoom===!0&&(ee(a.hfov+(z.hfov*.8-.2)*p),d=!0),(R[2]||R[6])&&(a.pitch+=(z.pitch*.8+.2)*p,d=!0),(R[3]||R[7])&&(a.pitch+=(z.pitch*.8-.2)*p,d=!0),(R[4]||R[8])&&(a.yaw+=(z.yaw*.8-.2)*p,d=!0),(R[5]||R[9])&&(a.yaw+=(z.yaw*.8+.2)*p,d=!0),d&&(m=Date.now()),a.autoRotate){if(u-A>.001){var g=(u-A)/1e3,E=(z.yaw/g*p-a.autoRotate*.2)*g;E=(-a.autoRotate>0?1:-1)*Math.min(Math.abs(a.autoRotate*g),Math.abs(E)),a.yaw+=E}a.autoRotateStopDelay&&(a.autoRotateStopDelay-=u-A,a.autoRotateStopDelay<=0&&(a.autoRotateStopDelay=!1,G=a.autoRotate,a.autoRotate=0))}if(ie.pitch&&(ht("pitch"),y=a.pitch),ie.yaw&&(ht("yaw"),x=a.yaw),ie.hfov&&(ht("hfov"),I=a.hfov),p>0&&!a.autoRotate){var S=1-a.friction;!R[4]&&!R[5]&&!R[8]&&!R[9]&&!ie.yaw&&(a.yaw+=z.yaw*p*S),!R[2]&&!R[3]&&!R[6]&&!R[7]&&!ie.pitch&&(a.pitch+=z.pitch*p*S),!R[0]&&!R[1]&&!ie.hfov&&(a.hfov>90&&(S*=1-(a.hfov-90)/90),ee(a.hfov+z.hfov*p*S))}if(A=u,p>0){z.yaw=z.yaw*.8+(a.yaw-x)/p*.2,z.pitch=z.pitch*.8+(a.pitch-y)/p*.2,z.hfov=z.hfov*.8+(a.hfov-I)/p*.2;var $=a.autoRotate?Math.abs(a.autoRotate):5;z.yaw=Math.min($,Math.max(z.yaw,-$)),z.pitch=Math.min($,Math.max(z.pitch,-$)),z.hfov=Math.min($,Math.max(z.hfov,-$))}R[0]&&R[1]&&(z.hfov=0),(R[2]||R[6])&&(R[3]||R[7])&&(z.pitch=0),(R[4]||R[8])&&(R[5]||R[9])&&(z.yaw=0)}}function ht(d){var y=ie[d],x=Math.min(1,Math.max((Date.now()-y.startTime)/1e3/(y.duration/1e3),0)),I=y.startPosition+a.animationTimingFunction(x)*(y.endPosition-y.startPosition);(y.endPosition>y.startPosition&&I>=y.endPosition||y.endPosition<y.startPosition&&I<=y.endPosition||y.endPosition===y.startPosition)&&(I=y.endPosition,z[d]=0,delete ie[d]),a[d]=I}function je(d){return d<.5?2*d*d:-1+(4-2*d)*d}function we(){W("resize")}function oe(){ae||(ae=!0,Ze())}function Ze(){if(!Xr)if(Me(),ve&&clearTimeout(ve),_||Y===!0)requestAnimationFrame(Ze);else if(R[0]||R[1]||R[2]||R[3]||R[4]||R[5]||R[6]||R[7]||R[8]||R[9]||a.autoRotate||ie.pitch||ie.yaw||ie.hfov||Math.abs(z.yaw)>.01||Math.abs(z.pitch)>.01||Math.abs(z.hfov)>.01)Tt(),a.autoRotateInactivityDelay>=0&&G&&Date.now()-m>a.autoRotateInactivityDelay&&!a.autoRotate&&(a.autoRotate=G,o.lookAt(ot,r,L,3e3)),requestAnimationFrame(Ze);else if(l&&(l.isLoading()||a.dynamic===!0&&Xe))requestAnimationFrame(Ze);else{o.getPitch&&o.getYaw&&o.getHfov&&ut("animatefinished",{pitch:o.getPitch(),yaw:o.getYaw(),hfov:o.getHfov()}),ae=!1,A=r;var d=a.autoRotateInactivityDelay-(Date.now()-m);d>0?ve=setTimeout(function(){a.autoRotate=G,o.lookAt(ot,r,L,3e3),oe()},d):a.autoRotateInactivityDelay>=0&&G&&(a.autoRotate=G,o.lookAt(ot,r,L,3e3),oe())}}function Me(){var d;if(O){var y=l.getCanvas();a.autoRotate!==!1&&(a.yaw>360?a.yaw-=360:a.yaw<-360&&(a.yaw+=360)),d=a.yaw;var x=0;if(a.avoidShowingBackground){var I=a.hfov/2,u=Math.atan2(Math.tan(I/180*Math.PI),y.width/y.height)*180/Math.PI,p=a.vaov>a.haov;p?u*(1-Math.min(Math.cos((a.pitch-I)/180*Math.PI),Math.cos((a.pitch+I)/180*Math.PI))):x=I*(1-Math.min(Math.cos((a.pitch-u)/180*Math.PI),Math.cos((a.pitch+u)/180*Math.PI)))}var g=a.maxYaw-a.minYaw,E=-180,S=180;g<360&&(E=a.minYaw+a.hfov/2+x,S=a.maxYaw-a.hfov/2-x,g<a.hfov&&(E=S=(E+S)/2),a.yaw=Math.max(E,Math.min(S,a.yaw))),a.autoRotate===!1&&(a.yaw>360?a.yaw-=360:a.yaw<-360&&(a.yaw+=360)),a.autoRotate!==!1&&d!=a.yaw&&A!==r&&(a.autoRotate*=-1);var $=2*Math.atan(Math.tan(a.hfov/180*Math.PI*.5)/(y.width/y.height))/Math.PI*180,V=a.minPitch+$/2,me=a.maxPitch-$/2,de=a.maxPitch-a.minPitch;de<$&&(V=me=(V+me)/2),isNaN(V)&&(V=-90),isNaN(me)&&(me=90),a.pitch=Math.max(V,Math.min(me,a.pitch)),l.render(a.pitch*Math.PI/180,a.yaw*Math.PI/180,a.hfov*Math.PI/180,{roll:a.roll*Math.PI/180}),Be(),a.compass&&(Et.style.transform="rotate("+(-a.yaw-a.northOffset)+"deg)",Et.style.webkitTransform="rotate("+(-a.yaw-a.northOffset)+"deg)")}}function Le(d,y,x,I){this.w=d,this.x=y,this.y=x,this.z=I}Le.prototype.multiply=function(d){return new Le(this.w*d.w-this.x*d.x-this.y*d.y-this.z*d.z,this.x*d.w+this.w*d.x+this.y*d.z-this.z*d.y,this.y*d.w+this.w*d.y+this.z*d.x-this.x*d.z,this.z*d.w+this.w*d.z+this.x*d.y-this.y*d.x)},Le.prototype.toEulerAngles=function(){var d=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),y=Math.asin(2*(this.w*this.y-this.z*this.x)),x=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z));return[d,y,x]};function nt(d,y,x){var I=[y?y*Math.PI/180/2:0,x?x*Math.PI/180/2:0,d?d*Math.PI/180/2:0],u=[Math.cos(I[0]),Math.cos(I[1]),Math.cos(I[2])],p=[Math.sin(I[0]),Math.sin(I[1]),Math.sin(I[2])];return new Le(u[0]*u[1]*u[2]-p[0]*p[1]*p[2],p[0]*u[1]*u[2]-u[0]*p[1]*p[2],u[0]*p[1]*u[2]+p[0]*u[1]*p[2],u[0]*u[1]*p[2]+p[0]*p[1]*u[2])}function ce(d,y,x){var I=nt(d,y,x);I=I.multiply(new Le(Math.sqrt(.5),-Math.sqrt(.5),0,0));var u=e.orientation?-e.orientation*Math.PI/180/2:0;return I.multiply(new Le(Math.cos(u),0,-Math.sin(u),0))}function ke(d){var y=ce(d.alpha,d.beta,d.gamma).toEulerAngles();typeof Y=="number"&&Y<10?Y+=1:Y===10?(se=y[2]/Math.PI*180+a.yaw,Y=!0,requestAnimationFrame(Ze)):(a.pitch=y[0]/Math.PI*180,a.roll=-y[1]/Math.PI*180,a.yaw=-y[2]/Math.PI*180+se)}function De(){try{var d={};a.horizonPitch!==r&&(d.horizonPitch=a.horizonPitch*Math.PI/180),a.horizonRoll!==r&&(d.horizonRoll=a.horizonRoll*Math.PI/180),a.backgroundColor!==r&&(d.backgroundColor=a.backgroundColor),l.init(X,a.type,a.dynamic,a.haov*Math.PI/180,a.vaov*Math.PI/180,a.vOffset*Math.PI/180,Ae,d),a.dynamic!==!0&&(X=r)}catch(y){if(y.type=="webgl error"||y.type=="no webgl")bt();else if(y.type=="webgl size error")bt(a.strings.textureSizeError.replace("%s",y.width).replace("%s",y.maxWidth));else throw bt(a.strings.unknownError),y}}function Ae(){if(a.sceneFadeDuration&&l.fadeImg!==r){l.fadeImg.style.opacity=0;var d=l.fadeImg;delete l.fadeImg,setTimeout(function(){_e.removeChild(d),ut("scenechangefadedone")},a.sceneFadeDuration)}a.compass?Et.style.display="inline":Et.style.display="none",He(),k.load.box.style.display="none",c!==r&&(_e.removeChild(c),c=r),O=!0,oe(),ut("load")}function ye(d){d.pitch=Number(d.pitch)||0,d.yaw=Number(d.yaw)||0;var y=t.createElement("div");y.className="pnlm-hotspot-base",d.cssClass?y.className+=" "+d.cssClass:y.className+=" pnlm-hotspot pnlm-sprite pnlm-"+Rt(d.type);var x=t.createElement("span");d.text&&(x.innerHTML=Rt(d.text));var I;if(d.video){var u=t.createElement("video"),p=d.video;a.basePath&&!St(p)&&(p=a.basePath+p),u.src=Ot(p),u.controls=!0,u.style.width=d.width+"px",fe.appendChild(y),x.appendChild(u)}else if(d.image){var g=d.image;a.basePath&&!St(g)&&(g=a.basePath+g),I=t.createElement("a"),I.href=Ot(d.URL?d.URL:g,!0),a.targetBlank&&(I.target="_blank",I.rel="noopener"),x.appendChild(I);var E=t.createElement("img");E.src=Ot(g),E.style.width=d.width+"px",E.style.paddingTop="5px",fe.appendChild(y),I.appendChild(E),x.style.maxWidth="initial"}else if(d.URL){if(I=t.createElement("a"),I.href=Ot(d.URL,!0),d.attributes)for(var S in d.attributes)I.setAttribute(S,d.attributes[S]);else a.targetBlank&&(I.target="_blank",I.rel="noopener");fe.appendChild(I),y.className+=" pnlm-pointer",x.className+=" pnlm-pointer",I.appendChild(y)}else d.sceneId&&(y.onclick=y.ontouchend=function(){return y.clicked||(y.clicked=!0,sr(d.sceneId,d.targetPitch,d.targetYaw,d.targetHfov)),!1},y.className+=" pnlm-pointer",x.className+=" pnlm-pointer"),fe.appendChild(y);d.createTooltipFunc?d.createTooltipFunc(y,d.createTooltipArgs):(d.text||d.video||d.image)&&(y.classList.add("pnlm-tooltip"),y.appendChild(x),x.style.width=x.scrollWidth-20+"px",x.style.marginLeft=-(x.scrollWidth-y.offsetWidth)/2+"px",x.style.marginTop=-x.scrollHeight-12+"px"),d.clickHandlerFunc&&(y.addEventListener("click",function($){d.clickHandlerFunc($,d.clickHandlerArgs)},"false"),t.documentElement.style.pointerAction===""&&t.documentElement.style.touchAction===""?y.addEventListener("pointerup",function($){d.clickHandlerFunc($,d.clickHandlerArgs)},!1):y.addEventListener("touchend",function($){d.clickHandlerFunc($,d.clickHandlerArgs)},!1),y.className+=" pnlm-pointer",x.className+=" pnlm-pointer"),d.draggable&&(y.addEventListener("mousedown",function($){d.dragHandlerFunc&&d.dragHandlerFunc($,d.dragHandlerArgs),f=d}),t.documentElement.style.pointerAction===""&&t.documentElement.style.touchAction===""&&y.addEventListener("pointerdown",function($){d.dragHandlerFunc&&d.dragHandlerFunc($,d.dragHandlerArgs),f=d}),y.addEventListener("touchmove",function($){pe(d,$.targetTouches[0])}),y.addEventListener("touchend",function($){d.dragHandlerFunc&&d.dragHandlerFunc($,d.dragHandlerArgs),f=null})),d.div=y}function pe(d,y){var x=gt(y);d.pitch=x[0],d.yaw=x[1],Ne(d)}function He(){yr||(a.hotSpots?(a.hotSpots=a.hotSpots.sort(function(d,y){return d.pitch<y.pitch}),a.hotSpots.forEach(ye)):a.hotSpots=[],yr=!0,Be())}function Ce(){var d=a.hotSpots;if(yr=!1,delete a.hotSpots,d)for(var y=0;y<d.length;y++){var x=d[y].div;if(x){for(;x.parentNode&&x.parentNode!=fe;)x=x.parentNode;fe.removeChild(x)}delete d[y].div}}function Ne(d){var y=Math.sin(d.pitch*Math.PI/180),x=Math.cos(d.pitch*Math.PI/180),I=Math.sin(a.pitch*Math.PI/180),u=Math.cos(a.pitch*Math.PI/180),p=Math.cos((-d.yaw+a.yaw)*Math.PI/180),g=y*I+x*p*u;if(d.yaw<=90&&d.yaw>-90&&g<=0||(d.yaw>90||d.yaw<=-90)&&g<=0)d.div.style.visibility="hidden";else{var E=Math.sin((-d.yaw+a.yaw)*Math.PI/180),S=Math.tan(a.hfov*Math.PI/360);d.div.style.visibility="visible";var $=l.getCanvas(),V=$.clientWidth,me=$.clientHeight,de=[-V/S*E*x/g/2,-V/S*(y*u-x*p*I)/g/2],Ue=Math.sin(a.roll*Math.PI/180),hr=Math.cos(a.roll*Math.PI/180);de=[de[0]*hr-de[1]*Ue,de[0]*Ue+de[1]*hr],de[0]+=(V-d.div.offsetWidth)/2,de[1]+=(me-d.div.offsetHeight)/2;var Wi="translate("+de[0]+"px, "+de[1]+"px) translateZ(9999px) rotate("+a.roll+"deg)";d.scale&&(Wi+=" scale("+L/a.hfov/g+")"),d.div.style.webkitTransform=Wi,d.div.style.MozTransform=Wi,d.div.style.transform=Wi}}function Be(){a.hotSpots.forEach(Ne)}function Ve(d){a={};var y,x,I=["haov","vaov","vOffset","northOffset","horizonPitch","horizonRoll"];Re=[];for(y in Oe)Oe.hasOwnProperty(y)&&(a[y]=Oe[y]);for(y in s.default)if(s.default.hasOwnProperty(y))if(y=="strings")for(x in s.default.strings)s.default.strings.hasOwnProperty(x)&&(a.strings[x]=Rt(s.default.strings[x]));else a[y]=s.default[y],I.indexOf(y)>=0&&Re.push(y);if(d!==null&&d!==""&&s.scenes&&s.scenes[d]){var u=s.scenes[d];for(y in u)if(u.hasOwnProperty(y))if(y=="strings")for(x in u.strings)u.strings.hasOwnProperty(x)&&(a.strings[x]=Rt(u.strings[x]));else a[y]=u[y],I.indexOf(y)>=0&&Re.push(y);a.scene=d}for(y in s)if(s.hasOwnProperty(y))if(y=="strings")for(x in s.strings)s.strings.hasOwnProperty(x)&&(a.strings[x]=Rt(s.strings[x]));else a[y]=s[y],I.indexOf(y)>=0&&Re.push(y)}function ct(d){if(d=d||!1,d&&"preview"in a){var y=a.preview;a.basePath&&!St(y)&&(y=a.basePath+y),c=t.createElement("div"),c.className="pnlm-preview-img",c.style.backgroundImage="url('"+Yt(y)+"')",_e.appendChild(c)}var x=a.title,I=a.author;d&&("previewTitle"in a&&(a.title=a.previewTitle),"previewAuthor"in a&&(a.author=a.previewAuthor)),a.hasOwnProperty("title")||(k.title.innerHTML=""),a.hasOwnProperty("author")||(k.author.innerHTML=""),!a.hasOwnProperty("title")&&!a.hasOwnProperty("author")&&(k.container.style.display="none"),a.targetBlank&&(qe.rel="noopener",qe.target="_blank"),j.load.innerHTML="<div><p>"+a.strings.loadButtonLabel+"</p></div>",k.load.boxp.innerHTML=a.strings.loadingLabel;for(var u in a)if(a.hasOwnProperty(u))switch(u){case"title":k.title.innerHTML=Rt(a[u]),k.container.style.display="inline";break;case"author":var p=Rt(a[u]);if(a.authorURL){var g=t.createElement("a");g.href=Ot(a.authorURL,!0),a.targetBlank&&(g.target="_blank",g.rel="noopener"),g.innerHTML=Rt(a[u]),p=g.outerHTML}k.author.innerHTML=a.strings.bylineLabel.replace("%s",p),k.container.style.display="inline";break;case"hfov":ee(Number(a[u]));break;case"autoLoad":a[u]===!0&&l===r&&(k.load.box.style.display="inline",j.load.style.display="none",$r());break;case"showZoomCtrl":a[u]&&a.showControls!=!1?j.zoom.style.display="block":j.zoom.style.display="none";break;case"showFullscreenCtrl":a[u]&&a.showControls!=!1&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?j.fullscreen.style.display="block":j.fullscreen.style.display="none";break;case"hotSpotDebug":a[u]?_t.style.display="block":_t.style.display="none";break;case"showControls":a[u]||(j.orientation.style.display="none",j.zoom.style.display="none",j.fullscreen.style.display="none");break;case"orientationOnByDefault":a[u]&&Or();break}d&&(x?a.title=x:delete a.title,I?a.author=I:delete a.author)}function ft(){if(O&&!B)if(D)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen();else try{n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.msRequestFullscreen?n.msRequestFullscreen():n.webkitRequestFullScreen()}catch{}}function W(d){t.fullscreenElement||t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?(j.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),D=!0):(j.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),D=!1),d!=="resize"&&ut("fullscreenchange",D),l.resize(),ee(a.hfov),oe()}function Ke(){O&&(ee(a.hfov-5),oe())}function Qe(){O&&(ee(a.hfov+5),oe())}function ne(d){var y=a.minHfov;if(a.type=="multires"&&l&&!a.multiResMinHfov&&(y=Math.min(y,l.getCanvas().width/(a.multiRes.cubeResolution/90*.9))),y>a.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),a.hfov;var x=a.hfov;if(d<y?x=y:d>a.maxHfov?x=a.maxHfov:x=d,a.avoidShowingBackground&&l&&!isNaN(a.maxPitch-a.minPitch)){var I=l.getCanvas();x=Math.min(x,Math.atan(Math.tan((a.maxPitch-a.minPitch)/360*Math.PI)/I.height*I.width)*360/Math.PI)}return x}function ee(d){a.hfov=ne(d),ut("zoomchange",a.hfov)}function Z(){ie={},G=a.autoRotate?a.autoRotate:G,a.autoRotate=!1}function wt(){Gr(),O=!1,qt(),j.load.style.display="none",k.load.box.style.display="inline",$r()}function sr(d,y,x,I,u){O||(u=!0),O=!1,ie={};var p,g,E,S;if(a.sceneFadeDuration&&!u){var $=l.render(a.pitch*Math.PI/180,a.yaw*Math.PI/180,a.hfov*Math.PI/180,{returnImage:"ImageBitmap"});if($!==r){$.then?p=t.createElement("canvas"):p=new Image,p.className="pnlm-fade-img",p.style.transition="opacity "+a.sceneFadeDuration/1e3+"s",p.style.width="100%",p.style.height="100%",$.then?$.then(function(V){p.width=V.width,p.height=V.height,p.getContext("2d").drawImage(V,0,0),sr(d,y,x,I,!0)}):(p.onload=function(){sr(d,y,x,I,!0)},p.src=$),_e.appendChild(p),l.fadeImg=p;return}}y==="same"?g=a.pitch:g=y,x==="same"?E=a.yaw:x==="sameAzimuth"?E=a.yaw+(a.northOffset||0)-(s.scenes[d].northOffset||0):E=x,I==="same"?S=a.hfov:S=I,Ce(),Ve(d),z.yaw=z.pitch=z.hfov=0,ct(),g!==r&&(a.pitch=g),E!==r&&(a.yaw=E),S!==r&&(a.hfov=S),ut("scenechange",d),wt()}function or(){e.removeEventListener("deviceorientation",ke),j.orientation.classList.remove("pnlm-orientation-button-active"),Y=!1}function Or(){!yt||(typeof DeviceMotionEvent!="undefined"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(d){d=="granted"&&(Y=1,e.addEventListener("deviceorientation",ke),j.orientation.classList.add("pnlm-orientation-button-active"))}):(Y=1,e.addEventListener("deviceorientation",ke),j.orientation.classList.add("pnlm-orientation-button-active")))}function Rt(d){return s.escapeHTML?String(d).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split(`
`).join("<br>"):String(d).split(`
`).join("<br>")}function Ot(d,y){try{var x=decodeURIComponent(Zr(d)).replace(/[^\w:]/g,"").toLowerCase()}catch{return"about:blank"}return x.indexOf("javascript:")===0||x.indexOf("vbscript:")===0?(console.log("Script URL removed."),"about:blank"):y&&x.indexOf("data:")===0?(console.log("Data URI removed from link."),"about:blank"):d}function Zr(d){return d.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,function(y,x){return x=x.toLowerCase(),x==="colon"?":":x.charAt(0)==="#"?x.charAt(1)==="x"?String.fromCharCode(parseInt(x.substring(2),16)):String.fromCharCode(+x.substring(1)):""})}function Yt(d){return Ot(d).replace(/"/g,"%22").replace(/'/g,"%27")}this.isLoaded=function(){return Boolean(O)},this.getPitch=function(){return a.pitch},this.setPitch=function(d,y,x,I){return m=Date.now(),Math.abs(d-a.pitch)<=mt?(typeof x=="function"&&x(I),this):(y=y==r?1e3:Number(y),y?(ie.pitch={startTime:Date.now(),startPosition:a.pitch,endPosition:d,duration:y},typeof x=="function"&&setTimeout(function(){x(I)},y)):a.pitch=d,oe(),this)},this.getPitchBounds=function(){return[a.minPitch,a.maxPitch]},this.setPitchBounds=function(d){return a.minPitch=Math.max(-90,Math.min(d[0],90)),a.maxPitch=Math.max(-90,Math.min(d[1],90)),this},this.getYaw=function(){return(a.yaw+540)%360-180},this.setYaw=function(d,y,x,I){return m=Date.now(),Math.abs(d-a.yaw)<=mt?(typeof x=="function"&&x(I),this):(y=y==r?1e3:Number(y),d=(d+180)%360-180,y?(a.yaw-d>180?d+=360:d-a.yaw>180&&(d-=360),ie.yaw={startTime:Date.now(),startPosition:a.yaw,endPosition:d,duration:y},typeof x=="function"&&setTimeout(function(){x(I)},y)):a.yaw=d,oe(),this)},this.getYawBounds=function(){return[a.minYaw,a.maxYaw]},this.setYawBounds=function(d){return a.minYaw=Math.max(-360,Math.min(d[0],360)),a.maxYaw=Math.max(-360,Math.min(d[1],360)),this},this.getHfov=function(){return a.hfov},this.setHfov=function(d,y,x,I){return m=Date.now(),Math.abs(d-a.hfov)<=mt?(typeof x=="function"&&x(I),this):(y=y==r?1e3:Number(y),y?(ie.hfov={startTime:Date.now(),startPosition:a.hfov,endPosition:ne(d),duration:y},typeof x=="function"&&setTimeout(function(){x(I)},y)):ee(d),oe(),this)},this.getHfovBounds=function(){return[a.minHfov,a.maxHfov]},this.setHfovBounds=function(d){return a.minHfov=Math.max(0,d[0]),a.maxHfov=Math.max(0,d[1]),this},this.lookAt=function(d,y,x,I,u,p){return I=I==r?1e3:Number(I),d!==r&&Math.abs(d-a.pitch)>mt&&(this.setPitch(d,I,u,p),u=r),y!==r&&Math.abs(y-a.yaw)>mt&&(this.setYaw(y,I,u,p),u=r),x!==r&&Math.abs(x-a.hfov)>mt&&(this.setHfov(x,I,u,p),u=r),typeof u=="function"&&u(p),this},this.getNorthOffset=function(){return a.northOffset},this.setNorthOffset=function(d){return a.northOffset=Math.min(360,Math.max(0,d)),oe(),this},this.getHorizonRoll=function(){return a.horizonRoll},this.setHorizonRoll=function(d){return a.horizonRoll=Math.min(90,Math.max(-90,d)),l.setPose(a.horizonPitch*Math.PI/180,a.horizonRoll*Math.PI/180),oe(),this},this.getHorizonPitch=function(){return a.horizonPitch},this.setHorizonPitch=function(d){return a.horizonPitch=Math.min(90,Math.max(-90,d)),l.setPose(a.horizonPitch*Math.PI/180,a.horizonRoll*Math.PI/180),oe(),this},this.startAutoRotate=function(d,y,x,I){return d=d||G||1,y=y===r?ot:y,x=x===r?L:x,a.autoRotate=d,I!==r&&(a.autoRotateInactivityDelay=I),o.lookAt(y,r,x,3e3),oe(),this},this.stopAutoRotate=function(){return G=a.autoRotate?a.autoRotate:G,a.autoRotate=!1,a.autoRotateInactivityDelay=-1,this},this.stopMovement=function(){Z(),z={yaw:0,pitch:0,hfov:0}},this.getRenderer=function(){return l},this.setUpdate=function(d){return Xe=d===!0,l===r?We():oe(),this},this.mouseEventToCoords=function(d){return gt(d)},this.loadScene=function(d,y,x,I){return O!==!1&&sr(d,y,x,I),this},this.getScene=function(){return a.scene},this.addScene=function(d,y){return s.scenes[d]=y,this},this.removeScene=function(d){return a.scene===d||!s.scenes.hasOwnProperty(d)?!1:(delete s.scenes[d],!0)},this.toggleFullscreen=function(){return ft(),this},this.getConfig=function(){return a},this.getContainer=function(){return n},this.addHotSpot=function(d,y){if(y===r&&a.scene===r)a.hotSpots.push(d);else{var x=y!==r?y:a.scene;if(s.scenes.hasOwnProperty(x))s.scenes[x].hasOwnProperty("hotSpots")||(s.scenes[x].hotSpots=[],x==a.scene&&(a.hotSpots=s.scenes[x].hotSpots)),s.scenes[x].hotSpots.push(d);else throw"Invalid scene ID!"}return(y===r||a.scene==y)&&(ye(d),O&&Ne(d)),this},this.removeHotSpot=function(d,y){if(y===r||a.scene==y){if(!a.hotSpots)return!1;for(var x=0;x<a.hotSpots.length;x++)if(a.hotSpots[x].hasOwnProperty("id")&&a.hotSpots[x].id===d){for(var I=a.hotSpots[x].div;I.parentNode!=fe;)I=I.parentNode;return fe.removeChild(I),delete a.hotSpots[x].div,a.hotSpots.splice(x,1),!0}}else if(s.scenes.hasOwnProperty(y)){if(!s.scenes[y].hasOwnProperty("hotSpots"))return!1;for(var u=0;u<s.scenes[y].hotSpots.length;u++)if(s.scenes[y].hotSpots[u].hasOwnProperty("id")&&s.scenes[y].hotSpots[u].id===d)return s.scenes[y].hotSpots.splice(u,1),!0}else return!1},this.resize=function(){l&&we()},this.isOrientationSupported=function(){return yt||!1},this.stopOrientation=function(){or()},this.startOrientation=function(){Or()},this.isOrientationActive=function(){return Boolean(Y)},this.on=function(d,y){return $e[d]=$e[d]||[],$e[d].push(y),this},this.off=function(d,y){if(!d)return $e={},this;if(y){var x=$e[d].indexOf(y);x>=0&&$e[d].splice(x,1),$e[d].length==0&&delete $e[d]}else delete $e[d];return this};function ut(d){if(d in $e)for(var y=$e[d].length;y>0;y--)$e[d][$e[d].length-y].apply(null,[].slice.call(arguments,1))}this.destroy=function(){Xr=!0,clearTimeout(ve),l&&l.destroy(),F&&(t.removeEventListener("mousemove",Vt,!1),t.removeEventListener("mouseup",wr,!1),n.removeEventListener("mozfullscreenchange",W,!1),n.removeEventListener("webkitfullscreenchange",W,!1),n.removeEventListener("msfullscreenchange",W,!1),n.removeEventListener("fullscreenchange",W,!1),$t?$t.disconnect():(e.removeEventListener("resize",we,!1),e.removeEventListener("orientationchange",we,!1)),n.removeEventListener("keydown",J,!1),n.removeEventListener("keyup",he,!1),n.removeEventListener("blur",ge,!1),t.removeEventListener("mouseleave",wr,!1)),n.innerHTML="",n.classList.remove("pnlm-container")}}return{viewer:function(n,s){return new i(n,s)}}}(window,document),window.libpannellum=function(e,t,r){function i(f,_){var m;f&&(m=t.createElement("canvas"),m.style.width=m.style.height="100%",f.appendChild(m));var v,h,P,w,b,R,D,O,B,F,X,A,z,ae,Y,se,ve,G,L,ot=["f","b","u","d","l","r"],ie=["f","r","b","l","u","d"];_&&(h=_),this.init=function(M,T,H,N,U,C,q,Q){if(T===r&&(T="equirectangular"),T!="equirectangular"&&T!="cubemap"&&T!="multires")throw console.log("Error: invalid image type specified!"),{type:"config error"};if(z=T,A=M,ae=H,L=Q||{},v){if(P&&(h.detachShader(v,P),h.deleteShader(P)),w&&(h.detachShader(v,w),h.deleteShader(w)),h.bindBuffer(h.ARRAY_BUFFER,null),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null),v.texture&&h.deleteTexture(v.texture),v.nodeCache)for(var te=0;te<v.nodeCache.length;te++)h.deleteTexture(v.nodeCache[te].texture);if(v.textureLoads)for(qe=[];v.textureLoads.length>0;)v.textureLoads.shift()(!1);h.deleteProgram(v),v=r}b&&(R&&(h.detachShader(b,R),h.deleteShader(R)),D&&(h.detachShader(b,D),h.deleteShader(D)),h.deleteProgram(b),b=r),X=r;var J,ge=!1,he;if(z=="cubemap")for(J=0;J<6;J++)A[J].width>0?(he===r&&(he=A[J].width),he!=A[J].width&&console.log("Cube faces have inconsistent widths: "+he+" vs. "+A[J].width)):ge=!0;function lt(W){if(ge){var Ke=W*W*4,Qe=new Uint8ClampedArray(Ke),ne=Q.backgroundColor?Q.backgroundColor:[0,0,0];ne[0]*=255,ne[1]*=255,ne[2]*=255;for(var ee=0;ee<Ke;ee++)Qe[ee++]=ne[0],Qe[ee++]=ne[1],Qe[ee++]=ne[2];var Z=new ImageData(Qe,W,W);for(J=0;J<6;J++)A[J].width==0&&(A[J]=Z)}}if(z=="cubemap"&&(he&he-1)!=0&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(h||(h=m.getContext("experimental-webgl",{alpha:!1,depth:!1})),h&&h.getError()==1286&&Gr()),!h&&(z=="multires"&&A.hasOwnProperty("fallbackPath")||z=="cubemap")&&("WebkitAppearance"in t.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||navigator.appVersion.indexOf("MSIE 10")!==-1)){B&&f.removeChild(B),B=t.createElement("div"),B.className="pnlm-world";var Tt;A.basePath?Tt=A.basePath+A.fallbackPath:Tt=A.fallbackPath;var ht=0,je=function(){var W=t.createElement("canvas");W.className="pnlm-face pnlm-"+ie[this.side]+"face",B.appendChild(W);var Ke=W.getContext("2d");W.style.width=this.width+4+"px",W.style.height=this.height+4+"px",W.width=this.width+4,W.height=this.height+4,Ke.drawImage(this,2,2);var Qe=Ke.getImageData(0,0,W.width,W.height),ne=Qe.data,ee,Z;for(ee=2;ee<W.width-2;ee++)for(Z=0;Z<4;Z++)ne[(ee+W.width)*4+Z]=ne[(ee+W.width*2)*4+Z],ne[(ee+W.width*(W.height-2))*4+Z]=ne[(ee+W.width*(W.height-3))*4+Z];for(ee=2;ee<W.height-2;ee++)for(Z=0;Z<4;Z++)ne[(ee*W.width+1)*4+Z]=ne[(ee*W.width+2)*4+Z],ne[((ee+1)*W.width-2)*4+Z]=ne[((ee+1)*W.width-3)*4+Z];for(Z=0;Z<4;Z++)ne[(W.width+1)*4+Z]=ne[(W.width*2+2)*4+Z],ne[(W.width*2-2)*4+Z]=ne[(W.width*3-3)*4+Z],ne[(W.width*(W.height-2)+1)*4+Z]=ne[(W.width*(W.height-3)+2)*4+Z],ne[(W.width*(W.height-1)-2)*4+Z]=ne[(W.width*(W.height-2)-3)*4+Z];for(ee=1;ee<W.width-1;ee++)for(Z=0;Z<4;Z++)ne[ee*4+Z]=ne[(ee+W.width)*4+Z],ne[(ee+W.width*(W.height-1))*4+Z]=ne[(ee+W.width*(W.height-2))*4+Z];for(ee=1;ee<W.height-1;ee++)for(Z=0;Z<4;Z++)ne[ee*W.width*4+Z]=ne[(ee*W.width+1)*4+Z],ne[((ee+1)*W.width-1)*4+Z]=ne[((ee+1)*W.width-2)*4+Z];for(Z=0;Z<4;Z++)ne[Z]=ne[(W.width+1)*4+Z],ne[(W.width-1)*4+Z]=ne[(W.width*2-2)*4+Z],ne[W.width*(W.height-1)*4+Z]=ne[(W.width*(W.height-2)+1)*4+Z],ne[(W.width*W.height-1)*4+Z]=ne[(W.width*(W.height-1)-2)*4+Z];Ke.putImageData(Qe,0,0),we.call(this)},we=function(){this.width>0?(O===r&&(O=this.width),O!=this.width&&console.log("Fallback faces have inconsistent widths: "+O+" vs. "+this.width)):ge=!0,ht++,ht==6&&(O=this.width,f.appendChild(B),q())};for(ge=!1,J=0;J<6;J++){var oe=new Image;oe.crossOrigin=L.crossOrigin?L.crossOrigin:"anonymous",oe.side=J,oe.onload=je,oe.onerror=we,z=="multires"?oe.src=Tt.replace("%s",ie[J])+(A.extension?"."+A.extension:""):oe.src=A[J].src}lt(O);return}else if(!h)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};z=="cubemap"&&lt(he),A.basePath?A.fullpath=A.basePath+A.path:A.fullpath=A.path,A.invTileResolution=1/A.tileResolution;var Ze=yr();for(F=[],J=0;J<6;J++)F[J]=Ze.slice(J*12,J*12+12),Ze=yr();var Me=0;if(z=="equirectangular"){if(Me=h.getParameter(h.MAX_TEXTURE_SIZE),Math.max(A.width/2,A.height)>Me)throw console.log("Error: The image is too big; it's "+A.width+"px wide, but this device's maximum supported size is "+Me*2+"px."),{type:"webgl size error",width:A.width,maxWidth:Me*2}}else if(z=="cubemap"&&he>h.getParameter(h.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+he+"px wide, but this device's maximum supported size is "+Me+"px."),{type:"webgl size error",width:he,maxWidth:Me};if(Q!==r){var Le=isNaN(Q.horizonPitch)?0:Number(Q.horizonPitch),nt=isNaN(Q.horizonRoll)?0:Number(Q.horizonRoll);(Le!=0||nt!=0)&&(X=[Le,nt])}var ce=h.TEXTURE_2D;if(h.viewport(0,0,h.drawingBufferWidth,h.drawingBufferHeight),h.getShaderPrecisionFormat){var ke=h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT);ke&&ke.precision<1&&(o=o.replace("highp","mediump"))}P=h.createShader(h.VERTEX_SHADER);var De=n;z=="multires"&&(De=s),h.shaderSource(P,De),h.compileShader(P),w=h.createShader(h.FRAGMENT_SHADER);var Ae=l;if(z=="cubemap"?(ce=h.TEXTURE_CUBE_MAP,Ae=a):z=="multires"&&(Ae=c),h.shaderSource(w,Ae),h.compileShader(w),v=h.createProgram(),h.attachShader(v,P),h.attachShader(v,w),h.linkProgram(v),h.getShaderParameter(P,h.COMPILE_STATUS)||console.log(h.getShaderInfoLog(P)),h.getShaderParameter(w,h.COMPILE_STATUS)||console.log(h.getShaderInfoLog(w)),h.getProgramParameter(v,h.LINK_STATUS)||console.log(h.getProgramInfoLog(v)),h.useProgram(v),v.drawInProgress=!1,Q.backgroundColor!==null){var ye=Q.backgroundColor?Q.backgroundColor:[0,0,0];h.clearColor(ye[0],ye[1],ye[2],1),h.clear(h.COLOR_BUFFER_BIT)}if(v.texCoordLocation=h.getAttribLocation(v,"a_texCoord"),h.enableVertexAttribArray(v.texCoordLocation),z!="multires"){if(Y||(Y=h.createBuffer()),h.bindBuffer(h.ARRAY_BUFFER,Y),h.bufferData(h.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),h.STATIC_DRAW),h.vertexAttribPointer(v.texCoordLocation,2,h.FLOAT,!1,0,0),v.aspectRatio=h.getUniformLocation(v,"u_aspectRatio"),h.uniform1f(v.aspectRatio,h.drawingBufferWidth/h.drawingBufferHeight),v.psi=h.getUniformLocation(v,"u_psi"),v.theta=h.getUniformLocation(v,"u_theta"),v.f=h.getUniformLocation(v,"u_f"),v.h=h.getUniformLocation(v,"u_h"),v.v=h.getUniformLocation(v,"u_v"),v.vo=h.getUniformLocation(v,"u_vo"),v.rot=h.getUniformLocation(v,"u_rot"),h.uniform1f(v.h,N/(Math.PI*2)),h.uniform1f(v.v,U/Math.PI),h.uniform1f(v.vo,C/Math.PI*2),z=="equirectangular"&&(v.backgroundColor=h.getUniformLocation(v,"u_backgroundColor"),h.uniform4fv(v.backgroundColor,ye.concat([1]))),v.texture=h.createTexture(),h.bindTexture(ce,v.texture),z=="cubemap")h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,A[1]),h.texImage2D(h.TEXTURE_CUBE_MAP_NEGATIVE_X,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,A[3]),h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_Y,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,A[4]),h.texImage2D(h.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,A[5]),h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_Z,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,A[0]),h.texImage2D(h.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,A[2]);else if(A.width<=Me)h.uniform1i(h.getUniformLocation(v,"u_splitImage"),0),h.texImage2D(ce,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,A);else{h.uniform1i(h.getUniformLocation(v,"u_splitImage"),1);var pe=t.createElement("canvas");pe.width=A.width/2,pe.height=A.height;var He=pe.getContext("2d");He.drawImage(A,0,0);var Ce=He.getImageData(0,0,A.width/2,A.height);h.texImage2D(ce,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,Ce),v.texture2=h.createTexture(),h.activeTexture(h.TEXTURE1),h.bindTexture(ce,v.texture2),h.uniform1i(h.getUniformLocation(v,"u_image1"),1),He.drawImage(A,-A.width/2,0),Ce=He.getImageData(0,0,A.width/2,A.height),h.texImage2D(ce,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,Ce),h.texParameteri(ce,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(ce,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(ce,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(ce,h.TEXTURE_MAG_FILTER,h.LINEAR),h.activeTexture(h.TEXTURE0)}z!="cubemap"&&A.width<=Me&&N==2*Math.PI&&(A.width&A.width-1)==0?h.texParameteri(ce,h.TEXTURE_WRAP_S,h.REPEAT):h.texParameteri(ce,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(ce,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(ce,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(ce,h.TEXTURE_MAG_FILTER,h.LINEAR)}else if(v.vertPosLocation=h.getAttribLocation(v,"a_vertCoord"),h.enableVertexAttribArray(v.vertPosLocation),se||(se=h.createBuffer()),ve||(ve=h.createBuffer()),G||(G=h.createBuffer()),h.bindBuffer(h.ARRAY_BUFFER,ve),h.bufferData(h.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),h.STATIC_DRAW),h.vertexAttribPointer(v.texCoordLocation,2,h.FLOAT,!1,0,0),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,G),h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),h.STATIC_DRAW),h.bindBuffer(h.ARRAY_BUFFER,se),h.vertexAttribPointer(v.vertPosLocation,3,h.FLOAT,!1,0,0),v.perspUniform=h.getUniformLocation(v,"u_perspMatrix"),v.cubeUniform=h.getUniformLocation(v,"u_cubeMatrix"),v.level=-1,v.currentNodes=[],v.nodeCache=[],v.nodeCacheTimestamp=0,v.textureLoads=[],A.shtHash||A.equirectangularThumbnail){R=h.createShader(h.VERTEX_SHADER),h.shaderSource(R,n),h.compileShader(R),D=h.createShader(h.FRAGMENT_SHADER),h.shaderSource(D,l),h.compileShader(D),b=h.createProgram(),h.attachShader(b,R),h.attachShader(b,D),h.linkProgram(b),h.getShaderParameter(R,h.COMPILE_STATUS)||console.log(h.getShaderInfoLog(R)),h.getShaderParameter(D,h.COMPILE_STATUS)||console.log(h.getShaderInfoLog(D)),h.getProgramParameter(b,h.LINK_STATUS)||console.log(h.getProgramInfoLog(b)),h.useProgram(b),b.texCoordLocation=h.getAttribLocation(b,"a_texCoord"),h.enableVertexAttribArray(b.texCoordLocation),Y||(Y=h.createBuffer()),h.bindBuffer(h.ARRAY_BUFFER,Y),h.bufferData(h.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),h.STATIC_DRAW),h.vertexAttribPointer(b.texCoordLocation,2,h.FLOAT,!1,0,0),b.aspectRatio=h.getUniformLocation(b,"u_aspectRatio"),h.uniform1f(b.aspectRatio,h.drawingBufferWidth/h.drawingBufferHeight),b.psi=h.getUniformLocation(b,"u_psi"),b.theta=h.getUniformLocation(b,"u_theta"),b.f=h.getUniformLocation(b,"u_f"),b.h=h.getUniformLocation(b,"u_h"),b.v=h.getUniformLocation(b,"u_v"),b.vo=h.getUniformLocation(b,"u_vo"),b.rot=h.getUniformLocation(b,"u_rot"),h.uniform1f(b.h,1),b.texture=h.createTexture(),h.bindTexture(ce,b.texture);var Ne,Be,Ve,ct=function(){h.useProgram(b),h.uniform1i(h.getUniformLocation(b,"u_splitImage"),0),h.texImage2D(ce,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Ne),h.texParameteri(ce,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(ce,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(ce,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(ce,h.TEXTURE_MAG_FILTER,h.LINEAR),h.uniform1f(b.v,Be),h.uniform1f(b.vo,Ve),h.useProgram(v)};if(A.shtHash&&(Ne=wr(A.shtHash),Be=(2+1/31)/2,Ve=1-(2+1/31)/2,ct()),A.equirectangularThumbnail)if(typeof A.equirectangularThumbnail=="string")if(A.equirectangularThumbnail.slice(0,5)=="data:")Ne=new Image,Ne.onload=function(){Be=1,Ve=0,ct()},Ne.src=A.equirectangularThumbnail;else throw console.log("Error: thumbnail string is not a data URI!"),{type:"config error"};else Ne=A.equirectangularThumbnail,Be=1,Ve=0,ct();h.bindBuffer(h.ARRAY_BUFFER,se),h.vertexAttribPointer(v.vertPosLocation,3,h.FLOAT,!1,0,0),h.useProgram(v)}var ft=h.getError();if(ft!==0)throw console.log("Error: Something went wrong with WebGL!",ft),{type:"webgl error"};q()},this.destroy=function(){if(f!==r&&(m!==r&&f.contains(m)&&f.removeChild(m),B!==r&&f.contains(B)&&f.removeChild(B)),h){var M=h.getExtension("WEBGL_lose_context");M&&M.loseContext()}},this.resize=function(){var M=e.devicePixelRatio||1;m.width=m.clientWidth*M,m.height=m.clientHeight*M,h&&(h.getError()==1286&&Gr(),h.viewport(0,0,h.drawingBufferWidth,h.drawingBufferHeight),z!="multires"?h.uniform1f(v.aspectRatio,m.clientWidth/m.clientHeight):A.shtHash&&(h.useProgram(b),h.uniform1f(b.aspectRatio,m.clientWidth/m.clientHeight),h.useProgram(v)))},m&&this.resize(),this.setPose=function(M,T){M=isNaN(M)?0:Number(M),T=isNaN(T)?0:Number(T),M==0&&T==0?X=r:X=[M,T]},this.render=function(M,T,H,N){var U,C,q,Q=0;if(N===r&&(N={}),N.roll&&(Q=N.roll),X!==r){var te=X[0],J=X[1],ge=M,he=T,lt=Math.cos(J)*Math.sin(M)*Math.sin(te)+Math.cos(M)*(Math.cos(te)*Math.cos(T)+Math.sin(J)*Math.sin(te)*Math.sin(T)),Tt=-Math.sin(M)*Math.sin(J)+Math.cos(M)*Math.cos(J)*Math.sin(T),ht=Math.cos(J)*Math.cos(te)*Math.sin(M)+Math.cos(M)*(-Math.cos(T)*Math.sin(te)+Math.cos(te)*Math.sin(J)*Math.sin(T));M=Math.asin(Math.max(Math.min(ht,1),-1)),T=Math.atan2(Tt,lt);var je=[Math.cos(ge)*(Math.sin(J)*Math.sin(te)*Math.cos(he)-Math.cos(te)*Math.sin(he)),Math.cos(ge)*Math.cos(J)*Math.cos(he),Math.cos(ge)*(Math.cos(te)*Math.sin(J)*Math.cos(he)+Math.sin(he)*Math.sin(te))],we=[-Math.cos(M)*Math.sin(T),Math.cos(M)*Math.cos(T)],oe=Math.acos(Math.max(Math.min((je[0]*we[0]+je[1]*we[1])/(Math.sqrt(je[0]*je[0]+je[1]*je[1]+je[2]*je[2])*Math.sqrt(we[0]*we[0]+we[1]*we[1])),1),-1));je[2]<0&&(oe=2*Math.PI-oe),Q+=oe}if(!h&&(z=="multires"||z=="cubemap")){q=O/2;var Ze={f:"translate3d(-"+(q+2)+"px, -"+(q+2)+"px, -"+q+"px)",b:"translate3d("+(q+2)+"px, -"+(q+2)+"px, "+q+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(q+2)+"px, -"+q+"px, "+(q+2)+"px) rotateX(270deg)",d:"translate3d(-"+(q+2)+"px, "+q+"px, -"+(q+2)+"px) rotateX(90deg)",l:"translate3d(-"+q+"px, -"+(q+2)+"px, "+(q+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+q+"px, -"+(q+2)+"px, -"+(q+2)+"px) rotateY(270deg)"};U=1/Math.tan(H/2);var Me=U*m.clientWidth/2+"px",Le="perspective("+Me+") translateZ("+Me+") rotateX("+M+"rad) rotateY("+T+"rad) ",nt=Object.keys(Ze);for(C=0;C<6;C++){var ce=B.querySelector(".pnlm-"+nt[C]+"face");!ce||(ce.style.webkitTransform=Le+Ze[nt[C]],ce.style.transform=Le+Ze[nt[C]])}return}if(z!="multires"){var ke=2*Math.atan(Math.tan(H*.5)/(h.drawingBufferWidth/h.drawingBufferHeight));U=1/Math.tan(ke*.5),h.uniform1f(v.psi,T),h.uniform1f(v.theta,M),h.uniform1f(v.rot,Q),h.uniform1f(v.f,U),ae===!0&&z=="equirectangular"&&(h.bindTexture(h.TEXTURE_2D,v.texture),h.texImage2D(h.TEXTURE_2D,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,A)),h.drawArrays(h.TRIANGLES,0,6)}else{var De=typeof A.shtHash!="undefined"||typeof A.equirectangularThumbnail!="undefined",Ae=De;if(De&&v.currentNodes.length>=6){Ae=!1;for(var C=0;C<6;C++)if(!v.currentNodes[C].textureLoaded){Ae=!0;break}}if(Ae){h.useProgram(b),h.bindBuffer(h.ARRAY_BUFFER,Y),h.vertexAttribPointer(b.texCoordLocation,2,h.FLOAT,!1,0,0),h.bindTexture(h.TEXTURE_2D,b.texture);var ke=2*Math.atan(Math.tan(H*.5)/(h.drawingBufferWidth/h.drawingBufferHeight));U=1/Math.tan(ke*.5),h.uniform1f(b.psi,T),h.uniform1f(b.theta,M),h.uniform1f(b.rot,Q),h.uniform1f(b.f,U),h.drawArrays(h.TRIANGLES,0,6),h.bindBuffer(h.ARRAY_BUFFER,se),h.vertexAttribPointer(v.vertPosLocation,3,h.FLOAT,!1,0,0),h.useProgram(v)}var ye=Pe(H,h.drawingBufferWidth/h.drawingBufferHeight,.1,100);$r(H);var pe=Xr();pe=Oe(pe,-Q,"z"),pe=Oe(pe,-M,"x"),pe=Oe(pe,T,"y"),pe=fe(pe),h.uniformMatrix4fv(v.perspUniform,!1,_e(ye)),h.uniformMatrix4fv(v.cubeUniform,!1,_e(pe));var He=St(ye,pe);if(v.nodeCache.sort($e),v.nodeCache.length>200&&v.nodeCache.length>v.currentNodes.length+50)for(var Ce=v.nodeCache.splice(200,v.nodeCache.length-200),Ne=0;Ne<Ce.length;Ne++)h.deleteTexture(Ce[Ne].texture);for(v.currentNodes=[],q=0;q<6;q++){var Be=new mt(F[q],ot[q],1,0,0,A.fullpath,null);$t(He,Be,M,T)}for(v.currentNodes.sort(Re),C=qe.length-1;C>=0;C--)v.currentNodes.indexOf(qe[C].node)===-1&&(qe[C].node.textureLoad=!1,qe.splice(C,1));if(qe.length===0)for(C=0;C<v.currentNodes.length;C++){var Ve=v.currentNodes[C];if(!Ve.texture&&!Ve.textureLoad){Ve.textureLoad=!0,setTimeout(_t,0,Ve);break}}v.textureLoads.length>0&&v.textureLoads.shift()(!0),Xe(!De)}if(N.returnImage!==r)return e.createImageBitmap&&N.returnImage=="ImageBitmap"?createImageBitmap(m):N.returnImage.toString().indexOf("image/")==0?m.toDataURL(N.returnImage):m.toDataURL("image/png")},this.isLoading=function(){if(h&&z=="multires"){for(var M=0;M<v.currentNodes.length;M++)if(!v.currentNodes[M].textureLoaded)return!0}return!1},this.isBaseLoaded=function(){if(v.currentNodes.length>=6){for(var M=0;M<6;M++)if(!v.currentNodes[M].textureLoaded)return!1;return!0}return!1},this.getCanvas=function(){return m};function $e(M,T){return M.level==1&&T.level!=1?-1:T.level==1&&M.level!=1?1:T.timestamp-M.timestamp}function Re(M,T){return M.level!=T.level?M.level-T.level:M.diff-T.diff}function Xe(M){if(!v.drawInProgress){v.drawInProgress=!0,M&&h.clear(h.COLOR_BUFFER_BIT);for(var T={},H=0;H<v.currentNodes.length;H++)T[v.currentNodes[H].parentPath]|=!(v.currentNodes[H].textureLoaded>1);for(var H=0;H<v.currentNodes.length;H++)v.currentNodes[H].textureLoaded>1&&T[v.currentNodes[H].path]!=0&&(h.bufferData(h.ARRAY_BUFFER,v.currentNodes[H].vertices,h.STATIC_DRAW),h.bindTexture(h.TEXTURE_2D,v.currentNodes[H].texture),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0));v.drawInProgress=!1}}function mt(M,T,H,N,U,C,q){this.vertices=M,this.side=T,this.level=H,this.x=N,this.y=U,this.path=C.replace("%s",T).replace("%l0",H-1).replace("%l",H).replace("%x",N).replace("%y",U),this.parentPath=q}function $t(M,T,H,N,U){if(bt(M,T.vertices)){var C=T.vertices,q=C[0]+C[3]+C[6]+C[9],Q=C[1]+C[4]+C[7]+C[10],te=C[2]+C[5]+C[8]+C[11],J=Math.sqrt(q*q+Q*Q+te*te),ge=Math.asin(te/J),he=Math.atan2(Q,q),lt=he-N;lt+=lt>Math.PI?-2*Math.PI:lt<-Math.PI?2*Math.PI:0,lt=Math.abs(lt),T.diff=Math.acos(Math.sin(H)*Math.sin(ge)+Math.cos(H)*Math.cos(ge)*Math.cos(lt));for(var Tt=!1,ht=0;ht<v.nodeCache.length;ht++)if(v.nodeCache[ht].path==T.path){Tt=!0,v.nodeCache[ht].timestamp=v.nodeCacheTimestamp++,v.nodeCache[ht].diff=T.diff,v.currentNodes.push(v.nodeCache[ht]);break}if(Tt||(T.timestamp=v.nodeCacheTimestamp++,v.currentNodes.push(T),v.nodeCache.push(T)),T.level<v.level){var je=A.cubeResolution*Math.pow(2,T.level-A.maxLevel),we=Math.ceil(je*A.invTileResolution)-1,oe=je%A.tileResolution*2,Ze=je*2%A.tileResolution;Ze===0&&(Ze=A.tileResolution),oe===0&&(oe=A.tileResolution*2);var Me=.5;(T.x==we||T.y==we)&&(Me=1-A.tileResolution/(A.tileResolution+Ze));var Le=1-Me,nt=[],ce,ke,De=Me,Ae=Me,ye=Me,pe=Le,He=Le,Ce=Le;Ze<A.tileResolution&&(T.x==we&&T.y!=we?(Ae=.5,He=.5,(T.side=="d"||T.side=="u")&&(ye=.5,Ce=.5)):T.x!=we&&T.y==we&&(De=.5,pe=.5,(T.side=="l"||T.side=="r")&&(ye=.5,Ce=.5))),oe<=A.tileResolution&&(T.x==we&&(De=0,pe=1,(T.side=="l"||T.side=="r")&&(ye=0,Ce=1)),T.y==we&&(Ae=0,He=1,(T.side=="d"||T.side=="u")&&(ye=0,Ce=1))),ce=new Float32Array([C[0],C[1],C[2],C[0]*De+C[3]*pe,C[1]*Me+C[4]*Le,C[2]*ye+C[5]*Ce,C[0]*De+C[6]*pe,C[1]*Ae+C[7]*He,C[2]*ye+C[8]*Ce,C[0]*Me+C[9]*Le,C[1]*Ae+C[10]*He,C[2]*ye+C[11]*Ce]),ke=new mt(ce,T.side,T.level+1,T.x*2,T.y*2,A.fullpath,T.path),nt.push(ke),T.x==we&&oe<=A.tileResolution||(ce=new Float32Array([C[0]*De+C[3]*pe,C[1]*Me+C[4]*Le,C[2]*ye+C[5]*Ce,C[3],C[4],C[5],C[3]*Me+C[6]*Le,C[4]*Ae+C[7]*He,C[5]*ye+C[8]*Ce,C[0]*De+C[6]*pe,C[1]*Ae+C[7]*He,C[2]*ye+C[8]*Ce]),ke=new mt(ce,T.side,T.level+1,T.x*2+1,T.y*2,A.fullpath,T.path),nt.push(ke)),!(T.x==we&&oe<=A.tileResolution)&&!(T.y==we&&oe<=A.tileResolution)&&(ce=new Float32Array([C[0]*De+C[6]*pe,C[1]*Ae+C[7]*He,C[2]*ye+C[8]*Ce,C[3]*Me+C[6]*Le,C[4]*Ae+C[7]*He,C[5]*ye+C[8]*Ce,C[6],C[7],C[8],C[9]*De+C[6]*pe,C[10]*Me+C[7]*Le,C[11]*ye+C[8]*Ce]),ke=new mt(ce,T.side,T.level+1,T.x*2+1,T.y*2+1,A.fullpath,T.path),nt.push(ke)),T.y==we&&oe<=A.tileResolution||(ce=new Float32Array([C[0]*Me+C[9]*Le,C[1]*Ae+C[10]*He,C[2]*ye+C[11]*Ce,C[0]*De+C[6]*pe,C[1]*Ae+C[7]*He,C[2]*ye+C[8]*Ce,C[9]*De+C[6]*pe,C[10]*Me+C[7]*Le,C[11]*ye+C[8]*Ce,C[9],C[10],C[11]]),ke=new mt(ce,T.side,T.level+1,T.x*2,T.y*2+1,A.fullpath,T.path),nt.push(ke));for(var Ne=0;Ne<nt.length;Ne++)$t(M,nt[Ne],H,N)}}}function yr(){return new Float32Array([-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1])}function Xr(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function Oe(M,T,H){var N=Math.sin(T),U=Math.cos(T);if(H=="x")return new Float32Array([M[0],U*M[1]+N*M[2],U*M[2]-N*M[1],M[3],U*M[4]+N*M[5],U*M[5]-N*M[4],M[6],U*M[7]+N*M[8],U*M[8]-N*M[7]]);if(H=="y")return new Float32Array([U*M[0]-N*M[2],M[1],U*M[2]+N*M[0],U*M[3]-N*M[5],M[4],U*M[5]+N*M[3],U*M[6]-N*M[8],M[7],U*M[8]+N*M[6]]);if(H=="z")return new Float32Array([U*M[0]+N*M[1],U*M[1]-N*M[0],M[2],U*M[3]+N*M[4],U*M[4]-N*M[3],M[5],U*M[6]+N*M[7],U*M[7]-N*M[6],M[8]])}function fe(M){return new Float32Array([M[0],M[1],M[2],0,M[3],M[4],M[5],0,M[6],M[7],M[8],0,0,0,0,1])}function _e(M){return new Float32Array([M[0],M[4],M[8],M[12],M[1],M[5],M[9],M[13],M[2],M[6],M[10],M[14],M[3],M[7],M[11],M[15]])}function Pe(M,T,H,N){var U=2*Math.atan(Math.tan(M/2)*h.drawingBufferHeight/h.drawingBufferWidth),C=1/Math.tan(U/2);return new Float32Array([C/T,0,0,0,0,C,0,0,0,0,(N+H)/(H-N),2*N*H/(H-N),0,0,-1,0])}function rt(M,T){h.bindTexture(h.TEXTURE_2D,T),h.texImage2D(h.TEXTURE_2D,0,h.RGB,h.RGB,h.UNSIGNED_BYTE,M),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.bindTexture(h.TEXTURE_2D,null)}var qe=[],ir=function(){var M=4,T={},H;function N(){var Q=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=H||"anonymous";var te=function(){v.textureLoads.push(function(J){J&&(Q.image.width>0&&Q.image.height>0?(rt(Q.image,Q.texture),Q.callback(Q.texture,!0)):Q.callback(Q.texture,!1)),C(Q)})};this.image.addEventListener("load",te),this.image.addEventListener("error",te)}N.prototype.loadTexture=function(Q,te,J){this.texture=te,this.callback=J,this.image.src=Q};function U(Q,te,J,ge){this.node=Q,this.src=te,this.texture=J,this.callback=ge}function C(Q){if(qe.length){var te=qe.shift();Q.loadTexture(te.src,te.texture,te.callback)}else T[M++]=Q}for(var q=0;q<M;q++)T[q]=new N;return function(Q,te,J,ge){H=ge;var he=h.createTexture();return M?T[--M].loadTexture(te,he,J):qe.push(new U(Q,te,he,J)),he}}();function k(M){ir(M,M.path+(A.extension?"."+A.extension:""),function(T,H){M.texture=T,M.textureLoaded=H?2:1},L.crossOrigin)}var _t;if(e.Worker&&e.createImageBitmap){let M=function(){self.onmessage=function(T){var H=T.data[0],N=T.data[1];fetch(H,{mode:"cors",credentials:N=="use-credentials"?"include":"same-origin"}).then(function(U){return U.blob()}).then(function(U){return createImageBitmap(U)}).then(function(U){postMessage([H,!0,U],[U])}).catch(function(){postMessage([H,!1])})}};var j=new Blob(["("+M.toString()+")()"],{type:"application/javascript"}),yt=new Worker(URL.createObjectURL(j)),Et={};yt.onmessage=function(T){var H=T.data[0],N=T.data[1],U=T.data[2];v.textureLoads.push(function(C){var q,Q=!1;N&&C&&(q=h.createTexture(),rt(U,q),Q=!0);var te=Et[H];delete Et[H],te!==r&&(te.texture=q,te.textureLoaded=Q?2:1)})},_t=function(T){var H=new URL(T.path+(A.extension?"."+A.extension:""),e.location).href;Et[H]=T,yt.postMessage([H,L.crossOrigin])}}else _t=k;function $r(M){for(var T=1;T<A.maxLevel&&h.drawingBufferWidth>A.tileResolution*Math.pow(2,T-1)*Math.tan(M/2)*.707;)T++;v.level=T}function St(M,T){return new Float32Array([M[0]*T[0],M[0]*T[1],M[0]*T[2],0,M[5]*T[4],M[5]*T[5],M[5]*T[6],0,M[10]*T[8],M[10]*T[9],M[10]*T[10],M[11],-T[8],-T[9],-T[10],0])}function We(M,T){return new Float32Array([M[0]*T[0]+M[1]*T[1]+M[2]*T[2],M[4]*T[0]+M[5]*T[1]+M[6]*T[2],M[11]+M[8]*T[0]+M[9]*T[1]+M[10]*T[2],1/(M[12]*T[0]+M[13]*T[1]+M[14]*T[2])])}function gr(M,T){var H=We(M,T),N=H[0]*H[3],U=H[1]*H[3],C=H[2]*H[3],q=[0,0,0];return N<-1&&(q[0]=-1),N>1&&(q[0]=1),U<-1&&(q[1]=-1),U>1&&(q[1]=1),(C<-1||C>1)&&(q[2]=1),q}function bt(M,T){var H=gr(M,T.slice(0,3)),N=gr(M,T.slice(3,6)),U=gr(M,T.slice(6,9)),C=gr(M,T.slice(9,12)),q=H[0]+N[0]+U[0]+C[0];if(q==-4||q==4)return!1;var Q=H[1]+N[1]+U[1]+C[1];if(Q==-4||Q==4)return!1;var te=H[2]+N[2]+U[2]+C[2];return te!=4}function Gr(){console.log("Reducing canvas size due to error 1286!"),m.width=Math.round(m.width/2),m.height=Math.round(m.height/2)}var nr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~",qt="Bf[ff4fff|ffff0fffffBo@Ri5xag{Jmdf2+WiefCs@Ll7+Vi]Btag6[NmdgCv=Ho9;Qk;7zWiF_GsahDy:ErE?Mn$5+SkS_AyWiD#-CuJ[Iqp6;Nnx?7*SlE$*BxR@FtPA?Jq+%7:NnF*zAzn?CwIG@Ft-Y9?IrG+vA%w:AzGR?Cx*IF@EuI,nA+$*9%Gu:A#xCR?ByJ-VB-*wA+J**9*ZBv:9%L.QD.*aB.O.v9-MF+$8,O:MG:*OD;a:UB:IO:n9:Q:KJ;#IG=u-KE=Hs:MC?T:IO=wEL?#%FJ@K**FI@Y;HV=pDU?*sCS@S.uCR[m;Hp=VDq?*SCs@s.QCt[r:Iw=OEz?#IF$@#*HF%@u:K$;KI+=uEK-=*sCM:?w:M+:HO.;aCU;:%OCn?:z.Q..Ha;.ODv?-yFG$@,$-V;-Hw=+JH*?*lBP:?%%,n=+J*?%GQ:=#NCt?;y++v=%O:=zGt?:xHI,@-u,*z=zX?:wI+@,tEY??%r-$*;xt@,tP=?$qG%[:xn.#-:u$[%qp];xnN?[*sl.y:-r-?yn$^+sks_=yoi:v=*o?;uk;[zoi,_+skh:s@zl[+pi];tkg][xmhg;o@ti^xkg{$mhf|+oigf;f[ff_fff|ffff~fffff",Wt=3.317,it=[];function ar(M,T){return Math.pow((Math.abs(M)-T)/T,2)*(M-T>0?1:-1)}function jr(M,T){var H=Math.floor(M/(19*19)),N=Math.floor(M/19)%19,U=M%19,C=ar(H,9)*T,q=ar(N,9)*T,Q=ar(U,9)*T;return[C,q,Q]}function gt(M,T){for(var H=Math.floor(M.length/T),N=[],U=0;U<H;U++){for(var C=0,q=0;q<T;q++)C=C*83+nr.indexOf(M[U*T+q]);N.push(C)}return N}function Vt(M,T,H){var N=Math.floor(Math.sqrt(M.length))-1,U=Array(N+1),C=Array(N+1);C[0]=0,U[0]=1,C[1]=Math.sin(H),U[1]=Math.cos(H);for(var q=2;q<=N;q++)C[q]=2*C[q-1]*U[1]-C[q-2],U[q]=2*U[q-1]*U[1]-U[q-2];for(var Q=0,te=0,J=1;J<=N+1;J++)te+=J;for(var ge=N;ge>=0;ge--){var he=Math.floor((ge+1)*ge/2);Q+=he!=0?M[he]*T[he-1]:M[he];for(var q=1;q<=ge;q++)Q+=(M[++he]*U[q]+M[he+te-ge-1]*C[q])*T[he-1]}return Math.round(Q)}function wr(M){if(it.length<1)for(var T=qt.length/32,H=0;H<32;H++){it.push([]);for(var N=0;N<T;N++)it[H].push(ar(gt(qt[H*T+N],1),41)*Wt)}gt(M[0],1)[0];for(var U=(ar(gt(M[1],1),41)+1)*255/2,C=gt(M.slice(2),2),q=[],Q=[],te=[],H=0;H<C.length;H++){var J=jr(C[H],U);q.push(J[0]),Q.push(J[1]),te.push(J[2])}for(var ge=.03125*Math.PI,he=[],H=31;H>=0;H--)for(var N=0;N<64;N++)he.push(Vt(q,it[H],(N+.5)*ge)),he.push(Vt(Q,it[H],(N+.5)*ge)),he.push(Vt(te,it[H],(N+.5)*ge)),he.push(255);return new ImageData(new Uint8ClampedArray(he),64,32)}}var n=["attribute vec2 a_texCoord;","varying vec2 v_texCoord;","void main() {","gl_Position = vec4(a_texCoord, 0.0, 1.0);","v_texCoord = a_texCoord;","}"].join(""),s=["attribute vec3 a_vertCoord;","attribute vec2 a_texCoord;","uniform mat4 u_cubeMatrix;","uniform mat4 u_perspMatrix;","varying mediump vec2 v_texCoord;","void main(void) {","gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);","v_texCoord = a_texCoord;","}"].join(""),o=["precision highp float;","uniform float u_aspectRatio;","uniform float u_psi;","uniform float u_theta;","uniform float u_f;","uniform float u_h;","uniform float u_v;","uniform float u_vo;","uniform float u_rot;","const float PI = 3.14159265358979323846264;","uniform sampler2D u_image0;","uniform sampler2D u_image1;","uniform bool u_splitImage;","uniform samplerCube u_imageCube;","varying vec2 v_texCoord;","uniform vec4 u_backgroundColor;","void main() {","float x = v_texCoord.x * u_aspectRatio;","float y = v_texCoord.y;","float sinrot = sin(u_rot);","float cosrot = cos(u_rot);","float rot_x = x * cosrot - y * sinrot;","float rot_y = x * sinrot + y * cosrot;","float sintheta = sin(u_theta);","float costheta = cos(u_theta);","float a = u_f * costheta - rot_y * sintheta;","float root = sqrt(rot_x * rot_x + a * a);","float lambda = atan(rot_x / root, a / root) + u_psi;","float phi = atan((rot_y * costheta + u_f * sintheta) / root);"].join(`
`),a=o+["float cosphi = cos(phi);","gl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));","}"].join(`
`),l=o+["lambda = mod(lambda + PI, PI * 2.0) - PI;","vec2 coord = vec2(lambda / PI, phi / (PI / 2.0));","if(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)","gl_FragColor = u_backgroundColor;","else {","if(u_splitImage) {","if(coord.x < 0.0)","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","else","gl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","} else {","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));","}","}","}"].join(`
`),c=["varying mediump vec2 v_texCoord;","uniform sampler2D u_sampler;","void main(void) {","gl_FragColor = texture2D(u_sampler, v_texCoord);","}"].join("");return{renderer:function(f,_,m,v){return new i(f,_,m,v)}}}(window,document);var W_="";function I_(e){let t,r,i;return{c(){t=At("div"),r=Yn(),i=At("p"),i.textContent="Hello",this.c=Ie},m(n,s){dt(n,t,s),e[2](t),dt(n,r,s),dt(n,i,s)},p:Ie,i:Ie,o:Ie,d(n){n&&Pt(t),e[2](null),n&&Pt(r),n&&Pt(i)}}}function z_(e,t,r){let{gql:i={}}=t,n;Gn(()=>{console.log("mounted"),pannellum.viewer(n,{type:"equirectangular",panorama:i.panorama.mediaItemUrl,preview:i.panorama.sourceUrl})});function s(o){yi[o?"unshift":"push"](()=>{n=o,r(0,n)})}return e.$$set=o=>{"gql"in o&&r(1,i=o.gql)},[n,i,s]}class $_ extends xi{constructor(t){super();Qi(this,{target:this.shadowRoot,props:Gi(this.attributes),customElement:!0},z_,I_,Yi,{gql:1},null),t&&(t.target&&dt(t.target,this,t.anchor),t.props&&(this.$set(t.props),Dt()))}static get observedAttributes(){return["gql"]}get gql(){return this.$$.ctx[1]}set gql(t){this.$$set({gql:t}),Dt()}}customElements.define("vepple-pannellum",$_);function O_(e){let t,r=e[6].message+"",i;return{c(){t=At("p"),i=Kr(r),Xi(t,"color","red")},m(n,s){dt(n,t,s),Hr(t,i)},p:Ie,d(n){n&&Pt(t)}}}function D_(e){let t,r,i;return{c(){t=At("div"),r=At("iframe"),r.allowFullscreen=!0,Xi(r,"border-style","none"),Xt(r,"part","iframe"),qo(r.src,i=` https://mjwlist.github.io/web-comp-test/dist/ pannellum.htm#panorama=${e[0].panorama.mediaItemUrl}&preview=${e[0].panorama.sourceUrl}`)||Xt(r,"src",i),Xt(t,"class","wrap"),Xt(t,"part","wrap")},m(n,s){dt(n,t,s),Hr(t,r)},p:Ie,d(n){n&&Pt(t)}}}function H_(e){let t;return{c(){t=At("p"),t.textContent="...waiting"},m(r,i){dt(r,t,i)},p:Ie,d(r){r&&Pt(t)}}}function N_(e){let t,r=e[6].message+"",i;return{c(){t=At("p"),i=Kr(r),Xi(t,"color","red")},m(n,s){dt(n,t,s),Hr(t,i)},p:Ie,d(n){n&&Pt(t)}}}function F_(e){let t,r,i=e[1].ctaText+"",n;return{c(){t=At("div"),r=At("a"),n=Kr(i),Xt(r,"part","link"),Xt(r,"href",e[1].ctaUrl),Xt(t,"part","content")},m(s,o){dt(s,t,o),Hr(t,r),Hr(r,n)},p:Ie,d(s){s&&Pt(t)}}}function k_(e){return{c:Ie,m:Ie,p:Ie,d:Ie}}function B_(e){let t,r,i={ctx:e,current:null,token:null,hasCatch:!0,pending:H_,then:D_,catch:O_,value:0,error:6};Kn(e[0],i);let n={ctx:e,current:null,token:null,hasCatch:!0,pending:k_,then:F_,catch:N_,value:1,error:6};return Kn(e[1],n),{c(){i.block.c(),t=Yn(),r=Vo(),n.block.c(),this.c=Ie},m(s,o){i.block.m(s,i.anchor=o),i.mount=()=>t.parentNode,i.anchor=t,dt(s,t,o),dt(s,r,o),n.block.m(s,n.anchor=o),n.mount=()=>r.parentNode,n.anchor=r},p(s,[o]){e=s,Qn(i,e,o),Qn(n,e,o)},i:Ie,o:Ie,d(s){i.block.d(s),i.token=null,i=null,s&&Pt(t),s&&Pt(r),n.block.d(s),n.token=null,n=null}}}function U_(e,t,r){let{post:i}=t,{api:n}=t;async function s(){const c=await fetch(`${n}/wp-json/rv/v1/settings`),f=await c.json();if(c.ok)return f.ctas[0];throw new Error(f)}async function o(){const c=await fetch(`${n}/graphql`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
            query MyQuery($name: String!) {
              posts(where: {name: $name}) {
                  nodes {
                    slug
                    postContent {
                      panorama {
                        title(format: RAW)
                        mediaItemUrl
                        sourceUrl(size: MEDIUM_LARGE)
                      }
                      position {
                        horizontal
                        vertical
                      }
                    }
                  }
                }
            }
      `,variables:{name:i}})}),f=await c.json();if(console.log(f),c.ok)return f.data.posts.nodes[0].postContent;throw new Error(f)}const a=o(),l=s();return e.$$set=c=>{"post"in c&&r(2,i=c.post),"api"in c&&r(3,n=c.api)},[a,l,i,n]}class q_ extends xi{constructor(t){super();this.shadowRoot.innerHTML="<style>*,*:before,*:after{box-sizing:border-box}.wrap{position:relative;padding-bottom:56.25%;height:0;overflow:hidden}iframe{position:absolute;top:0;left:0;width:100%;height:100%}</style>",Qi(this,{target:this.shadowRoot,props:Gi(this.attributes),customElement:!0},U_,B_,Yi,{post:2,api:3},null),t&&(t.target&&dt(t.target,this,t.anchor),t.props&&(this.$set(t.props),Dt()))}static get observedAttributes(){return["post","api"]}get post(){return this.$$.ctx[2]}set post(t){this.$$set({post:t}),Dt()}get api(){return this.$$.ctx[3]}set api(t){this.$$set({api:t}),Dt()}}customElements.define("vepple-embed",q_)});
