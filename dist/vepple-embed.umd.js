(function(U){typeof define=="function"&&define.amd?define(U):U()})(function(){"use strict";function U(){}function lo(e){return e&&typeof e=="object"&&typeof e.then=="function"}function qr(e){return e()}function ji(){return Object.create(null)}function wt(e){e.forEach(qr)}function Zi(e){return typeof e=="function"}function Ki(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function co(e){return Object.keys(e).length===0}function or(e,t){e.appendChild(t)}function Ye(e,t,r){e.insertBefore(t,r||null)}function it(e){e.parentNode.removeChild(e)}function xt(e){return document.createElement(e)}function hr(e){return document.createTextNode(e)}function vo(){return hr(" ")}function fo(){return hr("")}function Mt(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function uo(e,t,r){t in e?e[t]=typeof e[t]=="boolean"&&r===""?!0:r:Mt(e,t,r)}function po(e){return Array.from(e.childNodes)}function _o(e,t,r,i){r===null?e.style.removeProperty(t):e.style.setProperty(t,r,i?"important":"")}function Qi(e){const t={};for(const r of e)t[r.name]=r.value;return t}let It;function Ae(e){It=e}function Ji(){if(!It)throw new Error("Function called outside component initialization");return It}function mo(e){Ji().$$.on_mount.push(e)}const Ot=[],Wr=[],lr=[],en=[],yo=Promise.resolve();let Yr=!1;function go(){Yr||(Yr=!0,yo.then(Xe))}function Xr(e){lr.push(e)}const Br=new Set;let cr=0;function Xe(){const e=It;do{for(;cr<Ot.length;){const t=Ot[cr];cr++,Ae(t),wo(t.$$)}for(Ae(null),Ot.length=0,cr=0;Wr.length;)Wr.pop()();for(let t=0;t<lr.length;t+=1){const r=lr[t];Br.has(r)||(Br.add(r),r())}lr.length=0}while(Ot.length);for(;en.length;)en.pop()();Yr=!1,Br.clear(),Ae(e)}function wo(e){if(e.fragment!==null){e.update(),wt(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Xr)}}const vr=new Set;let nt;function xo(){nt={r:0,c:[],p:nt}}function Mo(){nt.r||wt(nt.c),nt=nt.p}function tn(e,t){e&&e.i&&(vr.delete(e),e.i(t))}function To(e,t,r,i){if(e&&e.o){if(vr.has(e))return;vr.add(e),nt.c.push(()=>{vr.delete(e),i&&(r&&e.d(1),i())}),e.o(t)}}function rn(e,t){const r=t.token={};function i(n,s,a,o){if(t.token!==r)return;t.resolved=o;let l=t.ctx;a!==void 0&&(l=l.slice(),l[a]=o);const h=n&&(t.current=n)(l);let c=!1;t.block&&(t.blocks?t.blocks.forEach((f,u)=>{u!==s&&f&&(xo(),To(f,1,1,()=>{t.blocks[u]===f&&(t.blocks[u]=null)}),Mo())}):t.block.d(1),h.c(),tn(h,1),h.m(t.mount(),t.anchor),c=!0),t.block=h,t.blocks&&(t.blocks[s]=h),c&&Xe()}if(lo(e)){const n=Ji();if(e.then(s=>{Ae(n),i(t.then,1,t.value,s),Ae(null)},s=>{if(Ae(n),i(t.catch,2,t.error,s),Ae(null),!t.hasCatch)throw s}),t.current!==t.pending)return i(t.pending,0),!0}else{if(t.current!==t.then)return i(t.then,1,t.value,e),!0;t.resolved=e}}function nn(e,t,r){const i=t.slice(),{resolved:n}=e;e.current===e.then&&(i[e.value]=n),e.current===e.catch&&(i[e.error]=n),e.block.p(i,r)}function Eo(e,t,r,i){const{fragment:n,on_mount:s,on_destroy:a,after_update:o}=e.$$;n&&n.m(t,r),i||Xr(()=>{const l=s.map(qr).filter(Zi);a?a.push(...l):wt(l),e.$$.on_mount=[]}),o.forEach(Xr)}function bo(e,t){const r=e.$$;r.fragment!==null&&(wt(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function $o(e,t){e.$$.dirty[0]===-1&&(Ot.push(e),go(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function sn(e,t,r,i,n,s,a,o=[-1]){const l=It;Ae(e);const h=e.$$={fragment:null,ctx:null,props:s,update:U,not_equal:n,bound:ji(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:ji(),dirty:o,skip_bound:!1,root:t.target||l.$$.root};a&&a(h.root);let c=!1;if(h.ctx=r?r(e,t.props||{},(f,u,...p)=>{const _=p.length?p[0]:u;return h.ctx&&n(h.ctx[f],h.ctx[f]=_)&&(!h.skip_bound&&h.bound[f]&&h.bound[f](_),c&&$o(e,f)),u}):[],h.update(),c=!0,wt(h.before_update),h.fragment=i?i(h.ctx):!1,t.target){if(t.hydrate){const f=po(t.target);h.fragment&&h.fragment.l(f),f.forEach(it)}else h.fragment&&h.fragment.c();t.intro&&tn(e.$$.fragment),Eo(e,t.target,t.anchor,t.customElement),Xe()}Ae(l)}let Ur;typeof HTMLElement=="function"&&(Ur=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(qr).filter(Zi);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(e,t,r){this[e]=r}disconnectedCallback(){wt(this.$$.on_disconnect)}$destroy(){bo(this,1),this.$destroy=U}$on(e,t){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const i=r.indexOf(t);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!co(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});var Gr=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function So(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),t}function Tt(){}Tt.prototype.addEventListener=function(e,t){var r=this.__events=this.__events||{},i=r[e]=r[e]||[];i.indexOf(t)<0&&i.push(t)},Tt.prototype.removeEventListener=function(e,t){var r=this.__events=this.__events||{},i=r[e];if(i){var n=i.indexOf(t);n>=0&&i.splice(n,1)}},Tt.prototype.emit=function(e,t){var r=this.__events=this.__events||{},i=r[e],n=Array.prototype.slice.call(arguments,1);if(i)for(var s=0;s<i.length;s++){var a=i[s];a.apply(this,n)}};function Co(e){for(var t in Tt.prototype)Tt.prototype.hasOwnProperty(t)&&(e.prototype[t]=Tt.prototype[t])}var Z=Co;function Lo(){return typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return Date.now()}}var st=Lo(),an=st;function Po(e,t){this.fn=e,this.cb=t,this.cfn=null}function Re(e){this._queue=[],this._delay=e&&e.delay||0,this._paused=e&&!!e.paused||!1,this._currentTask=null,this._lastFinished=null}Re.prototype.length=function(){return this._queue.length},Re.prototype.push=function(e,t){var r=new Po(e,t),i=this._cancel.bind(this,r);return this._queue.push(r),this._next(),i},Re.prototype.pause=function(){this._paused||(this._paused=!0)},Re.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},Re.prototype._start=function(e){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=e;var t=this._finish.bind(this,e);if(e.cfn=e.fn(t),typeof e.cfn!="function")throw new Error("WorkQueue: function is not cancellable")},Re.prototype._finish=function(e){var t=Array.prototype.slice.call(arguments,1);if(this._currentTask!==e)throw new Error("WorkQueue: called finish on wrong task");e.cb.apply(null,t),this._currentTask=null,this._lastFinished=an(),this._next()},Re.prototype._cancel=function(e){var t=Array.prototype.slice.call(arguments,1);if(this._currentTask===e)e.cfn.apply(null,t);else{var r=this._queue.indexOf(e);r>=0&&(this._queue.splice(r,1),e.cb.apply(null,t))}},Re.prototype._next=function(){if(!this._paused&&!!this._queue.length&&!this._currentTask){if(this._lastFinished!=null){var e=an()-this._lastFinished,t=this._delay-e;if(t>0){setTimeout(this._next.bind(this),t);return}}var r=this._queue.shift();this._start(r)}};var on=Re;function zo(e,t,r,i){i=i||{};var n;r!=null&&r.absoluteWidth!=null?n=r.absoluteWidth/e:r!=null&&r.relativeWidth!=null?n=r.relativeWidth:n=1;var s;r&&r.absoluteHeight!=null?s=r.absoluteHeight/t:r!=null&&r.relativeHeight!=null?s=r.relativeHeight:s=1;var a;r!=null&&r.absoluteX!=null?a=r.absoluteX/e:r!=null&&r.relativeX!=null?a=r.relativeX:a=0;var o;return r!=null&&r.absoluteY!=null?o=r.absoluteY/t:r!=null&&r.relativeY!=null?o=r.relativeY:o=0,i.x=a,i.y=o,i.width=n,i.height=s,i}var hn=zo;function Ao(e){return function(r){var i,n;try{n=e()}catch(s){i=s}finally{i?r(i):r(null,n)}}}var ln=Ao;function Ro(e){var t=!1,r;return function(){return t||(t=!0,r=e.apply(null,arguments)),r}}var jr=Ro,Io=jr;function Oo(e){return function(){if(!arguments.length)throw new Error("cancelized: expected at least one argument");var r=Array.prototype.slice.call(arguments,0),i=r[r.length-1]=Io(r[r.length-1]);function n(){i.apply(null,arguments)}return e.apply(null,r),n}}var cn=Oo;function Do(e){for(var t in e)e.hasOwnProperty(t)&&(e[t]=void 0)}var G=Do;function Zr(){this._renderers={}}Zr.prototype.set=function(e,t,r){this._renderers[e]||(this._renderers[e]={}),this._renderers[e][t]=r},Zr.prototype.get=function(e,t){var r=this._renderers[e]&&this._renderers[e][t];return r||null};var Ho=Zr,No=Z,ko=on,Fo=hn,Vo=ln,qo=cn,Wo=G,Yo=Ho;function Xo(e,t){return e.cmp(t)}function Bo(e,t){return-e.cmp(t)}function W(e){this._progressive=!!(e&&e.progressive),this._layers=[],this._renderers=[],this._tilesToLoad=[],this._tilesToRender=[],this._tmpVisible=[],this._tmpChildren=[],this._width=0,this._height=0,this._tmpRect={},this._tmpSize={},this._createTextureWorkQueue=new ko,this._emitRenderInvalid=this._emitRenderInvalid.bind(this),this._rendererRegistry=new Yo}No(W),W.prototype.destroy=function(){this.removeAllLayers(),Wo(this)},W.prototype.registerRenderer=function(e,t,r){return this._rendererRegistry.set(e,t,r)},W.prototype.domElement=function(){throw new Error("Stage implementation must override domElement")},W.prototype.width=function(){return this._width},W.prototype.height=function(){return this._height},W.prototype.size=function(e){return e=e||{},e.width=this._width,e.height=this._height,e},W.prototype.setSize=function(e){this._width=e.width,this._height=e.height,this.setSizeForType(),this.emit("resize"),this._emitRenderInvalid()},W.prototype.setSizeForType=function(e){throw new Error("Stage implementation must override setSizeForType")},W.prototype.loadImage=function(){throw new Error("Stage implementation must override loadImage")},W.prototype._emitRenderInvalid=function(){this.emit("renderInvalid")},W.prototype.validateLayer=function(e){throw new Error("Stage implementation must override validateLayer")},W.prototype.listLayers=function(){return[].concat(this._layers)},W.prototype.hasLayer=function(e){return this._layers.indexOf(e)>=0},W.prototype.addLayer=function(e,t){if(this._layers.indexOf(e)>=0)throw new Error("Layer already in stage");if(t==null&&(t=this._layers.length),t<0||t>this._layers.length)throw new Error("Invalid layer position");this.validateLayer(e);var r=e.geometry().type,i=e.view().type,n=this._rendererRegistry.get(r,i);if(!n)throw new Error("No "+this.type+" renderer avaiable for "+r+" geometry and "+i+" view");var s=this.createRenderer(n);this._layers.splice(t,0,e),this._renderers.splice(t,0,s),e.addEventListener("viewChange",this._emitRenderInvalid),e.addEventListener("effectsChange",this._emitRenderInvalid),e.addEventListener("fixedLevelChange",this._emitRenderInvalid),e.addEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},W.prototype.moveLayer=function(e,t){var r=this._layers.indexOf(e);if(r<0)throw new Error("No such layer in stage");if(t<0||t>=this._layers.length)throw new Error("Invalid layer position");e=this._layers.splice(r,1)[0];var i=this._renderers.splice(r,1)[0];this._layers.splice(t,0,e),this._renderers.splice(t,0,i),this._emitRenderInvalid()},W.prototype.removeLayer=function(e){var t=this._layers.indexOf(e);if(t<0)throw new Error("No such layer in stage");var r=this._layers.splice(t,1)[0],i=this._renderers.splice(t,1)[0];this.destroyRenderer(i),r.removeEventListener("viewChange",this._emitRenderInvalid),r.removeEventListener("effectsChange",this._emitRenderInvalid),r.removeEventListener("fixedLevelChange",this._emitRenderInvalid),r.removeEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},W.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},W.prototype.startFrame=function(){throw new Error("Stage implementation must override startFrame")},W.prototype.endFrame=function(){throw new Error("Stage implementation must override endFrame")},W.prototype.render=function(){var e,t,r=this._tilesToLoad,i=this._tilesToRender,n=!0,s,a=this._width,o=this._height,l=this._tmpRect,h=this._tmpSize;if(!(a<=0||o<=0)){for(this.startFrame(),e=0;e<this._layers.length;e++)this._layers[e].textureStore().startFrame();for(e=0;e<this._layers.length;e++){var c=this._layers[e],f=c.effects(),u=c.view(),p=c.textureStore(),_=this._renderers[e],w=this._layers.length-e,m,M;if(Fo(a,o,f&&f.rect,l),!(l.width<=0||l.height<=0)){for(h.width=l.width*this._width,h.height=l.height*this._height,u.setSize(h),_.startLayer(c,l),s=this._collectTiles(c,p),t=0;t<r.length;t++)m=r[t],p.markTile(m);for(t=0;t<i.length;t++)m=i[t],M=p.texture(m),_.renderTile(m,M,c,w);c.emit("renderComplete",s),s||(n=!1),_.endLayer(c,l)}}for(e=0;e<this._layers.length;e++)this._layers[e].textureStore().endFrame();this.endFrame(),this.emit("renderComplete",n)}},W.prototype._collectTiles=function(e,t){var r=this._tilesToLoad,i=this._tilesToRender,n=this._tmpVisible;r.length=0,i.length=0,n.length=0,e.visibleTiles(n);for(var s=!0,a=0;a<n.length;a++){var o=n[a],l;this._collectTileToLoad(o),t.texture(o)?(l=!1,this._collectTileToRender(o)):(l=this._collectChildren(o,t),s=!1),this._collectParents(o,t,l)}return r.sort(Xo),i.sort(Bo),s},W.prototype._collectChildren=function(e,t){var r=this._tmpChildren,i=!0;do{if(r.length=0,!e.children(r))break;i=!1;for(var n=0;n<r.length;n++)e=r[n],t.texture(e)?(this._collectTileToLoad(e),this._collectTileToRender(e)):i=!0}while(i&&r.length===1);return i},W.prototype._collectParents=function(e,t,r){for(var i=this._progressive;(i||r)&&(e=e.parent())!=null;){if(r){if(t.texture(e))this._collectTileToRender(e),r=!1;else if(!this._progressive)continue}this._collectTileToLoad(e)||(i=!1)}return r},W.prototype._collectTileToLoad=function(e){return this._collectTileIntoList(e,this._tilesToLoad)},W.prototype._collectTileToRender=function(e){return this._collectTileIntoList(e,this._tilesToRender)},W.prototype._collectTileIntoList=function(e,t){for(var r=!1,i=0;i<t.length;i++)if(e.equals(t[i])){r=!0;break}return r||t.push(e),!r},W.prototype.createTexture=function(e,t,r){var i=this;function n(){return new i.TextureClass(i,e,t)}var s=qo(Vo(n));return this._createTextureWorkQueue.push(s,function(a,o){r(a,e,t,o)})};var Uo=W,Go=function(){return typeof window!="undefined"?window:typeof self!="undefined"?self:typeof Gr!="undefined"?Gr:null}(),vn=Go,fn=vn,jo=Z,Zo=G,Kr={HTMLImageElement:["naturalWidth","naturalHeight"],HTMLCanvasElement:["width","height"],ImageBitmap:["width","height"]};function Be(e){var t=!1;for(var r in Kr)if(fn[r]&&e instanceof fn[r]){t=!0,this._widthProp=Kr[r][0],this._heightProp=Kr[r][1];break}if(!t)throw new Error("Unsupported pixel source");this._element=e}jo(Be),Be.prototype.destroy=function(){Zo(this)},Be.prototype.element=function(){return this._element},Be.prototype.width=function(){return this._element[this._widthProp]},Be.prototype.height=function(){return this._element[this._heightProp]},Be.prototype.timestamp=function(){return 0},Be.prototype.isDynamic=function(){return!1};var Qr=Be;function Ko(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}var Me=Ko,Qo=Me;function un(e){this.constructor.super_.apply(this,arguments),this.message=e}Qo(un,Error);var dn=un,fr={exports:{}};/*!
 * Bowser - a browser detector
 * https://github.com/ded/bowser
 * MIT License | (c) Dustin Diaz 2015
 */(function(e){(function(t,r,i){e.exports?e.exports=i():t[r]=i()})(Gr,"bowser",function(){var t=!0;function r(h){function c(Ce){var de=h.match(Ce);return de&&de.length>1&&de[1]||""}function f(Ce){var de=h.match(Ce);return de&&de.length>1&&de[2]||""}var u=c(/(ipod|iphone|ipad)/i).toLowerCase(),p=/like android/i.test(h),_=!p&&/android/i.test(h),w=/nexus\s*[0-6]\s*/i.test(h),m=!w&&/nexus\s*[0-9]+/i.test(h),M=/CrOS/.test(h),b=/silk/i.test(h),$=/sailfish/i.test(h),S=/tizen/i.test(h),C=/(web|hpw)(o|0)s/i.test(h),E=/windows phone/i.test(h);/SamsungBrowser/i.test(h);var D=!E&&/windows/i.test(h),k=!u&&!b&&/macintosh/i.test(h),H=!_&&!$&&!S&&!C&&/linux/i.test(h),N=f(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),R=c(/version\/(\d+(\.\d+)?)/i),F=/tablet/i.test(h)&&!/tablet pc/i.test(h),B=!F&&/[^-]mobi/i.test(h),z=/xbox/i.test(h),g;/opera/i.test(h)?g={name:"Opera",opera:t,version:R||c(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(h)?g={name:"Opera",opera:t,version:c(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||R}:/SamsungBrowser/i.test(h)?g={name:"Samsung Internet for Android",samsungBrowser:t,version:R||c(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(h)?g={name:"NAVER Whale browser",whale:t,version:c(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(h)?g={name:"MZ Browser",mzbrowser:t,version:c(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(h)?g={name:"Opera Coast",coast:t,version:R||c(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(h)?g={name:"Focus",focus:t,version:c(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(h)?g={name:"Yandex Browser",yandexbrowser:t,version:R||c(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(h)?g={name:"UC Browser",ucbrowser:t,version:c(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(h)?g={name:"Maxthon",maxthon:t,version:c(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(h)?g={name:"Epiphany",epiphany:t,version:c(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(h)?g={name:"Puffin",puffin:t,version:c(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(h)?g={name:"Sleipnir",sleipnir:t,version:c(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(h)?g={name:"K-Meleon",kMeleon:t,version:c(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:E?(g={name:"Windows Phone",osname:"Windows Phone",windowsphone:t},N?(g.msedge=t,g.version=N):(g.msie=t,g.version=c(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(h)?g={name:"Internet Explorer",msie:t,version:c(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:M?g={name:"Chrome",osname:"Chrome OS",chromeos:t,chromeBook:t,chrome:t,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(h)?g={name:"Microsoft Edge",msedge:t,version:N}:/vivaldi/i.test(h)?g={name:"Vivaldi",vivaldi:t,version:c(/vivaldi\/(\d+(\.\d+)?)/i)||R}:$?g={name:"Sailfish",osname:"Sailfish OS",sailfish:t,version:c(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(h)?g={name:"SeaMonkey",seamonkey:t,version:c(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(h)?(g={name:"Firefox",firefox:t,version:c(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(h)&&(g.firefoxos=t,g.osname="Firefox OS")):b?g={name:"Amazon Silk",silk:t,version:c(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(h)?g={name:"PhantomJS",phantom:t,version:c(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(h)?g={name:"SlimerJS",slimer:t,version:c(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(h)||/rim\stablet/i.test(h)?g={name:"BlackBerry",osname:"BlackBerry OS",blackberry:t,version:R||c(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:C?(g={name:"WebOS",osname:"WebOS",webos:t,version:R||c(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(h)&&(g.touchpad=t)):/bada/i.test(h)?g={name:"Bada",osname:"Bada",bada:t,version:c(/dolfin\/(\d+(\.\d+)?)/i)}:S?g={name:"Tizen",osname:"Tizen",tizen:t,version:c(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||R}:/qupzilla/i.test(h)?g={name:"QupZilla",qupzilla:t,version:c(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||R}:/chromium/i.test(h)?g={name:"Chromium",chromium:t,version:c(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||R}:/chrome|crios|crmo/i.test(h)?g={name:"Chrome",chrome:t,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:_?g={name:"Android",version:R}:/safari|applewebkit/i.test(h)?(g={name:"Safari",safari:t},R&&(g.version=R)):u?(g={name:u=="iphone"?"iPhone":u=="ipad"?"iPad":"iPod"},R&&(g.version=R)):/googlebot/i.test(h)?g={name:"Googlebot",googlebot:t,version:c(/googlebot\/(\d+(\.\d+))/i)||R}:g={name:c(/^(.*)\/(.*) /),version:f(/^(.*)\/(.*) /)},!g.msedge&&/(apple)?webkit/i.test(h)?(/(apple)?webkit\/537\.36/i.test(h)?(g.name=g.name||"Blink",g.blink=t):(g.name=g.name||"Webkit",g.webkit=t),!g.version&&R&&(g.version=R)):!g.opera&&/gecko\//i.test(h)&&(g.name=g.name||"Gecko",g.gecko=t,g.version=g.version||c(/gecko\/(\d+(\.\d+)?)/i)),!g.windowsphone&&(_||g.silk)?(g.android=t,g.osname="Android"):!g.windowsphone&&u?(g[u]=t,g.ios=t,g.osname="iOS"):k?(g.mac=t,g.osname="macOS"):z?(g.xbox=t,g.osname="Xbox"):D?(g.windows=t,g.osname="Windows"):H&&(g.linux=t,g.osname="Linux");function Ve(Ce){switch(Ce){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}var j="";g.windows?j=Ve(c(/Windows ((NT|XP)( \d\d?.\d)?)/i)):g.windowsphone?j=c(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):g.mac?(j=c(/Mac OS X (\d+([_\.\s]\d+)*)/i),j=j.replace(/[_\s]/g,".")):u?(j=c(/os (\d+([_\s]\d+)*) like mac os x/i),j=j.replace(/[_\s]/g,".")):_?j=c(/android[ \/-](\d+(\.\d+)*)/i):g.webos?j=c(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):g.blackberry?j=c(/rim\stablet\sos\s(\d+(\.\d+)*)/i):g.bada?j=c(/bada\/(\d+(\.\d+)*)/i):g.tizen&&(j=c(/tizen[\/\s](\d+(\.\d+)*)/i)),j&&(g.osversion=j);var mt=!g.windows&&j.split(".")[0];return F||m||u=="ipad"||_&&(mt==3||mt>=4&&!B)||g.silk?g.tablet=t:(B||u=="iphone"||u=="ipod"||_||w||g.blackberry||g.webos||g.bada)&&(g.mobile=t),g.msedge||g.msie&&g.version>=10||g.yandexbrowser&&g.version>=15||g.vivaldi&&g.version>=1||g.chrome&&g.version>=20||g.samsungBrowser&&g.version>=4||g.whale&&a([g.version,"1.0"])===1||g.mzbrowser&&a([g.version,"6.0"])===1||g.focus&&a([g.version,"1.0"])===1||g.firefox&&g.version>=20||g.safari&&g.version>=6||g.opera&&g.version>=10||g.ios&&g.osversion&&g.osversion.split(".")[0]>=6||g.blackberry&&g.version>=10.1||g.chromium&&g.version>=20?g.a=t:g.msie&&g.version<10||g.chrome&&g.version<20||g.firefox&&g.version<20||g.safari&&g.version<6||g.opera&&g.version<10||g.ios&&g.osversion&&g.osversion.split(".")[0]<6||g.chromium&&g.version<20?g.c=t:g.x=t,g}var i=r(typeof navigator!="undefined"&&navigator.userAgent||"");i.test=function(h){for(var c=0;c<h.length;++c){var f=h[c];if(typeof f=="string"&&f in i)return!0}return!1};function n(h){return h.split(".").length}function s(h,c){var f=[],u;if(Array.prototype.map)return Array.prototype.map.call(h,c);for(u=0;u<h.length;u++)f.push(c(h[u]));return f}function a(h){for(var c=Math.max(n(h[0]),n(h[1])),f=s(h,function(u){var p=c-n(u);return u=u+new Array(p+1).join(".0"),s(u.split("."),function(_){return new Array(20-_.length).join("0")+_}).reverse()});--c>=0;){if(f[0][c]>f[1][c])return 1;if(f[0][c]===f[1][c]){if(c===0)return 0}else return-1}}function o(h,c,f){var u=i;typeof c=="string"&&(f=c,c=void 0),c===void 0&&(c=!1),f&&(u=r(f));var p=""+u.version;for(var _ in h)if(h.hasOwnProperty(_)&&u[_]){if(typeof h[_]!="string")throw new Error("Browser version in the minVersion map should be a string: "+_+": "+String(h));return a([p,h[_]])<0}return c}function l(h,c,f){return!o(h,c,f)}return i.isUnsupportedBrowser=o,i.compareVersions=a,i.check=l,i._detect=r,i.detect=r,i})})(fr);var Jr=Qr,Jo=dn,eh=fr.exports,pn=vn,th=jr,rh=!!pn.createImageBitmap&&!eh.firefox,ih={imageOrientation:"flipY",premultiplyAlpha:"premultiply"};function ur(e){this._stage=e}ur.prototype.loadImage=function(e,t,r){var i=this,n=new Image;n.crossOrigin="anonymous";var s=t&&t.x||0,a=t&&t.y||0,o=t&&t.width||1,l=t&&t.height||1;r=th(r),n.onload=function(){i._handleLoad(n,s,a,o,l,r)},n.onerror=function(){i._handleError(e,r)},n.src=e;function h(){n.onload=n.onerror=null,n.src="",r.apply(null,arguments)}return h},ur.prototype._handleLoad=function(e,t,r,i,n,s){if(t===0&&r===0&&i===1&&n===1){s(null,new Jr(e));return}if(t*=e.naturalWidth,r*=e.naturalHeight,i*=e.naturalWidth,n*=e.naturalHeight,rh)pn.createImageBitmap(e,t,r,i,n,ih).then(function(l){s(null,new Jr(l))});else{var a=document.createElement("canvas");a.width=i,a.height=n;var o=a.getContext("2d");o.drawImage(e,t,r,i,n,0,0,i,n),s(null,new Jr(a))}},ur.prototype._handleError=function(e,t){t(new Jo("Network error: "+e))};var nh=ur,sh=1;function ah(){if(typeof window!="undefined"){if(window.devicePixelRatio)return window.devicePixelRatio;var e=window.screen;if(e&&e.deviceXDPI&&e.logicalXDPI)return e.deviceXDPI/e.logicalXDPI;if(e&&e.systemXDPI&&e.logicalXDPI)return e.systemXDPI/e.logicalXDPI}return sh}var dr=ah;function oh(e){return(e&e-1)==0}var hh=oh;function ei(e){for(var t=document.documentElement.style,r=["Moz","Webkit","Khtml","O","ms"],i=0;i<r.length;i++){var n=r[i],s=e[0].toUpperCase()+e.slice(1),a=n+s;if(a in t)return a}return e}function lh(e){var t=ei(e);return function(i){return i.style[t]}}function ti(e){var t=ei(e);return function(i,n){return i.style[t]=n}}var _n=ti("transform"),mn=ti("transformOrigin");function ch(e){_n(e,"translateZ(0)")}function vh(e){mn(e,"0 0 0")}function fh(e){e.style.position="absolute"}function uh(e,t,r){e.style.left=t+"px",e.style.top=r+"px"}function dh(e,t,r){e.style.width=t+"px",e.style.height=r+"px"}function ph(e){e.style.width=e.style.height=0}function _h(e){e.style.width=e.style.height="100%"}function mh(e){e.style.overflow="hidden"}function yh(e){e.style.overflow="visible"}function gh(e){e.style.pointerEvents="none"}var le={prefixProperty:ei,getWithVendorPrefix:lh,setWithVendorPrefix:ti,setTransform:_n,setTransformOrigin:mn,setNullTransform:ch,setNullTransformOrigin:vh,setAbsolute:fh,setPixelPosition:uh,setPixelSize:dh,setNullSize:ph,setFullSize:_h,setOverflowHidden:mh,setOverflowVisible:yh,setNoPointerEvents:gh},wh=Uo,xh=nh,Mh=fr.exports,Th=Me,Eh=dr,yn=hh,bh=le.setAbsolute,$h=le.setFullSize,Sh=G,Ch={videoUseTexImage2D:Mh.chrome};function Lh(e,t){var r={alpha:!0,premultipliedAlpha:!0,antialias:!!(t&&t.antialias),preserveDrawingBuffer:!!(t&&t.preserveDrawingBuffer)},i=e.getContext&&(e.getContext("webgl",r)||e.getContext("experimental-webgl",r));if(!i)throw new Error("Could not get WebGL context");return t.wrapContext&&(i=t.wrapContext(i)),i}function te(e){e=e||{};var t=this;this.constructor.super_.call(this,e),this._generateMipmaps=e.generateMipmaps!=null?e.generateMipmaps:!1,this._loader=new xh(this),this._domElement=document.createElement("canvas"),bh(this._domElement),$h(this._domElement),this._gl=Lh(this._domElement,e),this._handleContextLoss=function(){t.emit("webglcontextlost"),t._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=[]}Th(te,wh),te.prototype.destroy=function(){this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this.constructor.super_.prototype.destroy.call(this)},te.prototype.domElement=function(){return this._domElement},te.prototype.webGlContext=function(){return this._gl},te.prototype.setSizeForType=function(){var e=Eh();this._domElement.width=e*this._width,this._domElement.height=e*this._height},te.prototype.loadImage=function(e,t,r){return this._loader.loadImage(e,t,r)},te.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},te.prototype.validateLayer=function(e){var t=e.geometry().maxTileSize(),r=this.maxTextureSize();if(t>r)throw new Error("Layer has level with tile size larger than maximum texture size ("+t+" vs. "+r+")")},te.prototype.createRenderer=function(e){for(var t=this._rendererInstances,r=0;r<t.length;r++)if(t[r]instanceof e)return t[r];var i=new e(this._gl);return t.push(i),i},te.prototype.destroyRenderer=function(e){var t=this._rendererInstances;if(this._renderers.indexOf(e)<0){e.destroy();var r=t.indexOf(e);r>=0&&t.splice(r,1)}},te.prototype.startFrame=function(){var e=this._gl;if(!e)throw new Error("Bad WebGL context - maybe context was lost?");e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)},te.prototype.endFrame=function(){},te.prototype.takeSnapshot=function(e){(typeof e!="object"||e==null)&&(e={});var t=e.quality;if(typeof t=="undefined"&&(t=75),typeof t!="number"||t<0||t>100)throw new Error("WebGLStage: Snapshot quality needs to be a number between 0 and 100");return this.render(),this._domElement.toDataURL("image/jpeg",t/100)},te.type=te.prototype.type="webgl";function ri(e,t,r){this._stage=e,this._gl=e._gl,this._texture=null,this._timestamp=null,this._width=this._height=null,this.refresh(t,r)}ri.prototype.refresh=function(e,t){var r=this._gl,i=this._stage,n,s=t.timestamp();if(s!==this._timestamp){var a=t.element(),o=t.width(),l=t.height();if(o!==this._width||l!==this._height){var h=i.maxTextureSize();if(o>h)throw new Error("Texture width larger than max size ("+o+" vs. "+h+")");if(l>h)throw new Error("Texture height larger than max size ("+l+" vs. "+h+")");this._texture&&r.deleteTexture(n),n=this._texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,n),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a)}else n=this._texture,r.bindTexture(r.TEXTURE_2D,n),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a instanceof HTMLVideoElement&&Ch.videoUseTexImage2D?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a):r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,a);i._generateMipmaps&&yn(o)&&yn(l)?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),this._timestamp=s,this._width=o,this._height=l}},ri.prototype.destroy=function(){this._texture&&this._gl.deleteTexture(this._texture),Sh(this)},te.TextureClass=te.prototype.TextureClass=ri;var gn=te,L=1e-6,I=typeof Float32Array!="undefined"?Float32Array:Array,ge=Math.random;function Ph(e){I=e}var zh=Math.PI/180;function Ah(e){return e*zh}function Rh(e,t){return Math.abs(e-t)<=L*Math.max(1,Math.abs(e),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Ih=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",EPSILON:L,get ARRAY_TYPE(){return I},RANDOM:ge,setMatrixArrayType:Ph,toRadian:Ah,equals:Rh});function Oh(){var e=new I(4);return I!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function Dh(e){var t=new I(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Hh(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Nh(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function kh(e,t,r,i){var n=new I(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Fh(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function Vh(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function qh(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r*s-n*i;return a?(a=1/a,e[0]=s*a,e[1]=-i*a,e[2]=-n*a,e[3]=r*a,e):null}function Wh(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function Yh(e){return e[0]*e[3]-e[2]*e[1]}function wn(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],h=r[2],c=r[3];return e[0]=i*o+s*l,e[1]=n*o+a*l,e[2]=i*h+s*c,e[3]=n*h+a*c,e}function Xh(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*o,e[1]=n*l+a*o,e[2]=i*-o+s*l,e[3]=n*-o+a*l,e}function Bh(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1];return e[0]=i*o,e[1]=n*o,e[2]=s*l,e[3]=a*l,e}function Uh(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function Gh(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function jh(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Zh(e){return Math.hypot(e[0],e[1],e[2],e[3])}function Kh(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function Qh(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function xn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Jh(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function el(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(r-a)<=L*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=L*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-l)<=L*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-h)<=L*Math.max(1,Math.abs(s),Math.abs(h))}function tl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function rl(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}var il=wn,nl=xn,sl=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Oh,clone:Dh,copy:Hh,identity:Nh,fromValues:kh,set:Fh,transpose:Vh,invert:qh,adjoint:Wh,determinant:Yh,multiply:wn,rotate:Xh,scale:Bh,fromRotation:Uh,fromScaling:Gh,str:jh,frob:Zh,LDU:Kh,add:Qh,subtract:xn,exactEquals:Jh,equals:el,multiplyScalar:tl,multiplyScalarAndAdd:rl,mul:il,sub:nl});function al(){var e=new I(6);return I!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function ol(e){var t=new I(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function hl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function ll(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function cl(e,t,r,i,n,s){var a=new I(6);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=n,a[5]=s,a}function vl(e,t,r,i,n,s,a){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e}function fl(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=r*s-i*n;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*o-s*a)*l,e[5]=(i*a-r*o)*l,e):null}function ul(e){return e[0]*e[3]-e[1]*e[2]}function Mn(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=r[0],c=r[1],f=r[2],u=r[3],p=r[4],_=r[5];return e[0]=i*h+s*c,e[1]=n*h+a*c,e[2]=i*f+s*u,e[3]=n*f+a*u,e[4]=i*p+s*_+o,e[5]=n*p+a*_+l,e}function dl(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=Math.sin(r),c=Math.cos(r);return e[0]=i*c+s*h,e[1]=n*c+a*h,e[2]=i*-h+s*c,e[3]=n*-h+a*c,e[4]=o,e[5]=l,e}function pl(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=r[0],c=r[1];return e[0]=i*h,e[1]=n*h,e[2]=s*c,e[3]=a*c,e[4]=o,e[5]=l,e}function _l(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=r[0],c=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=i*h+s*c+o,e[5]=n*h+a*c+l,e}function ml(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function yl(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function gl(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function wl(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function xl(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function Ml(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function Tn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function Tl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function El(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function bl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function $l(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=t[0],h=t[1],c=t[2],f=t[3],u=t[4],p=t[5];return Math.abs(r-l)<=L*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-h)<=L*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-c)<=L*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-f)<=L*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-u)<=L*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-p)<=L*Math.max(1,Math.abs(o),Math.abs(p))}var Sl=Mn,Cl=Tn,Ll=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:al,clone:ol,copy:hl,identity:ll,fromValues:cl,set:vl,invert:fl,determinant:ul,multiply:Mn,rotate:dl,scale:pl,translate:_l,fromRotation:ml,fromScaling:yl,fromTranslation:gl,str:wl,frob:xl,add:Ml,subtract:Tn,multiplyScalar:Tl,multiplyScalarAndAdd:El,exactEquals:bl,equals:$l,mul:Sl,sub:Cl});function En(){var e=new I(9);return I!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Pl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function zl(e){var t=new I(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Al(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Rl(e,t,r,i,n,s,a,o,l){var h=new I(9);return h[0]=e,h[1]=t,h[2]=r,h[3]=i,h[4]=n,h[5]=s,h[6]=a,h[7]=o,h[8]=l,h}function Il(e,t,r,i,n,s,a,o,l,h){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=h,e}function Ol(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Dl(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Hl(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],f=c*a-o*h,u=-c*s+o*l,p=h*s-a*l,_=r*f+i*u+n*p;return _?(_=1/_,e[0]=f*_,e[1]=(-c*i+n*h)*_,e[2]=(o*i-n*a)*_,e[3]=u*_,e[4]=(c*r-n*l)*_,e[5]=(-o*r+n*s)*_,e[6]=p*_,e[7]=(-h*r+i*l)*_,e[8]=(a*r-i*s)*_,e):null}function Nl(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8];return e[0]=a*c-o*h,e[1]=n*h-i*c,e[2]=i*o-n*a,e[3]=o*l-s*c,e[4]=r*c-n*l,e[5]=n*s-r*o,e[6]=s*h-a*l,e[7]=i*l-r*h,e[8]=r*a-i*s,e}function kl(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8];return t*(h*s-a*l)+r*(-h*n+a*o)+i*(l*n-s*o)}function bn(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],f=t[8],u=r[0],p=r[1],_=r[2],w=r[3],m=r[4],M=r[5],b=r[6],$=r[7],S=r[8];return e[0]=u*i+p*a+_*h,e[1]=u*n+p*o+_*c,e[2]=u*s+p*l+_*f,e[3]=w*i+m*a+M*h,e[4]=w*n+m*o+M*c,e[5]=w*s+m*l+M*f,e[6]=b*i+$*a+S*h,e[7]=b*n+$*o+S*c,e[8]=b*s+$*l+S*f,e}function Fl(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],f=t[8],u=r[0],p=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=u*i+p*a+h,e[7]=u*n+p*o+c,e[8]=u*s+p*l+f,e}function Vl(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],f=t[8],u=Math.sin(r),p=Math.cos(r);return e[0]=p*i+u*a,e[1]=p*n+u*o,e[2]=p*s+u*l,e[3]=p*a-u*i,e[4]=p*o-u*n,e[5]=p*l-u*s,e[6]=h,e[7]=c,e[8]=f,e}function ql(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Wl(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Yl(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Xl(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Bl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Ul(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,l=n+n,h=r*a,c=i*a,f=i*o,u=n*a,p=n*o,_=n*l,w=s*a,m=s*o,M=s*l;return e[0]=1-f-_,e[3]=c-M,e[6]=u+m,e[1]=c+M,e[4]=1-h-_,e[7]=p-w,e[2]=u-m,e[5]=p+w,e[8]=1-h-f,e}function Gl(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],f=t[9],u=t[10],p=t[11],_=t[12],w=t[13],m=t[14],M=t[15],b=r*o-i*a,$=r*l-n*a,S=r*h-s*a,C=i*l-n*o,E=i*h-s*o,D=n*h-s*l,k=c*w-f*_,H=c*m-u*_,N=c*M-p*_,R=f*m-u*w,F=f*M-p*w,B=u*M-p*m,z=b*B-$*F+S*R+C*N-E*H+D*k;return z?(z=1/z,e[0]=(o*B-l*F+h*R)*z,e[1]=(l*N-a*B-h*H)*z,e[2]=(a*F-o*N+h*k)*z,e[3]=(n*F-i*B-s*R)*z,e[4]=(r*B-n*N+s*H)*z,e[5]=(i*N-r*F-s*k)*z,e[6]=(w*D-m*E+M*C)*z,e[7]=(m*S-_*D-M*$)*z,e[8]=(_*E-w*S+M*b)*z,e):null}function jl(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Zl(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Kl(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Ql(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function $n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function Jl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function ec(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function tc(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function rc(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],c=e[8],f=t[0],u=t[1],p=t[2],_=t[3],w=t[4],m=t[5],M=t[6],b=t[7],$=t[8];return Math.abs(r-f)<=L*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-u)<=L*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-p)<=L*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-_)<=L*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(a-w)<=L*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-m)<=L*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-M)<=L*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(h-b)<=L*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(c-$)<=L*Math.max(1,Math.abs(c),Math.abs($))}var ic=bn,nc=$n,sc=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:En,fromMat4:Pl,clone:zl,copy:Al,fromValues:Rl,set:Il,identity:Ol,transpose:Dl,invert:Hl,adjoint:Nl,determinant:kl,multiply:bn,translate:Fl,rotate:Vl,scale:ql,fromTranslation:Wl,fromRotation:Yl,fromScaling:Xl,fromMat2d:Bl,fromQuat:Ul,normalFromMat4:Gl,projection:jl,str:Zl,frob:Kl,add:Ql,subtract:$n,multiplyScalar:Jl,multiplyScalarAndAdd:ec,exactEquals:tc,equals:rc,mul:ic,sub:nc});function ac(){var e=new I(16);return I!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function oc(e){var t=new I(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function hc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function lc(e,t,r,i,n,s,a,o,l,h,c,f,u,p,_,w){var m=new I(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=i,m[4]=n,m[5]=s,m[6]=a,m[7]=o,m[8]=l,m[9]=h,m[10]=c,m[11]=f,m[12]=u,m[13]=p,m[14]=_,m[15]=w,m}function cc(e,t,r,i,n,s,a,o,l,h,c,f,u,p,_,w,m){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=h,e[9]=c,e[10]=f,e[11]=u,e[12]=p,e[13]=_,e[14]=w,e[15]=m,e}function Sn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vc(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function fc(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],f=t[9],u=t[10],p=t[11],_=t[12],w=t[13],m=t[14],M=t[15],b=r*o-i*a,$=r*l-n*a,S=r*h-s*a,C=i*l-n*o,E=i*h-s*o,D=n*h-s*l,k=c*w-f*_,H=c*m-u*_,N=c*M-p*_,R=f*m-u*w,F=f*M-p*w,B=u*M-p*m,z=b*B-$*F+S*R+C*N-E*H+D*k;return z?(z=1/z,e[0]=(o*B-l*F+h*R)*z,e[1]=(n*F-i*B-s*R)*z,e[2]=(w*D-m*E+M*C)*z,e[3]=(u*E-f*D-p*C)*z,e[4]=(l*N-a*B-h*H)*z,e[5]=(r*B-n*N+s*H)*z,e[6]=(m*S-_*D-M*$)*z,e[7]=(c*D-u*S+p*$)*z,e[8]=(a*F-o*N+h*k)*z,e[9]=(i*N-r*F-s*k)*z,e[10]=(_*E-w*S+M*b)*z,e[11]=(f*S-c*E-p*b)*z,e[12]=(o*H-a*R-l*k)*z,e[13]=(r*R-i*H+n*k)*z,e[14]=(w*$-_*C-m*b)*z,e[15]=(c*C-f*$+u*b)*z,e):null}function uc(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],f=t[9],u=t[10],p=t[11],_=t[12],w=t[13],m=t[14],M=t[15];return e[0]=o*(u*M-p*m)-f*(l*M-h*m)+w*(l*p-h*u),e[1]=-(i*(u*M-p*m)-f*(n*M-s*m)+w*(n*p-s*u)),e[2]=i*(l*M-h*m)-o*(n*M-s*m)+w*(n*h-s*l),e[3]=-(i*(l*p-h*u)-o*(n*p-s*u)+f*(n*h-s*l)),e[4]=-(a*(u*M-p*m)-c*(l*M-h*m)+_*(l*p-h*u)),e[5]=r*(u*M-p*m)-c*(n*M-s*m)+_*(n*p-s*u),e[6]=-(r*(l*M-h*m)-a*(n*M-s*m)+_*(n*h-s*l)),e[7]=r*(l*p-h*u)-a*(n*p-s*u)+c*(n*h-s*l),e[8]=a*(f*M-p*w)-c*(o*M-h*w)+_*(o*p-h*f),e[9]=-(r*(f*M-p*w)-c*(i*M-s*w)+_*(i*p-s*f)),e[10]=r*(o*M-h*w)-a*(i*M-s*w)+_*(i*h-s*o),e[11]=-(r*(o*p-h*f)-a*(i*p-s*f)+c*(i*h-s*o)),e[12]=-(a*(f*m-u*w)-c*(o*m-l*w)+_*(o*u-l*f)),e[13]=r*(f*m-u*w)-c*(i*m-n*w)+_*(i*u-n*f),e[14]=-(r*(o*m-l*w)-a*(i*m-n*w)+_*(i*l-n*o)),e[15]=r*(o*u-l*f)-a*(i*u-n*f)+c*(i*l-n*o),e}function dc(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=e[9],f=e[10],u=e[11],p=e[12],_=e[13],w=e[14],m=e[15],M=t*a-r*s,b=t*o-i*s,$=t*l-n*s,S=r*o-i*a,C=r*l-n*a,E=i*l-n*o,D=h*_-c*p,k=h*w-f*p,H=h*m-u*p,N=c*w-f*_,R=c*m-u*_,F=f*m-u*w;return M*F-b*R+$*N+S*H-C*k+E*D}function Cn(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],f=t[8],u=t[9],p=t[10],_=t[11],w=t[12],m=t[13],M=t[14],b=t[15],$=r[0],S=r[1],C=r[2],E=r[3];return e[0]=$*i+S*o+C*f+E*w,e[1]=$*n+S*l+C*u+E*m,e[2]=$*s+S*h+C*p+E*M,e[3]=$*a+S*c+C*_+E*b,$=r[4],S=r[5],C=r[6],E=r[7],e[4]=$*i+S*o+C*f+E*w,e[5]=$*n+S*l+C*u+E*m,e[6]=$*s+S*h+C*p+E*M,e[7]=$*a+S*c+C*_+E*b,$=r[8],S=r[9],C=r[10],E=r[11],e[8]=$*i+S*o+C*f+E*w,e[9]=$*n+S*l+C*u+E*m,e[10]=$*s+S*h+C*p+E*M,e[11]=$*a+S*c+C*_+E*b,$=r[12],S=r[13],C=r[14],E=r[15],e[12]=$*i+S*o+C*f+E*w,e[13]=$*n+S*l+C*u+E*m,e[14]=$*s+S*h+C*p+E*M,e[15]=$*a+S*c+C*_+E*b,e}function pc(e,t,r){var i=r[0],n=r[1],s=r[2],a,o,l,h,c,f,u,p,_,w,m,M;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*s+t[12],e[13]=t[1]*i+t[5]*n+t[9]*s+t[13],e[14]=t[2]*i+t[6]*n+t[10]*s+t[14],e[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(a=t[0],o=t[1],l=t[2],h=t[3],c=t[4],f=t[5],u=t[6],p=t[7],_=t[8],w=t[9],m=t[10],M=t[11],e[0]=a,e[1]=o,e[2]=l,e[3]=h,e[4]=c,e[5]=f,e[6]=u,e[7]=p,e[8]=_,e[9]=w,e[10]=m,e[11]=M,e[12]=a*i+c*n+_*s+t[12],e[13]=o*i+f*n+w*s+t[13],e[14]=l*i+u*n+m*s+t[14],e[15]=h*i+p*n+M*s+t[15]),e}function _c(e,t,r){var i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function mc(e,t,r,i){var n=i[0],s=i[1],a=i[2],o=Math.hypot(n,s,a),l,h,c,f,u,p,_,w,m,M,b,$,S,C,E,D,k,H,N,R,F,B,z,g;return o<L?null:(o=1/o,n*=o,s*=o,a*=o,l=Math.sin(r),h=Math.cos(r),c=1-h,f=t[0],u=t[1],p=t[2],_=t[3],w=t[4],m=t[5],M=t[6],b=t[7],$=t[8],S=t[9],C=t[10],E=t[11],D=n*n*c+h,k=s*n*c+a*l,H=a*n*c-s*l,N=n*s*c-a*l,R=s*s*c+h,F=a*s*c+n*l,B=n*a*c+s*l,z=s*a*c-n*l,g=a*a*c+h,e[0]=f*D+w*k+$*H,e[1]=u*D+m*k+S*H,e[2]=p*D+M*k+C*H,e[3]=_*D+b*k+E*H,e[4]=f*N+w*R+$*F,e[5]=u*N+m*R+S*F,e[6]=p*N+M*R+C*F,e[7]=_*N+b*R+E*F,e[8]=f*B+w*z+$*g,e[9]=u*B+m*z+S*g,e[10]=p*B+M*z+C*g,e[11]=_*B+b*z+E*g,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function yc(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],f=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+h*i,e[5]=a*n+c*i,e[6]=o*n+f*i,e[7]=l*n+u*i,e[8]=h*n-s*i,e[9]=c*n-a*i,e[10]=f*n-o*i,e[11]=u*n-l*i,e}function gc(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],h=t[8],c=t[9],f=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-h*i,e[1]=a*n-c*i,e[2]=o*n-f*i,e[3]=l*n-u*i,e[8]=s*i+h*n,e[9]=a*i+c*n,e[10]=o*i+f*n,e[11]=l*i+u*n,e}function wc(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],h=t[4],c=t[5],f=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+h*i,e[1]=a*n+c*i,e[2]=o*n+f*i,e[3]=l*n+u*i,e[4]=h*n-s*i,e[5]=c*n-a*i,e[6]=f*n-o*i,e[7]=u*n-l*i,e}function xc(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Mc(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tc(e,t,r){var i=r[0],n=r[1],s=r[2],a=Math.hypot(i,n,s),o,l,h;return a<L?null:(a=1/a,i*=a,n*=a,s*=a,o=Math.sin(t),l=Math.cos(t),h=1-l,e[0]=i*i*h+l,e[1]=n*i*h+s*o,e[2]=s*i*h-n*o,e[3]=0,e[4]=i*n*h-s*o,e[5]=n*n*h+l,e[6]=s*n*h+i*o,e[7]=0,e[8]=i*s*h+n*o,e[9]=n*s*h-i*o,e[10]=s*s*h+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Ec(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bc(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $c(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ln(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=i+i,l=n+n,h=s+s,c=i*o,f=i*l,u=i*h,p=n*l,_=n*h,w=s*h,m=a*o,M=a*l,b=a*h;return e[0]=1-(p+w),e[1]=f+b,e[2]=u-M,e[3]=0,e[4]=f-b,e[5]=1-(c+w),e[6]=_+m,e[7]=0,e[8]=u+M,e[9]=_-m,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Sc(e,t){var r=new I(3),i=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],f=i*i+n*n+s*s+a*a;return f>0?(r[0]=(o*a+c*i+l*s-h*n)*2/f,r[1]=(l*a+c*n+h*i-o*s)*2/f,r[2]=(h*a+c*s+o*n-l*i)*2/f):(r[0]=(o*a+c*i+l*s-h*n)*2,r[1]=(l*a+c*n+h*i-o*s)*2,r[2]=(h*a+c*s+o*n-l*i)*2),Ln(e,t,r),e}function Pn(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function zn(e,t){var r=t[0],i=t[1],n=t[2],s=t[4],a=t[5],o=t[6],l=t[8],h=t[9],c=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(s,a,o),e[2]=Math.hypot(l,h,c),e}function An(e,t){var r=new I(3);zn(r,t);var i=1/r[0],n=1/r[1],s=1/r[2],a=t[0]*i,o=t[1]*n,l=t[2]*s,h=t[4]*i,c=t[5]*n,f=t[6]*s,u=t[8]*i,p=t[9]*n,_=t[10]*s,w=a+c+_,m=0;return w>0?(m=Math.sqrt(w+1)*2,e[3]=.25*m,e[0]=(f-p)/m,e[1]=(u-l)/m,e[2]=(o-h)/m):a>c&&a>_?(m=Math.sqrt(1+a-c-_)*2,e[3]=(f-p)/m,e[0]=.25*m,e[1]=(o+h)/m,e[2]=(u+l)/m):c>_?(m=Math.sqrt(1+c-a-_)*2,e[3]=(u-l)/m,e[0]=(o+h)/m,e[1]=.25*m,e[2]=(f+p)/m):(m=Math.sqrt(1+_-a-c)*2,e[3]=(o-h)/m,e[0]=(u+l)/m,e[1]=(f+p)/m,e[2]=.25*m),e}function Cc(e,t,r,i){var n=t[0],s=t[1],a=t[2],o=t[3],l=n+n,h=s+s,c=a+a,f=n*l,u=n*h,p=n*c,_=s*h,w=s*c,m=a*c,M=o*l,b=o*h,$=o*c,S=i[0],C=i[1],E=i[2];return e[0]=(1-(_+m))*S,e[1]=(u+$)*S,e[2]=(p-b)*S,e[3]=0,e[4]=(u-$)*C,e[5]=(1-(f+m))*C,e[6]=(w+M)*C,e[7]=0,e[8]=(p+b)*E,e[9]=(w-M)*E,e[10]=(1-(f+_))*E,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Lc(e,t,r,i,n){var s=t[0],a=t[1],o=t[2],l=t[3],h=s+s,c=a+a,f=o+o,u=s*h,p=s*c,_=s*f,w=a*c,m=a*f,M=o*f,b=l*h,$=l*c,S=l*f,C=i[0],E=i[1],D=i[2],k=n[0],H=n[1],N=n[2],R=(1-(w+M))*C,F=(p+S)*C,B=(_-$)*C,z=(p-S)*E,g=(1-(u+M))*E,Ve=(m+b)*E,j=(_+$)*D,mt=(m-b)*D,Ce=(1-(u+w))*D;return e[0]=R,e[1]=F,e[2]=B,e[3]=0,e[4]=z,e[5]=g,e[6]=Ve,e[7]=0,e[8]=j,e[9]=mt,e[10]=Ce,e[11]=0,e[12]=r[0]+k-(R*k+z*H+j*N),e[13]=r[1]+H-(F*k+g*H+mt*N),e[14]=r[2]+N-(B*k+Ve*H+Ce*N),e[15]=1,e}function Pc(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,l=n+n,h=r*a,c=i*a,f=i*o,u=n*a,p=n*o,_=n*l,w=s*a,m=s*o,M=s*l;return e[0]=1-f-_,e[1]=c+M,e[2]=u-m,e[3]=0,e[4]=c-M,e[5]=1-h-_,e[6]=p+w,e[7]=0,e[8]=u+m,e[9]=p-w,e[10]=1-h-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zc(e,t,r,i,n,s,a){var o=1/(r-t),l=1/(n-i),h=1/(s-a);return e[0]=s*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*l,e[10]=(a+s)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*h,e[15]=0,e}function Ac(e,t,r,i,n){var s=1/Math.tan(t/2),a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(a=1/(i-n),e[10]=(n+i)*a,e[14]=2*n*i*a):(e[10]=-1,e[14]=-2*i),e}function Rc(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+o),h=2/(n+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((a-o)*l*.5),e[9]=(n-s)*h*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function Ic(e,t,r,i,n,s,a){var o=1/(t-r),l=1/(i-n),h=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(a+s)*h,e[15]=1,e}function Oc(e,t,r,i){var n,s,a,o,l,h,c,f,u,p,_=t[0],w=t[1],m=t[2],M=i[0],b=i[1],$=i[2],S=r[0],C=r[1],E=r[2];return Math.abs(_-S)<L&&Math.abs(w-C)<L&&Math.abs(m-E)<L?Sn(e):(c=_-S,f=w-C,u=m-E,p=1/Math.hypot(c,f,u),c*=p,f*=p,u*=p,n=b*u-$*f,s=$*c-M*u,a=M*f-b*c,p=Math.hypot(n,s,a),p?(p=1/p,n*=p,s*=p,a*=p):(n=0,s=0,a=0),o=f*a-u*s,l=u*n-c*a,h=c*s-f*n,p=Math.hypot(o,l,h),p?(p=1/p,o*=p,l*=p,h*=p):(o=0,l=0,h=0),e[0]=n,e[1]=o,e[2]=c,e[3]=0,e[4]=s,e[5]=l,e[6]=f,e[7]=0,e[8]=a,e[9]=h,e[10]=u,e[11]=0,e[12]=-(n*_+s*w+a*m),e[13]=-(o*_+l*w+h*m),e[14]=-(c*_+f*w+u*m),e[15]=1,e)}function Dc(e,t,r,i){var n=t[0],s=t[1],a=t[2],o=i[0],l=i[1],h=i[2],c=n-r[0],f=s-r[1],u=a-r[2],p=c*c+f*f+u*u;p>0&&(p=1/Math.sqrt(p),c*=p,f*=p,u*=p);var _=l*u-h*f,w=h*c-o*u,m=o*f-l*c;return p=_*_+w*w+m*m,p>0&&(p=1/Math.sqrt(p),_*=p,w*=p,m*=p),e[0]=_,e[1]=w,e[2]=m,e[3]=0,e[4]=f*m-u*w,e[5]=u*_-c*m,e[6]=c*w-f*_,e[7]=0,e[8]=c,e[9]=f,e[10]=u,e[11]=0,e[12]=n,e[13]=s,e[14]=a,e[15]=1,e}function Hc(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Nc(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function kc(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Rn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Fc(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function Vc(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function qc(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Wc(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],c=e[8],f=e[9],u=e[10],p=e[11],_=e[12],w=e[13],m=e[14],M=e[15],b=t[0],$=t[1],S=t[2],C=t[3],E=t[4],D=t[5],k=t[6],H=t[7],N=t[8],R=t[9],F=t[10],B=t[11],z=t[12],g=t[13],Ve=t[14],j=t[15];return Math.abs(r-b)<=L*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-$)<=L*Math.max(1,Math.abs(i),Math.abs($))&&Math.abs(n-S)<=L*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-C)<=L*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(a-E)<=L*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-D)<=L*Math.max(1,Math.abs(o),Math.abs(D))&&Math.abs(l-k)<=L*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(h-H)<=L*Math.max(1,Math.abs(h),Math.abs(H))&&Math.abs(c-N)<=L*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(f-R)<=L*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(u-F)<=L*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(p-B)<=L*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(_-z)<=L*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(w-g)<=L*Math.max(1,Math.abs(w),Math.abs(g))&&Math.abs(m-Ve)<=L*Math.max(1,Math.abs(m),Math.abs(Ve))&&Math.abs(M-j)<=L*Math.max(1,Math.abs(M),Math.abs(j))}var Yc=Cn,Xc=Rn,Bc=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:ac,clone:oc,copy:hc,fromValues:lc,set:cc,identity:Sn,transpose:vc,invert:fc,adjoint:uc,determinant:dc,multiply:Cn,translate:pc,scale:_c,rotate:mc,rotateX:yc,rotateY:gc,rotateZ:wc,fromTranslation:xc,fromScaling:Mc,fromRotation:Tc,fromXRotation:Ec,fromYRotation:bc,fromZRotation:$c,fromRotationTranslation:Ln,fromQuat2:Sc,getTranslation:Pn,getScaling:zn,getRotation:An,fromRotationTranslationScale:Cc,fromRotationTranslationScaleOrigin:Lc,fromQuat:Pc,frustum:zc,perspective:Ac,perspectiveFromFieldOfView:Rc,ortho:Ic,lookAt:Oc,targetTo:Dc,str:Hc,frob:Nc,add:kc,subtract:Rn,multiplyScalar:Fc,multiplyScalarAndAdd:Vc,exactEquals:qc,equals:Wc,mul:Yc,sub:Xc});function ii(){var e=new I(3);return I!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Uc(e){var t=new I(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function In(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function ni(e,t,r){var i=new I(3);return i[0]=e,i[1]=t,i[2]=r,i}function Gc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function jc(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function Zc(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function On(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Dn(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Hn(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Kc(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Qc(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Jc(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function ev(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function tv(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function rv(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function iv(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function Nn(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function kn(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function Fn(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function nv(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function sv(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Vn(e,t){var r=t[0],i=t[1],n=t[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function si(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function pr(e,t,r){var i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2];return e[0]=n*l-s*o,e[1]=s*a-i*l,e[2]=i*o-n*a,e}function av(e,t,r,i){var n=t[0],s=t[1],a=t[2];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e}function ov(e,t,r,i,n,s){var a=s*s,o=a*(2*s-3)+1,l=a*(s-2)+s,h=a*(s-1),c=a*(3-2*s);return e[0]=t[0]*o+r[0]*l+i[0]*h+n[0]*c,e[1]=t[1]*o+r[1]*l+i[1]*h+n[1]*c,e[2]=t[2]*o+r[2]*l+i[2]*h+n[2]*c,e}function hv(e,t,r,i,n,s){var a=1-s,o=a*a,l=s*s,h=o*a,c=3*s*o,f=3*l*a,u=l*s;return e[0]=t[0]*h+r[0]*c+i[0]*f+n[0]*u,e[1]=t[1]*h+r[1]*c+i[1]*f+n[1]*u,e[2]=t[2]*h+r[2]*c+i[2]*f+n[2]*u,e}function lv(e,t){t=t||1;var r=ge()*2*Math.PI,i=ge()*2-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function cv(e,t,r){var i=t[0],n=t[1],s=t[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];return a=a||1,e[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,e[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,e[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a,e}function vv(e,t,r){var i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function fv(e,t,r){var i=r[0],n=r[1],s=r[2],a=r[3],o=t[0],l=t[1],h=t[2],c=n*h-s*l,f=s*o-i*h,u=i*l-n*o,p=n*u-s*f,_=s*c-i*u,w=i*f-n*c,m=a*2;return c*=m,f*=m,u*=m,p*=2,_*=2,w*=2,e[0]=o+c+p,e[1]=l+f+_,e[2]=h+u+w,e}function uv(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function dv(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function pv(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function _v(e,t){var r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2],l=Math.sqrt(r*r+i*i+n*n),h=Math.sqrt(s*s+a*a+o*o),c=l*h,f=c&&si(e,t)/c;return Math.acos(Math.min(Math.max(f,-1),1))}function mv(e){return e[0]=0,e[1]=0,e[2]=0,e}function yv(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function gv(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function wv(e,t){var r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(r-s)<=L*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=L*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=L*Math.max(1,Math.abs(n),Math.abs(o))}var xv=On,Mv=Dn,Tv=Hn,Ev=Nn,bv=kn,qn=In,$v=Fn,Sv=function(){var e=ii();return function(t,r,i,n,s,a){var o,l;for(r||(r=3),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}(),Cv=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:ii,clone:Uc,length:In,fromValues:ni,copy:Gc,set:jc,add:Zc,subtract:On,multiply:Dn,divide:Hn,ceil:Kc,floor:Qc,min:Jc,max:ev,round:tv,scale:rv,scaleAndAdd:iv,distance:Nn,squaredDistance:kn,squaredLength:Fn,negate:nv,inverse:sv,normalize:Vn,dot:si,cross:pr,lerp:av,hermite:ov,bezier:hv,random:lv,transformMat4:cv,transformMat3:vv,transformQuat:fv,rotateX:uv,rotateY:dv,rotateZ:pv,angle:_v,zero:mv,str:yv,exactEquals:gv,equals:wv,sub:xv,mul:Mv,div:Tv,dist:Ev,sqrDist:bv,len:qn,sqrLen:$v,forEach:Sv});function Wn(){var e=new I(4);return I!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Yn(e){var t=new I(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Xn(e,t,r,i){var n=new I(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Bn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Un(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function Gn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function jn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Zn(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Kn(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Lv(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Pv(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function zv(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Av(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Rv(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Qn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Iv(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function Jn(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.hypot(r,i,n,s)}function es(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return r*r+i*i+n*n+s*s}function ai(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function oi(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function Ov(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Dv(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ts(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=s*a,e}function rs(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Hv(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],h=r[2]*i[3]-r[3]*i[2],c=t[0],f=t[1],u=t[2],p=t[3];return e[0]=f*h-u*l+p*o,e[1]=-(c*h)+u*a-p*s,e[2]=c*l-f*a+p*n,e[3]=-(c*o)+f*s-u*n,e}function is(e,t,r,i){var n=t[0],s=t[1],a=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e[3]=o+i*(r[3]-o),e}function Nv(e,t){t=t||1;var r,i,n,s,a,o;do r=ge()*2-1,i=ge()*2-1,a=r*r+i*i;while(a>=1);do n=ge()*2-1,s=ge()*2-1,o=n*n+s*s;while(o>=1);var l=Math.sqrt((1-a)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*n*l,e[3]=t*s*l,e}function kv(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,e}function Fv(e,t,r){var i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2],h=r[3],c=h*i+o*s-l*n,f=h*n+l*i-a*s,u=h*s+a*n-o*i,p=-a*i-o*n-l*s;return e[0]=c*h+p*-a+f*-l-u*-o,e[1]=f*h+p*-o+u*-a-c*-l,e[2]=u*h+p*-l+c*-o-f*-a,e[3]=t[3],e}function Vv(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function qv(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function ns(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function ss(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(r-a)<=L*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=L*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-l)<=L*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-h)<=L*Math.max(1,Math.abs(s),Math.abs(h))}var Wv=jn,Yv=Zn,Xv=Kn,Bv=Jn,Uv=es,Gv=ai,jv=oi,Zv=function(){var e=Wn();return function(t,r,i,n,s,a){var o,l;for(r||(r=4),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}(),Kv=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Wn,clone:Yn,fromValues:Xn,copy:Bn,set:Un,add:Gn,subtract:jn,multiply:Zn,divide:Kn,ceil:Lv,floor:Pv,min:zv,max:Av,round:Rv,scale:Qn,scaleAndAdd:Iv,distance:Jn,squaredDistance:es,length:ai,squaredLength:oi,negate:Ov,inverse:Dv,normalize:ts,dot:rs,cross:Hv,lerp:is,random:Nv,transformMat4:kv,transformQuat:Fv,zero:Vv,str:qv,exactEquals:ns,equals:ss,sub:Wv,mul:Yv,div:Xv,dist:Bv,sqrDist:Uv,len:Gv,sqrLen:jv,forEach:Zv});function _r(){var e=new I(4);return I!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Qv(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function as(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function Jv(e,t){var r=Math.acos(t[3])*2,i=Math.sin(r/2);return i>L?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function ef(e,t){var r=li(e,t);return Math.acos(2*r*r-1)}function os(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],h=r[2],c=r[3];return e[0]=i*c+a*o+n*h-s*l,e[1]=n*c+a*l+s*o-i*h,e[2]=s*c+a*h+i*l-n*o,e[3]=a*c-i*o-n*l-s*h,e}function hs(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*o,e[1]=n*l+s*o,e[2]=s*l-n*o,e[3]=a*l-i*o,e}function ls(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*o,e[1]=n*l+a*o,e[2]=s*l+i*o,e[3]=a*l-n*o,e}function cs(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*o,e[1]=n*l-i*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e}function tf(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function vs(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=Math.sqrt(r*r+i*i+n*n),o=Math.exp(s),l=a>0?o*Math.sin(a)/a:0;return e[0]=r*l,e[1]=i*l,e[2]=n*l,e[3]=o*Math.cos(a),e}function fs(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=Math.sqrt(r*r+i*i+n*n),o=a>0?Math.atan2(a,s)/a:0;return e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=.5*Math.log(r*r+i*i+n*n+s*s),e}function rf(e,t,r){return fs(e,t),ds(e,e,r),vs(e,e),e}function mr(e,t,r,i){var n=t[0],s=t[1],a=t[2],o=t[3],l=r[0],h=r[1],c=r[2],f=r[3],u,p,_,w,m;return p=n*l+s*h+a*c+o*f,p<0&&(p=-p,l=-l,h=-h,c=-c,f=-f),1-p>L?(u=Math.acos(p),_=Math.sin(u),w=Math.sin((1-i)*u)/_,m=Math.sin(i*u)/_):(w=1-i,m=i),e[0]=w*n+m*l,e[1]=w*s+m*h,e[2]=w*a+m*c,e[3]=w*o+m*f,e}function nf(e){var t=ge(),r=ge(),i=ge(),n=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=s*Math.sin(2*Math.PI*i),e[3]=s*Math.cos(2*Math.PI*i),e}function sf(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s,o=a?1/a:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=s*o,e}function af(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function us(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[s*3+s]-t[a*3+a]+1),e[n]=.5*i,i=.5/i,e[3]=(t[s*3+a]-t[a*3+s])*i,e[s]=(t[s*3+n]+t[n*3+s])*i,e[a]=(t[a*3+n]+t[n*3+a])*i}return e}function of(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var s=Math.sin(t),a=Math.cos(t),o=Math.sin(r),l=Math.cos(r),h=Math.sin(i),c=Math.cos(i);return e[0]=s*l*c-a*o*h,e[1]=a*o*c+s*l*h,e[2]=a*l*h-s*o*c,e[3]=a*l*c+s*o*h,e}function hf(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var lf=Yn,cf=Xn,hi=Bn,vf=Un,ff=Gn,uf=os,ds=Qn,li=rs,df=is,ci=ai,pf=ci,vi=oi,_f=vi,fi=ts,mf=ns,yf=ss,gf=function(){var e=ii(),t=ni(1,0,0),r=ni(0,1,0);return function(i,n,s){var a=si(n,s);return a<-.999999?(pr(e,t,n),qn(e)<1e-6&&pr(e,r,n),Vn(e,e),as(i,e,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(pr(e,n,s),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+a,fi(i,i))}}(),wf=function(){var e=_r(),t=_r();return function(r,i,n,s,a,o){return mr(e,i,a,o),mr(t,n,s,o),mr(r,e,t,2*o*(1-o)),r}}(),xf=function(){var e=En();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],fi(t,us(t,e))}}(),Mf=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:_r,identity:Qv,setAxisAngle:as,getAxisAngle:Jv,getAngle:ef,multiply:os,rotateX:hs,rotateY:ls,rotateZ:cs,calculateW:tf,exp:vs,ln:fs,pow:rf,slerp:mr,random:nf,invert:sf,conjugate:af,fromMat3:us,fromEuler:of,str:hf,clone:lf,fromValues:cf,copy:hi,set:vf,add:ff,mul:uf,scale:ds,dot:li,lerp:df,length:ci,len:pf,squaredLength:vi,sqrLen:_f,normalize:fi,exactEquals:mf,equals:yf,rotationTo:gf,sqlerp:wf,setAxes:xf});function Tf(){var e=new I(8);return I!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function Ef(e){var t=new I(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function bf(e,t,r,i,n,s,a,o){var l=new I(8);return l[0]=e,l[1]=t,l[2]=r,l[3]=i,l[4]=n,l[5]=s,l[6]=a,l[7]=o,l}function $f(e,t,r,i,n,s,a){var o=new I(8);o[0]=e,o[1]=t,o[2]=r,o[3]=i;var l=n*.5,h=s*.5,c=a*.5;return o[4]=l*i+h*r-c*t,o[5]=h*i+c*e-l*r,o[6]=c*i+l*t-h*e,o[7]=-l*e-h*t-c*r,o}function ps(e,t,r){var i=r[0]*.5,n=r[1]*.5,s=r[2]*.5,a=t[0],o=t[1],l=t[2],h=t[3];return e[0]=a,e[1]=o,e[2]=l,e[3]=h,e[4]=i*h+n*l-s*o,e[5]=n*h+s*a-i*l,e[6]=s*h+i*o-n*a,e[7]=-i*a-n*o-s*l,e}function Sf(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0]*.5,e[5]=t[1]*.5,e[6]=t[2]*.5,e[7]=0,e}function Cf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Lf(e,t){var r=_r();An(r,t);var i=new I(3);return Pn(i,t),ps(e,r,i),e}function _s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Pf(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function zf(e,t,r,i,n,s,a,o,l){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e}var Af=hi;function Rf(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var If=hi;function Of(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Df(e,t){var r=t[4],i=t[5],n=t[6],s=t[7],a=-t[0],o=-t[1],l=-t[2],h=t[3];return e[0]=(r*h+s*a+i*l-n*o)*2,e[1]=(i*h+s*o+n*a-r*l)*2,e[2]=(n*h+s*l+r*o-i*a)*2,e}function Hf(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=r[0]*.5,l=r[1]*.5,h=r[2]*.5,c=t[4],f=t[5],u=t[6],p=t[7];return e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=a*o+n*h-s*l+c,e[5]=a*l+s*o-i*h+f,e[6]=a*h+i*l-n*o+u,e[7]=-i*o-n*l-s*h+p,e}function Nf(e,t,r){var i=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],f=o*a+c*i+l*s-h*n,u=l*a+c*n+h*i-o*s,p=h*a+c*s+o*n-l*i,_=c*a-o*i-l*n-h*s;return hs(e,t,r),i=e[0],n=e[1],s=e[2],a=e[3],e[4]=f*a+_*i+u*s-p*n,e[5]=u*a+_*n+p*i-f*s,e[6]=p*a+_*s+f*n-u*i,e[7]=_*a-f*i-u*n-p*s,e}function kf(e,t,r){var i=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],f=o*a+c*i+l*s-h*n,u=l*a+c*n+h*i-o*s,p=h*a+c*s+o*n-l*i,_=c*a-o*i-l*n-h*s;return ls(e,t,r),i=e[0],n=e[1],s=e[2],a=e[3],e[4]=f*a+_*i+u*s-p*n,e[5]=u*a+_*n+p*i-f*s,e[6]=p*a+_*s+f*n-u*i,e[7]=_*a-f*i-u*n-p*s,e}function Ff(e,t,r){var i=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],f=o*a+c*i+l*s-h*n,u=l*a+c*n+h*i-o*s,p=h*a+c*s+o*n-l*i,_=c*a-o*i-l*n-h*s;return cs(e,t,r),i=e[0],n=e[1],s=e[2],a=e[3],e[4]=f*a+_*i+u*s-p*n,e[5]=u*a+_*n+p*i-f*s,e[6]=p*a+_*s+f*n-u*i,e[7]=_*a-f*i-u*n-p*s,e}function Vf(e,t,r){var i=r[0],n=r[1],s=r[2],a=r[3],o=t[0],l=t[1],h=t[2],c=t[3];return e[0]=o*a+c*i+l*s-h*n,e[1]=l*a+c*n+h*i-o*s,e[2]=h*a+c*s+o*n-l*i,e[3]=c*a-o*i-l*n-h*s,o=t[4],l=t[5],h=t[6],c=t[7],e[4]=o*a+c*i+l*s-h*n,e[5]=l*a+c*n+h*i-o*s,e[6]=h*a+c*s+o*n-l*i,e[7]=c*a-o*i-l*n-h*s,e}function qf(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],h=r[2],c=r[3];return e[0]=i*c+a*o+n*h-s*l,e[1]=n*c+a*l+s*o-i*h,e[2]=s*c+a*h+i*l-n*o,e[3]=a*c-i*o-n*l-s*h,o=r[4],l=r[5],h=r[6],c=r[7],e[4]=i*c+a*o+n*h-s*l,e[5]=n*c+a*l+s*o-i*h,e[6]=s*c+a*h+i*l-n*o,e[7]=a*c-i*o-n*l-s*h,e}function Wf(e,t,r,i){if(Math.abs(i)<L)return _s(e,t);var n=Math.hypot(r[0],r[1],r[2]);i=i*.5;var s=Math.sin(i),a=s*r[0]/n,o=s*r[1]/n,l=s*r[2]/n,h=Math.cos(i),c=t[0],f=t[1],u=t[2],p=t[3];e[0]=c*h+p*a+f*l-u*o,e[1]=f*h+p*o+u*a-c*l,e[2]=u*h+p*l+c*o-f*a,e[3]=p*h-c*a-f*o-u*l;var _=t[4],w=t[5],m=t[6],M=t[7];return e[4]=_*h+M*a+w*l-m*o,e[5]=w*h+M*o+m*a-_*l,e[6]=m*h+M*l+_*o-w*a,e[7]=M*h-_*a-w*o-m*l,e}function Yf(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e}function ms(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=r[4],l=r[5],h=r[6],c=r[7],f=t[4],u=t[5],p=t[6],_=t[7],w=r[0],m=r[1],M=r[2],b=r[3];return e[0]=i*b+a*w+n*M-s*m,e[1]=n*b+a*m+s*w-i*M,e[2]=s*b+a*M+i*m-n*w,e[3]=a*b-i*w-n*m-s*M,e[4]=i*c+a*o+n*h-s*l+f*b+_*w+u*M-p*m,e[5]=n*c+a*l+s*o-i*h+u*b+_*m+p*w-f*M,e[6]=s*c+a*h+i*l-n*o+p*b+_*M+f*m-u*w,e[7]=a*c-i*o-n*l-s*h+_*b-f*w-u*m-p*M,e}var Xf=ms;function Bf(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e}var ys=li;function Uf(e,t,r,i){var n=1-i;return ys(t,r)<0&&(i=-i),e[0]=t[0]*n+r[0]*i,e[1]=t[1]*n+r[1]*i,e[2]=t[2]*n+r[2]*i,e[3]=t[3]*n+r[3]*i,e[4]=t[4]*n+r[4]*i,e[5]=t[5]*n+r[5]*i,e[6]=t[6]*n+r[6]*i,e[7]=t[7]*n+r[7]*i,e}function Gf(e,t){var r=yr(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e}function jf(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var gs=ci,Zf=gs,yr=vi,Kf=yr;function Qf(e,t){var r=yr(t);if(r>0){r=Math.sqrt(r);var i=t[0]/r,n=t[1]/r,s=t[2]/r,a=t[3]/r,o=t[4],l=t[5],h=t[6],c=t[7],f=i*o+n*l+s*h+a*c;e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=(o-i*f)/r,e[5]=(l-n*f)/r,e[6]=(h-s*f)/r,e[7]=(c-a*f)/r}return e}function Jf(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function eu(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function tu(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],c=t[0],f=t[1],u=t[2],p=t[3],_=t[4],w=t[5],m=t[6],M=t[7];return Math.abs(r-c)<=L*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-f)<=L*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-u)<=L*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-p)<=L*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-_)<=L*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-w)<=L*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(l-m)<=L*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-M)<=L*Math.max(1,Math.abs(h),Math.abs(M))}var ru=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Tf,clone:Ef,fromValues:bf,fromRotationTranslationValues:$f,fromRotationTranslation:ps,fromTranslation:Sf,fromRotation:Cf,fromMat4:Lf,copy:_s,identity:Pf,set:zf,getReal:Af,getDual:Rf,setReal:If,setDual:Of,getTranslation:Df,translate:Hf,rotateX:Nf,rotateY:kf,rotateZ:Ff,rotateByQuatAppend:Vf,rotateByQuatPrepend:qf,rotateAroundAxis:Wf,add:Yf,multiply:ms,mul:Xf,scale:Bf,dot:ys,lerp:Uf,invert:Gf,conjugate:jf,length:gs,len:Zf,squaredLength:yr,sqrLen:Kf,normalize:Qf,str:Jf,exactEquals:eu,equals:tu});function ws(){var e=new I(2);return I!=Float32Array&&(e[0]=0,e[1]=0),e}function iu(e){var t=new I(2);return t[0]=e[0],t[1]=e[1],t}function nu(e,t){var r=new I(2);return r[0]=e,r[1]=t,r}function su(e,t){return e[0]=t[0],e[1]=t[1],e}function au(e,t,r){return e[0]=t,e[1]=r,e}function ou(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function xs(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Ms(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function Ts(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function hu(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function lu(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function cu(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function vu(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function fu(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function uu(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function du(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function Es(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.hypot(r,i)}function bs(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function $s(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function Ss(e){var t=e[0],r=e[1];return t*t+r*r}function pu(e,t){return e[0]=-t[0],e[1]=-t[1],e}function _u(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function mu(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function yu(e,t){return e[0]*t[0]+e[1]*t[1]}function gu(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function wu(e,t,r,i){var n=t[0],s=t[1];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e}function xu(e,t){t=t||1;var r=ge()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Mu(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function Tu(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function Eu(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function bu(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function $u(e,t,r,i){var n=t[0]-r[0],s=t[1]-r[1],a=Math.sin(i),o=Math.cos(i);return e[0]=n*o-s*a+r[0],e[1]=n*a+s*o+r[1],e}function Su(e,t){var r=e[0],i=e[1],n=t[0],s=t[1],a=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+s*s),o=a&&(r*n+i*s)/a;return Math.acos(Math.min(Math.max(o,-1),1))}function Cu(e){return e[0]=0,e[1]=0,e}function Lu(e){return"vec2("+e[0]+", "+e[1]+")"}function Pu(e,t){return e[0]===t[0]&&e[1]===t[1]}function zu(e,t){var r=e[0],i=e[1],n=t[0],s=t[1];return Math.abs(r-n)<=L*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=L*Math.max(1,Math.abs(i),Math.abs(s))}var Au=$s,Ru=xs,Iu=Ms,Ou=Ts,Du=Es,Hu=bs,Nu=Ss,ku=function(){var e=ws();return function(t,r,i,n,s,a){var o,l;for(r||(r=2),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],s(e,e,a),t[o]=e[0],t[o+1]=e[1];return t}}(),Fu=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:ws,clone:iu,fromValues:nu,copy:su,set:au,add:ou,subtract:xs,multiply:Ms,divide:Ts,ceil:hu,floor:lu,min:cu,max:vu,round:fu,scale:uu,scaleAndAdd:du,distance:Es,squaredDistance:bs,length:$s,squaredLength:Ss,negate:pu,inverse:_u,normalize:mu,dot:yu,cross:gu,lerp:wu,random:xu,transformMat2:Mu,transformMat2d:Tu,transformMat3:Eu,transformMat4:bu,rotate:$u,angle:Su,zero:Cu,str:Lu,exactEquals:Pu,equals:zu,len:Au,sub:Ru,mul:Iu,div:Ou,dist:Du,sqrDist:Hu,sqrLen:Nu,forEach:ku}),Vu=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",glMatrix:Ih,mat2:sl,mat2d:Ll,mat3:sc,mat4:Bc,quat:Mf,quat2:ru,vec2:Fu,vec3:Cv,vec4:Kv}),ne=So(Vu);function qu(e,t,r){return Math.min(Math.max(e,t),r)}var Et=qu,Wu=256,Cs=256,gr=Et,Yu=ne.vec4,wr=ne.vec3,bt=ne.mat4;function Ls(e,t,r){var i=e.createShader(t);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw e.getShaderInfoLog(i);return i}function Xu(e,t,r,i,n){var s=Ls(e,e.VERTEX_SHADER,t),a=Ls(e,e.FRAGMENT_SHADER,r),o=e.createProgram();if(e.attachShader(o,s),e.attachShader(o,a),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw e.getProgramInfoLog(o);for(var l=0;l<i.length;l++){var h=i[l];if(o[h]=e.getAttribLocation(o,h),o[h]===-1)throw new Error("Shader program has no "+h+" attribute")}for(var c=0;c<n.length;c++){var f=n[c];if(o[f]=e.getUniformLocation(o,f),o[f]===-1)throw new Error("Shader program has no "+f+" uniform")}return o}function Bu(e,t){for(var r=e.getAttachedShaders(t),i=0;i<r.length;i++){var n=r[i];e.detachShader(t,n),e.deleteShader(n)}e.deleteProgram(t)}function ui(e,t,r,i){var n=e.createBuffer();return e.bindBuffer(t,n),e.bufferData(t,i,r),n}function Uu(e,t,r,i){return{vertexIndices:ui(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW,new Uint16Array(t)),vertexPositions:ui(e,e.ARRAY_BUFFER,e.STATIC_DRAW,new Float32Array(r)),textureCoords:ui(e,e.ARRAY_BUFFER,e.STATIC_DRAW,new Float32Array(i))}}function Gu(e,t){e.deleteBuffer(t.vertexIndices),e.deleteBuffer(t.vertexPositions),e.deleteBuffer(t.textureCoords)}function ju(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++)e.enableVertexAttribArray(i)}function Zu(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++)e.disableVertexAttribArray(i)}function Ku(e,t,r){e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r._texture),e.uniform1i(t.uSampler,0)}function Qu(e,t,r,i){var n=((r+1)*Cs-i)/(Cs*Wu);e.uniform1f(t.uDepth,n)}var Ju=1,ed=Yu.create(),Ps=bt.create();bt.identity(Ps);function td(e,t,r){var i=Ju;t&&t.opacity!=null&&(i=t.opacity),e.uniform1f(r.opacity,i);var n=ed;t&&t.colorOffset&&(n=t.colorOffset),e.uniform4fv(r.colorOffset,n);var s=Ps;t&&t.colorMatrix&&(s=t.colorMatrix),e.uniformMatrix4fv(r.colorMatrix,!1,s)}var zs=wr.create(),As=wr.create();function rd(e,t,r,i){if(r.x===0&&r.width===1&&r.y===0&&r.height===1){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),bt.identity(i);return}var n=r.x,s=gr(n,0,1),a=s-n,o=1-s,l=gr(r.width-a,0,o),h=r.width-l,c=1-r.height-r.y,f=gr(c,0,1),u=f-c,p=1-f,_=gr(r.height-u,0,p),w=r.height-_;wr.set(As,r.width/l,r.height/_,1),wr.set(zs,(h-a)/l,(w-u)/_,0),bt.identity(i),bt.translate(i,i,zs),bt.scale(i,i,As),e.viewport(e.drawingBufferWidth*s,e.drawingBufferHeight*f,e.drawingBufferWidth*l,e.drawingBufferHeight*_)}var Rs={createShaderProgram:Xu,destroyShaderProgram:Bu,createConstantBuffers:Uu,destroyConstantBuffers:Gu,enableAttributes:ju,disableAttributes:Zu,setTexture:Ku,setDepth:Qu,setViewport:rd,setupPixelEffectUniforms:td},id=["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uProjMatrix;","varying vec2 vTextureCoord;","void main(void) {","  gl_Position = uViewportMatrix * uProjMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);","  gl_Position.z = uDepth * gl_Position.w;","  vTextureCoord = aTextureCoord;","}"].join(`
`),nd=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec2 vTextureCoord;","void main(void) {","  vec4 color = texture2D(uSampler, vTextureCoord) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join(`
`),at=ne.mat4,Is=ne.vec3,sd=G,Te=Rs,ad=Te.createConstantBuffers,od=Te.destroyConstantBuffers,hd=Te.createShaderProgram,ld=Te.destroyShaderProgram,cd=Te.enableAttributes,vd=Te.disableAttributes,fd=Te.setViewport,ud=Te.setupPixelEffectUniforms,dd=Te.setDepth,pd=Te.setTexture,_d=id,md=nd,Os=[0,1,2,0,2,3],yd=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],gd=[0,0,1,0,1,1,0,1],wd=["aVertexPosition","aTextureCoord"],xd=["uDepth","uOpacity","uSampler","uProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix"];function Dt(e){this.gl=e,this.projMatrix=at.create(),this.viewportMatrix=at.create(),this.translateVector=Is.create(),this.scaleVector=Is.create(),this.constantBuffers=ad(e,Os,yd,gd),this.shaderProgram=hd(e,_d,md,wd,xd)}Dt.prototype.destroy=function(){od(this.gl,this.constantBuffers),ld(this.gl,this.shaderProgram),sd(this)},Dt.prototype.startLayer=function(e,t){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,s=this.viewportMatrix;r.useProgram(i),cd(r,i),fd(r,e,t,s),r.uniformMatrix4fv(i.uViewportMatrix,!1,s),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),r.vertexAttribPointer(i.aTextureCoord,2,r.FLOAT,r.FALSE,0,0),ud(r,e.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},Dt.prototype.endLayer=function(e,t){var r=this.gl,i=this.shaderProgram;vd(r,i)},Dt.prototype.renderTile=function(e,t,r,i){var n=this.gl,s=this.shaderProgram,a=this.constantBuffers,o=this.projMatrix,l=this.translateVector,h=this.scaleVector;l[0]=e.centerX(),l[1]=e.centerY(),l[2]=-.5,h[0]=e.scaleX(),h[1]=e.scaleY(),h[2]=1,at.copy(o,r.view().projection()),at.rotateX(o,o,e.rotX()),at.rotateY(o,o,e.rotY()),at.translate(o,o,l),at.scale(o,o,h),n.uniformMatrix4fv(s.uProjMatrix,!1,o),dd(n,s,i,e.z),pd(n,s,t),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a.vertexIndices),n.drawElements(n.TRIANGLES,Os.length,n.UNSIGNED_SHORT,0)};var Ds=Dt,Md=Ds,Td=Me;function Hs(){this.constructor.super_.apply(this,arguments)}Td(Hs,Md);var Ns=Hs,Ed=Ds,bd=Me;function ks(){this.constructor.super_.apply(this,arguments)}bd(ks,Ed);var Fs=ks,$d=["attribute vec3 aVertexPosition;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uInvProjMatrix;","varying vec4 vRay;","void main(void) {","  vRay = uInvProjMatrix * vec4(aVertexPosition.xy, 1.0, 1.0);","  gl_Position = uViewportMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);","}"].join(`
`),Sd=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform float uTextureX;","uniform float uTextureY;","uniform float uTextureWidth;","uniform float uTextureHeight;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec4 vRay;","const float PI = 3.14159265358979323846264;","void main(void) {","  float r = inversesqrt(vRay.x * vRay.x + vRay.y * vRay.y + vRay.z * vRay.z);","  float phi  = acos(vRay.y * r);","  float theta = atan(vRay.x, -1.0*vRay.z);","  float s = 0.5 + 0.5 * theta / PI;","  float t = 1.0 - phi / PI;","  s = s * uTextureWidth + uTextureX;","  t = t * uTextureHeight + uTextureY;","  vec4 color = texture2D(uSampler, vec2(s, t)) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join(`
`),xr=ne.mat4,Cd=G,Ee=Rs,Ld=Ee.createConstantBuffers,Pd=Ee.destroyConstantBuffers,zd=Ee.createShaderProgram,Ad=Ee.destroyShaderProgram,Rd=Ee.enableAttributes,Id=Ee.disableAttributes,Od=Ee.setViewport,Dd=Ee.setupPixelEffectUniforms,Hd=Ee.setDepth,Nd=Ee.setTexture,kd=$d,Fd=Sd,Vs=[0,1,2,0,2,3],Vd=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],qd=[0,0,1,0,1,1,0,1],Wd=["aVertexPosition"],Yd=["uDepth","uOpacity","uSampler","uInvProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix","uTextureX","uTextureY","uTextureWidth","uTextureHeight"];function Ht(e){this.gl=e,this.invProjMatrix=xr.create(),this.viewportMatrix=xr.create(),this.constantBuffers=Ld(e,Vs,Vd,qd),this.shaderProgram=zd(e,kd,Fd,Wd,Yd)}Ht.prototype.destroy=function(){Pd(this.gl,this.constantBuffers),Ad(this.gl,this.shaderProgram),Cd(this)},Ht.prototype.startLayer=function(e,t){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,s=this.invProjMatrix,a=this.viewportMatrix;r.useProgram(i),Rd(r,i),Od(r,e,t,a),r.uniformMatrix4fv(i.uViewportMatrix,!1,a),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),xr.copy(s,e.view().projection()),xr.invert(s,s),r.uniformMatrix4fv(i.uInvProjMatrix,!1,s);var o=e.effects().textureCrop||{},l=o.x!=null?o.x:0,h=o.y!=null?o.y:0,c=o.width!=null?o.width:1,f=o.height!=null?o.height:1;r.uniform1f(i.uTextureX,l),r.uniform1f(i.uTextureY,h),r.uniform1f(i.uTextureWidth,c),r.uniform1f(i.uTextureHeight,f),Dd(r,e.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},Ht.prototype.endLayer=function(e,t){var r=this.gl,i=this.shaderProgram;Id(r,i)},Ht.prototype.renderTile=function(e,t,r,i){var n=this.gl,s=this.shaderProgram,a=this.constantBuffers;Hd(n,s,i,e.z),Nd(n,s,t),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a.vertexIndices),n.drawElements(n.TRIANGLES,Vs.length,n.UNSIGNED_SHORT,0)};var qs=Ht,Xd=Ns,Bd=Fs,Ud=qs;function Gd(e){switch(e.type){case"webgl":e.registerRenderer("flat","flat",Bd),e.registerRenderer("cube","rectilinear",Xd),e.registerRenderer("equirect","rectilinear",Ud);break;default:throw new Error("Unknown stage type: "+e.type)}}var Ws=Gd;function jd(){for(var e=0,t=0;t<arguments.length;t++){var r=arguments[t];e+=r,e+=r<<10,e^=r>>6}return e+=e<<3,e^=e>>11,e+=e<<15,e>=0?e:-e}var Mr=jd;function Zd(e,t){return(+e%(t=+t)+t)%t}var Ue=Zd,di=Ue,Kd=64;function ot(e){if(e!=null&&(!isFinite(e)||Math.floor(e)!==e||e<1))throw new Error("Set: invalid capacity");this._capacity=this._capacity||Kd,this._buckets=[];for(var t=0;t<this._capacity;t++)this._buckets.push([]);this._size=0}ot.prototype.add=function(e){for(var t=di(e.hash(),this._capacity),r=this._buckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n))return r[i]=e,n}return r.push(e),this._size++,null},ot.prototype.remove=function(e){for(var t=di(e.hash(),this._capacity),r=this._buckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n)){for(var s=i;s<r.length-1;s++)r[s]=r[s+1];return r.length=r.length-1,this._size--,n}}return null},ot.prototype.has=function(e){for(var t=di(e.hash(),this._capacity),r=this._buckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n))return!0}return!1},ot.prototype.size=function(){return this._size},ot.prototype.clear=function(){for(var e=0;e<this._capacity;e++)this._buckets[e].length=0;this._size=0},ot.prototype.forEach=function(e){for(var t=0,r=0;r<this._capacity;r++)for(var i=this._buckets[r],n=0;n<i.length;n++)e(i[n]),t+=1;return t};var Ys=ot,Qd=Ys;function pi(){this._stack=[],this._visited=new Qd,this._vertices=null}pi.prototype.search=function(e,t,r){var i=this._stack,n=this._visited,s=this._vertices,a=0;for(this._clear(),i.push(t);i.length>0;){var o=i.pop();if(!n.has(o)&&!!e.intersects(o.vertices(s))){n.add(o);for(var l=o.neighbors(),h=0;h<l.length;h++)i.push(l[h]);r.push(o),a++}}return this._vertices=s,this._clear(),a},pi.prototype._clear=function(){this._stack.length=0,this._visited.clear()};var Xs=pi,Jd=Ue;function Ie(e){if(!isFinite(e)||Math.floor(e)!==e||e<0)throw new Error("LruMap: invalid capacity");this._capacity=e,this._keys=new Array(this._capacity),this._values=new Array(this._capacity),this._start=0,this._size=0}Ie.prototype._index=function(e){return Jd(this._start+e,this._capacity)},Ie.prototype.get=function(e){for(var t=0;t<this._size;t++){var r=this._keys[this._index(t)];if(e.equals(r))return this._values[this._index(t)]}return null},Ie.prototype.set=function(e,t){if(this._capacity===0)return e;this.del(e);var r=this._size===this._capacity?this._keys[this._index(0)]:null;return this._keys[this._index(this._size)]=e,this._values[this._index(this._size)]=t,this._size<this._capacity?this._size++:this._start=this._index(1),r},Ie.prototype.del=function(e){for(var t=0;t<this._size;t++)if(e.equals(this._keys[this._index(t)])){for(var r=this._values[this._index(t)],i=t;i<this._size-1;i++)this._keys[this._index(i)]=this._keys[this._index(i+1)],this._values[this._index(i)]=this._values[this._index(i+1)];return this._size--,r}return null},Ie.prototype.has=function(e){for(var t=0;t<this._size;t++)if(e.equals(this._keys[this._index(t)]))return!0;return!1},Ie.prototype.size=function(){return this._size},Ie.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._start=0,this._size=0},Ie.prototype.forEach=function(e){for(var t=0,r=0;r<this._size;r++)e(this._keys[this._index(r)],this._values[this._index(r)]),t+=1;return t};var Bs=Ie;function Tr(e){this._fallbackOnly=!!e.fallbackOnly}Tr.prototype.numHorizontalTiles=function(){return Math.ceil(this.width()/this.tileWidth())},Tr.prototype.numVerticalTiles=function(){return Math.ceil(this.height()/this.tileHeight())},Tr.prototype.fallbackOnly=function(){return this._fallbackOnly};var _i=Tr;function ep(e,t){return e<t?-1:e>t?1:0}var Nt=ep,tp=Nt;function rp(e,t){for(var r=[],i=0;i<e.length;i++)r.push(new t(e[i]));return r.sort(function(n,s){return tp(n.width(),s.width())}),r}function ip(e){for(var t=[],r=0;r<e.length;r++)e[r]._fallbackOnly||t.push(e[r]);if(!t.length)throw new Error("No selectable levels in list");return t}var kt={makeLevelList:rp,makeSelectableLevelList:ip};function np(e){var t=typeof e;if(t==="object"){if(e===null)return"null";if(Object.prototype.toString.call(e)==="[object Array]")return"array";if(Object.prototype.toString.call(e)==="[object RegExp]")return"regexp"}return t}var Ft=np,sp=Me,ap=Mr,op=Xs,hp=Bs,lp=_i,cp=kt.makeLevelList,vp=kt.makeSelectableLevelList,Er=Et,br=Nt,fp=Ft,oe=ne.vec3,mi=ne.vec4,up=64,ht="fudlrb",lt={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},yi=oe.create();function Vt(e,t,r,i){t&&oe.rotateZ(e,e,yi,t),r&&oe.rotateX(e,e,yi,r),i&&oe.rotateY(e,e,yi,i)}for(var gi={},wi=0;wi<ht.length;wi++){var Us=ht[wi],Gs=lt[Us],js=oe.fromValues(0,0,-1);Vt(js,0,Gs.x,Gs.y),gi[Us]=js}var $r={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},xi=[[0,1],[1,0],[0,-1],[-1,0]];function K(e,t,r,i,n){this.face=e,this.x=t,this.y=r,this.z=i,this._geometry=n,this._level=n.levelList[i]}K.prototype.rotX=function(){return lt[this.face].x},K.prototype.rotY=function(){return lt[this.face].y},K.prototype.centerX=function(){return(this.x+.5)/this._level.numHorizontalTiles()-.5},K.prototype.centerY=function(){return .5-(this.y+.5)/this._level.numVerticalTiles()},K.prototype.scaleX=function(){return 1/this._level.numHorizontalTiles()},K.prototype.scaleY=function(){return 1/this._level.numVerticalTiles()},K.prototype.vertices=function(e){e||(e=[oe.create(),oe.create(),oe.create(),oe.create()]);var t=lt[this.face];function r(o,l,h){oe.set(o,l,h,-.5),Vt(o,0,t.x,t.y)}var i=this.centerX()-this.scaleX()/2,n=this.centerX()+this.scaleX()/2,s=this.centerY()-this.scaleY()/2,a=this.centerY()+this.scaleY()/2;return r(e[0],i,a),r(e[1],n,a),r(e[2],n,s),r(e[3],i,s),e},K.prototype.parent=function(){if(this.z===0)return null;var e=this.face,t=this.z,r=this.x,i=this.y,n=this._geometry,s=n.levelList[t],a=n.levelList[t-1],o=Math.floor(r/s.numHorizontalTiles()*a.numHorizontalTiles()),l=Math.floor(i/s.numVerticalTiles()*a.numVerticalTiles()),h=t-1;return new K(e,o,l,h,n)},K.prototype.children=function(e){if(this.z===this._geometry.levelList.length-1)return null;var t=this.face,r=this.z,i=this.x,n=this.y,s=this._geometry,a=s.levelList[r],o=s.levelList[r+1],l=o.numHorizontalTiles()/a.numHorizontalTiles(),h=o.numVerticalTiles()/a.numVerticalTiles();e=e||[];for(var c=0;c<l;c++)for(var f=0;f<h;f++){var u=l*i+c,p=h*n+f,_=r+1;e.push(new K(t,u,p,_,s))}return e},K.prototype.neighbors=function(){var e=this._geometry,t=e._neighborsCache,r=t.get(this);if(r)return r;for(var i=e._vec,n=this.face,s=this.x,a=this.y,o=this.z,l=this._level,h=l.numHorizontalTiles(),c=l.numVerticalTiles(),f=[],u=0;u<xi.length;u++){var p=xi[u][0],_=xi[u][1],w=s+p,m=a+_,M=o,b=n;if(w<0||w>=h||m<0||m>=c){var $=this.centerX(),S=this.centerY();w<0?(oe.set(i,-.5,S,-.5),b=$r[n][0]):w>=h?(oe.set(i,.5,S,-.5),b=$r[n][1]):m<0?(oe.set(i,$,.5,-.5),b=$r[n][2]):m>=c&&(oe.set(i,$,-.5,-.5),b=$r[n][3]);var C;C=lt[n],Vt(i,0,C.x,C.y),C=lt[b],Vt(i,0,-C.x,-C.y),w=Er(Math.floor((.5+i[0])*h),0,h-1),m=Er(Math.floor((.5-i[1])*c),0,c-1)}f.push(new K(b,w,m,M,e))}return t.set(this,f),f},K.prototype.hash=function(){return ap(ht.indexOf(this.face),this.z,this.y,this.x)},K.prototype.equals=function(e){return this._geometry===e._geometry&&this.face===e.face&&this.z===e.z&&this.y===e.y&&this.x===e.x},K.prototype.cmp=function(e){return br(this.z,e.z)||br(ht.indexOf(this.face),ht.indexOf(e.face))||br(this.y,e.y)||br(this.x,e.x)},K.prototype.str=function(){return"CubeTile("+tile.face+", "+tile.x+", "+tile.y+", "+tile.z+")"};function ct(e){if(this.constructor.super_.call(this,e),this._size=e.size,this._tileSize=e.tileSize,this._size%this._tileSize!=0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}sp(ct,lp),ct.prototype.width=function(){return this._size},ct.prototype.height=function(){return this._size},ct.prototype.tileWidth=function(){return this._tileSize},ct.prototype.tileHeight=function(){return this._tileSize},ct.prototype._validateWithParentLevel=function(e){var t=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),s=this.numHorizontalTiles(),a=this.numVerticalTiles(),o=e.width(),l=e.height(),h=e.tileWidth(),c=e.tileHeight(),f=e.numHorizontalTiles(),u=e.numVerticalTiles();if(t%o!=0)throw new Error("Level width must be multiple of parent level: "+t+" vs. "+o);if(r%l!=0)throw new Error("Level height must be multiple of parent level: "+r+" vs. "+l);if(s%f!=0)throw new Error("Number of horizontal tiles must be multiple of parent level: "+s+" ("+t+"/"+i+") vs. "+f+" ("+o+"/"+h+")");if(a%u!=0)throw new Error("Number of vertical tiles must be multiple of parent level: "+a+" ("+r+"/"+n+") vs. "+u+" ("+l+"/"+c+")")};function Oe(e){if(fp(e)!=="array")throw new Error("Level list must be an array");this.levelList=cp(e,ct),this.selectableLevelList=vp(this.levelList);for(var t=1;t<this.levelList.length;t++)this.levelList[t]._validateWithParentLevel(this.levelList[t-1]);this._tileSearcher=new op(this),this._neighborsCache=new hp(up),this._vec=mi.create(),this._viewSize={}}Oe.prototype.maxTileSize=function(){for(var e=0,t=0;t<this.levelList.length;t++){var r=this.levelList[t];e=Math.max(e,r.tileWidth,r.tileHeight)}return e},Oe.prototype.levelTiles=function(e,t){var r=this.levelList.indexOf(e),i=e.numHorizontalTiles()-1,n=e.numVerticalTiles()-1;t=t||[];for(var s=0;s<ht.length;s++)for(var a=ht[s],o=0;o<=i;o++)for(var l=0;l<=n;l++)t.push(new K(a,o,l,r,this));return t},Oe.prototype._closestTile=function(e,t){var r=this._vec;mi.set(r,0,0,1,1),mi.transformMat4(r,r,e.inverseProjection());var i=1/0,n=null;for(var s in gi){var a=gi[s],o=1-oe.dot(a,r);o<i&&(i=o,n=s)}for(var l=Math.max(Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]))/.5,h=0;h<3;h++)r[h]=r[h]/l;var c=lt[n];Vt(r,0,-c.x,-c.y);var f=this.levelList.indexOf(t),u=t.numHorizontalTiles(),p=t.numVerticalTiles(),_=Er(Math.floor((.5+r[0])*u),0,u-1),w=Er(Math.floor((.5-r[1])*p),0,p-1);return new K(n,_,w,f,this)},Oe.prototype.visibleTiles=function(e,t,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],e.size(i),i.width===0||i.height===0)return r;var s=this._closestTile(e,t),a=n.search(e,s,r);if(!a)throw new Error("Starting tile is not visible");return r},Oe.Tile=Oe.prototype.Tile=K,Oe.type=Oe.prototype.type="cube",K.type=K.prototype.type="cube";var dp=Oe,pp=Me,_p=Mr,mp=Xs,yp=Bs,gp=_i,wp=kt.makeLevelList,xp=kt.makeSelectableLevelList,Zs=Et,Ks=Ue,Mi=Nt,Mp=Ft,Ge=ne.vec2,Ti=ne.vec4,Tp=64,Ei=[[0,1],[1,0],[0,-1],[-1,0]];function Y(e,t,r,i){this.x=e,this.y=t,this.z=r,this._geometry=i,this._level=i.levelList[r]}Y.prototype.rotX=function(){return 0},Y.prototype.rotY=function(){return 0},Y.prototype.centerX=function(){var e=this._level.width(),t=this._level.tileWidth();return(this.x*t+.5*this.width())/e-.5},Y.prototype.centerY=function(){var e=this._level.height(),t=this._level.tileHeight();return .5-(this.y*t+.5*this.height())/e},Y.prototype.scaleX=function(){var e=this._level.width();return this.width()/e},Y.prototype.scaleY=function(){var e=this._level.height();return this.height()/e},Y.prototype.width=function(){var e=this._level.width(),t=this._level.tileWidth();if(this.x===this._level.numHorizontalTiles()-1){var r=Ks(e,t);return r||t}else return t},Y.prototype.height=function(){var e=this._level.height(),t=this._level.tileHeight();if(this.y===this._level.numVerticalTiles()-1){var r=Ks(e,t);return r||t}else return t},Y.prototype.levelWidth=function(){return this._level.width()},Y.prototype.levelHeight=function(){return this._level.height()},Y.prototype.vertices=function(e){e||(e=[Ge.create(),Ge.create(),Ge.create(),Ge.create()]);var t=this.centerX()-this.scaleX()/2,r=this.centerX()+this.scaleX()/2,i=this.centerY()-this.scaleY()/2,n=this.centerY()+this.scaleY()/2;return Ge.set(e[0],t,n),Ge.set(e[1],r,n),Ge.set(e[2],r,i),Ge.set(e[3],t,i),e},Y.prototype.parent=function(){if(this.z===0)return null;var e=this._geometry,t=this.z-1,r=Math.floor(this.x/2),i=Math.floor(this.y/2);return new Y(r,i,t,e)},Y.prototype.children=function(e){if(this.z===this._geometry.levelList.length-1)return null;var t=this._geometry,r=this.z+1;return e=e||[],e.push(new Y(2*this.x,2*this.y,r,t)),e.push(new Y(2*this.x,2*this.y+1,r,t)),e.push(new Y(2*this.x+1,2*this.y,r,t)),e.push(new Y(2*this.x+1,2*this.y+1,r,t)),e},Y.prototype.neighbors=function(){var e=this._geometry,t=e._neighborsCache,r=t.get(this);if(r)return r;for(var i=this.x,n=this.y,s=this.z,a=this._level,o=a.numHorizontalTiles()-1,l=a.numVerticalTiles()-1,h=[],c=0;c<Ei.length;c++){var f=Ei[c][0],u=Ei[c][1],p=i+f,_=n+u,w=s;0<=p&&p<=o&&0<=_&&_<=l&&h.push(new Y(p,_,w,e))}return t.set(this,h),h},Y.prototype.hash=function(){return _p(this.z,this.y,this.x)},Y.prototype.equals=function(e){return this._geometry===e._geometry&&this.z===e.z&&this.y===e.y&&this.x===e.x},Y.prototype.cmp=function(e){return Mi(this.z,e.z)||Mi(this.y,e.y)||Mi(this.x,e.x)},Y.prototype.str=function(){return"FlatTile("+tile.x+", "+tile.y+", "+tile.z+")"};function vt(e){this.constructor.super_.call(this,e),this._width=e.width,this._height=e.height,this._tileWidth=e.tileWidth,this._tileHeight=e.tileHeight}pp(vt,gp),vt.prototype.width=function(){return this._width},vt.prototype.height=function(){return this._height},vt.prototype.tileWidth=function(){return this._tileWidth},vt.prototype.tileHeight=function(){return this._tileHeight},vt.prototype._validateWithParentLevel=function(e){var t=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),s=e.width(),a=e.height(),o=e.tileWidth(),l=e.tileHeight();if(t%s!=0)return new Error("Level width must be multiple of parent level: "+t+" vs. "+s);if(r%a!=0)return new Error("Level height must be multiple of parent level: "+r+" vs. "+a);if(i%o!=0)return new Error("Level tile width must be multiple of parent level: "+i+" vs. "+o);if(n%l!=0)return new Error("Level tile height must be multiple of parent level: "+n+" vs. "+l)};function De(e){if(Mp(e)!=="array")throw new Error("Level list must be an array");this.levelList=wp(e,vt),this.selectableLevelList=xp(this.levelList);for(var t=1;t<this.levelList.length;t++)this.levelList[t]._validateWithParentLevel(this.levelList[t-1]);this._tileSearcher=new mp(this),this._neighborsCache=new yp(Tp),this._vec=Ti.create(),this._viewSize={}}De.prototype.maxTileSize=function(){for(var e=0,t=0;t<this.levelList.length;t++){var r=this.levelList[t];e=Math.max(e,r.tileWidth,r.tileHeight)}return e},De.prototype.levelTiles=function(e,t){var r=this.levelList.indexOf(e),i=e.numHorizontalTiles()-1,n=e.numVerticalTiles()-1;t||(t=[]);for(var s=0;s<=i;s++)for(var a=0;a<=n;a++)t.push(new Y(s,a,r,this));return t},De.prototype._closestTile=function(e,t){var r=this._vec;Ti.set(r,0,0,1,1),Ti.transformMat4(r,r,e.inverseProjection());var i=.5+r[0],n=.5-r[1],s=this.levelList.indexOf(t),a=t.width(),o=t.height(),l=t.tileWidth(),h=t.tileHeight(),c=t.numHorizontalTiles(),f=t.numVerticalTiles(),u=Zs(Math.floor(i*a/l),0,c-1),p=Zs(Math.floor(n*o/h),0,f-1);return new Y(u,p,s,this)},De.prototype.visibleTiles=function(e,t,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],e.size(i),i.width===0||i.height===0)return r;var s=this._closestTile(e,t),a=n.search(e,s,r);if(!a)throw new Error("Starting tile is not visible");return r},De.Tile=De.prototype.Tile=Y,De.type=De.prototype.type="flat",Y.type=Y.prototype.type="flat";var Ep=De,bp=Me,$p=Mr,Sp=Nt,Qs=kt,Cp=_i,Lp=Ft;function Q(e,t){this.z=e,this._geometry=t,this._level=t.levelList[e]}Q.prototype.rotX=function(){return 0},Q.prototype.rotY=function(){return 0},Q.prototype.centerX=function(){return .5},Q.prototype.centerY=function(){return .5},Q.prototype.scaleX=function(){return 1},Q.prototype.scaleY=function(){return 1},Q.prototype.parent=function(){return this.z===0?null:new Q(this.z-1,this._geometry)},Q.prototype.children=function(e){return this.z===this._geometry.levelList.length-1?null:(e=e||[],e.push(new Q(this.z+1,this._geometry)),e)},Q.prototype.neighbors=function(){return[]},Q.prototype.hash=function(){return $p(this.z)},Q.prototype.equals=function(e){return this._geometry===e._geometry&&this.z===e.z},Q.prototype.cmp=function(e){return Sp(this.z,e.z)},Q.prototype.str=function(){return"EquirectTile("+tile.z+")"};function $t(e){this.constructor.super_.call(this,e),this._width=e.width}bp($t,Cp),$t.prototype.width=function(){return this._width},$t.prototype.height=function(){return this._width/2},$t.prototype.tileWidth=function(){return this._width},$t.prototype.tileHeight=function(){return this._width/2};function je(e){if(Lp(e)!=="array")throw new Error("Level list must be an array");this.levelList=Qs.makeLevelList(e,$t),this.selectableLevelList=Qs.makeSelectableLevelList(this.levelList)}je.prototype.maxTileSize=function(){for(var e=0,t=0;t<this.levelList.length;t++){var r=this.levelList[t];e=Math.max(e,r.tileWidth,r.tileHeight)}return e},je.prototype.levelTiles=function(e,t){var r=this.levelList.indexOf(e);return t=t||[],t.push(new Q(r,this)),t},je.prototype.visibleTiles=function(e,t,r){var i=new Q(this.levelList.indexOf(t),this);r=r||[],r.length=0,r.push(i)},je.Tile=je.prototype.Tile=Q,je.type=je.prototype.type="equirect",Q.type=Q.prototype.type="equirect";var Pp=je;function ft(e,t,r){return 2*Math.atan(r*Math.tan(e/2)/t)}function zp(e,t,r){return ft(e,t,r)}function Ap(e,t,r){return ft(e,t,Math.sqrt(t*t+r*r))}function Rp(e,t,r){return ft(e,r,t)}function Ip(e,t,r){return ft(e,r,Math.sqrt(t*t+r*r))}function Op(e,t,r){return ft(e,Math.sqrt(t*t+r*r),t)}function Dp(e,t,r){return ft(e,Math.sqrt(t*t+r*r),r)}var Js={convert:ft,htov:zp,htod:Ap,vtoh:Rp,vtod:Ip,dtoh:Op,dtov:Dp};function Hp(e){return typeof e=="number"&&isFinite(e)}var bi=Hp;function Np(e){return e.toPrecision(15)}var $i=Np;function kp(){var e=arguments;return function(r){for(var i=r,n=0;n<e.length;n++){var s=e[n];i=s.call(null,i)}return i}}var ea=kp,Fp=Z,Ze=ne.mat4,se=ne.vec4,ta=dr,qt=Js,Si=Ue,Ke=bi,ut=Et,be=$i,Vp=ea,qp=G,Wp=0,Yp=0,Xp=0,Bp=0,Up=0,Gp=Math.PI/4,jp=0,Zp=0,ra=1e-6;function P(e,t){this._yaw=e&&e.yaw!=null?e.yaw:Xp,this._pitch=e&&e.pitch!=null?e.pitch:Bp,this._roll=e&&e.roll!=null?e.roll:Up,this._fov=e&&e.fov!=null?e.fov:Gp,this._width=e&&e.width!=null?e.width:Wp,this._height=e&&e.height!=null?e.height:Yp,this._projectionCenterX=e&&e.projectionCenterX!=null?e.projectionCenterX:jp,this._projectionCenterY=e&&e.projectionCenterY!=null?e.projectionCenterY:Zp,this._limiter=t||null,this._projMatrix=Ze.create(),this._invProjMatrix=Ze.create(),this._frustum=[se.create(),se.create(),se.create(),se.create(),se.create()],this._projectionChanged=!0,this._params={},this._fovs={},this._tmpVec=se.create(),this._update()}Fp(P),P.prototype.destroy=function(){qp(this)},P.prototype.yaw=function(){return this._yaw},P.prototype.pitch=function(){return this._pitch},P.prototype.roll=function(){return this._roll},P.prototype.projectionCenterX=function(){return this._projectionCenterX},P.prototype.projectionCenterY=function(){return this._projectionCenterY},P.prototype.fov=function(){return this._fov},P.prototype.width=function(){return this._width},P.prototype.height=function(){return this._height},P.prototype.size=function(e){return e=e||{},e.width=this._width,e.height=this._height,e},P.prototype.parameters=function(e){return e=e||{},e.yaw=this._yaw,e.pitch=this._pitch,e.roll=this._roll,e.fov=this._fov,e},P.prototype.limiter=function(){return this._limiter},P.prototype.setYaw=function(e){this._resetParams(),this._params.yaw=e,this._update(this._params)},P.prototype.setPitch=function(e){this._resetParams(),this._params.pitch=e,this._update(this._params)},P.prototype.setRoll=function(e){this._resetParams(),this._params.roll=e,this._update(this._params)},P.prototype.setFov=function(e){this._resetParams(),this._params.fov=e,this._update(this._params)},P.prototype.setProjectionCenterX=function(e){this._resetParams(),this._params.projectionCenterX=e,this._update(this._params)},P.prototype.setProjectionCenterY=function(e){this._resetParams(),this._params.projectionCenterY=e,this._update(this._params)},P.prototype.offsetYaw=function(e){this.setYaw(this._yaw+e)},P.prototype.offsetPitch=function(e){this.setPitch(this._pitch+e)},P.prototype.offsetRoll=function(e){this.setRoll(this._roll+e)},P.prototype.offsetFov=function(e){this.setFov(this._fov+e)},P.prototype.setSize=function(e){this._resetParams(),this._params.width=e.width,this._params.height=e.height,this._update(this._params)},P.prototype.setParameters=function(e){this._resetParams(),this._params.yaw=e.yaw,this._params.pitch=e.pitch,this._params.roll=e.roll,this._params.fov=e.fov,this._params.projectionCenterX=e.projectionCenterX,this._params.projectionCenterY=e.projectionCenterY,this._update(this._params)},P.prototype.setLimiter=function(e){this._limiter=e||null,this._update()},P.prototype._resetParams=function(){var e=this._params;e.yaw=null,e.pitch=null,e.roll=null,e.fov=null,e.width=null,e.height=null},P.prototype._update=function(e){e==null&&(this._resetParams(),e=this._params);var t=this._yaw,r=this._pitch,i=this._roll,n=this._fov,s=this._projectionCenterX,a=this._projectionCenterY,o=this._width,l=this._height;if(e.yaw=e.yaw!=null?e.yaw:t,e.pitch=e.pitch!=null?e.pitch:r,e.roll=e.roll!=null?e.roll:i,e.fov=e.fov!=null?e.fov:n,e.width=e.width!=null?e.width:o,e.height=e.height!=null?e.height:l,e.projectionCenterX=e.projectionCenterX!=null?e.projectionCenterX:s,e.projectionCenterY=e.projectionCenterY!=null?e.projectionCenterY:a,this._limiter&&(e=this._limiter(e),!e))throw new Error("Bad view limiter");e=this._normalize(e);var h=e.yaw,c=e.pitch,f=e.roll,u=e.fov,p=e.width,_=e.height,w=e.projectionCenterX,m=e.projectionCenterY;if(!Ke(h)||!Ke(c)||!Ke(f)||!Ke(u)||!Ke(p)||!Ke(_)||!Ke(w)||!Ke(m))throw new Error("Bad view - suspect a broken limiter");this._yaw=h,this._pitch=c,this._roll=f,this._fov=u,this._width=p,this._height=_,this._projectionCenterX=w,this._projectionCenterY=m,(h!==t||c!==r||f!==i||u!==n||p!==o||_!==l||w!==s||m!==a)&&(this._projectionChanged=!0,this.emit("change")),(p!==o||_!==l)&&this.emit("resize")},P.prototype._normalize=function(e){this._normalizeCoordinates(e);var t=qt.htov(Math.PI,e.width,e.height),r=isNaN(t)?Math.PI:Math.min(Math.PI,t);return e.fov=ut(e.fov,ra,r-ra),e},P.prototype._normalizeCoordinates=function(e){return"yaw"in e&&(e.yaw=Si(e.yaw-Math.PI,-2*Math.PI)+Math.PI),"pitch"in e&&(e.pitch=Si(e.pitch-Math.PI,-2*Math.PI)+Math.PI),"roll"in e&&(e.roll=Si(e.roll-Math.PI,-2*Math.PI)+Math.PI),e},P.prototype.normalizeToClosest=function(e,t){var r=this._yaw,i=this._pitch,n=e.yaw,s=e.pitch,a=n-2*Math.PI,o=n+2*Math.PI;Math.abs(a-r)<Math.abs(n-r)?n=a:Math.abs(o-r)<Math.abs(n-r)&&(n=o);var l=s-2*Math.PI,h=s+2*Math.PI;return Math.abs(l-i)<Math.abs(s-i)?s=l:Math.abs(l-i)<Math.abs(s-i)&&(s=h),t=t||{},t.yaw=n,t.pitch=s,t},P.prototype.updateWithControlParameters=function(e){var t=this._fov,r=qt.vtoh(t,this._width,this._height);isNaN(r)&&(r=t),this.offsetYaw(e.axisScaledX*r+e.x*2*r+e.yaw),this.offsetPitch(e.axisScaledY*t+e.y*2*r+e.pitch),this.offsetRoll(-e.roll),this.offsetFov(e.zoom*t)},P.prototype._updateProjection=function(){var e=this._projMatrix,t=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._width,n=this._height,s=this._fov,a=qt.vtoh(s,i,n),o=i/n,l=this._projectionCenterX,h=this._projectionCenterY;if(l!==0||h!==0){var c=Math.atan(l*2*Math.tan(a/2)),f=Math.atan(h*2*Math.tan(s/2)),u=this._fovs;u.leftDegrees=(a/2+c)*180/Math.PI,u.rightDegrees=(a/2-c)*180/Math.PI,u.upDegrees=(s/2+f)*180/Math.PI,u.downDegrees=(s/2-f)*180/Math.PI,Ze.perspectiveFromFieldOfView(e,u,-1,1)}else Ze.perspective(e,s,o,-1,1);Ze.rotateZ(e,e,this._roll),Ze.rotateX(e,e,this._pitch),Ze.rotateY(e,e,this._yaw),Ze.invert(t,e),this._matrixToFrustum(e,r),this._projectionChanged=!1}},P.prototype._matrixToFrustum=function(e,t){se.set(t[0],e[3]+e[0],e[7]+e[4],e[11]+e[8],0),se.set(t[1],e[3]-e[0],e[7]-e[4],e[11]-e[8],0),se.set(t[2],e[3]+e[1],e[7]+e[5],e[11]+e[9],0),se.set(t[3],e[3]-e[1],e[7]-e[5],e[11]-e[9],0),se.set(t[4],e[3]+e[2],e[7]+e[6],e[11]+e[10],0)},P.prototype.projection=function(){return this._updateProjection(),this._projMatrix},P.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},P.prototype.intersects=function(e){this._updateProjection();for(var t=this._frustum,r=this._tmpVec,i=0;i<t.length;i++){for(var n=t[i],s=!1,a=0;a<e.length;a++){var o=e[a];se.set(r,o[0],o[1],o[2],0),se.dot(n,r)>=0&&(s=!0)}if(!s)return!1}return!0},P.prototype.selectLevel=function(e){for(var t=ta()*this._height,r=Math.tan(.5*this._fov),i=0;i<e.length;i++){var n=e[i];if(r*n.height()>=t)return n}return e[e.length-1]},P.prototype.coordinatesToScreen=function(e,t){var r=this._tmpVec;t||(t={});var i=this._width,n=this._height;if(i<=0||n<=0)return t.x=null,t.y=null,null;var s=e.yaw,a=e.pitch,o=Math.sin(s)*Math.cos(a),l=-Math.sin(a),h=-Math.cos(s)*Math.cos(a);if(se.set(r,o,l,h,1),se.transformMat4(r,r,this.projection()),r[3]>=0)t.x=i*(r[0]/r[3]+1)/2,t.y=n*(1-r[1]/r[3])/2;else return t.x=null,t.y=null,null;return t},P.prototype.screenToCoordinates=function(e,t){var r=this._tmpVec;t||(t={});var i=this._width,n=this._height,s=2*e.x/i-1,a=1-2*e.y/n;se.set(r,s,a,1,1),se.transformMat4(r,r,this.inverseProjection());var o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);return t.yaw=Math.atan2(r[0],-r[2]),t.pitch=Math.acos(r[1]/o)-Math.PI/2,this._normalizeCoordinates(t),t},P.prototype.coordinatesToPerspectiveTransform=function(e,t,r){r=r||"";var i=this._height,n=this._width,s=this._fov,a=.5*i/Math.tan(s/2),o="";return o+="translateX("+be(n/2)+"px) ",o+="translateY("+be(i/2)+"px) ",o+="translateX(-50%) translateY(-50%) ",o+="perspective("+be(a)+"px) ",o+="translateZ("+be(a)+"px) ",o+="rotateZ("+be(-this._roll)+"rad) ",o+="rotateX("+be(-this._pitch)+"rad) ",o+="rotateY("+be(this._yaw)+"rad) ",o+="rotateY("+be(-e.yaw)+"rad) ",o+="rotateX("+be(e.pitch)+"rad) ",o+="translateZ("+be(-t)+"px) ",o+=r+" ",o},P.limit={yaw:function(e,t){return function(i){return i.yaw=ut(i.yaw,e,t),i}},pitch:function(e,t){return function(i){return i.pitch=ut(i.pitch,e,t),i}},roll:function(e,t){return function(i){return i.roll=ut(i.roll,e,t),i}},hfov:function(e,t){return function(i){var n=i.width,s=i.height;if(n>0&&s>0){var a=qt.htov(e,n,s),o=qt.htov(t,n,s);i.fov=ut(i.fov,a,o)}return i}},vfov:function(e,t){return function(i){return i.fov=ut(i.fov,e,t),i}},resolution:function(e){return function(r){var i=r.height;if(i){var n=ta()*i,s=2*Math.atan(n/e);r.fov=ut(r.fov,s,1/0)}return r}},traditional:function(e,t,r){return r=r!=null?r:t,Vp(P.limit.resolution(e),P.limit.vfov(0,t),P.limit.hfov(0,r),P.limit.pitch(-Math.PI/2,Math.PI/2))}},P.type=P.prototype.type="rectilinear";var Kp=P,Qp=Z,Sr=ne.mat4,Wt=ne.vec4,ia=dr,St=bi,He=Et,Jp=G,e_=0,t_=0,na=.5,sa=.5,r_=1,i_=[1,0,1,0],n_=[-1,-1,1,1],s_=1e-6;function O(e,t){if(!(e&&e.mediaAspectRatio!=null))throw new Error("mediaAspectRatio must be defined");this._x=e&&e.x!=null?e.x:na,this._y=e&&e.y!=null?e.y:sa,this._zoom=e&&e.zoom!=null?e.zoom:r_,this._mediaAspectRatio=e.mediaAspectRatio,this._width=e&&e.width!=null?e.width:e_,this._height=e&&e.height!=null?e.height:t_,this._limiter=t||null,this._projMatrix=Sr.create(),this._invProjMatrix=Sr.create(),this._frustum=[0,0,0,0],this._projectionChanged=!0,this._params={},this._vec=Wt.create(),this._update()}Qp(O),O.prototype.destroy=function(){Jp(this)},O.prototype.x=function(){return this._x},O.prototype.y=function(){return this._y},O.prototype.zoom=function(){return this._zoom},O.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},O.prototype.width=function(){return this._width},O.prototype.height=function(){return this._height},O.prototype.size=function(e){return e=e||{},e.width=this._width,e.height=this._height,e},O.prototype.parameters=function(e){return e=e||{},e.x=this._x,e.y=this._y,e.zoom=this._zoom,e.mediaAspectRatio=this._mediaAspectRatio,e},O.prototype.limiter=function(){return this._limiter},O.prototype.setX=function(e){this._resetParams(),this._params.x=e,this._update(this._params)},O.prototype.setY=function(e){this._resetParams(),this._params.y=e,this._update(this._params)},O.prototype.setZoom=function(e){this._resetParams(),this._params.zoom=e,this._update(this._params)},O.prototype.offsetX=function(e){this.setX(this._x+e)},O.prototype.offsetY=function(e){this.setY(this._y+e)},O.prototype.offsetZoom=function(e){this.setZoom(this._zoom+e)},O.prototype.setMediaAspectRatio=function(e){this._resetParams(),this._params.mediaAspectRatio=e,this._update(this._params)},O.prototype.setSize=function(e){this._resetParams(),this._params.width=e.width,this._params.height=e.height,this._update(this._params)},O.prototype.setParameters=function(e){this._resetParams(),this._params.x=e.x,this._params.y=e.y,this._params.zoom=e.zoom,this._params.mediaAspectRatio=e.mediaAspectRatio,this._update(this._params)},O.prototype.setLimiter=function(e){this._limiter=e||null,this._update()},O.prototype._resetParams=function(){var e=this._params;e.x=null,e.y=null,e.zoom=null,e.mediaAspectRatio=null,e.width=null,e.height=null},O.prototype._update=function(e){e==null&&(this._resetParams(),e=this._params);var t=this._x,r=this._y,i=this._zoom,n=this._mediaAspectRatio,s=this._width,a=this._height;if(e.x=e.x!=null?e.x:t,e.y=e.y!=null?e.y:r,e.zoom=e.zoom!=null?e.zoom:i,e.mediaAspectRatio=e.mediaAspectRatio!=null?e.mediaAspectRatio:n,e.width=e.width!=null?e.width:s,e.height=e.height!=null?e.height:a,this._limiter&&(e=this._limiter(e),!e))throw new Error("Bad view limiter");var o=e.x,l=e.y,h=e.zoom,c=e.mediaAspectRatio,f=e.width,u=e.height;if(!St(o)||!St(l)||!St(h)||!St(c)||!St(f)||!St(u))throw new Error("Bad view - suspect a broken limiter");h=He(h,s_,1/0),this._x=o,this._y=l,this._zoom=h,this._mediaAspectRatio=c,this._width=f,this._height=u,(o!==t||l!==r||h!==i||c!==n||f!==s||u!==a)&&(this._projectionChanged=!0,this.emit("change")),(f!==s||u!==a)&&this.emit("resize")},O.prototype._zoomX=function(){return this._zoom},O.prototype._zoomY=function(){var e=this._mediaAspectRatio,t=this._width/this._height,r=this._zoom,i=r*e/t;return isNaN(i)&&(i=r),i},O.prototype.updateWithControlParameters=function(e){var t=this.zoom(),r=this._zoomX(),i=this._zoomY();this.offsetX(e.axisScaledX*r+e.x*t),this.offsetY(e.axisScaledY*i+e.y*t),this.offsetZoom(e.zoom*t)},O.prototype._updateProjection=function(){var e=this._projMatrix,t=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._x,n=this._y,s=this._zoomX(),a=this._zoomY(),o=r[0]=.5-n+.5*a,l=r[1]=i-.5+.5*s,h=r[2]=.5-n-.5*a,c=r[3]=i-.5-.5*s;Sr.ortho(e,c,l,h,o,-1,1),Sr.invert(t,e),this._projectionChanged=!1}},O.prototype.projection=function(){return this._updateProjection(),this._projMatrix},O.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},O.prototype.intersects=function(e){this._updateProjection();for(var t=this._frustum,r=0;r<t.length;r++){for(var i=t[r],n=i_[r],s=n_[r],a=!1,o=0;o<e.length;o++){var l=e[o];if(s<0&&l[n]<i||s>0&&l[n]>i){a=!0;break}}if(!a)return!1}return!0},O.prototype.selectLevel=function(e){for(var t=ia()*this.width(),r=this._zoom,i=0;i<e.length;i++){var n=e[i];if(r*n.width()>=t)return n}return e[e.length-1]},O.prototype.coordinatesToScreen=function(e,t){var r=this._vec;t||(t={});var i=this._width,n=this._height;if(i<=0||n<=0)return t.x=null,t.y=null,null;var s=e&&e.x!=null?e.x:na,a=e&&e.y!=null?e.y:sa;Wt.set(r,s-.5,.5-a,-1,1),Wt.transformMat4(r,r,this.projection());for(var o=0;o<3;o++)r[o]/=r[3];return t.x=i*(r[0]+1)/2,t.y=n*(1-r[1])/2,t},O.prototype.screenToCoordinates=function(e,t){var r=this._vec;t||(t={});var i=this._width,n=this._height,s=2*e.x/i-1,a=1-2*e.y/n;return Wt.set(r,s,a,1,1),Wt.transformMat4(r,r,this.inverseProjection()),t.x=.5+r[0],t.y=.5-r[1],t},O.limit={x:function(e,t){return function(i){return i.x=He(i.x,e,t),i}},y:function(e,t){return function(i){return i.y=He(i.y,e,t),i}},zoom:function(e,t){return function(i){return i.zoom=He(i.zoom,e,t),i}},resolution:function(e){return function(r){if(r.width<=0||r.height<=0)return r;var i=r.width,n=ia()*i/e;return r.zoom=He(r.zoom,n,1/0),r}},visibleX:function(e,t){return function(i){var n=t-e;i.zoom>n&&(i.zoom=n);var s=e+.5*i.zoom,a=t-.5*i.zoom;return i.x=He(i.x,s,a),i}},visibleY:function(e,t){return function(i){if(i.width<=0||i.height<=0)return i;var n=i.width/i.height,s=n/i.mediaAspectRatio,a=(t-e)*s;i.zoom>a&&(i.zoom=a);var o=e+.5*i.zoom/s,l=t-.5*i.zoom/s;return i.y=He(i.y,o,l),i}},letterbox:function(){return function(t){if(t.width<=0||t.height<=0)return t;var r=t.width/t.height,i=1,n=r/t.mediaAspectRatio;t.mediaAspectRatio>=r&&(t.zoom=Math.min(t.zoom,i)),t.mediaAspectRatio<=r&&(t.zoom=Math.min(t.zoom,n));var s,a;t.zoom>i?s=a=.5:(s=0+.5*t.zoom/i,a=1-.5*t.zoom/i);var o,l;return t.zoom>n?o=l=.5:(o=0+.5*t.zoom/n,l=1-.5*t.zoom/n),t.x=He(t.x,s,a),t.y=He(t.y,o,l),t}}},O.type=O.prototype.type="flat";var a_=O,o_=on,h_=Ue;function Yt(e){this._concurrency=e&&e.concurrency||1,this._paused=e&&!!e.paused||!1,this._pool=[];for(var t=0;t<this._concurrency;t++)this._pool.push(new o_(e));this._next=0}Yt.prototype.length=function(){for(var e=0,t=0;t<this._pool.length;t++)e+=this._pool[t].length();return e},Yt.prototype.push=function(e,t){var r=this._next,i=this._pool[r].push(e,t);return this._next=h_(this._next+1,this._concurrency),i},Yt.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var e=0;e<this._concurrency;e++)this._pool[e].pause()}},Yt.prototype.resume=function(){if(this._paused){this._paused=!1;for(var e=0;e<this._concurrency;e++)this._pool[e].resume()}};var l_=Yt;function c_(){}var Xt=c_,v_=Xt;function f_(){var e=Array.prototype.slice.call(arguments,0);return function(){var r=e.slice(0),i=null,n=null,s=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],a=arguments.length?arguments[arguments.length-1]:v_;function o(){var h=arguments[0];if(h){i=n=null,a.apply(null,arguments);return}if(!r.length){i=n=null,a.apply(null,arguments);return}i=r.shift();var c=i,f=Array.prototype.slice.call(arguments,1);f.push(o);var u=i.apply(null,f);if(c===i){if(typeof u!="function")throw new Error("chain: chaining on non-cancellable function");n=u}}function l(){n&&n.apply(null,arguments)}return s.unshift(null),o.apply(null,s),l}}var Ci=f_;function u_(e,t){var r=null;function i(){r!=null&&(r=null,t(null))}function n(){r!=null&&(clearTimeout(r),r=null,t.apply(null,arguments))}return r=setTimeout(i,e),n}var aa=u_,d_=Z,p_=dn,__=l_,m_=Ci,y_=aa,oa=st,ha={x:"x",y:"y",z:"z",f:"face"},g_="bdflru",w_=4,x_=1e4;function Bt(e,t){t=t||{},this._loadPool=new __({concurrency:t.concurrency||w_}),this._retryDelay=t.retryDelay||x_,this._retryMap={},this._sourceFromTile=e}d_(Bt),Bt.prototype.loadAsset=function(e,t,r){var i=this,n=this._retryDelay,s=this._retryMap,a=this._sourceFromTile(t),o=a.url,l=a.rect,h=e.loadImage.bind(e,o,l),c=function(m){return i._loadPool.push(h,function(M,b){M?(M instanceof p_&&(s[o]=oa(),i.emit("networkError",M,t)),m(M,t)):(delete s[o],m(null,t,b))})},f,u=s[o];if(u!=null){var p=oa(),_=p-u;_<n?f=n-_:(f=0,delete s[o])}var w=y_.bind(null,f);return m_(w,c)(r)},Bt.fromString=function(e,t){t=t||{};var r=t&&t.cubeMapPreviewFaceOrder||g_,i=t.cubeMapPreviewUrl?s:n;return new Bt(i,t);function n(o){var l=e;for(var h in ha){var c=ha[h],f=M_(h),u=o.hasOwnProperty(c)?o[c]:"";l=l.replace(f,u)}return{url:l}}function s(o){return o.z===0?a(o):n(o)}function a(o){var l=r.indexOf(o.face)/6;return{url:t.cubeMapPreviewUrl,rect:{x:0,y:l,width:1,height:1/6}}}};function M_(e){var t="\\{("+e+")\\}";return new RegExp(t,"g")}var T_=Bt;function Li(e){this._asset=e}Li.prototype.asset=function(){return this._asset},Li.prototype.loadAsset=function(e,t,r){var i=this,n=setTimeout(function(){r(null,t,i._asset)},0);function s(){clearTimeout(n),r.apply(null,arguments)}return s};var E_=Li,b_=Qr,$_=Me,S_=Z,C_=G;function dt(e){this.constructor.super_.call(this,e),this._timestamp=0}$_(dt,b_),S_(dt),dt.prototype.destroy=function(){C_(this)},dt.prototype.timestamp=function(){return this._timestamp},dt.prototype.isDynamic=function(){return!0},dt.prototype.markDirty=function(){this._timestamp++,this.emit("change")};var L_=dt,Cr=Ue,P_=64;function Qe(e){if(e!=null&&(!isFinite(e)||Math.floor(e)!==e||e<1))throw new Error("Map: invalid capacity");this._capacity=e||P_,this._keyBuckets=[],this._valBuckets=[];for(var t=0;t<this._capacity;t++)this._keyBuckets.push([]),this._valBuckets.push([]);this._size=0}Qe.prototype.get=function(e){for(var t=Cr(e.hash(),this._capacity),r=this._keyBuckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n)){var s=this._valBuckets[t],a=s[i];return a}}return null},Qe.prototype.set=function(e,t){for(var r=Cr(e.hash(),this._capacity),i=this._keyBuckets[r],n=this._valBuckets[r],s=0;s<i.length;s++){var a=i[s];if(e.equals(a)){var o=n[s];return i[s]=e,n[s]=t,o}}return i.push(e),n.push(t),this._size++,null},Qe.prototype.del=function(e){for(var t=Cr(e.hash(),this._capacity),r=this._keyBuckets[t],i=this._valBuckets[t],n=0;n<r.length;n++){var s=r[n];if(e.equals(s)){for(var a=i[n],o=n;o<r.length-1;o++)r[o]=r[o+1],i[o]=i[o+1];return r.length=r.length-1,i.length=i.length-1,this._size--,a}}return null},Qe.prototype.has=function(e){for(var t=Cr(e.hash(),this._capacity),r=this._keyBuckets[t],i=0;i<r.length;i++){var n=r[i];if(e.equals(n))return!0}return!1},Qe.prototype.size=function(){return this._size},Qe.prototype.clear=function(){for(var e=0;e<this._capacity;e++)this._keyBuckets[e].length=0,this._valBuckets[e].length=0;this._size=0},Qe.prototype.forEach=function(e){for(var t=0,r=0;r<this._capacity;r++)for(var i=this._keyBuckets[r],n=this._valBuckets[r],s=0;s<i.length;s++)e(i[s],n[s]),t+=1;return t};var z_=Qe,A_=Ue;function Je(e){if(!isFinite(e)||Math.floor(e)!==e||e<0)throw new Error("LruSet: invalid capacity");this._capacity=e,this._elements=new Array(this._capacity),this._start=0,this._size=0}Je.prototype._index=function(e){return A_(this._start+e,this._capacity)},Je.prototype.add=function(e){if(this._capacity===0)return e;this.remove(e);var t=this._size===this._capacity?this._elements[this._index(0)]:null;return this._elements[this._index(this._size)]=e,this._size<this._capacity?this._size++:this._start=this._index(1),t},Je.prototype.remove=function(e){for(var t=0;t<this._size;t++){var r=this._elements[this._index(t)];if(e.equals(r)){for(var i=t;i<this._size-1;i++)this._elements[this._index(i)]=this._elements[this._index(i+1)];return this._size--,r}}return null},Je.prototype.has=function(e){for(var t=0;t<this._size;t++)if(e.equals(this._elements[this._index(t)]))return!0;return!1},Je.prototype.size=function(){return this._size},Je.prototype.clear=function(){this._elements.length=0,this._start=0,this._size=0},Je.prototype.forEach=function(e){for(var t=0,r=0;r<this._size;r++)e(this._elements[this._index(r)]),t+=1;return t};var R_=Je;function I_(e,t){for(var r in t)r in e||(e[r]=t[r]);return e}var $e=I_,O_=Xt;function D_(e){return function(){var r=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],i=arguments.length?arguments[arguments.length-1]:O_,n=null,s=!1;function a(){var o=arguments[0];!o||s?i.apply(null,arguments):n=e.apply(null,r)}return r.push(a),a(!0),function(){s=!0,n.apply(null,arguments)}}}var la=D_,ca=z_,va=Ys,H_=R_,fa=Z,N_=$e,k_=la,F_=Ci,V_=Me,ua=G,Ut=typeof MARZIPANODEBUG!="undefined"&&MARZIPANODEBUG.textureStore,pe={IDLE:0,START:1,MARK:2,END:3},q_={previouslyVisibleCacheSize:512},W_=0;function Pi(){}V_(Pi,Error);function Gt(e,t){var r=this,i=W_++;r._id=i,r._store=e,r._tile=t,r._asset=null,r._texture=null,r._changeHandler=function(){e.emit("textureInvalid",t)};var n=e.source(),s=e.stage(),a=n.loadAsset.bind(n),o=s.createTexture.bind(s),l=F_(k_(a),o);e.emit("textureStartLoad",t),Ut&&console.log("loading",i,t),r._cancel=l(s,t,function(h,c,f,u){if(r._cancel=null,h){f&&f.destroy(),u&&u.destroy(),h instanceof Pi?(e.emit("textureCancel",t),Ut&&console.log("cancel",i,t)):(e.emit("textureError",t,h),Ut&&console.log("error",i,t));return}r._texture=u,f.isDynamic()?(r._asset=f,f.addEventListener("change",r._changeHandler)):f.destroy(),e.emit("textureLoad",t),Ut&&console.log("load",i,t)})}Gt.prototype.asset=function(){return this._asset},Gt.prototype.texture=function(){return this._texture},Gt.prototype.destroy=function(){var e=this._id,t=this._store,r=this._tile,i=this._asset,n=this._texture,s=this._cancel;if(s){s(new Pi("Texture load cancelled"));return}i&&(i.removeEventListener("change",this._changeHandler),i.destroy()),n&&n.destroy(),t.emit("textureUnload",r),Ut&&console.log("unload",e,r),ua(this)},fa(Gt);function re(e,t,r){r=N_(r||{},q_),this._source=e,this._stage=t,this._state=pe.IDLE,this._delimCount=0,this._itemMap=new ca,this._visible=new va,this._previouslyVisible=new H_(r.previouslyVisibleCacheSize),this._pinMap=new ca,this._newVisible=new va,this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}fa(re),re.prototype.destroy=function(){this.clear(),ua(this)},re.prototype.stage=function(){return this._stage},re.prototype.source=function(){return this._source},re.prototype.clear=function(){var e=this;e._evicted.length=0,e._itemMap.forEach(function(t){e._evicted.push(t)}),e._evicted.forEach(function(t){e._unloadTile(t)}),e._itemMap.clear(),e._visible.clear(),e._previouslyVisible.clear(),e._pinMap.clear(),e._newVisible.clear(),e._noLongerVisible.length=0,e._visibleAgain.length=0,e._evicted.length=0},re.prototype.clearNotPinned=function(){var e=this;e._evicted.length=0,e._itemMap.forEach(function(t){e._pinMap.has(t)||e._evicted.push(t)}),e._evicted.forEach(function(t){e._unloadTile(t)}),e._visible.clear(),e._previouslyVisible.clear(),e._evicted.length=0},re.prototype.startFrame=function(){if(this._state!==pe.IDLE&&this._state!==pe.START)throw new Error("TextureStore: startFrame called out of sequence");this._state=pe.START,this._delimCount++},re.prototype.markTile=function(e){if(this._state!==pe.START&&this._state!==pe.MARK)throw new Error("TextureStore: markTile called out of sequence");this._state=pe.MARK;var t=this._itemMap.get(e),r=t&&t.texture(),i=t&&t.asset();r&&i&&r.refresh(e,i),this._newVisible.add(e)},re.prototype.endFrame=function(){if(this._state!==pe.START&&this._state!==pe.MARK&&this._state!==pe.END)throw new Error("TextureStore: endFrame called out of sequence");this._state=pe.END,this._delimCount--,this._delimCount||(this._update(),this._state=pe.IDLE)},re.prototype._update=function(){var e=this;e._noLongerVisible.length=0,e._visible.forEach(function(r){e._newVisible.has(r)||e._noLongerVisible.push(r)}),e._visibleAgain.length=0,e._newVisible.forEach(function(r){e._previouslyVisible.has(r)&&e._visibleAgain.push(r)}),e._visibleAgain.forEach(function(r){e._previouslyVisible.remove(r)}),e._evicted.length=0,e._noLongerVisible.forEach(function(r){var i=e._itemMap.get(r),n=i&&i.texture();if(n){var s=e._previouslyVisible.add(r);s!=null&&e._evicted.push(s)}else i&&e._unloadTile(r)}),e._evicted.forEach(function(r){e._pinMap.has(r)||e._unloadTile(r)}),e._newVisible.forEach(function(r){var i=e._itemMap.get(r);i||e._loadTile(r)});var t=e._visible;e._visible=e._newVisible,e._newVisible=t,e._newVisible.clear(),e._noLongerVisible.length=0,e._visibleAgain.length=0,e._evicted.length=0},re.prototype._loadTile=function(e){if(this._itemMap.has(e))throw new Error("TextureStore: loading texture already in cache");var t=new Gt(this,e);this._itemMap.set(e,t)},re.prototype._unloadTile=function(e){var t=this._itemMap.del(e);if(!t)throw new Error("TextureStore: unloading texture not in cache");t.destroy()},re.prototype.asset=function(e){var t=this._itemMap.get(e);return t?t.asset():null},re.prototype.texture=function(e){var t=this._itemMap.get(e);return t?t.texture():null},re.prototype.pin=function(e){var t=(this._pinMap.get(e)||0)+1;return this._pinMap.set(e,t),this._itemMap.has(e)||this._loadTile(e),t},re.prototype.unpin=function(e){var t=this._pinMap.get(e);if(t)t--,t>0?this._pinMap.set(e,t):(this._pinMap.del(e),!this._visible.has(e)&&!this._previouslyVisible.has(e)&&this._unloadTile(e));else throw new Error("TextureStore: unpin when not pinned");return t},re.prototype.query=function(e){var t=this._itemMap.get(e),r=this._pinMap.get(e)||0;return{visible:this._visible.has(e),previouslyVisible:this._previouslyVisible.has(e),hasAsset:t!=null&&t.asset()!=null,hasTexture:t!=null&&t.texture()!=null,pinned:r!==0,pinCount:r}};var da=re;function Y_(e,t){for(var r in t)e[r]=t[r];return e}var pa=Y_,X_=Z,B_=pa,U_=G;function ie(e,t,r,i,n){n=n||{};var s=this;this._source=e,this._geometry=t,this._view=r,this._textureStore=i,this._effects=n.effects||{},this._fixedLevelIndex=null,this._viewChangeHandler=function(){s.emit("viewChange",s.view())},this._view.addEventListener("change",this._viewChangeHandler),this._textureStoreChangeHandler=function(){s.emit("textureStoreChange",s.textureStore())},this._textureStore.addEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureInvalid",this._textureStoreChangeHandler)}X_(ie),ie.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureInvalid",this._textureStoreChangeHandler),U_(this)},ie.prototype.source=function(){return this._source},ie.prototype.geometry=function(){return this._geometry},ie.prototype.view=function(){return this._view},ie.prototype.textureStore=function(){return this._textureStore},ie.prototype.effects=function(){return this._effects},ie.prototype.setEffects=function(e){this._effects=e,this.emit("effectsChange",this._effects)},ie.prototype.mergeEffects=function(e){B_(this._effects,e),this.emit("effectsChange",this._effects)},ie.prototype.fixedLevel=function(){return this._fixedLevelIndex},ie.prototype.setFixedLevel=function(e){if(e!==this._fixedLevelIndex){if(e!=null&&(e>=this._geometry.levelList.length||e<0))throw new Error("Level index out of range: "+e);this._fixedLevelIndex=e,this.emit("fixedLevelChange",this._fixedLevelIndex)}},ie.prototype._selectLevel=function(){var e;return this._fixedLevelIndex!=null?e=this._geometry.levelList[this._fixedLevelIndex]:e=this._view.selectLevel(this._geometry.selectableLevelList),e},ie.prototype.visibleTiles=function(e){var t=this._selectLevel();return this._geometry.visibleTiles(this._view,t,e)},ie.prototype.pinLevel=function(e){for(var t=this._geometry.levelList[e],r=this._geometry.levelTiles(t),i=0;i<r.length;i++)this._textureStore.pin(r[i])},ie.prototype.unpinLevel=function(e){for(var t=this._geometry.levelList[e],r=this._geometry.levelTiles(t),i=0;i<r.length;i++)this._textureStore.unpin(r[i])},ie.prototype.pinFirstLevel=function(){return this.pinLevel(0)},ie.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)};var _a=ie,G_=Z,j_=G;function et(e){var t=this;this._stage=e,this._running=!1,this._rendering=!1,this._requestHandle=null,this._boundLoop=this._loop.bind(this),this._renderInvalidHandler=function(){t._rendering||t.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}G_(et),et.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),j_(this)},et.prototype.stage=function(){return this._stage},et.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},et.prototype.stop=function(){this._requestHandle&&(window.cancelAnimationFrame(this._requestHandle),this._requestHandle=null),this._running=!1},et.prototype.renderOnNextFrame=function(){this._running&&!this._requestHandle&&(this._requestHandle=window.requestAnimationFrame(this._boundLoop))},et.prototype._loop=function(){if(!this._running)throw new Error("Render loop running while in stopped state");this._requestHandle=null,this._rendering=!0,this.emit("beforeRender"),this._rendering=!1,this._stage.render(),this.emit("afterRender")};var ma=et;function Ne(){this.velocity=null,this.friction=null,this.offset=null}Ne.equals=function(e,t){return e.velocity===t.velocity&&e.friction===t.friction&&e.offset===t.offset},Ne.prototype.equals=function(e){return Ne.equals(this,e)},Ne.prototype.update=function(e,t){e.offset&&(this.offset=this.offset||0,this.offset+=e.offset);var r=this.offsetFromVelocity(t);r&&(this.offset=this.offset||0,this.offset+=r),this.velocity=e.velocity,this.friction=e.friction},Ne.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},Ne.prototype.velocityAfter=function(e){return this.velocity?this.friction?Z_(this.velocity,this.friction*e):this.velocity:null},Ne.prototype.offsetFromVelocity=function(e){e=Math.min(e,this.nullVelocityTime());var t=this.velocityAfter(e),r=(this.velocity+t)/2;return r*e},Ne.prototype.nullVelocityTime=function(){return this.velocity==null?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)};function Z_(e,t){return e<0?Math.min(0,e+t):e>0?Math.max(0,e-t):0}var ke=Ne,K_=Z,Q_=ke,J_=G;function Ct(e,t,r,i,n){if(!e)throw new Error("KeyControlMethod: keyCode must be defined");if(!t)throw new Error("KeyControlMethod: parameter must be defined");if(!r)throw new Error("KeyControlMethod: velocity must be defined");if(!i)throw new Error("KeyControlMethod: friction must be defined");n=n||document,this._keyCode=e,this._parameter=t,this._velocity=r,this._friction=i,this._element=n,this._keydownHandler=this._handlePress.bind(this),this._keyupHandler=this._handleRelease.bind(this),this._blurHandler=this._handleBlur.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler),this._dynamics=new Q_,this._pressing=!1}K_(Ct),Ct.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler),J_(this)},Ct.prototype._handlePress=function(e){e.keyCode===this._keyCode&&(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))},Ct.prototype._handleRelease=function(e){e.keyCode===this._keyCode&&(this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1)},Ct.prototype._handleBlur=function(){this._dynamics.velocity=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive"),this._pressing=!1};var ya=Ct,zi={exports:{}};/*! Hammer.JS - v2.0.4 - 2014-09-28
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2014 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,r,i,n){var s=["","webkit","moz","MS","ms","o"],a=r.createElement("div"),o="function",l=Math.round,h=Math.abs,c=Date.now;function f(v,d,y){return setTimeout(M(v,y),d)}function u(v,d,y){return Array.isArray(v)?(p(v,y[d],y),!0):!1}function p(v,d,y){var x;if(!!v)if(v.forEach)v.forEach(d,y);else if(v.length!==n)for(x=0;x<v.length;)d.call(y,v[x],x,v),x++;else for(x in v)v.hasOwnProperty(x)&&d.call(y,v[x],x,v)}function _(v,d,y){for(var x=Object.keys(d),T=0;T<x.length;)(!y||y&&v[x[T]]===n)&&(v[x[T]]=d[x[T]]),T++;return v}function w(v,d){return _(v,d,!0)}function m(v,d,y){var x=d.prototype,T;T=v.prototype=Object.create(x),T.constructor=v,T._super=x,y&&_(T,y)}function M(v,d){return function(){return v.apply(d,arguments)}}function b(v,d){return typeof v==o?v.apply(d&&d[0]||n,d):v}function $(v,d){return v===n?d:v}function S(v,d,y){p(k(d),function(x){v.addEventListener(x,y,!1)})}function C(v,d,y){p(k(d),function(x){v.removeEventListener(x,y,!1)})}function E(v,d){for(;v;){if(v==d)return!0;v=v.parentNode}return!1}function D(v,d){return v.indexOf(d)>-1}function k(v){return v.trim().split(/\s+/g)}function H(v,d,y){if(v.indexOf&&!y)return v.indexOf(d);for(var x=0;x<v.length;){if(y&&v[x][y]==d||!y&&v[x]===d)return x;x++}return-1}function N(v){return Array.prototype.slice.call(v,0)}function R(v,d,y){for(var x=[],T=[],A=0;A<v.length;){var V=d?v[A][d]:v[A];H(T,V)<0&&x.push(v[A]),T[A]=V,A++}return y&&(d?x=x.sort(function(he,ze){return he[d]>ze[d]}):x=x.sort()),x}function F(v,d){for(var y,x,T=d[0].toUpperCase()+d.slice(1),A=0;A<s.length;){if(y=s[A],x=y?y+T:d,x in v)return x;A++}return n}var B=1;function z(){return B++}function g(v){var d=v.ownerDocument;return d.defaultView||d.parentWindow}var Ve=/mobile|tablet|ip(ad|hone|od)|android/i,j="ontouchstart"in t,mt=F(t,"PointerEvent")!==n,Ce=j&&Ve.test(navigator.userAgent),de="touch",fm="pen",Ni="mouse",um="kinect",dm=25,ce=1,yt=2,J=4,ve=8,Rr=1,Jt=2,er=4,tr=8,rr=16,Le=Jt|er,gt=tr|rr,Ga=Le|gt,ja=["x","y"],Ir=["clientX","clientY"];function me(v,d){var y=this;this.manager=v,this.callback=d,this.element=v.element,this.target=v.options.inputTarget,this.domHandler=function(x){b(v.options.enable,[v])&&y.handler(x)},this.init()}me.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(g(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(g(this.element),this.evWin,this.domHandler)}};function pm(v){var d,y=v.options.inputClass;return y?d=y:mt?d=Fi:Ce?d=Hr:j?d=Vi:d=Dr,new d(v,_m)}function _m(v,d,y){var x=y.pointers.length,T=y.changedPointers.length,A=d&ce&&x-T==0,V=d&(J|ve)&&x-T==0;y.isFirst=!!A,y.isFinal=!!V,A&&(v.session={}),y.eventType=d,mm(v,y),v.emit("hammer.input",y),v.recognize(y),v.session.prevInput=y}function mm(v,d){var y=v.session,x=d.pointers,T=x.length;y.firstInput||(y.firstInput=Za(d)),T>1&&!y.firstMultiple?y.firstMultiple=Za(d):T===1&&(y.firstMultiple=!1);var A=y.firstInput,V=y.firstMultiple,ae=V?V.center:A.center,he=d.center=Ka(x);d.timeStamp=c(),d.deltaTime=d.timeStamp-A.timeStamp,d.angle=ki(ae,he),d.distance=Or(ae,he),ym(y,d),d.offsetDirection=Qa(d.deltaX,d.deltaY),d.scale=V?Mm(V.pointers,x):1,d.rotation=V?xm(V.pointers,x):0,gm(y,d);var ze=v.element;E(d.srcEvent.target,ze)&&(ze=d.srcEvent.target),d.target=ze}function ym(v,d){var y=d.center,x=v.offsetDelta||{},T=v.prevDelta||{},A=v.prevInput||{};(d.eventType===ce||A.eventType===J)&&(T=v.prevDelta={x:A.deltaX||0,y:A.deltaY||0},x=v.offsetDelta={x:y.x,y:y.y}),d.deltaX=T.x+(y.x-x.x),d.deltaY=T.y+(y.y-x.y)}function gm(v,d){var y=v.lastInterval||d,x=d.timeStamp-y.timeStamp,T,A,V,ae;if(d.eventType!=ve&&(x>dm||y.velocity===n)){var he=y.deltaX-d.deltaX,ze=y.deltaY-d.deltaY,Rt=wm(x,he,ze);A=Rt.x,V=Rt.y,T=h(Rt.x)>h(Rt.y)?Rt.x:Rt.y,ae=Qa(he,ze),v.lastInterval=d}else T=y.velocity,A=y.velocityX,V=y.velocityY,ae=y.direction;d.velocity=T,d.velocityX=A,d.velocityY=V,d.direction=ae}function Za(v){for(var d=[],y=0;y<v.pointers.length;)d[y]={clientX:l(v.pointers[y].clientX),clientY:l(v.pointers[y].clientY)},y++;return{timeStamp:c(),pointers:d,center:Ka(d),deltaX:v.deltaX,deltaY:v.deltaY}}function Ka(v){var d=v.length;if(d===1)return{x:l(v[0].clientX),y:l(v[0].clientY)};for(var y=0,x=0,T=0;T<d;)y+=v[T].clientX,x+=v[T].clientY,T++;return{x:l(y/d),y:l(x/d)}}function wm(v,d,y){return{x:d/v||0,y:y/v||0}}function Qa(v,d){return v===d?Rr:h(v)>=h(d)?v>0?Jt:er:d>0?tr:rr}function Or(v,d,y){y||(y=ja);var x=d[y[0]]-v[y[0]],T=d[y[1]]-v[y[1]];return Math.sqrt(x*x+T*T)}function ki(v,d,y){y||(y=ja);var x=d[y[0]]-v[y[0]],T=d[y[1]]-v[y[1]];return Math.atan2(T,x)*180/Math.PI}function xm(v,d){return ki(d[1],d[0],Ir)-ki(v[1],v[0],Ir)}function Mm(v,d){return Or(d[0],d[1],Ir)/Or(v[0],v[1],Ir)}var Tm={mousedown:ce,mousemove:yt,mouseup:J},Em="mousedown",bm="mousemove mouseup";function Dr(){this.evEl=Em,this.evWin=bm,this.allow=!0,this.pressed=!1,me.apply(this,arguments)}m(Dr,me,{handler:function(d){var y=Tm[d.type];y&ce&&d.button===0&&(this.pressed=!0),y&yt&&d.which!==1&&(y=J),!(!this.pressed||!this.allow)&&(y&J&&(this.pressed=!1),this.callback(this.manager,y,{pointers:[d],changedPointers:[d],pointerType:Ni,srcEvent:d}))}});var $m={pointerdown:ce,pointermove:yt,pointerup:J,pointercancel:ve,pointerout:ve},Sm={2:de,3:fm,4:Ni,5:um},Ja="pointerdown",eo="pointermove pointerup pointercancel";t.MSPointerEvent&&(Ja="MSPointerDown",eo="MSPointerMove MSPointerUp MSPointerCancel");function Fi(){this.evEl=Ja,this.evWin=eo,me.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}m(Fi,me,{handler:function(d){var y=this.store,x=!1,T=d.type.toLowerCase().replace("ms",""),A=$m[T],V=Sm[d.pointerType]||d.pointerType,ae=V==de,he=H(y,d.pointerId,"pointerId");A&ce&&(d.button===0||ae)?he<0&&(y.push(d),he=y.length-1):A&(J|ve)&&(x=!0),!(he<0)&&(y[he]=d,this.callback(this.manager,A,{pointers:y,changedPointers:[d],pointerType:V,srcEvent:d}),x&&y.splice(he,1))}});var Cm={touchstart:ce,touchmove:yt,touchend:J,touchcancel:ve},Lm="touchstart",Pm="touchstart touchmove touchend touchcancel";function to(){this.evTarget=Lm,this.evWin=Pm,this.started=!1,me.apply(this,arguments)}m(to,me,{handler:function(d){var y=Cm[d.type];if(y===ce&&(this.started=!0),!!this.started){var x=zm.call(this,d,y);y&(J|ve)&&x[0].length-x[1].length==0&&(this.started=!1),this.callback(this.manager,y,{pointers:x[0],changedPointers:x[1],pointerType:de,srcEvent:d})}}});function zm(v,d){var y=N(v.touches),x=N(v.changedTouches);return d&(J|ve)&&(y=R(y.concat(x),"identifier",!0)),[y,x]}var Am={touchstart:ce,touchmove:yt,touchend:J,touchcancel:ve},Rm="touchstart touchmove touchend touchcancel";function Hr(){this.evTarget=Rm,this.targetIds={},me.apply(this,arguments)}m(Hr,me,{handler:function(d){var y=Am[d.type],x=Im.call(this,d,y);!x||this.callback(this.manager,y,{pointers:x[0],changedPointers:x[1],pointerType:de,srcEvent:d})}});function Im(v,d){var y=N(v.touches),x=this.targetIds;if(d&(ce|yt)&&y.length===1)return x[y[0].identifier]=!0,[y,y];var T,A,V=N(v.changedTouches),ae=[],he=this.target;if(A=y.filter(function(ze){return E(ze.target,he)}),d===ce)for(T=0;T<A.length;)x[A[T].identifier]=!0,T++;for(T=0;T<V.length;)x[V[T].identifier]&&ae.push(V[T]),d&(J|ve)&&delete x[V[T].identifier],T++;if(!!ae.length)return[R(A.concat(ae),"identifier",!0),ae]}function Vi(){me.apply(this,arguments);var v=M(this.handler,this);this.touch=new Hr(this.manager,v),this.mouse=new Dr(this.manager,v)}m(Vi,me,{handler:function(d,y,x){var T=x.pointerType==de,A=x.pointerType==Ni;if(T)this.mouse.allow=!1;else if(A&&!this.mouse.allow)return;y&(J|ve)&&(this.mouse.allow=!0),this.callback(d,y,x)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ro=F(a.style,"touchAction"),io=ro!==n,no="compute",so="auto",qi="manipulation",ir="none",nr="pan-x",sr="pan-y";function Wi(v,d){this.manager=v,this.set(d)}Wi.prototype={set:function(v){v==no&&(v=this.compute()),io&&(this.manager.element.style[ro]=v),this.actions=v.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var v=[];return p(this.manager.recognizers,function(d){b(d.options.enable,[d])&&(v=v.concat(d.getTouchAction()))}),Om(v.join(" "))},preventDefaults:function(v){if(!io){var d=v.srcEvent,y=v.offsetDirection;if(this.manager.session.prevented){d.preventDefault();return}var x=this.actions,T=D(x,ir),A=D(x,sr),V=D(x,nr);if(T||A&&y&Le||V&&y&gt)return this.preventSrc(d)}},preventSrc:function(v){this.manager.session.prevented=!0,v.preventDefault()}};function Om(v){if(D(v,ir))return ir;var d=D(v,nr),y=D(v,sr);return d&&y?nr+" "+sr:d||y?d?nr:sr:D(v,qi)?qi:so}var Nr=1,ye=2,At=4,tt=8,qe=tt,ar=16,Pe=32;function We(v){this.id=z(),this.manager=null,this.options=w(v||{},this.defaults),this.options.enable=$(this.options.enable,!0),this.state=Nr,this.simultaneous={},this.requireFail=[]}We.prototype={defaults:{},set:function(v){return _(this.options,v),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(v){if(u(v,"recognizeWith",this))return this;var d=this.simultaneous;return v=kr(v,this),d[v.id]||(d[v.id]=v,v.recognizeWith(this)),this},dropRecognizeWith:function(v){return u(v,"dropRecognizeWith",this)?this:(v=kr(v,this),delete this.simultaneous[v.id],this)},requireFailure:function(v){if(u(v,"requireFailure",this))return this;var d=this.requireFail;return v=kr(v,this),H(d,v)===-1&&(d.push(v),v.requireFailure(this)),this},dropRequireFailure:function(v){if(u(v,"dropRequireFailure",this))return this;v=kr(v,this);var d=H(this.requireFail,v);return d>-1&&this.requireFail.splice(d,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(v){return!!this.simultaneous[v.id]},emit:function(v){var d=this,y=this.state;function x(T){d.manager.emit(d.options.event+(T?Dm(y):""),v)}y<tt&&x(!0),x(),y>=tt&&x(!0)},tryEmit:function(v){if(this.canEmit())return this.emit(v);this.state=Pe},canEmit:function(){for(var v=0;v<this.requireFail.length;){if(!(this.requireFail[v].state&(Pe|Nr)))return!1;v++}return!0},recognize:function(v){var d=_({},v);if(!b(this.options.enable,[this,d])){this.reset(),this.state=Pe;return}this.state&(qe|ar|Pe)&&(this.state=Nr),this.state=this.process(d),this.state&(ye|At|tt|ar)&&this.tryEmit(d)},process:function(v){},getTouchAction:function(){},reset:function(){}};function Dm(v){return v&ar?"cancel":v&tt?"end":v&At?"move":v&ye?"start":""}function ao(v){return v==rr?"down":v==tr?"up":v==Jt?"left":v==er?"right":""}function kr(v,d){var y=d.manager;return y?y.get(v):v}function xe(){We.apply(this,arguments)}m(xe,We,{defaults:{pointers:1},attrTest:function(v){var d=this.options.pointers;return d===0||v.pointers.length===d},process:function(v){var d=this.state,y=v.eventType,x=d&(ye|At),T=this.attrTest(v);return x&&(y&ve||!T)?d|ar:x||T?y&J?d|tt:d&ye?d|At:ye:Pe}});function Fr(){xe.apply(this,arguments),this.pX=null,this.pY=null}m(Fr,xe,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ga},getTouchAction:function(){var v=this.options.direction,d=[];return v&Le&&d.push(sr),v&gt&&d.push(nr),d},directionTest:function(v){var d=this.options,y=!0,x=v.distance,T=v.direction,A=v.deltaX,V=v.deltaY;return T&d.direction||(d.direction&Le?(T=A===0?Rr:A<0?Jt:er,y=A!=this.pX,x=Math.abs(v.deltaX)):(T=V===0?Rr:V<0?tr:rr,y=V!=this.pY,x=Math.abs(v.deltaY))),v.direction=T,y&&x>d.threshold&&T&d.direction},attrTest:function(v){return xe.prototype.attrTest.call(this,v)&&(this.state&ye||!(this.state&ye)&&this.directionTest(v))},emit:function(v){this.pX=v.deltaX,this.pY=v.deltaY;var d=ao(v.direction);d&&this.manager.emit(this.options.event+d,v),this._super.emit.call(this,v)}});function Yi(){xe.apply(this,arguments)}m(Yi,xe,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ir]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.scale-1)>this.options.threshold||this.state&ye)},emit:function(v){if(this._super.emit.call(this,v),v.scale!==1){var d=v.scale<1?"in":"out";this.manager.emit(this.options.event+d,v)}}});function Xi(){We.apply(this,arguments),this._timer=null,this._input=null}m(Xi,We,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[so]},process:function(v){var d=this.options,y=v.pointers.length===d.pointers,x=v.distance<d.threshold,T=v.deltaTime>d.time;if(this._input=v,!x||!y||v.eventType&(J|ve)&&!T)this.reset();else if(v.eventType&ce)this.reset(),this._timer=f(function(){this.state=qe,this.tryEmit()},d.time,this);else if(v.eventType&J)return qe;return Pe},reset:function(){clearTimeout(this._timer)},emit:function(v){this.state===qe&&(v&&v.eventType&J?this.manager.emit(this.options.event+"up",v):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}});function Bi(){xe.apply(this,arguments)}m(Bi,xe,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ir]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.rotation)>this.options.threshold||this.state&ye)}});function Ui(){xe.apply(this,arguments)}m(Ui,xe,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Le|gt,pointers:1},getTouchAction:function(){return Fr.prototype.getTouchAction.call(this)},attrTest:function(v){var d=this.options.direction,y;return d&(Le|gt)?y=v.velocity:d&Le?y=v.velocityX:d&gt&&(y=v.velocityY),this._super.attrTest.call(this,v)&&d&v.direction&&v.distance>this.options.threshold&&h(y)>this.options.velocity&&v.eventType&J},emit:function(v){var d=ao(v.direction);d&&this.manager.emit(this.options.event+d,v),this.manager.emit(this.options.event,v)}});function Vr(){We.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}m(Vr,We,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[qi]},process:function(v){var d=this.options,y=v.pointers.length===d.pointers,x=v.distance<d.threshold,T=v.deltaTime<d.time;if(this.reset(),v.eventType&ce&&this.count===0)return this.failTimeout();if(x&&T&&y){if(v.eventType!=J)return this.failTimeout();var A=this.pTime?v.timeStamp-this.pTime<d.interval:!0,V=!this.pCenter||Or(this.pCenter,v.center)<d.posThreshold;this.pTime=v.timeStamp,this.pCenter=v.center,!V||!A?this.count=1:this.count+=1,this._input=v;var ae=this.count%d.taps;if(ae===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=qe,this.tryEmit()},d.interval,this),ye):qe}return Pe},failTimeout:function(){return this._timer=f(function(){this.state=Pe},this.options.interval,this),Pe},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==qe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function rt(v,d){return d=d||{},d.recognizers=$(d.recognizers,rt.defaults.preset),new Gi(v,d)}rt.VERSION="2.0.4",rt.defaults={domEvents:!1,touchAction:no,enable:!0,inputTarget:null,inputClass:null,preset:[[Bi,{enable:!1}],[Yi,{enable:!1},["rotate"]],[Ui,{direction:Le}],[Fr,{direction:Le},["swipe"]],[Vr],[Vr,{event:"doubletap",taps:2},["tap"]],[Xi]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Hm=1,oo=2;function Gi(v,d){d=d||{},this.options=w(d,rt.defaults),this.options.inputTarget=this.options.inputTarget||v,this.handlers={},this.session={},this.recognizers=[],this.element=v,this.input=pm(this),this.touchAction=new Wi(this,this.options.touchAction),ho(this,!0),p(d.recognizers,function(y){var x=this.add(new y[0](y[1]));y[2]&&x.recognizeWith(y[2]),y[3]&&x.requireFailure(y[3])},this)}Gi.prototype={set:function(v){return _(this.options,v),v.touchAction&&this.touchAction.update(),v.inputTarget&&(this.input.destroy(),this.input.target=v.inputTarget,this.input.init()),this},stop:function(v){this.session.stopped=v?oo:Hm},recognize:function(v){var d=this.session;if(!d.stopped){this.touchAction.preventDefaults(v);var y,x=this.recognizers,T=d.curRecognizer;(!T||T&&T.state&qe)&&(T=d.curRecognizer=null);for(var A=0;A<x.length;)y=x[A],d.stopped!==oo&&(!T||y==T||y.canRecognizeWith(T))?y.recognize(v):y.reset(),!T&&y.state&(ye|At|tt)&&(T=d.curRecognizer=y),A++}},get:function(v){if(v instanceof We)return v;for(var d=this.recognizers,y=0;y<d.length;y++)if(d[y].options.event==v)return d[y];return null},add:function(v){if(u(v,"add",this))return this;var d=this.get(v.options.event);return d&&this.remove(d),this.recognizers.push(v),v.manager=this,this.touchAction.update(),v},remove:function(v){if(u(v,"remove",this))return this;var d=this.recognizers;return v=this.get(v),d.splice(H(d,v),1),this.touchAction.update(),this},on:function(v,d){var y=this.handlers;return p(k(v),function(x){y[x]=y[x]||[],y[x].push(d)}),this},off:function(v,d){var y=this.handlers;return p(k(v),function(x){d?y[x].splice(H(y[x],d),1):delete y[x]}),this},emit:function(v,d){this.options.domEvents&&Nm(v,d);var y=this.handlers[v]&&this.handlers[v].slice();if(!(!y||!y.length)){d.type=v,d.preventDefault=function(){d.srcEvent.preventDefault()};for(var x=0;x<y.length;)y[x](d),x++}},destroy:function(){this.element&&ho(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ho(v,d){var y=v.element;p(v.options.cssProps,function(x,T){y.style[F(y.style,T)]=d?x:""})}function Nm(v,d){var y=r.createEvent("Event");y.initEvent(v,!0,!0),y.gesture=d,d.target.dispatchEvent(y)}_(rt,{INPUT_START:ce,INPUT_MOVE:yt,INPUT_END:J,INPUT_CANCEL:ve,STATE_POSSIBLE:Nr,STATE_BEGAN:ye,STATE_CHANGED:At,STATE_ENDED:tt,STATE_RECOGNIZED:qe,STATE_CANCELLED:ar,STATE_FAILED:Pe,DIRECTION_NONE:Rr,DIRECTION_LEFT:Jt,DIRECTION_RIGHT:er,DIRECTION_UP:tr,DIRECTION_DOWN:rr,DIRECTION_HORIZONTAL:Le,DIRECTION_VERTICAL:gt,DIRECTION_ALL:Ga,Manager:Gi,Input:me,TouchAction:Wi,TouchInput:Hr,MouseInput:Dr,PointerEventInput:Fi,TouchMouseInput:Vi,SingleTouchInput:to,Recognizer:We,AttrRecognizer:xe,Tap:Vr,Pan:Fr,Swipe:Ui,Pinch:Yi,Rotate:Bi,Press:Xi,on:S,off:C,each:p,merge:w,extend:_,inherit:m,bindFn:M,prefixed:F}),typeof n==o&&n.amd?n(function(){return rt}):e.exports?e.exports=rt:t[i]=rt})(window,document,"Hammer")})(zi);var Lt=zi.exports,e1=1,Ai="MarzipanoHammerElementId";function ga(e,t){return e[Ai]||(e[Ai]=e1++),t+e[Ai]}function Lr(){this._managers={},this._refCount={}}Lr.prototype.get=function(e,t){var r=ga(e,t);return this._managers[r]||(this._managers[r]=this._createManager(e,t),this._refCount[r]=0),this._refCount[r]++,new Pr(this,this._managers[r],e,t)},Lr.prototype._createManager=function(e,t){var r=new Lt.Manager(e);return t==="mouse"?r.add(new Lt.Pan({direction:Lt.DIRECTION_ALL,threshold:0})):(t==="touch"||t==="pen"||t==="kinect")&&(r.add(new Lt.Pan({direction:Lt.DIRECTION_ALL,threshold:20,pointers:1})),r.add(new Lt.Pinch)),r},Lr.prototype._releaseHandle=function(e,t){var r=ga(e,t);this._refCount[r]&&(this._refCount[r]--,this._refCount[r]||(this._managers[r].destroy(),delete this._managers[r],delete this._refCount[r]))};function Pr(e,t,r,i){this._manager=t,this._element=r,this._type=i,this._hammerGestures=e,this._eventHandlers=[]}Pr.prototype.on=function(e,t){var r=this._type,i=function(n){r===n.pointerType&&t(n)};this._eventHandlers.push({events:e,handler:i}),this._manager.on(e,i)},Pr.prototype.release=function(){for(var e=0;e<this._eventHandlers.length;e++){var t=this._eventHandlers[e];this._manager.off(t.events,t.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},Pr.prototype.manager=function(){return this._manager};var zr=new Lr;function t1(e,t,r,i,n){var s=Math.sqrt(Math.pow(t,2)+Math.pow(r,2));e=Math.max(e,s/i),wa(t,r,e,n),n[0]=Math.abs(n[0]),n[1]=Math.abs(n[1])}function wa(e,t,r,i){var n=Math.atan(t/e);i[0]=r*Math.cos(n),i[1]=r*Math.sin(n)}var xa={maxFriction:t1,changeVectorNorm:wa},r1=Z,Ma=ke,i1=zr,n1=$e,s1=xa.maxFriction,a1=G,o1={friction:6,maxFrictionTime:.3,hammerEvent:"pan"},Ta=typeof MARZIPANODEBUG!="undefined"&&MARZIPANODEBUG.controls;function Fe(e,t,r){if(this._element=e,this._opts=n1(r||{},o1),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new Ma,y:new Ma},this._hammer=i1.get(e,t),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),this._opts.hammerEvent!="pan"&&this._opts.hammerEvent!="pinch")throw new Error(this._opts.hammerEvent+" is not a hammerEvent managed in DragControlMethod");this._hammer.on(this._opts.hammerEvent+"start",this._handleStart.bind(this)),this._hammer.on(this._opts.hammerEvent+"move",this._handleMove.bind(this)),this._hammer.on(this._opts.hammerEvent+"end",this._handleEnd.bind(this)),this._hammer.on(this._opts.hammerEvent+"cancel",this._handleEnd.bind(this))}r1(Fe),Fe.prototype.destroy=function(){this._hammer.release(),a1(this)},Fe.prototype._handleHammerEvent=function(e){if(e.isFirst){if(Ta&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}if(e.isFinal){if(Ta&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},Fe.prototype._handleStart=function(e){e.preventDefault(),this._startEvent=e},Fe.prototype._handleMove=function(e){e.preventDefault(),this._startEvent&&(this._updateDynamicsMove(e),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},Fe.prototype._handleEnd=function(e){e.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(e),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},Fe.prototype._updateDynamicsMove=function(e){var t=e.deltaX,r=e.deltaY,i=this._lastEvent||this._startEvent;i&&(t-=i.deltaX,r-=i.deltaY);var n=this._element.getBoundingClientRect(),s=n.right-n.left,a=n.bottom-n.top;t/=s,r/=a,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-t,this._dynamics.y.offset=-r,this._lastEvent=e};var Ri=[null,null];Fe.prototype._updateDynamicsRelease=function(e){var t=this._element.getBoundingClientRect(),r=t.right-t.left,i=t.bottom-t.top,n=1e3*e.velocityX/r,s=1e3*e.velocityY/i;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=n,this._dynamics.y.velocity=s,s1(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,Ri),this._dynamics.x.friction=Ri[0],this._dynamics.y.friction=Ri[1]};var Ea=Fe,h1=Z,ba=ke,l1=zr,c1=$e,v1=xa.maxFriction,f1=G,u1={speed:8,friction:6,maxFrictionTime:.3};function pt(e,t,r){this._element=e,this._opts=c1(r||{},u1),this._active=!1,this._hammer=l1.get(e,t),this._dynamics={x:new ba,y:new ba},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}h1(pt),pt.prototype.destroy=function(){this._hammer.release(),f1(this)},pt.prototype._handleStart=function(e){e.preventDefault(),this._active||(this._active=!0,this.emit("active"))},pt.prototype._handleMove=function(e){e.preventDefault(),this._updateDynamics(e,!1)},pt.prototype._handleRelease=function(e){e.preventDefault(),this._updateDynamics(e,!0),this._active&&(this._active=!1,this.emit("inactive"))};var Ii=[null,null];pt.prototype._updateDynamics=function(e,t){var r=this._element.getBoundingClientRect(),i=r.right-r.left,n=r.bottom-r.top,s=Math.max(i,n),a=e.deltaX/s*this._opts.speed,o=e.deltaY/s*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=a,this._dynamics.y.velocity=o,t&&(v1(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,Ii),this._dynamics.x.friction=Ii[0],this._dynamics.y.friction=Ii[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)};var $a=pt,d1=Z,p1=ke,_1=$e,m1=G,y1={frictionTime:.2,zoomDelta:.001};function jt(e,t){this._element=e,this._opts=_1(t||{},y1),this._dynamics=new p1,this._eventList=[];var r=this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing;this._wheelListener=r.bind(this),e.addEventListener("wheel",this._wheelListener)}d1(jt),jt.prototype.destroy=function(){this._element.removeEventListener("wheel",this._wheelListener),m1(this)},jt.prototype.withoutSmoothing=function(e){this._dynamics.offset=Sa(e)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),e.preventDefault(),this.emit("active"),this.emit("inactive")},jt.prototype.withSmoothing=function(e){var t=e.timeStamp;for(this._eventList.push(e);this._eventList[0].timeStamp<t-this._opts.frictionTime*1e3;)this._eventList.shift(0);for(var r=0,i=0;i<this._eventList.length;i++){var n=Sa(this._eventList[i])*this._opts.zoomDelta;r+=n/this._opts.frictionTime}this._dynamics.velocity=r,this._dynamics.friction=Math.abs(r)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),e.preventDefault(),this.emit("active"),this.emit("inactive")};function Sa(e){var t=e.deltaMode==1?20:1;return e.deltaY*t}var Ca=jt,g1=Z,w1=ke,x1=zr,M1=G;function Pt(e,t,r){this._hammer=x1.get(e,t),this._lastEvent=null,this._active=!1,this._dynamics=new w1,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}g1(Pt),Pt.prototype.destroy=function(){this._hammer.release(),M1(this)},Pt.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},Pt.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},Pt.prototype._handleEvent=function(e){var t=e.scale;this._lastEvent&&(t/=this._lastEvent.scale),this._dynamics.offset=(t-1)*-1,this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=e};var La=Pt,T1=Z,E1=ke,b1=G;function Zt(e){if(!e)throw new Error("VelocityControlMethod: parameter must be defined");this._parameter=e,this._dynamics=new E1}T1(Zt),Zt.prototype.destroy=function(){b1(this)},Zt.prototype.setVelocity=function(e){this._dynamics.velocity=e,this.emit("parameterDynamics",this._parameter,this._dynamics)},Zt.prototype.setFriction=function(e){this._dynamics.friction=e,this.emit("parameterDynamics",this._parameter,this._dynamics)};var $1=Zt,S1=Z,C1=ke,L1=G;function Kt(e,t,r,i){if(!e)throw new Error("ElementPressControlMethod: element must be defined");if(!t)throw new Error("ElementPressControlMethod: parameter must be defined");if(!r)throw new Error("ElementPressControlMethod: velocity must be defined");if(!i)throw new Error("ElementPressControlMethod: friction must be defined");this._element=e,this._pressHandler=this._handlePress.bind(this),this._releaseHandler=this._handleRelease.bind(this),e.addEventListener("mousedown",this._pressHandler),e.addEventListener("mouseup",this._releaseHandler),e.addEventListener("mouseleave",this._releaseHandler),e.addEventListener("touchstart",this._pressHandler),e.addEventListener("touchmove",this._releaseHandler),e.addEventListener("touchend",this._releaseHandler),this._parameter=t,this._velocity=r,this._friction=i,this._dynamics=new C1,this._pressing=!1}S1(Kt),Kt.prototype.destroy=function(){this._element.removeEventListener("mousedown",this._pressHandler),this._element.removeEventListener("mouseup",this._releaseHandler),this._element.removeEventListener("mouseleave",this._releaseHandler),this._element.removeEventListener("touchstart",this._pressHandler),this._element.removeEventListener("touchmove",this._releaseHandler),this._element.removeEventListener("touchend",this._releaseHandler),L1(this)},Kt.prototype._handlePress=function(){this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active")},Kt.prototype._handleRelease=function(){this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1};var P1=Kt,z1=Z,A1=ke,R1=st,I1=G;function we(e){e=e||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch","roll"],this._now=e.nowForTesting||R1,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}z1(we),we.prototype.add=function(e){if(!this.has(e)){var t={};this._parameters.forEach(function(n){t[n]={dynamics:new A1,time:null}});var r=this._updateDynamics.bind(this,t),i={instance:e,dynamics:t,parameterDynamicsHandler:r};e.addEventListener("parameterDynamics",r),this._methods.push(i)}},we.prototype.remove=function(e){var t=this._indexOfInstance(e);if(t>=0){var r=this._methods.splice(t,1)[0];r.instance.removeEventListener("parameterDynamics",r.parameterDynamicsHandler)}},we.prototype.has=function(e){return this._indexOfInstance(e)>=0},we.prototype._indexOfInstance=function(e){for(var t=0;t<this._methods.length;t++)if(this._methods[t].instance===e)return t;return-1},we.prototype.list=function(){for(var e=[],t=0;t<this._methods.length;t++)e.push(this._methods[t].instance);return e},we.prototype._updateDynamics=function(e,t,r){var i=e[t];if(!i)throw new Error("Unknown control parameter "+t);var n=this._now();i.dynamics.update(r,(n-i.time)/1e3),i.time=n,this.emit("change")},we.prototype._resetComposedOffsets=function(){for(var e=0;e<this._parameters.length;e++)this._composedOffsets[this._parameters[e]]=0},we.prototype.offsets=function(){var e,t=!1,r=this._now();this._resetComposedOffsets();for(var i=0;i<this._methods.length;i++)for(var n=this._methods[i].dynamics,s=0;s<this._parameters.length;s++){e=this._parameters[s];var a=n[e],o=a.dynamics;o.offset!=null&&(this._composedOffsets[e]+=o.offset,o.offset=null);var l=(r-a.time)/1e3,h=o.offsetFromVelocity(l);h&&(this._composedOffsets[e]+=h);var c=o.velocityAfter(l);o.velocity=c,c&&(t=!0),a.time=r}return this._composeReturn.changing=t,this._composeReturn},we.prototype.destroy=function(){for(var e=this.list(),t=0;t<e.length;t++)this.remove(e[t]);I1(this)};var O1=we,D1=Z,H1=O1,N1=G,Pa=typeof MARZIPANODEBUG!="undefined"&&MARZIPANODEBUG.controls;function X(e){e=e||{},this._methods={},this._methodGroups={},this._composer=new H1,this._enabled=e&&e.enabled?!!e.enabled:!0,this._activeCount=0,this.updatedViews_=[],this._attachedRenderLoop=null}D1(X),X.prototype.destroy=function(){this.detach(),this._composer.destroy(),N1(this)},X.prototype.methods=function(){var e={};for(var t in this._methods)e[t]=this._methods[t];return e},X.prototype.method=function(e){return this._methods[e]},X.prototype.registerMethod=function(e,t,r){if(this._methods[e])throw new Error("Control method already registered with id "+e);this._methods[e]={instance:t,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,e),inactiveHandler:this._handleInactive.bind(this,e)},r&&this.enableMethod(e,t)},X.prototype.unregisterMethod=function(e){var t=this._methods[e];if(!t)throw new Error("No control method registered with id "+e);t.enabled&&this.disableMethod(e),delete this._methods[e]},X.prototype.enableMethod=function(e){var t=this._methods[e];if(!t)throw new Error("No control method registered with id "+e);t.enabled||(t.enabled=!0,t.active&&this._incrementActiveCount(),this._listen(e),this._updateComposer(),this.emit("methodEnabled",e))},X.prototype.disableMethod=function(e){var t=this._methods[e];if(!t)throw new Error("No control method registered with id "+e);!t.enabled||(t.enabled=!1,t.active&&this._decrementActiveCount(),this._unlisten(e),this._updateComposer(),this.emit("methodDisabled",e))},X.prototype.addMethodGroup=function(e,t){this._methodGroups[e]=t},X.prototype.removeMethodGroup=function(e){delete this._methodGroups[e]},X.prototype.methodGroups=function(){var e={};for(var t in this._methodGroups)e[t]=this._methodGroups[t];return e},X.prototype.enableMethodGroup=function(e){var t=this;t._methodGroups[e].forEach(function(r){t.enableMethod(r)})},X.prototype.disableMethodGroup=function(e){var t=this;t._methodGroups[e].forEach(function(r){t.disableMethod(r)})},X.prototype.enabled=function(){return this._enabled},X.prototype.enable=function(){this._enabled||(this._enabled=!0,this._activeCount>0&&this.emit("active"),this.emit("enabled"),this._updateComposer())},X.prototype.disable=function(){!this._enabled||(this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this.emit("disabled"),this._updateComposer())},X.prototype.attach=function(e){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=e,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=e.renderOnNextFrame.bind(e),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},X.prototype.detach=function(){!this._attachedRenderLoop||(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},X.prototype.attached=function(){return this._attachedRenderLoop!=null},X.prototype._listen=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");t.instance.addEventListener("active",t.activeHandler),t.instance.addEventListener("inactive",t.inactiveHandler)},X.prototype._unlisten=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");t.instance.removeEventListener("active",t.activeHandler),t.instance.removeEventListener("inactive",t.inactiveHandler)},X.prototype._handleActive=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");if(!t.enabled)throw new Error("Should not receive event from disabled control method");t.active||(t.active=!0,this._incrementActiveCount())},X.prototype._handleInactive=function(e){var t=this._methods[e];if(!t)throw new Error("Bad method id");if(!t.enabled)throw new Error("Should not receive event from disabled control method");t.active&&(t.active=!1,this._decrementActiveCount())},X.prototype._incrementActiveCount=function(){this._activeCount++,Pa&&this._checkActiveCount(),this._enabled&&this._activeCount===1&&this.emit("active")},X.prototype._decrementActiveCount=function(){this._activeCount--,Pa&&this._checkActiveCount(),this._enabled&&this._activeCount===0&&this.emit("inactive")},X.prototype._checkActiveCount=function(){var e=0;for(var t in this._methods){var r=this._methods[t];r.enabled&&r.active&&e++}if(e!=this._activeCount)throw new Error("Bad control state")},X.prototype._updateComposer=function(){var e=this._composer;for(var t in this._methods){var r=this._methods[t],i=this._enabled&&r.enabled;i&&!e.has(r.instance)&&e.add(r.instance),!i&&e.has(r.instance)&&e.remove(r.instance)}},X.prototype._updateViewsWithControls=function(){var e=this._composer.offsets();e.changing&&this._attachedRenderLoop.renderOnNextFrame(),this.updatedViews_.length=0;for(var t=this._attachedRenderLoop.stage().listLayers(),r=0;r<t.length;r++){var i=t[r].view();this.updatedViews_.indexOf(i)<0&&(t[r].view().updateWithControlParameters(e.offsets),this.updatedViews_.push(i))}};var za=X,k1=le.setTransform,Aa=$i;function F1(e,t,r,i){i=i||"";var n="translateX("+Aa(t)+"px) translateY("+Aa(r)+"px) translateZ(0) "+i;k1(e,n)}var Ra=F1,V1=Z,q1=Ra,W1=le.setTransform,Y1=G;function fe(e,t,r,i,n){n=n||{},n.perspective=n.perspective||{},n.perspective.extraTransforms=n.perspective.extraTransforms!=null?n.perspective.extraTransforms:"",this._domElement=e,this._parentDomElement=t,this._view=r,this._coords={},this._perspective={},this.setPosition(i),this._parentDomElement.appendChild(this._domElement),this.setPerspective(n.perspective),this._visible=!0,this._position={x:0,y:0}}V1(fe),fe.prototype.destroy=function(){this._parentDomElement.removeChild(this._domElement),Y1(this)},fe.prototype.domElement=function(){return this._domElement},fe.prototype.position=function(){return this._coords},fe.prototype.setPosition=function(e){for(var t in e)this._coords[t]=e[t];this._update()},fe.prototype.perspective=function(){return this._perspective},fe.prototype.setPerspective=function(e){for(var t in e)this._perspective[t]=e[t];this._update()},fe.prototype.show=function(){this._visible||(this._visible=!0,this._update())},fe.prototype.hide=function(){this._visible&&(this._visible=!1,this._update())},fe.prototype._update=function(){var e=this._domElement,t=this._coords,r=this._position,i,n,s=!1;if(this._visible){var a=this._view;this._perspective.radius?(s=!0,this._setEmbeddedPosition(a,t)):(a.coordinatesToScreen(t,r),i=r.x,n=r.y,i!=null&&n!=null&&(s=!0,this._setPosition(i,n)))}s?(e.style.display="block",e.style.position="absolute"):(e.style.display="none",e.style.position="")},fe.prototype._setEmbeddedPosition=function(e,t){var r=e.coordinatesToPerspectiveTransform(t,this._perspective.radius,this._perspective.extraTransforms);W1(this._domElement,r)},fe.prototype._setPosition=function(e,t){q1(this._domElement,e,t,this._perspective.extraTransforms)};var Ia=fe,X1=Z,B1=Ia,U1=hn,Oa=Ra,Da=le.setAbsolute,G1=le.setOverflowHidden,j1=le.setOverflowVisible,Z1=le.setNullSize,K1=le.setPixelSize,Ha=le.setWithVendorPrefix("pointer-events"),Q1=G;function ue(e,t,r,i,n){n=n||{},this._parentDomElement=e,this._stage=t,this._view=r,this._renderLoop=i,this._hotspots=[],this._visible=!0,this._rect=n.rect,this._visibilityOrRectChanged=!0,this._stageWidth=null,this._stageHeight=null,this._tmpRect={},this._hotspotContainerWrapper=document.createElement("div"),Da(this._hotspotContainerWrapper),Ha(this._hotspotContainerWrapper,"none"),this._parentDomElement.appendChild(this._hotspotContainerWrapper),this._hotspotContainer=document.createElement("div"),Da(this._hotspotContainer),Ha(this._hotspotContainer,"all"),this._hotspotContainerWrapper.appendChild(this._hotspotContainer),this._updateHandler=this._update.bind(this),this._renderLoop.addEventListener("afterRender",this._updateHandler)}X1(ue),ue.prototype.destroy=function(){for(;this._hotspots.length;)this.destroyHotspot(this._hotspots[0]);this._parentDomElement.removeChild(this._hotspotContainerWrapper),this._renderLoop.removeEventListener("afterRender",this._updateHandler),Q1(this)},ue.prototype.domElement=function(){return this._hotspotContainer},ue.prototype.setRect=function(e){this._rect=e,this._visibilityOrRectChanged=!0},ue.prototype.rect=function(){return this._rect},ue.prototype.createHotspot=function(e,t,r){t=t||{};var i=new B1(e,this._hotspotContainer,this._view,t,r);return this._hotspots.push(i),i._update(),this.emit("hotspotsChange"),i},ue.prototype.hasHotspot=function(e){return this._hotspots.indexOf(e)>=0},ue.prototype.listHotspots=function(){return[].concat(this._hotspots)},ue.prototype.destroyHotspot=function(e){var t=this._hotspots.indexOf(e);if(t<0)throw new Error("No such hotspot");this._hotspots.splice(t,1),e.destroy(),this.emit("hotspotsChange")},ue.prototype.hide=function(){this._visible&&(this._visible=!1,this._visibilityOrRectChanged=!0,this._update())},ue.prototype.show=function(){this._visible||(this._visible=!0,this._visibilityOrRectChanged=!0,this._update())},ue.prototype._update=function(){var e=this._hotspotContainerWrapper,t=this._stage.width(),r=this._stage.height(),i=this._tmpRect;if(this._visibilityOrRectChanged||this._rect&&(t!==this._stageWidth||r!==this._stageHeight)){var n=this._visible;e.style.display=n?"block":"none",n&&(this._rect?(U1(t,r,this._rect,i),Oa(e,t*i.x,r*i.y),K1(e,t*i.width,r*i.height),G1(e)):(Oa(e,0,0),Z1(e),j1(e))),this._stageWidth=t,this._stageHeight=r,this._visibilityOrRectChanged=!1}for(var s=0;s<this._hotspots.length;s++)this._hotspots[s]._update()};var Na=ue,J1=_a,e0=da,t0=Na,r0=Z,ka=st,i0=Xt,n0=Ft,Fa=$e,s0=G;function ee(e,t){this._viewer=e,this._view=t,this._layers=[],this._hotspotContainer=new t0(e._controlContainer,e.stage(),this._view,e.renderLoop()),this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotContainerHandler=this._updateHotspotContainer.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotContainerHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._view.addEventListener("change",this._viewChangeHandler),this._updateHotspotContainer()}r0(ee),ee.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotContainerHandler),this._movement&&this.stopMovement(),this._hotspotContainer.destroy(),this.destroyAllLayers(),s0(this)},ee.prototype.hotspotContainer=function(){return this._hotspotContainer},ee.prototype.layer=function(){return this._layers[0]},ee.prototype.listLayers=function(){return[].concat(this._layers)},ee.prototype.view=function(){return this._view},ee.prototype.viewer=function(){return this._viewer},ee.prototype.visible=function(){return this._viewer.scene()===this},ee.prototype.createLayer=function(e){e=e||{};var t=e.textureStoreOpts||{},r=e.layerOpts||{},i=e.source,n=e.geometry,s=this._view,a=this._viewer.stage(),o=new e0(i,a,t),l=new J1(i,n,s,o,r);return this._layers.push(l),e.pinFirstLevel&&l.pinFirstLevel(),this.emit("layerChange"),l},ee.prototype.destroyLayer=function(e){var t=this._layers.indexOf(e);if(t<0)throw new Error("No such layer in scene");this._layers.splice(t,1),this.emit("layerChange"),e.textureStore().destroy(),e.destroy()},ee.prototype.destroyAllLayers=function(){for(;this._layers.length>0;)this.destroyLayer(this._layers[0])},ee.prototype.switchTo=function(e,t){return this._viewer.switchScene(this,e,t)},ee.prototype.lookTo=function(e,t,r){var i=this;if(t=t||{},r=r||i0,n0(e)!=="object")throw new Error("Target view parameters must be an object");var n=function(_){return(_*=2)<1?.5*_*_:-.5*(--_*(_-2)-1)},s=t.ease!=null?t.ease:n,a=t.controlsInterrupt!=null?t.controlsInterrupt:!1,o=t.transitionDuration!=null?t.transitionDuration:1e3,l=t.shortest!=null?t.shortest:!0,h=this._view,c=h.parameters(),f={};Fa(f,e),Fa(f,c),l&&h.normalizeToClosest&&h.normalizeToClosest(f,f);var u=function(){var _=!1;return function(w,m){if(m>=o&&_)return null;var M=Math.min(m/o,1);for(var b in w){var $=c[b],S=f[b];w[b]=$+s(M)*(S-$)}return _=m>=o,w}},p=this._viewer.controls().enabled();a||this._viewer.controls().disable(),this.startMovement(u,function(){p&&i._viewer.controls().enable(),r()})},ee.prototype.startMovement=function(e,t){var r=this._viewer.renderLoop();this._movement&&this.stopMovement();var i=e();if(typeof i!="function")throw new Error("Bad movement");this._movement=e,this._movementStep=i,this._movementStartTime=ka(),this._movementParams={},this._movementCallback=t,r.addEventListener("beforeRender",this._updateMovementHandler),r.renderOnNextFrame()},ee.prototype.stopMovement=function(){var e=this._movementCallback,t=this._viewer.renderLoop();!this._movement||(this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null,t.removeEventListener("beforeRender",this._updateMovementHandler),e&&e())},ee.prototype.movement=function(){return this._movement},ee.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var e=this._viewer.renderLoop(),t=this._view,r=ka()-this._movementStartTime,i=this._movementStep,n=this._movementParams;n=t.parameters(n),n=i(n,r),n==null?this.stopMovement():(t.setParameters(n),e.renderOnNextFrame())},ee.prototype._updateHotspotContainer=function(){this.visible()?this._hotspotContainer.show():this._hotspotContainer.hide()};var Va=ee,a0=Z,o0=$e,qa=st,h0={duration:1/0};function Se(e){e=o0(e||{},h0),this._duration=e.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}a0(Se),Se.prototype.start=function(){this._startTime=qa(),this._handle==null&&this._duration<1/0&&this._setup(this._duration)},Se.prototype.started=function(){return this._startTime!=null},Se.prototype.stop=function(){this._startTime=null,this._handle!=null&&(clearTimeout(this._handle),this._handle=null)},Se.prototype._setup=function(e){this._handle=setTimeout(this._check,e)},Se.prototype._teardown=function(){clearTimeout(this._handle),this._handle=null},Se.prototype._check=function(){var e=qa(),t=e-this._startTime,r=this._duration-t;this._teardown(),r<=0?(this.emit("timeout"),this._startTime=null):r<1/0&&this._setup(r)},Se.prototype.duration=function(){return this._duration},Se.prototype.setDuration=function(e){this._duration=e,this._startTime!=null&&this._check()};var l0=Se,c0=$e,v0=G,f0={active:"move",inactive:"default",disabled:"default"};function zt(e,t,r,i){i=c0(i||{},f0),this._element=r,this._controls=e,this._id=t,this._attached=!1,this._setActiveCursor=this._setCursor.bind(this,i.active),this._setInactiveCursor=this._setCursor.bind(this,i.inactive),this._setDisabledCursor=this._setCursor.bind(this,i.disabled),this._setOriginalCursor=this._setCursor.bind(this,this._element.style.cursor),this._updateAttachmentHandler=this._updateAttachment.bind(this),e.addEventListener("methodEnabled",this._updateAttachmentHandler),e.addEventListener("methodDisabled",this._updateAttachmentHandler),e.addEventListener("enabled",this._updateAttachmentHandler),e.addEventListener("disabled",this._updateAttachmentHandler),this._updateAttachment()}zt.prototype.destroy=function(){this._detachFromControlMethod(this._controls.method(this._id)),this._setOriginalCursor(),this._controls.removeEventListener("methodEnabled",this._updateAttachmentHandler),this._controls.removeEventListener("methodDisabled",this._updateAttachmentHandler),this._controls.removeEventListener("enabled",this._updateAttachmentHandler),this._controls.removeEventListener("disabled",this._updateAttachmentHandler),v0(this)},zt.prototype._updateAttachment=function(){var e=this._controls,t=this._id;e.enabled()&&e.method(t).enabled?this._attachToControlMethod(e.method(t)):this._detachFromControlMethod(e.method(t))},zt.prototype._attachToControlMethod=function(e){this._attached||(e.instance.addEventListener("active",this._setActiveCursor),e.instance.addEventListener("inactive",this._setInactiveCursor),e.active?this._setActiveCursor():this._setInactiveCursor(),this._attached=!0)},zt.prototype._detachFromControlMethod=function(e){this._attached&&(e.instance.removeEventListener("active",this._setActiveCursor),e.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor(),this._attached=!1)},zt.prototype._setCursor=function(e){this._element.style.cursor=e};var u0=zt,d0=$e,Oi=Ea,p0=$a,_0=Ca,m0=La,_e=ya,y0={mouseViewMode:"drag",dragMode:"pan"};function g0(e,t,r){r=d0(r||{},y0);var i={mouseViewDrag:new Oi(t,"mouse"),mouseViewQtvr:new p0(t,"mouse"),leftArrowKey:new _e(37,"x",-.7,3),rightArrowKey:new _e(39,"x",.7,3),upArrowKey:new _e(38,"y",-.7,3),downArrowKey:new _e(40,"y",.7,3),plusKey:new _e(107,"zoom",-.7,3),minusKey:new _e(109,"zoom",.7,3),wKey:new _e(87,"y",-.7,3),aKey:new _e(65,"x",-.7,3),sKey:new _e(83,"y",.7,3),dKey:new _e(68,"x",.7,3),qKey:new _e(81,"roll",.7,3),eKey:new _e(69,"roll",-.7,3)},n=["scrollZoom","touchView","pinch"];r.scrollZoom!==!1&&(i.scrollZoom=new _0(t));var s={arrowKeys:["leftArrowKey","rightArrowKey","upArrowKey","downArrowKey"],plusMinusKeys:["plusKey","minusKey"],wasdKeys:["wKey","aKey","sKey","dKey"],qeKeys:["qKey","eKey"]};switch(r.dragMode){case"pinch":i.pinch=new Oi(t,"touch",{hammerEvent:"pinch"});break;case"pan":i.touchView=new Oi(t,"touch"),i.pinch=new m0(t,"touch");break;default:throw new Error("Unknown drag mode: "+r.dragMode)}switch(r.mouseViewMode){case"drag":n.push("mouseViewDrag");break;case"qtvr":n.push("mouseViewQtvr");break;default:throw new Error("Unknown mouse view mode: "+r.mouseViewMode)}for(var a in i){var o=i[a];e.registerMethod(a,o),n.indexOf(a)>=0&&e.enableMethod(a)}for(var l in s){var h=s[l];e.addMethodGroup(l,h)}return i}var Wa=g0,Ya=st;function w0(e,t,r){var i=!1,n=Ya();function s(){if(!i){var a=(Ya()-n)/e;a<1?(t(a),requestAnimationFrame(s)):(t(1),r())}}return t(0),requestAnimationFrame(s),function(){i=!0,r.apply(null,arguments)}}var Xa=w0,x0=Z,M0=ma,T0=za,E0=Va,b0=l0,$0=gn,S0=u0,Ba=zr,C0=Wa,L0=Ws,P0=le.setOverflowHidden,z0=le.setAbsolute,A0=le.setFullSize,R0=Xa,I0=Xt,O0=G;function q(e,t){t=t||{},this._domElement=e,P0(e),this._stage=new $0(t.stage),L0(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),z0(this._controlContainer),A0(this._controlContainer),e.appendChild(this._controlContainer),this._size={},this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new M0(this._stage),this._controls=new T0,this._controlMethods=C0(this._controls,this._controlContainer,t.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=Ba.get(this._controlContainer,"touch"),this._hammerManagerMouse=Ba.get(this._controlContainer,"mouse"),this._dragCursor=new S0(this._controls,"mouseViewDrag",e,t.cursors&&t.cursors.drag||{}),this._renderLoop.start(),this._scenes=[],this._currentScene=null,this._replacedScene=null,this._cancelCurrentTween=null,this._layerChangeHandler=this._updateSceneLayers.bind(this),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new b0,this._idleTimer.start(),this._resetIdleTimerHandler=this._resetIdleTimer.bind(this),this.addEventListener("viewChange",this._resetIdleTimerHandler),this._triggerIdleTimerHandler=this._triggerIdleTimer.bind(this),this._idleTimer.addEventListener("timeout",this._triggerIdleTimerHandler),this._stopMovementHandler=this.stopMovement.bind(this),this._controls.addEventListener("active",this._stopMovementHandler),this.addEventListener("sceneChange",this._stopMovementHandler),this._idleMovement=null}x0(q),q.prototype.destroy=function(){window.removeEventListener("resize",this._updateSizeListener),this._currentScene&&this._removeSceneEventListeners(this._currentScene),this._replacedScene&&this._removeSceneEventListeners(this._replacedScene),this._dragCursor.destroy();for(var e in this._controlMethods)this._controlMethods[e].destroy();for(;this._scenes.length;)this.destroyScene(this._scenes[0]);this._domElement.removeChild(this._stage.domElement()),this._stage.destroy(),this._renderLoop.destroy(),this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&this._cancelCurrentTween(),O0(this)},q.prototype.updateSize=function(){var e=this._size;e.width=this._domElement.clientWidth,e.height=this._domElement.clientHeight,this._stage.setSize(e)},q.prototype.stage=function(){return this._stage},q.prototype.renderLoop=function(){return this._renderLoop},q.prototype.controls=function(){return this._controls},q.prototype.domElement=function(){return this._domElement},q.prototype.createScene=function(e){e=e||{};var t=this.createEmptyScene({view:e.view});return t.createLayer({source:e.source,geometry:e.geometry,pinFirstLevel:e.pinFirstLevel,textureStoreOpts:e.textureStoreOpts,layerOpts:e.layerOpts}),t},q.prototype.createEmptyScene=function(e){e=e||{};var t=new E0(this,e.view);return this._scenes.push(t),t},q.prototype._updateSceneLayers=function(){var e,t,r=this._stage,i=this._currentScene,n=this._replacedScene,s=r.listLayers(),a=[];if(n&&(a=a.concat(n.listLayers())),i&&(a=a.concat(i.listLayers())),Math.abs(s.length-a.length)!==1)throw new Error("Stage and scene out of sync");if(a.length<s.length){for(e=0;e<s.length;e++)if(t=s[e],a.indexOf(t)<0){this._removeLayerFromStage(t);break}}if(a.length>s.length)for(e=0;e<a.length;e++)t=a[e],s.indexOf(t)<0&&this._addLayerToStage(t,e)},q.prototype._addLayerToStage=function(e,t){e.pinFirstLevel(),this._stage.addLayer(e,t)},q.prototype._removeLayerFromStage=function(e){this._stage.removeLayer(e),e.unpinFirstLevel(),e.textureStore().clearNotPinned()},q.prototype._addSceneEventListeners=function(e){e.addEventListener("layerChange",this._layerChangeHandler),e.addEventListener("viewChange",this._viewChangeHandler)},q.prototype._removeSceneEventListeners=function(e){e.removeEventListener("layerChange",this._layerChangeHandler),e.removeEventListener("viewChange",this._viewChangeHandler)},q.prototype.destroyScene=function(e){var t=this._scenes.indexOf(e);if(t<0)throw new Error("No such scene in viewer");var r,i;if(this._currentScene===e){for(this._removeSceneEventListeners(e),i=e.listLayers(),r=0;r<i.length;r++)this._removeLayerFromStage(i[r]);this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._currentScene=null,this.emit("sceneChange")}if(this._replacedScene===e){for(this._removeSceneEventListeners(e),i=e.listLayers(),r=0;r<i.length;r++)this._removeLayerFromStage(i[r]);this._replacedScene=null}this._scenes.splice(t,1),e.destroy()},q.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},q.prototype.hasScene=function(e){return this._scenes.indexOf(e)>=0},q.prototype.listScenes=function(){return[].concat(this._scenes)},q.prototype.scene=function(){return this._currentScene},q.prototype.view=function(){var e=this._currentScene;return e?e.view():null},q.prototype.lookTo=function(e,t,r){var i=this._currentScene;i&&i.lookTo(e,t,r)},q.prototype.startMovement=function(e,t){var r=this._currentScene;!r||r.startMovement(e,t)},q.prototype.stopMovement=function(){var e=this._currentScene;!e||e.stopMovement()},q.prototype.movement=function(){var e=this._currentScene;if(!!e)return e.movement()},q.prototype.setIdleMovement=function(e,t){this._idleTimer.setDuration(e),this._idleMovement=t},q.prototype.breakIdleMovement=function(){this.stopMovement(),this._resetIdleTimer()},q.prototype._resetIdleTimer=function(){this._idleTimer.start()},q.prototype._triggerIdleTimer=function(){var e=this._idleMovement;!e||this.startMovement(e)};var D0=1e3;function H0(e,t,r){var i=t.listLayers();i.forEach(function(n){n.mergeEffects({opacity:e})}),t._hotspotContainer.domElement().style.opacity=e}q.prototype.switchScene=function(e,t,r){var i=this;t=t||{},r=r||I0;var n=this._stage,s=this._currentScene;if(s===e){r();return}if(this._scenes.indexOf(e)<0)throw new Error("No such scene in viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var a=s?s.listLayers():[],o=e.listLayers(),l=n.listLayers();if(s&&(l.length!==a.length||l.length>1&&l[0]!=a[0]))throw new Error("Stage not in sync with viewer");for(var h=t.transitionDuration!=null?t.transitionDuration:D0,c=t.transitionUpdate!=null?t.transitionUpdate:H0,f=0;f<o.length;f++)this._addLayerToStage(o[f]);function u(_){c(_,e,s)}function p(){if(i._replacedScene){i._removeSceneEventListeners(i._replacedScene),a=i._replacedScene.listLayers();for(var _=0;_<a.length;_++)i._removeLayerFromStage(a[_]);i._replacedScene=null}i._cancelCurrentTween=null,r()}this._cancelCurrentTween=R0(h,u,p),this._currentScene=e,this._replacedScene=s,this.emit("sceneChange"),this.emit("viewChange"),this._addSceneEventListeners(e)};var N0=q,Ar=ne.vec4,k0=ne.mat4;function F0(e){var t=e||{};return t.colorOffset=t.colorOffset||Ar.create(),t.colorMatrix=t.colorMatrix||k0.create(),t}function Ua(e,t,r){V0(r,e,t.colorMatrix),Ar.add(r,r,t.colorOffset)}function V0(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3];return e[0]=r[0]*i+r[1]*n+r[2]*s+r[3]*a,e[1]=r[4]*i+r[5]*n+r[6]*s+r[7]*a,e[2]=r[8]*i+r[9]*n+r[10]*s+r[11]*a,e[3]=r[12]*i+r[13]*n+r[14]*s+r[15]*a,e}var _t=Ar.create();function q0(e,t){for(var r=e.width,i=e.height,n=e.data,s=0;s<r*i;s++)Ar.set(_t,n[s*4+0]/255,n[s*4+1]/255,n[s*4+2]/255,n[s*4+3]/255),Ua(_t,t,_t),n[s*4+0]=_t[0]*255,n[s*4+1]=_t[1]*255,n[s*4+2]=_t[2]*255,n[s*4+3]=_t[3]*255}var W0={identity:F0,applyToPixel:Ua,applyToImageData:q0},Y0=$e,Di=.1,Hi=.01,X0={yawSpeed:Di,pitchSpeed:Di,fovSpeed:Di,yawAccel:Hi,pitchAccel:Hi,fovAccel:Hi,targetPitch:0,targetFov:null};function B0(e){e=Y0(e||{},X0);var t=e.yawSpeed,r=e.pitchSpeed,i=e.fovSpeed,n=e.yawAccel,s=e.pitchAccel,a=e.fovAccel,o=e.targetPitch,l=e.targetFov;return function(){var c=0,f=0,u=0,p=0,_=0,w=0,m=0,M,b,$,S;return function(E,D){if(M=(D-c)/1e3,_=Math.min(f+M*n,t),b=_*M,E.yaw=E.yaw+b,o!=null&&E.pitch!==o){var k=.5*u*u/s;Math.abs(o-E.pitch)>k?w=Math.min(u+M*s,r):w=Math.max(u-M*s,0),$=w*M,o<E.pitch&&(E.pitch=Math.max(o,E.pitch-$)),o>E.pitch&&(E.pitch=Math.min(o,E.pitch+$))}if(l!=null&&E.fov!==o){var H=.5*p*p/a;Math.abs(l-E.fov)>H?m=Math.min(p+M*a,i):m=Math.max(p-M*a,0),S=m*M,l<E.fov&&(E.fov=Math.max(l,E.fov-S)),l>E.fov&&(E.fov=Math.min(l,E.fov+S))}return c=D,f=_,u=w,p=m,E}}}var U0=B0;function G0(e,t){function r(){t&&t.length>0?e.apply(null,t):e()}setTimeout(r,0)}var j0=G0;function Z0(e){return e*Math.PI/180}var K0=Z0;function Q0(e){return e*180/Math.PI}var J0=Q0,Qt={WebGlStage:gn,WebGlCubeRenderer:Ns,WebGlFlatRenderer:Fs,WebGlEquirectRenderer:qs,registerDefaultRenderers:Ws,CubeGeometry:dp,FlatGeometry:Ep,EquirectGeometry:Pp,RectilinearView:Kp,FlatView:a_,ImageUrlSource:T_,SingleAssetSource:E_,StaticAsset:Qr,DynamicAsset:L_,TextureStore:da,Layer:_a,RenderLoop:ma,KeyControlMethod:ya,DragControlMethod:Ea,QtvrControlMethod:$a,ScrollZoomControlMethod:Ca,PinchZoomControlMethod:La,VelocityControlMethod:$1,ElementPressControlMethod:P1,Controls:za,Dynamics:ke,Viewer:N0,Scene:Va,Hotspot:Ia,HotspotContainer:Na,colorEffects:W0,registerDefaultControls:Wa,autorotate:U0,util:{async:ln,cancelize:cn,chain:Ci,clamp:Et,clearOwnProperties:G,cmp:Nt,compose:ea,convertFov:Js,decimal:$i,defaults:$e,defer:j0,degToRad:K0,delay:aa,dom:le,extend:pa,hash:Mr,inherits:Me,mod:Ue,noop:Xt,now:st,once:jr,pixelRatio:dr,radToDeg:J0,real:bi,retry:la,tween:Xa,type:Ft},dependencies:{bowser:fr.exports,glMatrix:ne,eventEmitter:Z,hammerjs:zi.exports}};function em(e){let t,r;return{c(){t=xt("div"),r=xt("div"),this.c=U,Mt(r,"class","pano"),Mt(t,"class","wrap")},m(i,n){Ye(i,t,n),or(t,r),e[2](r)},p:U,i:U,o:U,d(i){i&&it(t),e[2](null)}}}function tm(e,t,r){let{gql:i={}}=t,n;mo(()=>{const a={controls:{mouseViewMode:"drag"}},o=new Qt.Viewer(n,a),l=Qt.ImageUrlSource.fromString(i.panorama.mediaItemUrl);o.controls().enableMethodGroup("arrowKeys");const h=new Qt.EquirectGeometry([{width:4e3}]),c=Qt.RectilinearView.limit.traditional(1024,100*Math.PI/180),f=new Qt.RectilinearView({yaw:Math.PI},c);o.createScene({source:l,geometry:h,view:f,pinFirstLevel:!0}).switchTo()});function s(a){Wr[a?"unshift":"push"](()=>{n=a,r(0,n)})}return e.$$set=a=>{"gql"in a&&r(1,i=a.gql)},[n,i,s]}class rm extends Ur{constructor(t){super();this.shadowRoot.innerHTML="<style>*,*:before,*:after{box-sizing:inherit}.wrap{position:relative;padding-bottom:56.25%;height:0;overflow:hidden}.pano{position:absolute;top:0;left:0;width:100%;height:100%}</style>",sn(this,{target:this.shadowRoot,props:Qi(this.attributes),customElement:!0},tm,em,Ki,{gql:1},null),t&&(t.target&&Ye(t.target,this,t.anchor),t.props&&(this.$set(t.props),Xe()))}static get observedAttributes(){return["gql"]}get gql(){return this.$$.ctx[1]}set gql(t){this.$$set({gql:t}),Xe()}}customElements.define("vepple-panorama",rm);function im(e){return{c:U,m:U,p:U,d:U}}function nm(e){let t;return{c(){t=xt("vepple-panorama"),uo(t,"gql",e[0])},m(r,i){Ye(r,t,i)},p:U,d(r){r&&it(t)}}}function sm(e){return{c:U,m:U,p:U,d:U}}function am(e){let t,r=e[6].message+"",i;return{c(){t=xt("p"),i=hr(r),_o(t,"color","red")},m(n,s){Ye(n,t,s),or(t,i)},p:U,d(n){n&&it(t)}}}function om(e){let t,r,i=e[1].ctaText+"",n;return{c(){t=xt("div"),r=xt("a"),n=hr(i),Mt(r,"part","link"),Mt(r,"href",e[1].ctaUrl),Mt(t,"part","content")},m(s,a){Ye(s,t,a),or(t,r),or(r,n)},p:U,d(s){s&&it(t)}}}function hm(e){return{c:U,m:U,p:U,d:U}}function lm(e){let t,r,i={ctx:e,current:null,token:null,hasCatch:!1,pending:sm,then:nm,catch:im,value:0};rn(e[0],i);let n={ctx:e,current:null,token:null,hasCatch:!0,pending:hm,then:om,catch:am,value:1,error:6};return rn(e[1],n),{c(){i.block.c(),t=vo(),r=fo(),n.block.c(),this.c=U},m(s,a){i.block.m(s,i.anchor=a),i.mount=()=>t.parentNode,i.anchor=t,Ye(s,t,a),Ye(s,r,a),n.block.m(s,n.anchor=a),n.mount=()=>r.parentNode,n.anchor=r},p(s,[a]){e=s,nn(i,e,a),nn(n,e,a)},i:U,o:U,d(s){i.block.d(s),i.token=null,i=null,s&&it(t),s&&it(r),n.block.d(s),n.token=null,n=null}}}function cm(e,t,r){let{post:i}=t,{api:n}=t;async function s(){const h=await fetch(`${n}/wp-json/rv/v1/settings`),c=await h.json();if(h.ok)return c.ctas[0];throw new Error(c)}async function a(){const h=await fetch(`${n}/graphql`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
            query MyQuery($name: String!) {
              posts(where: {name: $name}) {
                  nodes {
                    slug
                    postContent {
                      panorama {
                        title(format: RAW)
                        mediaItemUrl
                        sourceUrl(size: MEDIUM_LARGE)
                      }
                      position {
                        horizontal
                        vertical
                      }
                    }
                  }
                }
            }
      `,variables:{name:i}})}),c=await h.json();if(h.ok)return c.data.posts.nodes[0].postContent;throw new Error(c)}const o=a();let l=s();return e.$$set=h=>{"post"in h&&r(2,i=h.post),"api"in h&&r(3,n=h.api)},[o,l,i,n]}class vm extends Ur{constructor(t){super();this.shadowRoot.innerHTML="<style>*,*:before,*:after{box-sizing:inherit}</style>",sn(this,{target:this.shadowRoot,props:Qi(this.attributes),customElement:!0},cm,lm,Ki,{post:2,api:3},null),t&&(t.target&&Ye(t.target,this,t.anchor),t.props&&(this.$set(t.props),Xe()))}static get observedAttributes(){return["post","api"]}get post(){return this.$$.ctx[2]}set post(t){this.$$set({post:t}),Xe()}get api(){return this.$$.ctx[3]}set api(t){this.$$set({api:t}),Xe()}}customElements.define("vepple-embed",vm)});
